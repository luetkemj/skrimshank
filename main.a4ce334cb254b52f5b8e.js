/*! For license information please see main.a4ce334cb254b52f5b8e.js.LICENSE.txt */
(()=>{var __webpack_modules__={718:module=>{"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},277:module=>{"use strict";module.exports=({onlyFirst=!1}={})=>{const pattern=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(pattern,onlyFirst?void 0:"g")}},187:module=>{"use strict";function earcut(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;if(hasHoles&&(outerNode=function(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)(list=linkedList(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)outerNode=filterPoints(outerNode=eliminateHole(queue[i],outerNode),outerNode.next);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)(x=data[i])<minX&&(minX=x),(y=data[i+1])<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?1/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function(start,minX,minY,invSize){var p=start;do{null===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1)}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(filterPoints(ear),triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return filterPoints(p)}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize),void earcutLinked(c,triangles,dim,minX,minY,invSize)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){var bridge=function(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){if(qx=x,x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m;do{hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&(tan=Math.abs(hy-p.y)/(hx-p.x),locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))&&(m=p,tanMin=tan)),p=p.next}while(p!==stop);return m}(hole,outerNode);if(!bridge)return outerNode;var bridgeReverse=splitPolygon(bridge,hole),filteredBridge=filterPoints(bridge,bridge.next);return filterPoints(bridgeReverse,bridgeReverse.next),outerNode===bridge?filteredBridge:outerNode}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=32767*(x-minX)*invSize)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=32767*(y-minY)*invSize)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){var p=start,leftmost=start;do{(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&function(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){var o1=sign(area(p1,q1,p2)),o2=sign(area(p1,q1,q2)),o3=sign(area(p2,q2,p1)),o4=sign(area(p2,q2,q1));return o1!==o2&&o3!==o4||(!(0!==o1||!onSegment(p1,p2,q1))||(!(0!==o2||!onSegment(p1,q2,q1))||(!(0!==o3||!onSegment(p2,p1,q2))||!(0!==o4||!onSegment(p2,q1,q2)))))}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign(num){return num>0?1:num<0?-1:0}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}module.exports=earcut,module.exports.default=earcut,earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&(holeIndex+=data[i-1].length,result.holes.push(holeIndex))}return result}},991:module=>{"use strict";module.exports=function(){return/\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F|\uD83D\uDC68(?:\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68\uD83C\uDFFB|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFE])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|[\u2695\u2696\u2708]\uFE0F|\uD83D[\uDC66\uDC67]|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|(?:\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708])\uFE0F|\uD83C\uDFFB\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C[\uDFFB-\uDFFF])|(?:\uD83E\uDDD1\uD83C\uDFFB\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)\uD83C\uDFFB|\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1)|(?:\uD83E\uDDD1\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69]))(?:\uD83C[\uDFFB-\uDFFE])|(?:\uD83E\uDDD1\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)(?:\uD83C[\uDFFB\uDFFC])|\uD83D\uDC69(?:\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFC-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD]))|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83E\uDDD1\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFD])|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708]|\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F|\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|\uD83C\uDFF4\u200D\u2620)\uFE0F|\uD83D\uDC69\u200D\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|\uD83D\uDC15\u200D\uD83E\uDDBA|\uD83D\uDC69\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC67|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDF6\uD83C\uDDE6|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD0F\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDBB\uDDD2-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5\uDEEB\uDEEC\uDEF4-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])\uFE0F|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD])/g}},485:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__(894)},894:function(module,__unused_webpack_exports,__webpack_require__){module=__webpack_require__.nmd(module),function(){var Heap,defaultCmp,floor,heapify,heappop,heappush,heappushpop,heapreplace,insort,min,nlargest,nsmallest,updateItem,_siftdown,_siftup;floor=Math.floor,min=Math.min,defaultCmp=function(x,y){return x<y?-1:x>y?1:0},insort=function(a,x,lo,hi,cmp){var mid;if(null==lo&&(lo=0),null==cmp&&(cmp=defaultCmp),lo<0)throw new Error("lo must be non-negative");for(null==hi&&(hi=a.length);lo<hi;)cmp(x,a[mid=floor((lo+hi)/2)])<0?hi=mid:lo=mid+1;return[].splice.apply(a,[lo,lo-lo].concat(x)),x},heappush=function(array,item,cmp){return null==cmp&&(cmp=defaultCmp),array.push(item),_siftdown(array,0,array.length-1,cmp)},heappop=function(array,cmp){var lastelt,returnitem;return null==cmp&&(cmp=defaultCmp),lastelt=array.pop(),array.length?(returnitem=array[0],array[0]=lastelt,_siftup(array,0,cmp)):returnitem=lastelt,returnitem},heapreplace=function(array,item,cmp){var returnitem;return null==cmp&&(cmp=defaultCmp),returnitem=array[0],array[0]=item,_siftup(array,0,cmp),returnitem},heappushpop=function(array,item,cmp){var _ref;return null==cmp&&(cmp=defaultCmp),array.length&&cmp(array[0],item)<0&&(item=(_ref=[array[0],item])[0],array[0]=_ref[1],_siftup(array,0,cmp)),item},heapify=function(array,cmp){var i,_i,_len,_ref1,_results,_results1;for(null==cmp&&(cmp=defaultCmp),_ref1=function(){_results1=[];for(var _j=0,_ref=floor(array.length/2);0<=_ref?_j<_ref:_j>_ref;0<=_ref?_j++:_j--)_results1.push(_j);return _results1}.apply(this).reverse(),_results=[],_i=0,_len=_ref1.length;_i<_len;_i++)i=_ref1[_i],_results.push(_siftup(array,i,cmp));return _results},updateItem=function(array,item,cmp){var pos;if(null==cmp&&(cmp=defaultCmp),-1!==(pos=array.indexOf(item)))return _siftdown(array,0,pos,cmp),_siftup(array,pos,cmp)},nlargest=function(array,n,cmp){var elem,result,_i,_len,_ref;if(null==cmp&&(cmp=defaultCmp),!(result=array.slice(0,n)).length)return result;for(heapify(result,cmp),_i=0,_len=(_ref=array.slice(n)).length;_i<_len;_i++)elem=_ref[_i],heappushpop(result,elem,cmp);return result.sort(cmp).reverse()},nsmallest=function(array,n,cmp){var elem,los,result,_i,_j,_len,_ref,_ref1,_results;if(null==cmp&&(cmp=defaultCmp),10*n<=array.length){if(!(result=array.slice(0,n).sort(cmp)).length)return result;for(los=result[result.length-1],_i=0,_len=(_ref=array.slice(n)).length;_i<_len;_i++)cmp(elem=_ref[_i],los)<0&&(insort(result,elem,0,null,cmp),result.pop(),los=result[result.length-1]);return result}for(heapify(array,cmp),_results=[],_j=0,_ref1=min(n,array.length);0<=_ref1?_j<_ref1:_j>_ref1;0<=_ref1?++_j:--_j)_results.push(heappop(array,cmp));return _results},_siftdown=function(array,startpos,pos,cmp){var newitem,parent,parentpos;for(null==cmp&&(cmp=defaultCmp),newitem=array[pos];pos>startpos&&cmp(newitem,parent=array[parentpos=pos-1>>1])<0;)array[pos]=parent,pos=parentpos;return array[pos]=newitem},_siftup=function(array,pos,cmp){var childpos,endpos,newitem,rightpos,startpos;for(null==cmp&&(cmp=defaultCmp),endpos=array.length,startpos=pos,newitem=array[pos],childpos=2*pos+1;childpos<endpos;)(rightpos=childpos+1)<endpos&&!(cmp(array[childpos],array[rightpos])<0)&&(childpos=rightpos),array[pos]=array[childpos],childpos=2*(pos=childpos)+1;return array[pos]=newitem,_siftdown(array,startpos,pos,cmp)},Heap=function(){function Heap(cmp){this.cmp=null!=cmp?cmp:defaultCmp,this.nodes=[]}return Heap.push=heappush,Heap.pop=heappop,Heap.replace=heapreplace,Heap.pushpop=heappushpop,Heap.heapify=heapify,Heap.updateItem=updateItem,Heap.nlargest=nlargest,Heap.nsmallest=nsmallest,Heap.prototype.push=function(x){return heappush(this.nodes,x,this.cmp)},Heap.prototype.pop=function(){return heappop(this.nodes,this.cmp)},Heap.prototype.peek=function(){return this.nodes[0]},Heap.prototype.contains=function(x){return-1!==this.nodes.indexOf(x)},Heap.prototype.replace=function(x){return heapreplace(this.nodes,x,this.cmp)},Heap.prototype.pushpop=function(x){return heappushpop(this.nodes,x,this.cmp)},Heap.prototype.heapify=function(){return heapify(this.nodes,this.cmp)},Heap.prototype.updateItem=function(x){return updateItem(this.nodes,x,this.cmp)},Heap.prototype.clear=function(){return this.nodes=[]},Heap.prototype.empty=function(){return 0===this.nodes.length},Heap.prototype.size=function(){return this.nodes.length},Heap.prototype.clone=function(){var heap;return(heap=new Heap).nodes=this.nodes.slice(0),heap},Heap.prototype.toArray=function(){return this.nodes.slice(0)},Heap.prototype.insert=Heap.prototype.push,Heap.prototype.top=Heap.prototype.peek,Heap.prototype.front=Heap.prototype.peek,Heap.prototype.has=Heap.prototype.contains,Heap.prototype.copy=Heap.prototype.clone,Heap}(),(null!==module?module.exports:void 0)?module.exports=Heap:window.Heap=Heap}.call(this)},903:module=>{"use strict";const isFullwidthCodePoint=codePoint=>!Number.isNaN(codePoint)&&(codePoint>=4352&&(codePoint<=4447||9001===codePoint||9002===codePoint||11904<=codePoint&&codePoint<=12871&&12351!==codePoint||12880<=codePoint&&codePoint<=19903||19968<=codePoint&&codePoint<=42182||43360<=codePoint&&codePoint<=43388||44032<=codePoint&&codePoint<=55203||63744<=codePoint&&codePoint<=64255||65040<=codePoint&&codePoint<=65049||65072<=codePoint&&codePoint<=65131||65281<=codePoint&&codePoint<=65376||65504<=codePoint&&codePoint<=65510||110592<=codePoint&&codePoint<=110593||127488<=codePoint&&codePoint<=127569||131072<=codePoint&&codePoint<=262141));module.exports=isFullwidthCodePoint,module.exports.default=isFullwidthCodePoint},486:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;module=__webpack_require__.nmd(module),function(){var FUNC_ERROR_TEXT="Expected a function",PLACEHOLDER="__lodash_placeholder__",wrapFlags=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source),reTrimStart=/^\s+/,reWhitespace=/\s/,reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /,reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,reForbiddenIdentifierChars=/[()=,{}\[\]\/\s]/,reEscapeChar=/\\(\\)?/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsOctal=/^0o[0-7]+$/i,reIsUint=/^(?:0|[1-9]\d*)$/,reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,rsComboRange="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",rsBreakRange="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsAstral="[\\ud800-\\udfff]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="[\\u2700-\\u27bf]",rsLower="[a-z\\xdf-\\xf6\\xf8-\\xff]",rsMisc="[^\\ud800-\\udfff"+rsBreakRange+rsDigits+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsNonAstral="[^\\ud800-\\udfff]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",reOptMod="(?:"+rsCombo+"|"+rsFitz+")"+"?",rsSeq="[\\ufe0e\\ufe0f]?"+reOptMod+("(?:\\u200d(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")[\\ufe0e\\ufe0f]?"+reOptMod+")*"),rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reApos=RegExp("['’]","g"),reComboMark=RegExp(rsCombo,"g"),reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g"),reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+(?:['’](?:d|ll|m|re|s|t|ve))?",rsUpper+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rsDigits,rsEmoji].join("|"),"g"),reHasUnicode=RegExp("[\\u200d\\ud800-\\udfff"+rsComboRange+"\\ufe0e\\ufe0f]"),reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],templateCounter=-1,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},freeParseFloat=parseFloat,freeParseInt=parseInt,freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports=exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,freeProcess=moduleExports&&freeGlobal.process,nodeUtil=function(){try{var types=freeModule&&freeModule.require&&freeModule.require("util").types;return types||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){for(var index=-1,length=null==array?0:array.length;++index<length;){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){for(var index=-1,length=null==array?0:array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}function arrayEachRight(array,iteratee){for(var length=null==array?0:array.length;length--&&!1!==iteratee(array[length],length,array););return array}function arrayEvery(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}function arrayFilter(array,predicate){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}function arrayIncludes(array,value){return!!(null==array?0:array.length)&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){for(var index=-1,length=null==array?0:array.length;++index<length;)if(comparator(value,array[index]))return!0;return!1}function arrayMap(array,iteratee){for(var index=-1,length=null==array?0:array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=null==array?0:array.length;for(initAccum&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=null==array?0:array.length;for(initAccum&&length&&(accumulator=array[--length]);length--;)accumulator=iteratee(accumulator,array[length],length,array);return accumulator}function arraySome(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}var asciiSize=baseProperty("length");function baseFindKey(collection,predicate,eachFunc){var result;return eachFunc(collection,(function(value,key,collection){if(predicate(value,key,collection))return result=key,!1})),result}function baseFindIndex(array,predicate,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?1:-1);fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}function baseIndexOf(array,value,fromIndex){return value==value?function(array,value,fromIndex){var index=fromIndex-1,length=array.length;for(;++index<length;)if(array[index]===value)return index;return-1}(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}function baseIndexOfWith(array,value,fromIndex,comparator){for(var index=fromIndex-1,length=array.length;++index<length;)if(comparator(array[index],value))return index;return-1}function baseIsNaN(value){return value!=value}function baseMean(array,iteratee){var length=null==array?0:array.length;return length?baseSum(array,iteratee)/length:NaN}function baseProperty(key){return function(object){return null==object?undefined:object[key]}}function basePropertyOf(object){return function(key){return null==object?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){return eachFunc(collection,(function(value,index,collection){accumulator=initAccum?(initAccum=!1,value):iteratee(accumulator,value,index,collection)})),accumulator}function baseSum(array,iteratee){for(var result,index=-1,length=array.length;++index<length;){var current=iteratee(array[index]);undefined!==current&&(result=undefined===result?current:result+current)}return result}function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}function baseTrim(string){return string?string.slice(0,trimmedEndIndex(string)+1).replace(reTrimStart,""):string}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,(function(key){return object[key]}))}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){for(var index=-1,length=strSymbols.length;++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1;);return index}function charsEndIndex(strSymbols,chrSymbols){for(var index=strSymbols.length;index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1;);return index}function countHolders(array,placeholder){for(var length=array.length,result=0;length--;)array[length]===placeholder&&++result;return result}var deburrLetter=basePropertyOf({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),escapeHtmlChar=basePropertyOf({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function hasUnicode(string){return reHasUnicode.test(string)}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach((function(value,key){result[++index]=[key,value]})),result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=0,result=[];++index<length;){var value=array[index];value!==placeholder&&value!==PLACEHOLDER||(array[index]=PLACEHOLDER,result[resIndex++]=index)}return result}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach((function(value){result[++index]=value})),result}function setToPairs(set){var index=-1,result=Array(set.size);return set.forEach((function(value){result[++index]=[value,value]})),result}function stringSize(string){return hasUnicode(string)?function(string){var result=reUnicode.lastIndex=0;for(;reUnicode.test(string);)++result;return result}(string):asciiSize(string)}function stringToArray(string){return hasUnicode(string)?function(string){return string.match(reUnicode)||[]}(string):function(string){return string.split("")}(string)}function trimmedEndIndex(string){for(var index=string.length;index--&&reWhitespace.test(string.charAt(index)););return index}var unescapeHtmlChar=basePropertyOf({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var _=function runInContext(context){var uid,Array=(context=null==context?root:_.defaults(root.Object(),context,_.pick(root,contextProps))).Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=context["__core-js_shared__"],funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,idCounter=0,maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",nativeObjectToString=objectProto.toString,objectCtorString=funcToString.call(Object),oldDash=root._,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?context.Buffer:undefined,Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined,symIterator=Symbol?Symbol.iterator:undefined,symToStringTag=Symbol?Symbol.toStringTag:undefined,defineProperty=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}(),ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout,nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse,DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create"),metaMap=WeakMap&&new WeakMap,realNames={},dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto))return{};if(objectCreate)return objectCreate(proto);object.prototype=proto;var result=new object;return object.prototype=undefined,result}}();function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value,this.__actions__=[],this.__chain__=!!chainAll,this.__index__=0,this.__values__=undefined}function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function SetCache(values){var index=-1,length=null==values?0:values.length;for(this.__data__=new MapCache;++index<length;)this.add(values[index])}function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:undefined}function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length))}function arrayShuffle(array){return shuffleSelf(copyArray(array))}function assignMergeValue(object,key,value){(undefined!==value&&!eq(object[key],value)||undefined===value&&!(key in object))&&baseAssignValue(object,key,value)}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(undefined!==value||key in object)||baseAssignValue(object,key,value)}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseAggregator(collection,setter,iteratee,accumulator){return baseEach(collection,(function(value,key,collection){setter(accumulator,value,iteratee(value),collection)})),accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignValue(object,key,value){"__proto__"==key&&defineProperty?defineProperty(object,key,{configurable:!0,enumerable:!0,value,writable:!0}):object[key]=value}function baseAt(object,paths){for(var index=-1,length=paths.length,result=Array(length),skip=null==object;++index<length;)result[index]=skip?undefined:get(object,paths[index]);return result}function baseClamp(number,lower,upper){return number==number&&(undefined!==upper&&(number=number<=upper?number:upper),undefined!==lower&&(number=number>=lower?number:lower)),number}function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=1&bitmask,isFlat=2&bitmask,isFull=4&bitmask;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),undefined!==result)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=function(array){var length=array.length,result=new array.constructor(length);length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input);return result}(value),!isDeep)return copyArray(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value))return cloneBuffer(value,isDeep);if(tag==objectTag||tag==argsTag||isFunc&&!object){if(result=isFlat||isFunc?{}:initCloneObject(value),!isDeep)return isFlat?function(source,object){return copyObject(source,getSymbolsIn(source),object)}(value,function(object,source){return object&&copyObject(source,keysIn(source),object)}(result,value)):function(source,object){return copyObject(source,getSymbols(source),object)}(value,baseAssign(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=function(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return function(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return new Ctor;case numberTag:case stringTag:return new Ctor(object);case regexpTag:return function(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result}(object);case setTag:return new Ctor;case symbolTag:return symbol=object,symbolValueOf?Object(symbolValueOf.call(symbol)):{}}var symbol}(value,tag,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked)return stacked;stack.set(value,result),isSet(value)?value.forEach((function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))})):isMap(value)&&value.forEach((function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))}));var props=isArr?undefined:(isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys)(value);return arrayEach(props||value,(function(subValue,key){props&&(subValue=value[key=subValue]),assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))})),result}function baseConformsTo(object,source,props){var length=props.length;if(null==object)return!length;for(object=Object(object);length--;){var key=props[length],predicate=source[key],value=object[key];if(undefined===value&&!(key in object)||!predicate(value))return!1}return!0}function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout((function(){func.apply(undefined,args)}),wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=!0,length=array.length,result=[],valuesLength=values.length;if(!length)return result;iteratee&&(values=arrayMap(values,baseUnary(iteratee))),comparator?(includes=arrayIncludesWith,isCommon=!1):values.length>=200&&(includes=cacheHas,isCommon=!1,values=new SetCache(values));outer:for(;++index<length;){var value=array[index],computed=null==iteratee?value:iteratee(value);if(value=comparator||0!==value?value:0,isCommon&&computed==computed){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===computed)continue outer;result.push(value)}else includes(values,computed,comparator)||result.push(value)}return result}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=function(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0},Hash.prototype.delete=function(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result},Hash.prototype.get=function(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined},Hash.prototype.has=function(key){var data=this.__data__;return nativeCreate?undefined!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&undefined===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function(){this.__data__=[],this.size=0},ListCache.prototype.delete=function(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,!0)},ListCache.prototype.get=function(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]},ListCache.prototype.has=function(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this},MapCache.prototype.clear=function(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function(key){var result=getMapData(this,key).delete(key);return this.size-=result?1:0,result},MapCache.prototype.get=function(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function(value){return this.__data__.set(value,"__lodash_hash_undefined__"),this},SetCache.prototype.has=function(value){return this.__data__.has(value)},Stack.prototype.clear=function(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function(key){var data=this.__data__,result=data.delete(key);return this.size=data.size,result},Stack.prototype.get=function(key){return this.__data__.get(key)},Stack.prototype.has=function(key){return this.__data__.has(key)},Stack.prototype.set=function(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<199)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new MapCache(pairs)}return data.set(key,value),this.size=data.size,this};var baseEach=createBaseEach(baseForOwn),baseEachRight=createBaseEach(baseForOwnRight,!0);function baseEvery(collection,predicate){var result=!0;return baseEach(collection,(function(value,index,collection){return result=!!predicate(value,index,collection)})),result}function baseExtremum(array,iteratee,comparator){for(var index=-1,length=array.length;++index<length;){var value=array[index],current=iteratee(value);if(null!=current&&(undefined===computed?current==current&&!isSymbol(current):comparator(current,computed)))var computed=current,result=value}return result}function baseFilter(collection,predicate){var result=[];return baseEach(collection,(function(value,index,collection){predicate(value,index,collection)&&result.push(value)})),result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate||(predicate=isFlattenable),result||(result=[]);++index<length;){var value=array[index];depth>0&&predicate(value)?depth>1?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}var baseFor=createBaseFor(),baseForRight=createBaseFor(!0);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,(function(key){return isFunction(object[key])}))}function baseGet(object,path){for(var index=0,length=(path=castPath(path,object)).length;null!=object&&index<length;)object=object[toKey(path[index++])];return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){return null==value?undefined===value?"[object Undefined]":"[object Null]":symToStringTag&&symToStringTag in Object(value)?function(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]);return result}(value):function(value){return nativeObjectToString.call(value)}(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return null!=object&&hasOwnProperty.call(object,key)}function baseHasIn(object,key){return null!=object&&key in Object(object)}function baseIntersection(arrays,iteratee,comparator){for(var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=1/0,result=[];othIndex--;){var array=arrays[othIndex];othIndex&&iteratee&&(array=arrayMap(array,baseUnary(iteratee))),maxLength=nativeMin(array.length,maxLength),caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:for(;++index<length&&result.length<maxLength;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){for(othIndex=othLength;--othIndex;){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator)))continue outer}seen&&seen.push(computed),result.push(value)}}return result}function baseInvoke(object,path,args){var func=null==(object=parent(object,path=castPath(path,object)))?object:object[toKey(last(path))];return null==func?undefined:apply(func,object,args)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!=value&&other!=other:function(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other),objIsObj=(objTag=objTag==argsTag?objectTag:objTag)==objectTag,othIsObj=(othTag=othTag==argsTag?objectTag:othTag)==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other))return!1;objIsArr=!0,objIsObj=!1}if(isSameTag&&!objIsObj)return stack||(stack=new Stack),objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):function(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case arrayBufferTag:return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=1&bitmask;if(convert||(convert=setToArray),object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=2,stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack.delete(object),result;case symbolTag:if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(1&bitmask)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;return stack||(stack=new Stack),equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag)return!1;return stack||(stack=new Stack),function(object,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,objProps=getAllKeys(object),objLength=objProps.length,othLength=getAllKeys(other).length;if(objLength!=othLength&&!isPartial)return!1;var index=objLength;for(;index--;){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key)))return!1}var objStacked=stack.get(object),othStacked=stack.get(other);if(objStacked&&othStacked)return objStacked==other&&othStacked==object;var result=!0;stack.set(object,other),stack.set(other,object);var skipCtor=isPartial;for(;++index<objLength;){var objValue=object[key=objProps[index]],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(undefined===compared?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor==othCtor||!("constructor"in object)||!("constructor"in other)||"function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor||(result=!1)}return stack.delete(object),stack.delete(other),result}(object,other,bitmask,customizer,equalFunc,stack)}(value,other,bitmask,customizer,baseIsEqual,stack))}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=Object(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){var key=(data=matchData[index])[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(undefined===objValue&&!(key in object))return!1}else{var stack=new Stack;if(customizer)var result=customizer(objValue,srcValue,key,object,source,stack);if(!(undefined===result?baseIsEqual(srcValue,objValue,3,customizer,stack):result))return!1}}return!0}function baseIsNative(value){return!(!isObject(value)||(func=value,maskSrcKey&&maskSrcKey in func))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value));var func}function baseIteratee(value){return"function"==typeof value?value:null==value?identity:"object"==typeof value?isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}function baseKeys(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}function baseKeysIn(object){if(!isObject(object))return function(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result}(object);var isProto=isPrototype(object),result=[];for(var key in object)("constructor"!=key||!isProto&&hasOwnProperty.call(object,key))&&result.push(key);return result}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,(function(value,key,collection){result[++index]=iteratee(value,key,collection)})),result}function baseMatches(source){var matchData=getMatchData(source);return 1==matchData.length&&matchData[0][2]?matchesStrictComparable(matchData[0][0],matchData[0][1]):function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){return isKey(path)&&isStrictComparable(srcValue)?matchesStrictComparable(toKey(path),srcValue):function(object){var objValue=get(object,path);return undefined===objValue&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,3)}}function baseMerge(object,source,srcIndex,customizer,stack){object!==source&&baseFor(source,(function(srcValue,key){if(stack||(stack=new Stack),isObject(srcValue))!function(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=safeGet(object,key),srcValue=safeGet(source,key),stacked=stack.get(srcValue);if(stacked)return void assignMergeValue(object,key,stacked);var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined,isCommon=undefined===newValue;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue,isArr||isBuff||isTyped?isArray(objValue)?newValue=objValue:isArrayLikeObject(objValue)?newValue=copyArray(objValue):isBuff?(isCommon=!1,newValue=cloneBuffer(srcValue,!0)):isTyped?(isCommon=!1,newValue=cloneTypedArray(srcValue,!0)):newValue=[]:isPlainObject(srcValue)||isArguments(srcValue)?(newValue=objValue,isArguments(objValue)?newValue=toPlainObject(objValue):isObject(objValue)&&!isFunction(objValue)||(newValue=initCloneObject(srcValue))):isCommon=!1}isCommon&&(stack.set(srcValue,newValue),mergeFunc(newValue,srcValue,srcIndex,customizer,stack),stack.delete(srcValue));assignMergeValue(object,key,newValue)}(object,source,key,srcIndex,baseMerge,customizer,stack);else{var newValue=customizer?customizer(safeGet(object,key),srcValue,key+"",object,source,stack):undefined;undefined===newValue&&(newValue=srcValue),assignMergeValue(object,key,newValue)}}),keysIn)}function baseNth(array,n){var length=array.length;if(length)return isIndex(n+=n<0?length:0,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){iteratees=iteratees.length?arrayMap(iteratees,(function(iteratee){return isArray(iteratee)?function(value){return baseGet(value,1===iteratee.length?iteratee[0]:iteratee)}:iteratee})):[identity];var index=-1;iteratees=arrayMap(iteratees,baseUnary(getIteratee()));var result=baseMap(collection,(function(value,key,collection){var criteria=arrayMap(iteratees,(function(iteratee){return iteratee(value)}));return{criteria,index:++index,value}}));return function(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}(result,(function(object,other){return function(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;for(;++index<length;){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result)return index>=ordersLength?result:result*("desc"==orders[index]?-1:1)}return object.index-other.index}(object,other,orders)}))}function basePickBy(object,paths,predicate){for(var index=-1,length=paths.length,result={};++index<length;){var path=paths[index],value=baseGet(object,path);predicate(value,path)&&baseSet(result,castPath(path,object),value)}return result}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;for(array===values&&(values=copyArray(values)),iteratee&&(seen=arrayMap(array,baseUnary(iteratee)));++index<length;)for(var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;(fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1;)seen!==array&&splice.call(seen,fromIndex,1),splice.call(array,fromIndex,1);return array}function basePullAt(array,indexes){for(var length=array?indexes.length:0,lastIndex=length-1;length--;){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;isIndex(index)?splice.call(array,index,1):baseUnset(array,index)}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRepeat(string,n){var result="";if(!string||n<1||n>9007199254740991)return result;do{n%2&&(result+=string),(n=nativeFloor(n/2))&&(string+=string)}while(n);return result}function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}function baseSample(collection){return arraySample(values(collection))}function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length))}function baseSet(object,path,value,customizer){if(!isObject(object))return object;for(var index=-1,length=(path=castPath(path,object)).length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=toKey(path[index]),newValue=value;if("__proto__"===key||"constructor"===key||"prototype"===key)return object;if(index!=lastIndex){var objValue=nested[key];undefined===(newValue=customizer?customizer(objValue,key,nested):undefined)&&(newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object}var baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity,baseSetToString=defineProperty?function(func,string){return defineProperty(func,"toString",{configurable:!0,enumerable:!1,value:constant(string),writable:!0})}:identity;function baseShuffle(collection){return shuffleSelf(values(collection))}function baseSlice(array,start,end){var index=-1,length=array.length;start<0&&(start=-start>length?0:length+start),(end=end>length?length:end)<0&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}function baseSome(collection,predicate){var result;return baseEach(collection,(function(value,index,collection){return!(result=predicate(value,index,collection))})),!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=null==array?low:array.length;if("number"==typeof value&&value==value&&high<=2147483647){for(;low<high;){var mid=low+high>>>1,computed=array[mid];null!==computed&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)?low=mid+1:high=mid}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){var low=0,high=null==array?0:array.length;if(0===high)return 0;for(var valIsNaN=(value=iteratee(value))!=value,valIsNull=null===value,valIsSymbol=isSymbol(value),valIsUndefined=undefined===value;low<high;){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=undefined!==computed,othIsNull=null===computed,othIsReflexive=computed==computed,othIsSymbol=isSymbol(computed);if(valIsNaN)var setLow=retHighest||othIsReflexive;else setLow=valIsUndefined?othIsReflexive&&(retHighest||othIsDefined):valIsNull?othIsReflexive&&othIsDefined&&(retHighest||!othIsNull):valIsSymbol?othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol):!othIsNull&&!othIsSymbol&&(retHighest?computed<=value:computed<value);setLow?low=mid+1:high=mid}return nativeMin(high,4294967294)}function baseSortedUniq(array,iteratee){for(var index=-1,length=array.length,resIndex=0,result=[];++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=0===value?0:value}}return result}function baseToNumber(value){return"number"==typeof value?value:isSymbol(value)?NaN:+value}function baseToString(value){if("string"==typeof value)return value;if(isArray(value))return arrayMap(value,baseToString)+"";if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-Infinity?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=!0,result=[],seen=result;if(comparator)isCommon=!1,includes=arrayIncludesWith;else if(length>=200){var set=iteratee?null:createSet(array);if(set)return setToArray(set);isCommon=!1,includes=cacheHas,seen=new SetCache}else seen=iteratee?[]:result;outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,isCommon&&computed==computed){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else includes(seen,computed,comparator)||(seen!==result&&seen.push(computed),result.push(value))}return result}function baseUnset(object,path){return null==(object=parent(object,path=castPath(path,object)))||delete object[toKey(last(path))]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){for(var length=array.length,index=fromRight?length:-1;(fromRight?index--:++index<length)&&predicate(array[index],index,array););return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;return result instanceof LazyWrapper&&(result=result.value()),arrayReduce(actions,(function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))}),result)}function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2)return length?baseUniq(arrays[0]):[];for(var index=-1,result=Array(length);++index<length;)for(var array=arrays[index],othIndex=-1;++othIndex<length;)othIndex!=index&&(result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator));return baseUniq(baseFlatten(result,1),iteratee,comparator)}function baseZipObject(props,values,assignFunc){for(var index=-1,length=props.length,valsLength=values.length,result={};++index<length;){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return"function"==typeof value?value:identity}function castPath(value,object){return isArray(value)?value:isKey(value,object)?[value]:stringToPath(toString(value))}var castRest=baseRest;function castSlice(array,start,end){var length=array.length;return end=undefined===end?length:end,!start&&end>=length?array:baseSlice(array,start,end)}var clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id)};function cloneBuffer(buffer,isDeep){if(isDeep)return buffer.slice();var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);return buffer.copy(result),result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array(result).set(new Uint8Array(arrayBuffer)),result}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=undefined!==value,valIsNull=null===value,valIsReflexive=value==value,valIsSymbol=isSymbol(value),othIsDefined=undefined!==other,othIsNull=null===other,othIsReflexive=other==other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive)return 1;if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive)return-1}return 0}function composeArgs(args,partials,holders,isCurried){for(var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)(isUncurried||argsIndex<argsLength)&&(result[holders[argsIndex]]=args[argsIndex]);for(;rangeLength--;)result[leftIndex++]=args[argsIndex++];return result}function composeArgsRight(args,partials,holders,isCurried){for(var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;++argsIndex<rangeLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)(isUncurried||argsIndex<argsLength)&&(result[offset+holders[holdersIndex]]=args[argsIndex++]);return result}function copyArray(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;undefined===newValue&&(newValue=source[key]),isNew?baseAssignValue(object,key,newValue):assignValue(object,key,newValue)}return object}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest((function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;for(customizer=assigner.length>3&&"function"==typeof customizer?(length--,customizer):undefined,guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?undefined:customizer,length=1),object=Object(object);++index<length;){var source=sources[index];source&&assigner(object,source,index,customizer)}return object}))}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}function createCaseFirst(methodName){return function(string){var strSymbols=hasUnicode(string=toString(string))?stringToArray(string):undefined,chr=strSymbols?strSymbols[0]:string.charAt(0),trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection),predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return flatRest((function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;for(fromRight&&funcs.reverse();index--;){var func=funcs[index];if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(prereq&&!wrapper&&"wrapper"==getFuncName(func))var wrapper=new LodashWrapper([],!0)}for(index=wrapper?index:length;++index<length;){var funcName=getFuncName(func=funcs[index]),data="wrapper"==funcName?getData(func):undefined;wrapper=data&&isLaziable(data[0])&&424==data[1]&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments,value=args[0];if(wrapper&&1==args.length&&isArray(value))return wrapper.plant(value).value();for(var index=0,result=length?funcs[index].apply(this,args):value;++index<length;)result=funcs[index].call(this,result);return result}}))}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=128&bitmask,isBind=1&bitmask,isBindKey=2&bitmask,isCurried=24&bitmask,isFlip=512&bitmask,Ctor=isBindKey?undefined:createCtor(func);return function wrapper(){for(var length=arguments.length,args=Array(length),index=length;index--;)args[index]=arguments[index];if(isCurried)var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder);if(partials&&(args=composeArgs(args,partials,holders,isCurried)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight,isCurried)),length-=holdersCount,isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return length=args.length,argPos?args=reorder(args,argPos):isFlip&&length>1&&args.reverse(),isAry&&ary<length&&(args.length=ary),this&&this!==root&&this instanceof wrapper&&(fn=Ctor||createCtor(fn)),fn.apply(thisBinding,args)}}function createInverter(setter,toIteratee){return function(object,iteratee){return function(object,setter,iteratee,accumulator){return baseForOwn(object,(function(value,key,object){setter(accumulator,iteratee(value),key,object)})),accumulator}(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(undefined===value&&undefined===other)return defaultValue;if(undefined!==value&&(result=value),undefined!==other){if(undefined===result)return other;"string"==typeof value||"string"==typeof other?(value=baseToString(value),other=baseToString(other)):(value=baseToNumber(value),other=baseToNumber(other)),result=operator(value,other)}return result}}function createOver(arrayFunc){return flatRest((function(iteratees){return iteratees=arrayMap(iteratees,baseUnary(getIteratee())),baseRest((function(args){var thisArg=this;return arrayFunc(iteratees,(function(iteratee){return apply(iteratee,thisArg,args)}))}))}))}function createPadding(length,chars){var charsLength=(chars=undefined===chars?" ":baseToString(chars)).length;if(charsLength<2)return charsLength?baseRepeat(chars,length):chars;var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createRange(fromRight){return function(start,end,step){return step&&"number"!=typeof step&&isIterateeCall(start,end,step)&&(end=step=undefined),start=toFinite(start),undefined===end?(end=start,start=0):end=toFinite(end),function(start,end,step,fromRight){for(var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);length--;)result[fromRight?length:++index]=start,start+=step;return result}(start,end,step=undefined===step?start<end?1:-1:toFinite(step),fromRight)}}function createRelationalOperation(operator){return function(value,other){return"string"==typeof value&&"string"==typeof other||(value=toNumber(value),other=toNumber(other)),operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=8&bitmask;bitmask|=isCurry?32:64,4&(bitmask&=~(isCurry?64:32))||(bitmask&=-4);var newData=[func,bitmask,thisArg,isCurry?partials:undefined,isCurry?holders:undefined,isCurry?undefined:partials,isCurry?undefined:holders,argPos,ary,arity],result=wrapFunc.apply(undefined,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){if(number=toNumber(number),(precision=null==precision?0:nativeMin(toInteger(precision),292))&&nativeIsFinite(number)){var pair=(toString(number)+"e").split("e");return+((pair=(toString(func(pair[0]+"e"+(+pair[1]+precision)))+"e").split("e"))[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=Set&&1/setToArray(new Set([,-0]))[1]==Infinity?function(values){return new Set(values)}:noop;function createToPairs(keysFunc){return function(object){var tag=getTag(object);return tag==mapTag?mapToArray(object):tag==setTag?setToPairs(object):function(object,props){return arrayMap(props,(function(key){return[key,object[key]]}))}(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=2&bitmask;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=-97,partials=holders=undefined),ary=undefined===ary?ary:nativeMax(toInteger(ary),0),arity=undefined===arity?arity:toInteger(arity),length-=holders?holders.length:0,64&bitmask){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&function(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<131,isCombo=128==srcBitmask&&8==bitmask||128==srcBitmask&&256==bitmask&&data[7].length<=source[8]||384==srcBitmask&&source[7].length<=source[8]&&8==bitmask;if(!isCommon&&!isCombo)return data;1&srcBitmask&&(data[2]=source[2],newBitmask|=1&bitmask?0:4);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value,data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}(value=source[5])&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):value,data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]);(value=source[7])&&(data[7]=value);128&srcBitmask&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8]));null==data[9]&&(data[9]=source[9]);data[0]=source[0],data[1]=newBitmask}(newData,data),func=newData[0],bitmask=newData[1],thisArg=newData[2],partials=newData[3],holders=newData[4],!(arity=newData[9]=undefined===newData[9]?isBindKey?0:func.length:nativeMax(newData[9]-length,0))&&24&bitmask&&(bitmask&=-25),bitmask&&1!=bitmask)result=8==bitmask||16==bitmask?function(func,bitmask,arity){var Ctor=createCtor(func);return function wrapper(){for(var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);index--;)args[index]=arguments[index];var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);return(length-=holders.length)<arity?createRecurry(func,bitmask,createHybrid,wrapper.placeholder,void 0,args,holders,void 0,void 0,arity-length):apply(this&&this!==root&&this instanceof wrapper?Ctor:func,this,args)}}(func,bitmask,arity):32!=bitmask&&33!=bitmask||holders.length?createHybrid.apply(undefined,newData):function(func,bitmask,thisArg,partials){var isBind=1&bitmask,Ctor=createCtor(func);return function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];return apply(fn,isBind?thisArg:this,args)}}(func,bitmask,thisArg,partials);else var result=function(func,bitmask,thisArg){var isBind=1&bitmask,Ctor=createCtor(func);return function wrapper(){return(this&&this!==root&&this instanceof wrapper?Ctor:func).apply(isBind?thisArg:this,arguments)}}(func,bitmask,thisArg);return setWrapToString((data?baseSetData:setData)(result,newData),func,bitmask)}function customDefaultsAssignIn(objValue,srcValue,key,object){return undefined===objValue||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)?srcValue:objValue}function customDefaultsMerge(objValue,srcValue,key,object,source,stack){return isObject(objValue)&&isObject(srcValue)&&(stack.set(srcValue,objValue),baseMerge(objValue,srcValue,undefined,customDefaultsMerge,stack),stack.delete(srcValue)),objValue}function customOmitClone(value){return isPlainObject(value)?undefined:value}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var arrStacked=stack.get(array),othStacked=stack.get(other);if(arrStacked&&othStacked)return arrStacked==other&&othStacked==array;var index=-1,result=!0,seen=2&bitmask?new SetCache:undefined;for(stack.set(array,other),stack.set(other,array);++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(undefined!==compared){if(compared)continue;result=!1;break}if(seen){if(!arraySome(other,(function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex)}))){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack.delete(array),stack.delete(other),result}function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=metaMap?function(func){return metaMap.get(func)}:noop;function getFuncName(func){for(var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}function getHolder(func){return(hasOwnProperty.call(lodash,"placeholder")?lodash:func).placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;return result=result===iteratee?baseIteratee:result,arguments.length?result(arguments[0],arguments[1]):result}function getMapData(map,key){var value,type,data=map.__data__;return("string"==(type=typeof(value=key))||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value)?data["string"==typeof key?"string":"hash"]:data.map}function getMatchData(object){for(var result=keys(object),length=result.length;length--;){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=function(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:undefined}var getSymbols=nativeGetSymbols?function(object){return null==object?[]:(object=Object(object),arrayFilter(nativeGetSymbols(object),(function(symbol){return propertyIsEnumerable.call(object,symbol)})))}:stubArray,getSymbolsIn=nativeGetSymbols?function(object){for(var result=[];object;)arrayPush(result,getSymbols(object)),object=getPrototype(object);return result}:stubArray,getTag=baseGetTag;function hasPath(object,path,hasFunc){for(var index=-1,length=(path=castPath(path,object)).length,result=!1;++index<length;){var key=toKey(path[index]);if(!(result=null!=object&&hasFunc(object,key)))break;object=object[key]}return result||++index!=length?result:!!(length=null==object?0:object.length)&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}function initCloneObject(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:baseCreate(getPrototype(object))}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){var type=typeof value;return!!(length=null==length?9007199254740991:length)&&("number"==type||"symbol"!=type&&reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;return!!("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}function isKey(value,object){if(isArray(value))return!1;var type=typeof value;return!("number"!=type&&"symbol"!=type&&"boolean"!=type&&null!=value&&!isSymbol(value))||(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag)&&(getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return"[object Promise]";case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return result});var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}function isStrictComparable(value){return value==value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){return null!=object&&(object[key]===srcValue&&(undefined!==srcValue||key in Object(object)))}}function overRest(func,start,transform){return start=nativeMax(undefined===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),apply(func,this,otherArgs)}}function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}function safeGet(object,key){if(("constructor"!==key||"function"!=typeof object[key])&&"__proto__"!=key)return object[key]}var setData=shortOut(baseSetData),setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait)},setToString=shortOut(baseSetToString);function setWrapToString(wrapper,reference,bitmask){var source=reference+"";return setToString(wrapper,function(source,details){var length=details.length;if(!length)return source;var lastIndex=length-1;return details[lastIndex]=(length>1?"& ":"")+details[lastIndex],details=details.join(length>2?", ":" "),source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}(source,function(details,bitmask){return arrayEach(wrapFlags,(function(pair){var value="_."+pair[0];bitmask&pair[1]&&!arrayIncludes(details,value)&&details.push(value)})),details.sort()}(function(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}(source),bitmask)))}function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=800)return arguments[0]}else count=0;return func.apply(undefined,arguments)}}function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;for(size=undefined===size?length:size;++index<size;){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index],array[index]=value}return array.length=size,array}var stringToPath=function(func){var result=memoize(func,(function(key){return 500===cache.size&&cache.clear(),key})),cache=result.cache;return result}((function(string){var result=[];return 46===string.charCodeAt(0)&&result.push(""),string.replace(rePropName,(function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)})),result}));function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-Infinity?"-0":result}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper)return wrapper.clone();var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);return result.__actions__=copyArray(wrapper.__actions__),result.__index__=wrapper.__index__,result.__values__=wrapper.__values__,result}var difference=baseRest((function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0)):[]})),differenceBy=baseRest((function(array,values){var iteratee=last(values);return isArrayLikeObject(iteratee)&&(iteratee=undefined),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0),getIteratee(iteratee,2)):[]})),differenceWith=baseRest((function(array,values){var comparator=last(values);return isArrayLikeObject(comparator)&&(comparator=undefined),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0),undefined,comparator):[]}));function findIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length-1;return undefined!==fromIndex&&(index=toInteger(fromIndex),index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)),baseFindIndex(array,getIteratee(predicate,3),index,!0)}function flatten(array){return(null==array?0:array.length)?baseFlatten(array,1):[]}function head(array){return array&&array.length?array[0]:undefined}var intersection=baseRest((function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]})),intersectionBy=baseRest((function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);return iteratee===last(mapped)?iteratee=undefined:mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]})),intersectionWith=baseRest((function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);return(comparator="function"==typeof comparator?comparator:undefined)&&mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]}));function last(array){var length=null==array?0:array.length;return length?array[length-1]:undefined}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}var pullAt=flatRest((function(array,indexes){var length=null==array?0:array.length,result=baseAt(array,indexes);return basePullAt(array,arrayMap(indexes,(function(index){return isIndex(index,length)?+index:index})).sort(compareAscending)),result}));function reverse(array){return null==array?array:nativeReverse.call(array)}var union=baseRest((function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0))})),unionBy=baseRest((function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=undefined),baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0),getIteratee(iteratee,2))})),unionWith=baseRest((function(arrays){var comparator=last(arrays);return comparator="function"==typeof comparator?comparator:undefined,baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0),undefined,comparator)}));function unzip(array){if(!array||!array.length)return[];var length=0;return array=arrayFilter(array,(function(group){if(isArrayLikeObject(group))return length=nativeMax(group.length,length),!0})),baseTimes(length,(function(index){return arrayMap(array,baseProperty(index))}))}function unzipWith(array,iteratee){if(!array||!array.length)return[];var result=unzip(array);return null==iteratee?result:arrayMap(result,(function(group){return apply(iteratee,undefined,group)}))}var without=baseRest((function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]})),xor=baseRest((function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))})),xorBy=baseRest((function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=undefined),baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))})),xorWith=baseRest((function(arrays){var comparator=last(arrays);return comparator="function"==typeof comparator?comparator:undefined,baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)})),zip=baseRest(unzip);var zipWith=baseRest((function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;return iteratee="function"==typeof iteratee?(arrays.pop(),iteratee):undefined,unzipWith(arrays,iteratee)}));function chain(value){var result=lodash(value);return result.__chain__=!0,result}function thru(value,interceptor){return interceptor(value)}var wrapperAt=flatRest((function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};return!(length>1||this.__actions__.length)&&value instanceof LazyWrapper&&isIndex(start)?((value=value.slice(start,+start+(length?1:0))).__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(value,this.__chain__).thru((function(array){return length&&!array.length&&array.push(undefined),array}))):this.thru(interceptor)}));var countBy=createAggregator((function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:baseAssignValue(result,key,1)}));var find=createFind(findIndex),findLast=createFind(findLastIndex);function forEach(collection,iteratee){return(isArray(collection)?arrayEach:baseEach)(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){return(isArray(collection)?arrayEachRight:baseEachRight)(collection,getIteratee(iteratee,3))}var groupBy=createAggregator((function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):baseAssignValue(result,key,[value])}));var invokeMap=baseRest((function(collection,path,args){var index=-1,isFunc="function"==typeof path,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,(function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args)})),result})),keyBy=createAggregator((function(result,value,key){baseAssignValue(result,key,value)}));function map(collection,iteratee){return(isArray(collection)?arrayMap:baseMap)(collection,getIteratee(iteratee,3))}var partition=createAggregator((function(result,value,key){result[key?0:1].push(value)}),(function(){return[[],[]]}));var sortBy=baseRest((function(collection,iteratees){if(null==collection)return[];var length=iteratees.length;return length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])?iteratees=[]:length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])&&(iteratees=[iteratees[0]]),baseOrderBy(collection,baseFlatten(iteratees,1),[])})),now=ctxNow||function(){return root.Date.now()};function ary(func,n,guard){return n=guard?undefined:n,createWrap(func,128,undefined,undefined,undefined,undefined,n=func&&null==n?func.length:n)}function before(n,func){var result;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){return--n>0&&(result=func.apply(this,arguments)),n<=1&&(func=undefined),result}}var bind=baseRest((function(func,thisArg,partials){var bitmask=1;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=32}return createWrap(func,bitmask,thisArg,partials,holders)})),bindKey=baseRest((function(object,key,partials){var bitmask=3;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=32}return createWrap(key,bitmask,object,partials,holders)}));function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=undefined,lastInvokeTime=time,result=func.apply(thisArg,args)}function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime;return undefined===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&time-lastInvokeTime>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,function(time){var timeWaiting=wait-(time-lastCallTime);return maxing?nativeMin(timeWaiting,maxWait-(time-lastInvokeTime)):timeWaiting}(time))}function trailingEdge(time){return timerId=undefined,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=undefined,result)}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(undefined===timerId)return leadingEdge(lastCallTime);if(maxing)return clearTimeout(timerId),timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return undefined===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function(){undefined!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=undefined},debounced.flush=function(){return undefined===timerId?result:trailingEdge(now())},debounced}var defer=baseRest((function(func,args){return baseDelay(func,1,args)})),delay=baseRest((function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)}));function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result)||cache,result};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}memoize.Cache=MapCache;var overArgs=castRest((function(func,transforms){var funcsLength=(transforms=1==transforms.length&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()))).length;return baseRest((function(args){for(var index=-1,length=nativeMin(args.length,funcsLength);++index<length;)args[index]=transforms[index].call(this,args[index]);return apply(func,this,args)}))})),partial=baseRest((function(func,partials){return createWrap(func,32,undefined,partials,replaceHolders(partials,getHolder(partial)))})),partialRight=baseRest((function(func,partials){return createWrap(func,64,undefined,partials,replaceHolders(partials,getHolder(partialRight)))})),rearg=flatRest((function(func,indexes){return createWrap(func,256,undefined,undefined,undefined,indexes)}));function eq(value,other){return value===other||value!=value&&other!=other}var gt=createRelationalOperation(baseGt),gte=createRelationalOperation((function(value,other){return value>=other})),isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")},isArray=Array.isArray,isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):function(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag};function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}var isBuffer=nativeIsBuffer||stubFalse,isDate=nodeIsDate?baseUnary(nodeIsDate):function(value){return isObjectLike(value)&&baseGetTag(value)==dateTag};function isError(value){if(!isObjectLike(value))return!1;var tag=baseGetTag(value);return tag==errorTag||"[object DOMException]"==tag||"string"==typeof value.message&&"string"==typeof value.name&&!isPlainObject(value)}function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return tag==funcTag||tag==genTag||"[object AsyncFunction]"==tag||"[object Proxy]"==tag}function isInteger(value){return"number"==typeof value&&value==toInteger(value)}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991}function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}function isObjectLike(value){return null!=value&&"object"==typeof value}var isMap=nodeIsMap?baseUnary(nodeIsMap):function(value){return isObjectLike(value)&&getTag(value)==mapTag};function isNumber(value){return"number"==typeof value||isObjectLike(value)&&baseGetTag(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag)return!1;var proto=getPrototype(value);if(null===proto)return!0;var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):function(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag};var isSet=nodeIsSet?baseUnary(nodeIsSet):function(value){return isObjectLike(value)&&getTag(value)==setTag};function isString(value){return"string"==typeof value||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&baseGetTag(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):function(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]};var lt=createRelationalOperation(baseLt),lte=createRelationalOperation((function(value,other){return value<=other}));function toArray(value){if(!value)return[];if(isArrayLike(value))return isString(value)?stringToArray(value):copyArray(value);if(symIterator&&value[symIterator])return function(iterator){for(var data,result=[];!(data=iterator.next()).done;)result.push(data.value);return result}(value[symIterator]());var tag=getTag(value);return(tag==mapTag?mapToArray:tag==setTag?setToArray:values)(value)}function toFinite(value){return value?Infinity===(value=toNumber(value))||-Infinity===value?17976931348623157e292*(value<0?-1:1):value==value?value:0:0===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result==result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,4294967295):0}function toNumber(value){if("number"==typeof value)return value;if(isSymbol(value))return NaN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NaN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toString(value){return null==value?"":baseToString(value)}var assign=createAssigner((function(object,source){if(isPrototype(source)||isArrayLike(source))copyObject(source,keys(source),object);else for(var key in source)hasOwnProperty.call(source,key)&&assignValue(object,key,source[key])})),assignIn=createAssigner((function(object,source){copyObject(source,keysIn(source),object)})),assignInWith=createAssigner((function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)})),assignWith=createAssigner((function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)})),at=flatRest(baseAt);var defaults=baseRest((function(object,sources){object=Object(object);var index=-1,length=sources.length,guard=length>2?sources[2]:undefined;for(guard&&isIterateeCall(sources[0],sources[1],guard)&&(length=1);++index<length;)for(var source=sources[index],props=keysIn(source),propsIndex=-1,propsLength=props.length;++propsIndex<propsLength;){var key=props[propsIndex],value=object[key];(undefined===value||eq(value,objectProto[key])&&!hasOwnProperty.call(object,key))&&(object[key]=source[key])}return object})),defaultsDeep=baseRest((function(args){return args.push(undefined,customDefaultsMerge),apply(mergeWith,undefined,args)}));function get(object,path,defaultValue){var result=null==object?undefined:baseGet(object,path);return undefined===result?defaultValue:result}function hasIn(object,path){return null!=object&&hasPath(object,path,baseHasIn)}var invert=createInverter((function(result,value,key){null!=value&&"function"!=typeof value.toString&&(value=nativeObjectToString.call(value)),result[value]=key}),constant(identity)),invertBy=createInverter((function(result,value,key){null!=value&&"function"!=typeof value.toString&&(value=nativeObjectToString.call(value)),hasOwnProperty.call(result,value)?result[value].push(key):result[value]=[key]}),getIteratee),invoke=baseRest(baseInvoke);function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,!0):baseKeysIn(object)}var merge=createAssigner((function(object,source,srcIndex){baseMerge(object,source,srcIndex)})),mergeWith=createAssigner((function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)})),omit=flatRest((function(object,paths){var result={};if(null==object)return result;var isDeep=!1;paths=arrayMap(paths,(function(path){return path=castPath(path,object),isDeep||(isDeep=path.length>1),path})),copyObject(object,getAllKeysIn(object),result),isDeep&&(result=baseClone(result,7,customOmitClone));for(var length=paths.length;length--;)baseUnset(result,paths[length]);return result}));var pick=flatRest((function(object,paths){return null==object?{}:function(object,paths){return basePickBy(object,paths,(function(value,path){return hasIn(object,path)}))}(object,paths)}));function pickBy(object,predicate){if(null==object)return{};var props=arrayMap(getAllKeysIn(object),(function(prop){return[prop]}));return predicate=getIteratee(predicate),basePickBy(object,props,(function(value,path){return predicate(value,path[0])}))}var toPairs=createToPairs(keys),toPairsIn=createToPairs(keysIn);function values(object){return null==object?[]:baseValues(object,keys(object))}var camelCase=createCompounder((function(result,word,index){return word=word.toLowerCase(),result+(index?capitalize(word):word)}));function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){return(string=toString(string))&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}var kebabCase=createCompounder((function(result,word,index){return result+(index?"-":"")+word.toLowerCase()})),lowerCase=createCompounder((function(result,word,index){return result+(index?" ":"")+word.toLowerCase()})),lowerFirst=createCaseFirst("toLowerCase");var snakeCase=createCompounder((function(result,word,index){return result+(index?"_":"")+word.toLowerCase()}));var startCase=createCompounder((function(result,word,index){return result+(index?" ":"")+upperFirst(word)}));var upperCase=createCompounder((function(result,word,index){return result+(index?" ":"")+word.toUpperCase()})),upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){return string=toString(string),undefined===(pattern=guard?undefined:pattern)?function(string){return reHasUnicodeWord.test(string)}(string)?function(string){return string.match(reUnicodeWord)||[]}(string):function(string){return string.match(reAsciiWord)||[]}(string):string.match(pattern)||[]}var attempt=baseRest((function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}})),bindAll=flatRest((function(object,methodNames){return arrayEach(methodNames,(function(key){key=toKey(key),baseAssignValue(object,key,bind(object[key],object))})),object}));function constant(value){return function(){return value}}var flow=createFlow(),flowRight=createFlow(!0);function identity(value){return value}function iteratee(func){return baseIteratee("function"==typeof func?func:baseClone(func,1))}var method=baseRest((function(path,args){return function(object){return baseInvoke(object,path,args)}})),methodOf=baseRest((function(object,args){return function(path){return baseInvoke(object,path,args)}}));function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);null!=options||isObject(source)&&(methodNames.length||!props.length)||(options=source,source=object,object=this,methodNames=baseFunctions(source,keys(source)));var chain=!(isObject(options)&&"chain"in options&&!options.chain),isFunc=isFunction(object);return arrayEach(methodNames,(function(methodName){var func=source[methodName];object[methodName]=func,isFunc&&(object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);return actions.push({func,args:arguments,thisArg:object}),result.__chain__=chainAll,result}return func.apply(object,arrayPush([this.value()],arguments))})})),object}function noop(){}var over=createOver(arrayMap),overEvery=createOver(arrayEvery),overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):function(path){return function(object){return baseGet(object,path)}}(path)}var range=createRange(),rangeRight=createRange(!0);function stubArray(){return[]}function stubFalse(){return!1}var add=createMathOperation((function(augend,addend){return augend+addend}),0),ceil=createRound("ceil"),divide=createMathOperation((function(dividend,divisor){return dividend/divisor}),1),floor=createRound("floor");var source,multiply=createMathOperation((function(multiplier,multiplicand){return multiplier*multiplicand}),1),round=createRound("round"),subtract=createMathOperation((function(minuend,subtrahend){return minuend-subtrahend}),0);return lodash.after=function(n,func){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){if(--n<1)return func.apply(this,arguments)}},lodash.ary=ary,lodash.assign=assign,lodash.assignIn=assignIn,lodash.assignInWith=assignInWith,lodash.assignWith=assignWith,lodash.at=at,lodash.before=before,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.castArray=function(){if(!arguments.length)return[];var value=arguments[0];return isArray(value)?value:[value]},lodash.chain=chain,lodash.chunk=function(array,size,guard){size=(guard?isIterateeCall(array,size,guard):undefined===size)?1:nativeMax(toInteger(size),0);var length=null==array?0:array.length;if(!length||size<1)return[];for(var index=0,resIndex=0,result=Array(nativeCeil(length/size));index<length;)result[resIndex++]=baseSlice(array,index,index+=size);return result},lodash.compact=function(array){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];value&&(result[resIndex++]=value)}return result},lodash.concat=function(){var length=arguments.length;if(!length)return[];for(var args=Array(length-1),array=arguments[0],index=length;index--;)args[index-1]=arguments[index];return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1))},lodash.cond=function(pairs){var length=null==pairs?0:pairs.length,toIteratee=getIteratee();return pairs=length?arrayMap(pairs,(function(pair){if("function"!=typeof pair[1])throw new TypeError(FUNC_ERROR_TEXT);return[toIteratee(pair[0]),pair[1]]})):[],baseRest((function(args){for(var index=-1;++index<length;){var pair=pairs[index];if(apply(pair[0],this,args))return apply(pair[1],this,args)}}))},lodash.conforms=function(source){return function(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}(baseClone(source,1))},lodash.constant=constant,lodash.countBy=countBy,lodash.create=function(prototype,properties){var result=baseCreate(prototype);return null==properties?result:baseAssign(result,properties)},lodash.curry=function curry(func,arity,guard){var result=createWrap(func,8,undefined,undefined,undefined,undefined,undefined,arity=guard?undefined:arity);return result.placeholder=curry.placeholder,result},lodash.curryRight=function curryRight(func,arity,guard){var result=createWrap(func,16,undefined,undefined,undefined,undefined,undefined,arity=guard?undefined:arity);return result.placeholder=curryRight.placeholder,result},lodash.debounce=debounce,lodash.defaults=defaults,lodash.defaultsDeep=defaultsDeep,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.differenceBy=differenceBy,lodash.differenceWith=differenceWith,lodash.drop=function(array,n,guard){var length=null==array?0:array.length;return length?baseSlice(array,(n=guard||undefined===n?1:toInteger(n))<0?0:n,length):[]},lodash.dropRight=function(array,n,guard){var length=null==array?0:array.length;return length?baseSlice(array,0,(n=length-(n=guard||undefined===n?1:toInteger(n)))<0?0:n):[]},lodash.dropRightWhile=function(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0,!0):[]},lodash.dropWhile=function(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0):[]},lodash.fill=function(array,value,start,end){var length=null==array?0:array.length;return length?(start&&"number"!=typeof start&&isIterateeCall(array,value,start)&&(start=0,end=length),function(array,value,start,end){var length=array.length;for((start=toInteger(start))<0&&(start=-start>length?0:length+start),(end=void 0===end||end>length?length:toInteger(end))<0&&(end+=length),end=start>end?0:toLength(end);start<end;)array[start++]=value;return array}(array,value,start,end)):[]},lodash.filter=function(collection,predicate){return(isArray(collection)?arrayFilter:baseFilter)(collection,getIteratee(predicate,3))},lodash.flatMap=function(collection,iteratee){return baseFlatten(map(collection,iteratee),1)},lodash.flatMapDeep=function(collection,iteratee){return baseFlatten(map(collection,iteratee),Infinity)},lodash.flatMapDepth=function(collection,iteratee,depth){return depth=undefined===depth?1:toInteger(depth),baseFlatten(map(collection,iteratee),depth)},lodash.flatten=flatten,lodash.flattenDeep=function(array){return(null==array?0:array.length)?baseFlatten(array,Infinity):[]},lodash.flattenDepth=function(array,depth){return(null==array?0:array.length)?baseFlatten(array,depth=undefined===depth?1:toInteger(depth)):[]},lodash.flip=function(func){return createWrap(func,512)},lodash.flow=flow,lodash.flowRight=flowRight,lodash.fromPairs=function(pairs){for(var index=-1,length=null==pairs?0:pairs.length,result={};++index<length;){var pair=pairs[index];result[pair[0]]=pair[1]}return result},lodash.functions=function(object){return null==object?[]:baseFunctions(object,keys(object))},lodash.functionsIn=function(object){return null==object?[]:baseFunctions(object,keysIn(object))},lodash.groupBy=groupBy,lodash.initial=function(array){return(null==array?0:array.length)?baseSlice(array,0,-1):[]},lodash.intersection=intersection,lodash.intersectionBy=intersectionBy,lodash.intersectionWith=intersectionWith,lodash.invert=invert,lodash.invertBy=invertBy,lodash.invokeMap=invokeMap,lodash.iteratee=iteratee,lodash.keyBy=keyBy,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=function(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,(function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value)})),result},lodash.mapValues=function(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,(function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))})),result},lodash.matches=function(source){return baseMatches(baseClone(source,1))},lodash.matchesProperty=function(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,1))},lodash.memoize=memoize,lodash.merge=merge,lodash.mergeWith=mergeWith,lodash.method=method,lodash.methodOf=methodOf,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=function(n){return n=toInteger(n),baseRest((function(args){return baseNth(args,n)}))},lodash.omit=omit,lodash.omitBy=function(object,predicate){return pickBy(object,negate(getIteratee(predicate)))},lodash.once=function(func){return before(2,func)},lodash.orderBy=function(collection,iteratees,orders,guard){return null==collection?[]:(isArray(iteratees)||(iteratees=null==iteratees?[]:[iteratees]),isArray(orders=guard?undefined:orders)||(orders=null==orders?[]:[orders]),baseOrderBy(collection,iteratees,orders))},lodash.over=over,lodash.overArgs=overArgs,lodash.overEvery=overEvery,lodash.overSome=overSome,lodash.partial=partial,lodash.partialRight=partialRight,lodash.partition=partition,lodash.pick=pick,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=function(object){return function(path){return null==object?undefined:baseGet(object,path)}},lodash.pull=pull,lodash.pullAll=pullAll,lodash.pullAllBy=function(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array},lodash.pullAllWith=function(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array},lodash.pullAt=pullAt,lodash.range=range,lodash.rangeRight=rangeRight,lodash.rearg=rearg,lodash.reject=function(collection,predicate){return(isArray(collection)?arrayFilter:baseFilter)(collection,negate(getIteratee(predicate,3)))},lodash.remove=function(array,predicate){var result=[];if(!array||!array.length)return result;var index=-1,indexes=[],length=array.length;for(predicate=getIteratee(predicate,3);++index<length;){var value=array[index];predicate(value,index,array)&&(result.push(value),indexes.push(index))}return basePullAt(array,indexes),result},lodash.rest=function(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return baseRest(func,start=undefined===start?start:toInteger(start))},lodash.reverse=reverse,lodash.sampleSize=function(collection,n,guard){return n=(guard?isIterateeCall(collection,n,guard):undefined===n)?1:toInteger(n),(isArray(collection)?arraySampleSize:baseSampleSize)(collection,n)},lodash.set=function(object,path,value){return null==object?object:baseSet(object,path,value)},lodash.setWith=function(object,path,value,customizer){return customizer="function"==typeof customizer?customizer:undefined,null==object?object:baseSet(object,path,value,customizer)},lodash.shuffle=function(collection){return(isArray(collection)?arrayShuffle:baseShuffle)(collection)},lodash.slice=function(array,start,end){var length=null==array?0:array.length;return length?(end&&"number"!=typeof end&&isIterateeCall(array,start,end)?(start=0,end=length):(start=null==start?0:toInteger(start),end=undefined===end?length:toInteger(end)),baseSlice(array,start,end)):[]},lodash.sortBy=sortBy,lodash.sortedUniq=function(array){return array&&array.length?baseSortedUniq(array):[]},lodash.sortedUniqBy=function(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]},lodash.split=function(string,separator,limit){return limit&&"number"!=typeof limit&&isIterateeCall(string,separator,limit)&&(separator=limit=undefined),(limit=undefined===limit?4294967295:limit>>>0)?(string=toString(string))&&("string"==typeof separator||null!=separator&&!isRegExp(separator))&&!(separator=baseToString(separator))&&hasUnicode(string)?castSlice(stringToArray(string),0,limit):string.split(separator,limit):[]},lodash.spread=function(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=null==start?0:nativeMax(toInteger(start),0),baseRest((function(args){var array=args[start],otherArgs=castSlice(args,0,start);return array&&arrayPush(otherArgs,array),apply(func,this,otherArgs)}))},lodash.tail=function(array){var length=null==array?0:array.length;return length?baseSlice(array,1,length):[]},lodash.take=function(array,n,guard){return array&&array.length?baseSlice(array,0,(n=guard||undefined===n?1:toInteger(n))<0?0:n):[]},lodash.takeRight=function(array,n,guard){var length=null==array?0:array.length;return length?baseSlice(array,(n=length-(n=guard||undefined===n?1:toInteger(n)))<0?0:n,length):[]},lodash.takeRightWhile=function(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!1,!0):[]},lodash.takeWhile=function(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]},lodash.tap=function(value,interceptor){return interceptor(value),value},lodash.throttle=function(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading,maxWait:wait,trailing})},lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=toPairs,lodash.toPairsIn=toPairsIn,lodash.toPath=function(value){return isArray(value)?arrayMap(value,toKey):isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))},lodash.toPlainObject=toPlainObject,lodash.transform=function(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);if(iteratee=getIteratee(iteratee,4),null==accumulator){var Ctor=object&&object.constructor;accumulator=isArrLike?isArr?new Ctor:[]:isObject(object)&&isFunction(Ctor)?baseCreate(getPrototype(object)):{}}return(isArrLike?arrayEach:baseForOwn)(object,(function(value,index,object){return iteratee(accumulator,value,index,object)})),accumulator},lodash.unary=function(func){return ary(func,1)},lodash.union=union,lodash.unionBy=unionBy,lodash.unionWith=unionWith,lodash.uniq=function(array){return array&&array.length?baseUniq(array):[]},lodash.uniqBy=function(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]},lodash.uniqWith=function(array,comparator){return comparator="function"==typeof comparator?comparator:undefined,array&&array.length?baseUniq(array,undefined,comparator):[]},lodash.unset=function(object,path){return null==object||baseUnset(object,path)},lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=function(object,path,updater){return null==object?object:baseUpdate(object,path,castFunction(updater))},lodash.updateWith=function(object,path,updater,customizer){return customizer="function"==typeof customizer?customizer:undefined,null==object?object:baseUpdate(object,path,castFunction(updater),customizer)},lodash.values=values,lodash.valuesIn=function(object){return null==object?[]:baseValues(object,keysIn(object))},lodash.without=without,lodash.words=words,lodash.wrap=function(value,wrapper){return partial(castFunction(wrapper),value)},lodash.xor=xor,lodash.xorBy=xorBy,lodash.xorWith=xorWith,lodash.zip=zip,lodash.zipObject=function(props,values){return baseZipObject(props||[],values||[],assignValue)},lodash.zipObjectDeep=function(props,values){return baseZipObject(props||[],values||[],baseSet)},lodash.zipWith=zipWith,lodash.entries=toPairs,lodash.entriesIn=toPairsIn,lodash.extend=assignIn,lodash.extendWith=assignInWith,mixin(lodash,lodash),lodash.add=add,lodash.attempt=attempt,lodash.camelCase=camelCase,lodash.capitalize=capitalize,lodash.ceil=ceil,lodash.clamp=function(number,lower,upper){return undefined===upper&&(upper=lower,lower=undefined),undefined!==upper&&(upper=(upper=toNumber(upper))==upper?upper:0),undefined!==lower&&(lower=(lower=toNumber(lower))==lower?lower:0),baseClamp(toNumber(number),lower,upper)},lodash.clone=function(value){return baseClone(value,4)},lodash.cloneDeep=function(value){return baseClone(value,5)},lodash.cloneDeepWith=function(value,customizer){return baseClone(value,5,customizer="function"==typeof customizer?customizer:undefined)},lodash.cloneWith=function(value,customizer){return baseClone(value,4,customizer="function"==typeof customizer?customizer:undefined)},lodash.conformsTo=function(object,source){return null==source||baseConformsTo(object,source,keys(source))},lodash.deburr=deburr,lodash.defaultTo=function(value,defaultValue){return null==value||value!=value?defaultValue:value},lodash.divide=divide,lodash.endsWith=function(string,target,position){string=toString(string),target=baseToString(target);var length=string.length,end=position=undefined===position?length:baseClamp(toInteger(position),0,length);return(position-=target.length)>=0&&string.slice(position,end)==target},lodash.eq=eq,lodash.escape=function(string){return(string=toString(string))&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string},lodash.escapeRegExp=function(string){return(string=toString(string))&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string},lodash.every=function(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=undefined),func(collection,getIteratee(predicate,3))},lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=function(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)},lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=function(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)},lodash.floor=floor,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=function(object,iteratee){return null==object?object:baseFor(object,getIteratee(iteratee,3),keysIn)},lodash.forInRight=function(object,iteratee){return null==object?object:baseForRight(object,getIteratee(iteratee,3),keysIn)},lodash.forOwn=function(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))},lodash.forOwnRight=function(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))},lodash.get=get,lodash.gt=gt,lodash.gte=gte,lodash.has=function(object,path){return null!=object&&hasPath(object,path,baseHas)},lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=function(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection),fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;return fromIndex<0&&(fromIndex=nativeMax(length+fromIndex,0)),isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1},lodash.indexOf=function(array,value,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseIndexOf(array,value,index)},lodash.inRange=function(number,start,end){return start=toFinite(start),undefined===end?(end=start,start=0):end=toFinite(end),function(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}(number=toNumber(number),start,end)},lodash.invoke=invoke,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isArrayBuffer=isArrayBuffer,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=function(value){return!0===value||!1===value||isObjectLike(value)&&baseGetTag(value)==boolTag},lodash.isBuffer=isBuffer,lodash.isDate=isDate,lodash.isElement=function(value){return isObjectLike(value)&&1===value.nodeType&&!isPlainObject(value)},lodash.isEmpty=function(value){if(null==value)return!0;if(isArrayLike(value)&&(isArray(value)||"string"==typeof value||"function"==typeof value.splice||isBuffer(value)||isTypedArray(value)||isArguments(value)))return!value.length;var tag=getTag(value);if(tag==mapTag||tag==setTag)return!value.size;if(isPrototype(value))return!baseKeys(value).length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0},lodash.isEqual=function(value,other){return baseIsEqual(value,other)},lodash.isEqualWith=function(value,other,customizer){var result=(customizer="function"==typeof customizer?customizer:undefined)?customizer(value,other):undefined;return undefined===result?baseIsEqual(value,other,undefined,customizer):!!result},lodash.isError=isError,lodash.isFinite=function(value){return"number"==typeof value&&nativeIsFinite(value)},lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=isMap,lodash.isMatch=function(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))},lodash.isMatchWith=function(object,source,customizer){return customizer="function"==typeof customizer?customizer:undefined,baseIsMatch(object,source,getMatchData(source),customizer)},lodash.isNaN=function(value){return isNumber(value)&&value!=+value},lodash.isNative=function(value){if(isMaskable(value))throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return baseIsNative(value)},lodash.isNil=function(value){return null==value},lodash.isNull=function(value){return null===value},lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isSafeInteger=function(value){return isInteger(value)&&value>=-9007199254740991&&value<=9007199254740991},lodash.isSet=isSet,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=isTypedArray,lodash.isUndefined=function(value){return undefined===value},lodash.isWeakMap=function(value){return isObjectLike(value)&&getTag(value)==weakMapTag},lodash.isWeakSet=function(value){return isObjectLike(value)&&"[object WeakSet]"==baseGetTag(value)},lodash.join=function(array,separator){return null==array?"":nativeJoin.call(array,separator)},lodash.kebabCase=kebabCase,lodash.last=last,lodash.lastIndexOf=function(array,value,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length;return undefined!==fromIndex&&(index=(index=toInteger(fromIndex))<0?nativeMax(length+index,0):nativeMin(index,length-1)),value==value?function(array,value,fromIndex){for(var index=fromIndex+1;index--;)if(array[index]===value)return index;return index}(array,value,index):baseFindIndex(array,baseIsNaN,index,!0)},lodash.lowerCase=lowerCase,lodash.lowerFirst=lowerFirst,lodash.lt=lt,lodash.lte=lte,lodash.max=function(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined},lodash.maxBy=function(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined},lodash.mean=function(array){return baseMean(array,identity)},lodash.meanBy=function(array,iteratee){return baseMean(array,getIteratee(iteratee,2))},lodash.min=function(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined},lodash.minBy=function(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined},lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=function(){return{}},lodash.stubString=function(){return""},lodash.stubTrue=function(){return!0},lodash.multiply=multiply,lodash.nth=function(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined},lodash.noConflict=function(){return root._===this&&(root._=oldDash),this},lodash.noop=noop,lodash.now=now,lodash.pad=function(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;if(!length||strLength>=length)return string;var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)},lodash.padEnd=function(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string},lodash.padStart=function(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string},lodash.parseInt=function(string,radix,guard){return guard||null==radix?radix=0:radix&&(radix=+radix),nativeParseInt(toString(string).replace(reTrimStart,""),radix||0)},lodash.random=function(lower,upper,floating){if(floating&&"boolean"!=typeof floating&&isIterateeCall(lower,upper,floating)&&(upper=floating=undefined),undefined===floating&&("boolean"==typeof upper?(floating=upper,upper=undefined):"boolean"==typeof lower&&(floating=lower,lower=undefined)),undefined===lower&&undefined===upper?(lower=0,upper=1):(lower=toFinite(lower),undefined===upper?(upper=lower,lower=0):upper=toFinite(upper)),lower>upper){var temp=lower;lower=upper,upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)},lodash.reduce=function(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)},lodash.reduceRight=function(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)},lodash.repeat=function(string,n,guard){return n=(guard?isIterateeCall(string,n,guard):undefined===n)?1:toInteger(n),baseRepeat(toString(string),n)},lodash.replace=function(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])},lodash.result=function(object,path,defaultValue){var index=-1,length=(path=castPath(path,object)).length;for(length||(length=1,object=undefined);++index<length;){var value=null==object?undefined:object[toKey(path[index])];undefined===value&&(index=length,value=defaultValue),object=isFunction(value)?value.call(object):value}return object},lodash.round=round,lodash.runInContext=runInContext,lodash.sample=function(collection){return(isArray(collection)?arraySample:baseSample)(collection)},lodash.size=function(collection){if(null==collection)return 0;if(isArrayLike(collection))return isString(collection)?stringSize(collection):collection.length;var tag=getTag(collection);return tag==mapTag||tag==setTag?collection.size:baseKeys(collection).length},lodash.snakeCase=snakeCase,lodash.some=function(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=undefined),func(collection,getIteratee(predicate,3))},lodash.sortedIndex=function(array,value){return baseSortedIndex(array,value)},lodash.sortedIndexBy=function(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))},lodash.sortedIndexOf=function(array,value){var length=null==array?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value))return index}return-1},lodash.sortedLastIndex=function(array,value){return baseSortedIndex(array,value,!0)},lodash.sortedLastIndexBy=function(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),!0)},lodash.sortedLastIndexOf=function(array,value){if(null==array?0:array.length){var index=baseSortedIndex(array,value,!0)-1;if(eq(array[index],value))return index}return-1},lodash.startCase=startCase,lodash.startsWith=function(string,target,position){return string=toString(string),position=null==position?0:baseClamp(toInteger(position),0,string.length),target=baseToString(target),string.slice(position,position+target.length)==target},lodash.subtract=subtract,lodash.sum=function(array){return array&&array.length?baseSum(array,identity):0},lodash.sumBy=function(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0},lodash.template=function(string,options,guard){var settings=lodash.templateSettings;guard&&isIterateeCall(string,options,guard)&&(options=undefined),string=toString(string),options=assignInWith({},options,settings,customDefaultsAssignIn);var isEscaping,isEvaluating,imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+(hasOwnProperty.call(options,"sourceURL")?(options.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,(function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match})),source+="';\n";var variable=hasOwnProperty.call(options,"variable")&&options.variable;if(variable){if(reForbiddenIdentifierChars.test(variable))throw new Error("Invalid `variable` option passed into `_.template`")}else source="with (obj) {\n"+source+"\n}\n";source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt((function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)}));if(result.source=source,isError(result))throw result;return result},lodash.times=function(n,iteratee){if((n=toInteger(n))<1||n>9007199254740991)return[];var index=4294967295,length=nativeMin(n,4294967295);n-=4294967295;for(var result=baseTimes(length,iteratee=getIteratee(iteratee));++index<n;)iteratee(index);return result},lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=function(value){return toString(value).toLowerCase()},lodash.toNumber=toNumber,lodash.toSafeInteger=function(value){return value?baseClamp(toInteger(value),-9007199254740991,9007199254740991):0===value?value:0},lodash.toString=toString,lodash.toUpper=function(value){return toString(value).toUpperCase()},lodash.trim=function(string,chars,guard){if((string=toString(string))&&(guard||undefined===chars))return baseTrim(string);if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars);return castSlice(strSymbols,charsStartIndex(strSymbols,chrSymbols),charsEndIndex(strSymbols,chrSymbols)+1).join("")},lodash.trimEnd=function(string,chars,guard){if((string=toString(string))&&(guard||undefined===chars))return string.slice(0,trimmedEndIndex(string)+1);if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string);return castSlice(strSymbols,0,charsEndIndex(strSymbols,stringToArray(chars))+1).join("")},lodash.trimStart=function(string,chars,guard){if((string=toString(string))&&(guard||undefined===chars))return string.replace(reTrimStart,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string);return castSlice(strSymbols,charsStartIndex(strSymbols,stringToArray(chars))).join("")},lodash.truncate=function(string,options){var length=30,omission="...";if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length,omission="omission"in options?baseToString(options.omission):omission}var strLength=(string=toString(string)).length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength)return string;var end=length-stringSize(omission);if(end<1)return omission;var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(undefined===separator)return result+omission;if(strSymbols&&(end+=result.length-end),isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;for(separator.global||(separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")),separator.lastIndex=0;match=separator.exec(substring);)var newEnd=match.index;result=result.slice(0,undefined===newEnd?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);index>-1&&(result=result.slice(0,index))}return result+omission},lodash.unescape=function(string){return(string=toString(string))&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string},lodash.uniqueId=function(prefix){var id=++idCounter;return toString(prefix)+id},lodash.upperCase=upperCase,lodash.upperFirst=upperFirst,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,(source={},baseForOwn(lodash,(function(func,methodName){hasOwnProperty.call(lodash.prototype,methodName)||(source[methodName]=func)})),source),{chain:!1}),lodash.VERSION="4.17.21",arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(methodName){lodash[methodName].placeholder=lodash})),arrayEach(["drop","take"],(function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=undefined===n?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();return result.__filtered__?result.__takeCount__=nativeMin(n,result.__takeCount__):result.__views__.push({size:nativeMin(n,4294967295),type:methodName+(result.__dir__<0?"Right":"")}),result},LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}})),arrayEach(["filter","map","takeWhile"],(function(methodName,index){var type=index+1,isFilter=1==type||3==type;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();return result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type}),result.__filtered__=result.__filtered__||isFilter,result}})),arrayEach(["head","last"],(function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}})),arrayEach(["initial","tail"],(function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}})),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()},LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)},LazyWrapper.prototype.invokeMap=baseRest((function(path,args){return"function"==typeof path?new LazyWrapper(this):this.map((function(value){return baseInvoke(value,path,args)}))})),LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))},LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;return result.__filtered__&&(start>0||end<0)?new LazyWrapper(result):(start<0?result=result.takeRight(-start):start&&(result=result.drop(start)),undefined!==end&&(result=(end=toInteger(end))<0?result.dropRight(-end):result.take(end-start)),result)},LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(4294967295)},baseForOwn(LazyWrapper.prototype,(function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+("last"==methodName?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);lodashFunc&&(lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value),interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};useLazy&&checkIteratee&&"function"==typeof iteratee&&1!=iteratee.length&&(isLazy=useLazy=!1);var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);return result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(result,chainAll)}return isUnwrapped&&onlyLazy?func.apply(this,args):(result=this.thru(interceptor),isUnwrapped?isTaker?result.value()[0]:result.value():result)})})),arrayEach(["pop","push","shift","sort","splice","unshift"],(function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName]((function(value){return func.apply(isArray(value)?value:[],args)}))}})),baseForOwn(LazyWrapper.prototype,(function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"";hasOwnProperty.call(realNames,key)||(realNames[key]=[]),realNames[key].push({name:methodName,func:lodashFunc})}})),realNames[createHybrid(undefined,2).name]=[{name:"wrapper",func:undefined}],LazyWrapper.prototype.clone=function(){var result=new LazyWrapper(this.__wrapped__);return result.__actions__=copyArray(this.__actions__),result.__dir__=this.__dir__,result.__filtered__=this.__filtered__,result.__iteratees__=copyArray(this.__iteratees__),result.__takeCount__=this.__takeCount__,result.__views__=copyArray(this.__views__),result},LazyWrapper.prototype.reverse=function(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1,result.__filtered__=!0}else(result=this.clone()).__dir__*=-1;return result},LazyWrapper.prototype.value=function(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=function(start,end,transforms){var index=-1,length=transforms.length;for(;++index<length;){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size)}}return{start,end}}(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length)return baseWrapperValue(array,this.__actions__);var result=[];outer:for(;length--&&resIndex<takeCount;){for(var iterIndex=-1,value=array[index+=dir];++iterIndex<iterLength;){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(2==type)value=computed;else if(!computed){if(1==type)continue outer;break outer}}result[resIndex++]=value}return result},lodash.prototype.at=wrapperAt,lodash.prototype.chain=function(){return chain(this)},lodash.prototype.commit=function(){return new LodashWrapper(this.value(),this.__chain__)},lodash.prototype.next=function(){undefined===this.__values__&&(this.__values__=toArray(this.value()));var done=this.__index__>=this.__values__.length;return{done,value:done?undefined:this.__values__[this.__index__++]}},lodash.prototype.plant=function(value){for(var result,parent=this;parent instanceof baseLodash;){var clone=wrapperClone(parent);clone.__index__=0,clone.__values__=undefined,result?previous.__wrapped__=clone:result=clone;var previous=clone;parent=parent.__wrapped__}return previous.__wrapped__=value,result},lodash.prototype.reverse=function(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;return this.__actions__.length&&(wrapped=new LazyWrapper(this)),(wrapped=wrapped.reverse()).__actions__.push({func:thru,args:[reverse],thisArg:undefined}),new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)},lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=function(){return baseWrapperValue(this.__wrapped__,this.__actions__)},lodash.prototype.first=lodash.prototype.head,symIterator&&(lodash.prototype[symIterator]=function(){return this}),lodash}();root._=_,undefined===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return _}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}.call(this)},418:module=>{"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null==val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}module.exports=function(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(test2).map((function(n){return test2[n]})).join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach((function(letter){test3[letter]=letter})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(err){return!1}}()?Object.assign:function(target,source){for(var from,symbols,to=toObject(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},657:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__(558)},558:(module,__unused_webpack_exports,__webpack_require__)=>{module.exports={Heap:__webpack_require__(485),Node:__webpack_require__(289),Grid:__webpack_require__(809),Util:__webpack_require__(408),DiagonalMovement:__webpack_require__(506),Heuristic:__webpack_require__(430),AStarFinder:__webpack_require__(131),BestFirstFinder:__webpack_require__(644),BreadthFirstFinder:__webpack_require__(904),DijkstraFinder:__webpack_require__(607),BiAStarFinder:__webpack_require__(713),BiBestFirstFinder:__webpack_require__(325),BiBreadthFirstFinder:__webpack_require__(513),BiDijkstraFinder:__webpack_require__(535),IDAStarFinder:__webpack_require__(944),JumpPointFinder:__webpack_require__(717)}},506:module=>{module.exports={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4}},809:(module,__unused_webpack_exports,__webpack_require__)=>{var Node=__webpack_require__(289),DiagonalMovement=__webpack_require__(506);function Grid(width_or_matrix,height,matrix){var width;"object"!=typeof width_or_matrix?width=width_or_matrix:(height=width_or_matrix.length,width=width_or_matrix[0].length,matrix=width_or_matrix),this.width=width,this.height=height,this.nodes=this._buildNodes(width,height,matrix)}Grid.prototype._buildNodes=function(width,height,matrix){var i,j,nodes=new Array(height);for(i=0;i<height;++i)for(nodes[i]=new Array(width),j=0;j<width;++j)nodes[i][j]=new Node(j,i);if(void 0===matrix)return nodes;if(matrix.length!==height||matrix[0].length!==width)throw new Error("Matrix size does not fit");for(i=0;i<height;++i)for(j=0;j<width;++j)matrix[i][j]&&(nodes[i][j].walkable=!1);return nodes},Grid.prototype.getNodeAt=function(x,y){return this.nodes[y][x]},Grid.prototype.isWalkableAt=function(x,y){return this.isInside(x,y)&&this.nodes[y][x].walkable},Grid.prototype.isInside=function(x,y){return x>=0&&x<this.width&&y>=0&&y<this.height},Grid.prototype.setWalkableAt=function(x,y,walkable){this.nodes[y][x].walkable=walkable},Grid.prototype.getNeighbors=function(node,diagonalMovement){var x=node.x,y=node.y,neighbors=[],s0=!1,d0=!1,s1=!1,d1=!1,s2=!1,d2=!1,s3=!1,d3=!1,nodes=this.nodes;if(this.isWalkableAt(x,y-1)&&(neighbors.push(nodes[y-1][x]),s0=!0),this.isWalkableAt(x+1,y)&&(neighbors.push(nodes[y][x+1]),s1=!0),this.isWalkableAt(x,y+1)&&(neighbors.push(nodes[y+1][x]),s2=!0),this.isWalkableAt(x-1,y)&&(neighbors.push(nodes[y][x-1]),s3=!0),diagonalMovement===DiagonalMovement.Never)return neighbors;if(diagonalMovement===DiagonalMovement.OnlyWhenNoObstacles)d0=s3&&s0,d1=s0&&s1,d2=s1&&s2,d3=s2&&s3;else if(diagonalMovement===DiagonalMovement.IfAtMostOneObstacle)d0=s3||s0,d1=s0||s1,d2=s1||s2,d3=s2||s3;else{if(diagonalMovement!==DiagonalMovement.Always)throw new Error("Incorrect value of diagonalMovement");d0=!0,d1=!0,d2=!0,d3=!0}return d0&&this.isWalkableAt(x-1,y-1)&&neighbors.push(nodes[y-1][x-1]),d1&&this.isWalkableAt(x+1,y-1)&&neighbors.push(nodes[y-1][x+1]),d2&&this.isWalkableAt(x+1,y+1)&&neighbors.push(nodes[y+1][x+1]),d3&&this.isWalkableAt(x-1,y+1)&&neighbors.push(nodes[y+1][x-1]),neighbors},Grid.prototype.clone=function(){var i,j,width=this.width,height=this.height,thisNodes=this.nodes,newGrid=new Grid(width,height),newNodes=new Array(height);for(i=0;i<height;++i)for(newNodes[i]=new Array(width),j=0;j<width;++j)newNodes[i][j]=new Node(j,i,thisNodes[i][j].walkable);return newGrid.nodes=newNodes,newGrid},module.exports=Grid},430:module=>{module.exports={manhattan:function(dx,dy){return dx+dy},euclidean:function(dx,dy){return Math.sqrt(dx*dx+dy*dy)},octile:function(dx,dy){var F=Math.SQRT2-1;return dx<dy?F*dx+dy:F*dy+dx},chebyshev:function(dx,dy){return Math.max(dx,dy)}}},289:module=>{module.exports=function(x,y,walkable){this.x=x,this.y=y,this.walkable=void 0===walkable||walkable}},408:(__unused_webpack_module,exports)=>{function backtrace(node){for(var path=[[node.x,node.y]];node.parent;)node=node.parent,path.push([node.x,node.y]);return path.reverse()}function interpolate(x0,y0,x1,y1){var sx,sy,dx,dy,err,e2,abs=Math.abs,line=[];for(sx=x0<x1?1:-1,sy=y0<y1?1:-1,err=(dx=abs(x1-x0))-(dy=abs(y1-y0));line.push([x0,y0]),x0!==x1||y0!==y1;)(e2=2*err)>-dy&&(err-=dy,x0+=sx),e2<dx&&(err+=dx,y0+=sy);return line}exports.backtrace=backtrace,exports.biBacktrace=function(nodeA,nodeB){var pathA=backtrace(nodeA),pathB=backtrace(nodeB);return pathA.concat(pathB.reverse())},exports.pathLength=function(path){var i,a,b,dx,dy,sum=0;for(i=1;i<path.length;++i)a=path[i-1],b=path[i],dx=a[0]-b[0],dy=a[1]-b[1],sum+=Math.sqrt(dx*dx+dy*dy);return sum},exports.interpolate=interpolate,exports.expandPath=function(path){var coord0,coord1,interpolated,interpolatedLen,i,j,expanded=[],len=path.length;if(len<2)return expanded;for(i=0;i<len-1;++i)for(coord0=path[i],coord1=path[i+1],interpolatedLen=(interpolated=interpolate(coord0[0],coord0[1],coord1[0],coord1[1])).length,j=0;j<interpolatedLen-1;++j)expanded.push(interpolated[j]);return expanded.push(path[len-1]),expanded},exports.smoothenPath=function(grid,path){var sx,sy,newPath,i,j,coord,line,testCoord,blocked,len=path.length,x0=path[0][0],y0=path[0][1],x1=path[len-1][0],y1=path[len-1][1];for(newPath=[[sx=x0,sy=y0]],i=2;i<len;++i){for(line=interpolate(sx,sy,(coord=path[i])[0],coord[1]),blocked=!1,j=1;j<line.length;++j)if(testCoord=line[j],!grid.isWalkableAt(testCoord[0],testCoord[1])){blocked=!0;break}blocked&&(lastValidCoord=path[i-1],newPath.push(lastValidCoord),sx=lastValidCoord[0],sy=lastValidCoord[1])}return newPath.push([x1,y1]),newPath},exports.compressPath=function(path){if(path.length<3)return path;var lx,ly,ldx,ldy,sq,i,compressed=[],sx=path[0][0],sy=path[0][1],px=path[1][0],py=path[1][1],dx=px-sx,dy=py-sy;for(dx/=sq=Math.sqrt(dx*dx+dy*dy),dy/=sq,compressed.push([sx,sy]),i=2;i<path.length;i++)lx=px,ly=py,ldx=dx,ldy=dy,dx=(px=path[i][0])-lx,dy=(py=path[i][1])-ly,dy/=sq=Math.sqrt(dx*dx+dy*dy),(dx/=sq)===ldx&&dy===ldy||compressed.push([lx,ly]);return compressed.push([px,py]),compressed}},131:(module,__unused_webpack_exports,__webpack_require__)=>{var Heap=__webpack_require__(485),Util=__webpack_require__(408),Heuristic=__webpack_require__(430),DiagonalMovement=__webpack_require__(506);function AStarFinder(opt){opt=opt||{},this.allowDiagonal=opt.allowDiagonal,this.dontCrossCorners=opt.dontCrossCorners,this.heuristic=opt.heuristic||Heuristic.manhattan,this.weight=opt.weight||1,this.diagonalMovement=opt.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=DiagonalMovement.OnlyWhenNoObstacles:this.diagonalMovement=DiagonalMovement.IfAtMostOneObstacle:this.diagonalMovement=DiagonalMovement.Never),this.diagonalMovement===DiagonalMovement.Never?this.heuristic=opt.heuristic||Heuristic.manhattan:this.heuristic=opt.heuristic||Heuristic.octile}AStarFinder.prototype.findPath=function(startX,startY,endX,endY,grid){var node,neighbors,neighbor,i,l,x,y,ng,openList=new Heap((function(nodeA,nodeB){return nodeA.f-nodeB.f})),startNode=grid.getNodeAt(startX,startY),endNode=grid.getNodeAt(endX,endY),heuristic=this.heuristic,diagonalMovement=this.diagonalMovement,weight=this.weight,abs=Math.abs,SQRT2=Math.SQRT2;for(startNode.g=0,startNode.f=0,openList.push(startNode),startNode.opened=!0;!openList.empty();){if((node=openList.pop()).closed=!0,node===endNode)return Util.backtrace(endNode);for(i=0,l=(neighbors=grid.getNeighbors(node,diagonalMovement)).length;i<l;++i)(neighbor=neighbors[i]).closed||(x=neighbor.x,y=neighbor.y,ng=node.g+(x-node.x==0||y-node.y==0?1:SQRT2),(!neighbor.opened||ng<neighbor.g)&&(neighbor.g=ng,neighbor.h=neighbor.h||weight*heuristic(abs(x-endX),abs(y-endY)),neighbor.f=neighbor.g+neighbor.h,neighbor.parent=node,neighbor.opened?openList.updateItem(neighbor):(openList.push(neighbor),neighbor.opened=!0)))}return[]},module.exports=AStarFinder},644:(module,__unused_webpack_exports,__webpack_require__)=>{var AStarFinder=__webpack_require__(131);function BestFirstFinder(opt){AStarFinder.call(this,opt);var orig=this.heuristic;this.heuristic=function(dx,dy){return 1e6*orig(dx,dy)}}BestFirstFinder.prototype=new AStarFinder,BestFirstFinder.prototype.constructor=BestFirstFinder,module.exports=BestFirstFinder},713:(module,__unused_webpack_exports,__webpack_require__)=>{var Heap=__webpack_require__(485),Util=__webpack_require__(408),Heuristic=__webpack_require__(430),DiagonalMovement=__webpack_require__(506);function BiAStarFinder(opt){opt=opt||{},this.allowDiagonal=opt.allowDiagonal,this.dontCrossCorners=opt.dontCrossCorners,this.diagonalMovement=opt.diagonalMovement,this.heuristic=opt.heuristic||Heuristic.manhattan,this.weight=opt.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=DiagonalMovement.OnlyWhenNoObstacles:this.diagonalMovement=DiagonalMovement.IfAtMostOneObstacle:this.diagonalMovement=DiagonalMovement.Never),this.diagonalMovement===DiagonalMovement.Never?this.heuristic=opt.heuristic||Heuristic.manhattan:this.heuristic=opt.heuristic||Heuristic.octile}BiAStarFinder.prototype.findPath=function(startX,startY,endX,endY,grid){var node,neighbors,neighbor,i,l,x,y,ng,cmp=function(nodeA,nodeB){return nodeA.f-nodeB.f},startOpenList=new Heap(cmp),endOpenList=new Heap(cmp),startNode=grid.getNodeAt(startX,startY),endNode=grid.getNodeAt(endX,endY),heuristic=this.heuristic,diagonalMovement=this.diagonalMovement,weight=this.weight,abs=Math.abs,SQRT2=Math.SQRT2;for(startNode.g=0,startNode.f=0,startOpenList.push(startNode),startNode.opened=1,endNode.g=0,endNode.f=0,endOpenList.push(endNode),endNode.opened=2;!startOpenList.empty()&&!endOpenList.empty();){for((node=startOpenList.pop()).closed=!0,i=0,l=(neighbors=grid.getNeighbors(node,diagonalMovement)).length;i<l;++i)if(!(neighbor=neighbors[i]).closed){if(2===neighbor.opened)return Util.biBacktrace(node,neighbor);x=neighbor.x,y=neighbor.y,ng=node.g+(x-node.x==0||y-node.y==0?1:SQRT2),(!neighbor.opened||ng<neighbor.g)&&(neighbor.g=ng,neighbor.h=neighbor.h||weight*heuristic(abs(x-endX),abs(y-endY)),neighbor.f=neighbor.g+neighbor.h,neighbor.parent=node,neighbor.opened?startOpenList.updateItem(neighbor):(startOpenList.push(neighbor),neighbor.opened=1))}for((node=endOpenList.pop()).closed=!0,i=0,l=(neighbors=grid.getNeighbors(node,diagonalMovement)).length;i<l;++i)if(!(neighbor=neighbors[i]).closed){if(1===neighbor.opened)return Util.biBacktrace(neighbor,node);x=neighbor.x,y=neighbor.y,ng=node.g+(x-node.x==0||y-node.y==0?1:SQRT2),(!neighbor.opened||ng<neighbor.g)&&(neighbor.g=ng,neighbor.h=neighbor.h||weight*heuristic(abs(x-startX),abs(y-startY)),neighbor.f=neighbor.g+neighbor.h,neighbor.parent=node,neighbor.opened?endOpenList.updateItem(neighbor):(endOpenList.push(neighbor),neighbor.opened=2))}}return[]},module.exports=BiAStarFinder},325:(module,__unused_webpack_exports,__webpack_require__)=>{var BiAStarFinder=__webpack_require__(713);function BiBestFirstFinder(opt){BiAStarFinder.call(this,opt);var orig=this.heuristic;this.heuristic=function(dx,dy){return 1e6*orig(dx,dy)}}BiBestFirstFinder.prototype=new BiAStarFinder,BiBestFirstFinder.prototype.constructor=BiBestFirstFinder,module.exports=BiBestFirstFinder},513:(module,__unused_webpack_exports,__webpack_require__)=>{var Util=__webpack_require__(408),DiagonalMovement=__webpack_require__(506);function BiBreadthFirstFinder(opt){opt=opt||{},this.allowDiagonal=opt.allowDiagonal,this.dontCrossCorners=opt.dontCrossCorners,this.diagonalMovement=opt.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=DiagonalMovement.OnlyWhenNoObstacles:this.diagonalMovement=DiagonalMovement.IfAtMostOneObstacle:this.diagonalMovement=DiagonalMovement.Never)}BiBreadthFirstFinder.prototype.findPath=function(startX,startY,endX,endY,grid){var neighbors,neighbor,node,i,l,startNode=grid.getNodeAt(startX,startY),endNode=grid.getNodeAt(endX,endY),startOpenList=[],endOpenList=[],diagonalMovement=this.diagonalMovement;for(startOpenList.push(startNode),startNode.opened=!0,startNode.by=0,endOpenList.push(endNode),endNode.opened=!0,endNode.by=1;startOpenList.length&&endOpenList.length;){for((node=startOpenList.shift()).closed=!0,i=0,l=(neighbors=grid.getNeighbors(node,diagonalMovement)).length;i<l;++i)if(!(neighbor=neighbors[i]).closed)if(neighbor.opened){if(1===neighbor.by)return Util.biBacktrace(node,neighbor)}else startOpenList.push(neighbor),neighbor.parent=node,neighbor.opened=!0,neighbor.by=0;for((node=endOpenList.shift()).closed=!0,i=0,l=(neighbors=grid.getNeighbors(node,diagonalMovement)).length;i<l;++i)if(!(neighbor=neighbors[i]).closed)if(neighbor.opened){if(0===neighbor.by)return Util.biBacktrace(neighbor,node)}else endOpenList.push(neighbor),neighbor.parent=node,neighbor.opened=!0,neighbor.by=1}return[]},module.exports=BiBreadthFirstFinder},535:(module,__unused_webpack_exports,__webpack_require__)=>{var BiAStarFinder=__webpack_require__(713);function BiDijkstraFinder(opt){BiAStarFinder.call(this,opt),this.heuristic=function(dx,dy){return 0}}BiDijkstraFinder.prototype=new BiAStarFinder,BiDijkstraFinder.prototype.constructor=BiDijkstraFinder,module.exports=BiDijkstraFinder},904:(module,__unused_webpack_exports,__webpack_require__)=>{var Util=__webpack_require__(408),DiagonalMovement=__webpack_require__(506);function BreadthFirstFinder(opt){opt=opt||{},this.allowDiagonal=opt.allowDiagonal,this.dontCrossCorners=opt.dontCrossCorners,this.diagonalMovement=opt.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=DiagonalMovement.OnlyWhenNoObstacles:this.diagonalMovement=DiagonalMovement.IfAtMostOneObstacle:this.diagonalMovement=DiagonalMovement.Never)}BreadthFirstFinder.prototype.findPath=function(startX,startY,endX,endY,grid){var neighbors,neighbor,node,i,l,openList=[],diagonalMovement=this.diagonalMovement,startNode=grid.getNodeAt(startX,startY),endNode=grid.getNodeAt(endX,endY);for(openList.push(startNode),startNode.opened=!0;openList.length;){if((node=openList.shift()).closed=!0,node===endNode)return Util.backtrace(endNode);for(i=0,l=(neighbors=grid.getNeighbors(node,diagonalMovement)).length;i<l;++i)(neighbor=neighbors[i]).closed||neighbor.opened||(openList.push(neighbor),neighbor.opened=!0,neighbor.parent=node)}return[]},module.exports=BreadthFirstFinder},607:(module,__unused_webpack_exports,__webpack_require__)=>{var AStarFinder=__webpack_require__(131);function DijkstraFinder(opt){AStarFinder.call(this,opt),this.heuristic=function(dx,dy){return 0}}DijkstraFinder.prototype=new AStarFinder,DijkstraFinder.prototype.constructor=DijkstraFinder,module.exports=DijkstraFinder},944:(module,__unused_webpack_exports,__webpack_require__)=>{__webpack_require__(408);var Heuristic=__webpack_require__(430),Node=__webpack_require__(289),DiagonalMovement=__webpack_require__(506);function IDAStarFinder(opt){opt=opt||{},this.allowDiagonal=opt.allowDiagonal,this.dontCrossCorners=opt.dontCrossCorners,this.diagonalMovement=opt.diagonalMovement,this.heuristic=opt.heuristic||Heuristic.manhattan,this.weight=opt.weight||1,this.trackRecursion=opt.trackRecursion||!1,this.timeLimit=opt.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=DiagonalMovement.OnlyWhenNoObstacles:this.diagonalMovement=DiagonalMovement.IfAtMostOneObstacle:this.diagonalMovement=DiagonalMovement.Never),this.diagonalMovement===DiagonalMovement.Never?this.heuristic=opt.heuristic||Heuristic.manhattan:this.heuristic=opt.heuristic||Heuristic.octile}IDAStarFinder.prototype.findPath=function(startX,startY,endX,endY,grid){var j,route,t,startTime=(new Date).getTime(),h=function(a,b){return this.heuristic(Math.abs(b.x-a.x),Math.abs(b.y-a.y))}.bind(this),search=function(node,g,cutoff,route,depth){if(this.timeLimit>0&&(new Date).getTime()-startTime>1e3*this.timeLimit)return 1/0;var min,t,k,neighbour,f=g+h(node,end)*this.weight;if(f>cutoff)return f;if(node==end)return route[depth]=[node.x,node.y],node;var a,b,neighbours=grid.getNeighbors(node,this.diagonalMovement);for(k=0,min=1/0;neighbour=neighbours[k];++k){if(this.trackRecursion&&(neighbour.retainCount=neighbour.retainCount+1||1,!0!==neighbour.tested&&(neighbour.tested=!0)),(t=search(neighbour,g+(b=neighbour,(a=node).x===b.x||a.y===b.y?1:Math.SQRT2),cutoff,route,depth+1))instanceof Node)return route[depth]=[node.x,node.y],t;this.trackRecursion&&0==--neighbour.retainCount&&(neighbour.tested=!1),t<min&&(min=t)}return min}.bind(this),start=grid.getNodeAt(startX,startY),end=grid.getNodeAt(endX,endY),cutOff=h(start,end);for(j=0;;++j){if((t=search(start,0,cutOff,route=[],0))===1/0)return[];if(t instanceof Node)return route;cutOff=t}return[]},module.exports=IDAStarFinder},524:(module,__unused_webpack_exports,__webpack_require__)=>{var JumpPointFinderBase=__webpack_require__(10),DiagonalMovement=__webpack_require__(506);function JPFAlwaysMoveDiagonally(opt){JumpPointFinderBase.call(this,opt)}JPFAlwaysMoveDiagonally.prototype=new JumpPointFinderBase,JPFAlwaysMoveDiagonally.prototype.constructor=JPFAlwaysMoveDiagonally,JPFAlwaysMoveDiagonally.prototype._jump=function(x,y,px,py){var grid=this.grid,dx=x-px,dy=y-py;if(!grid.isWalkableAt(x,y))return null;if(!0===this.trackJumpRecursion&&(grid.getNodeAt(x,y).tested=!0),grid.getNodeAt(x,y)===this.endNode)return[x,y];if(0!==dx&&0!==dy){if(grid.isWalkableAt(x-dx,y+dy)&&!grid.isWalkableAt(x-dx,y)||grid.isWalkableAt(x+dx,y-dy)&&!grid.isWalkableAt(x,y-dy))return[x,y];if(this._jump(x+dx,y,x,y)||this._jump(x,y+dy,x,y))return[x,y]}else if(0!==dx){if(grid.isWalkableAt(x+dx,y+1)&&!grid.isWalkableAt(x,y+1)||grid.isWalkableAt(x+dx,y-1)&&!grid.isWalkableAt(x,y-1))return[x,y]}else if(grid.isWalkableAt(x+1,y+dy)&&!grid.isWalkableAt(x+1,y)||grid.isWalkableAt(x-1,y+dy)&&!grid.isWalkableAt(x-1,y))return[x,y];return this._jump(x+dx,y+dy,x,y)},JPFAlwaysMoveDiagonally.prototype._findNeighbors=function(node){var px,py,dx,dy,neighborNodes,neighborNode,i,l,parent=node.parent,x=node.x,y=node.y,grid=this.grid,neighbors=[];if(parent)px=parent.x,py=parent.y,dx=(x-px)/Math.max(Math.abs(x-px),1),dy=(y-py)/Math.max(Math.abs(y-py),1),0!==dx&&0!==dy?(grid.isWalkableAt(x,y+dy)&&neighbors.push([x,y+dy]),grid.isWalkableAt(x+dx,y)&&neighbors.push([x+dx,y]),grid.isWalkableAt(x+dx,y+dy)&&neighbors.push([x+dx,y+dy]),grid.isWalkableAt(x-dx,y)||neighbors.push([x-dx,y+dy]),grid.isWalkableAt(x,y-dy)||neighbors.push([x+dx,y-dy])):0===dx?(grid.isWalkableAt(x,y+dy)&&neighbors.push([x,y+dy]),grid.isWalkableAt(x+1,y)||neighbors.push([x+1,y+dy]),grid.isWalkableAt(x-1,y)||neighbors.push([x-1,y+dy])):(grid.isWalkableAt(x+dx,y)&&neighbors.push([x+dx,y]),grid.isWalkableAt(x,y+1)||neighbors.push([x+dx,y+1]),grid.isWalkableAt(x,y-1)||neighbors.push([x+dx,y-1]));else for(i=0,l=(neighborNodes=grid.getNeighbors(node,DiagonalMovement.Always)).length;i<l;++i)neighborNode=neighborNodes[i],neighbors.push([neighborNode.x,neighborNode.y]);return neighbors},module.exports=JPFAlwaysMoveDiagonally},405:(module,__unused_webpack_exports,__webpack_require__)=>{var JumpPointFinderBase=__webpack_require__(10),DiagonalMovement=__webpack_require__(506);function JPFMoveDiagonallyIfAtMostOneObstacle(opt){JumpPointFinderBase.call(this,opt)}JPFMoveDiagonallyIfAtMostOneObstacle.prototype=new JumpPointFinderBase,JPFMoveDiagonallyIfAtMostOneObstacle.prototype.constructor=JPFMoveDiagonallyIfAtMostOneObstacle,JPFMoveDiagonallyIfAtMostOneObstacle.prototype._jump=function(x,y,px,py){var grid=this.grid,dx=x-px,dy=y-py;if(!grid.isWalkableAt(x,y))return null;if(!0===this.trackJumpRecursion&&(grid.getNodeAt(x,y).tested=!0),grid.getNodeAt(x,y)===this.endNode)return[x,y];if(0!==dx&&0!==dy){if(grid.isWalkableAt(x-dx,y+dy)&&!grid.isWalkableAt(x-dx,y)||grid.isWalkableAt(x+dx,y-dy)&&!grid.isWalkableAt(x,y-dy))return[x,y];if(this._jump(x+dx,y,x,y)||this._jump(x,y+dy,x,y))return[x,y]}else if(0!==dx){if(grid.isWalkableAt(x+dx,y+1)&&!grid.isWalkableAt(x,y+1)||grid.isWalkableAt(x+dx,y-1)&&!grid.isWalkableAt(x,y-1))return[x,y]}else if(grid.isWalkableAt(x+1,y+dy)&&!grid.isWalkableAt(x+1,y)||grid.isWalkableAt(x-1,y+dy)&&!grid.isWalkableAt(x-1,y))return[x,y];return grid.isWalkableAt(x+dx,y)||grid.isWalkableAt(x,y+dy)?this._jump(x+dx,y+dy,x,y):null},JPFMoveDiagonallyIfAtMostOneObstacle.prototype._findNeighbors=function(node){var px,py,dx,dy,neighborNodes,neighborNode,i,l,parent=node.parent,x=node.x,y=node.y,grid=this.grid,neighbors=[];if(parent)px=parent.x,py=parent.y,dx=(x-px)/Math.max(Math.abs(x-px),1),dy=(y-py)/Math.max(Math.abs(y-py),1),0!==dx&&0!==dy?(grid.isWalkableAt(x,y+dy)&&neighbors.push([x,y+dy]),grid.isWalkableAt(x+dx,y)&&neighbors.push([x+dx,y]),(grid.isWalkableAt(x,y+dy)||grid.isWalkableAt(x+dx,y))&&neighbors.push([x+dx,y+dy]),!grid.isWalkableAt(x-dx,y)&&grid.isWalkableAt(x,y+dy)&&neighbors.push([x-dx,y+dy]),!grid.isWalkableAt(x,y-dy)&&grid.isWalkableAt(x+dx,y)&&neighbors.push([x+dx,y-dy])):0===dx?grid.isWalkableAt(x,y+dy)&&(neighbors.push([x,y+dy]),grid.isWalkableAt(x+1,y)||neighbors.push([x+1,y+dy]),grid.isWalkableAt(x-1,y)||neighbors.push([x-1,y+dy])):grid.isWalkableAt(x+dx,y)&&(neighbors.push([x+dx,y]),grid.isWalkableAt(x,y+1)||neighbors.push([x+dx,y+1]),grid.isWalkableAt(x,y-1)||neighbors.push([x+dx,y-1]));else for(i=0,l=(neighborNodes=grid.getNeighbors(node,DiagonalMovement.IfAtMostOneObstacle)).length;i<l;++i)neighborNode=neighborNodes[i],neighbors.push([neighborNode.x,neighborNode.y]);return neighbors},module.exports=JPFMoveDiagonallyIfAtMostOneObstacle},368:(module,__unused_webpack_exports,__webpack_require__)=>{var JumpPointFinderBase=__webpack_require__(10),DiagonalMovement=__webpack_require__(506);function JPFMoveDiagonallyIfNoObstacles(opt){JumpPointFinderBase.call(this,opt)}JPFMoveDiagonallyIfNoObstacles.prototype=new JumpPointFinderBase,JPFMoveDiagonallyIfNoObstacles.prototype.constructor=JPFMoveDiagonallyIfNoObstacles,JPFMoveDiagonallyIfNoObstacles.prototype._jump=function(x,y,px,py){var grid=this.grid,dx=x-px,dy=y-py;if(!grid.isWalkableAt(x,y))return null;if(!0===this.trackJumpRecursion&&(grid.getNodeAt(x,y).tested=!0),grid.getNodeAt(x,y)===this.endNode)return[x,y];if(0!==dx&&0!==dy){if(this._jump(x+dx,y,x,y)||this._jump(x,y+dy,x,y))return[x,y]}else if(0!==dx){if(grid.isWalkableAt(x,y-1)&&!grid.isWalkableAt(x-dx,y-1)||grid.isWalkableAt(x,y+1)&&!grid.isWalkableAt(x-dx,y+1))return[x,y]}else if(0!==dy&&(grid.isWalkableAt(x-1,y)&&!grid.isWalkableAt(x-1,y-dy)||grid.isWalkableAt(x+1,y)&&!grid.isWalkableAt(x+1,y-dy)))return[x,y];return grid.isWalkableAt(x+dx,y)&&grid.isWalkableAt(x,y+dy)?this._jump(x+dx,y+dy,x,y):null},JPFMoveDiagonallyIfNoObstacles.prototype._findNeighbors=function(node){var px,py,dx,dy,neighborNodes,neighborNode,i,l,isNextWalkable,parent=node.parent,x=node.x,y=node.y,grid=this.grid,neighbors=[];if(parent){if(px=parent.x,py=parent.y,dx=(x-px)/Math.max(Math.abs(x-px),1),dy=(y-py)/Math.max(Math.abs(y-py),1),0!==dx&&0!==dy)grid.isWalkableAt(x,y+dy)&&neighbors.push([x,y+dy]),grid.isWalkableAt(x+dx,y)&&neighbors.push([x+dx,y]),grid.isWalkableAt(x,y+dy)&&grid.isWalkableAt(x+dx,y)&&neighbors.push([x+dx,y+dy]);else if(0!==dx){isNextWalkable=grid.isWalkableAt(x+dx,y);var isTopWalkable=grid.isWalkableAt(x,y+1),isBottomWalkable=grid.isWalkableAt(x,y-1);isNextWalkable&&(neighbors.push([x+dx,y]),isTopWalkable&&neighbors.push([x+dx,y+1]),isBottomWalkable&&neighbors.push([x+dx,y-1])),isTopWalkable&&neighbors.push([x,y+1]),isBottomWalkable&&neighbors.push([x,y-1])}else if(0!==dy){isNextWalkable=grid.isWalkableAt(x,y+dy);var isRightWalkable=grid.isWalkableAt(x+1,y),isLeftWalkable=grid.isWalkableAt(x-1,y);isNextWalkable&&(neighbors.push([x,y+dy]),isRightWalkable&&neighbors.push([x+1,y+dy]),isLeftWalkable&&neighbors.push([x-1,y+dy])),isRightWalkable&&neighbors.push([x+1,y]),isLeftWalkable&&neighbors.push([x-1,y])}}else for(i=0,l=(neighborNodes=grid.getNeighbors(node,DiagonalMovement.OnlyWhenNoObstacles)).length;i<l;++i)neighborNode=neighborNodes[i],neighbors.push([neighborNode.x,neighborNode.y]);return neighbors},module.exports=JPFMoveDiagonallyIfNoObstacles},403:(module,__unused_webpack_exports,__webpack_require__)=>{var JumpPointFinderBase=__webpack_require__(10),DiagonalMovement=__webpack_require__(506);function JPFNeverMoveDiagonally(opt){JumpPointFinderBase.call(this,opt)}JPFNeverMoveDiagonally.prototype=new JumpPointFinderBase,JPFNeverMoveDiagonally.prototype.constructor=JPFNeverMoveDiagonally,JPFNeverMoveDiagonally.prototype._jump=function(x,y,px,py){var grid=this.grid,dx=x-px,dy=y-py;if(!grid.isWalkableAt(x,y))return null;if(!0===this.trackJumpRecursion&&(grid.getNodeAt(x,y).tested=!0),grid.getNodeAt(x,y)===this.endNode)return[x,y];if(0!==dx){if(grid.isWalkableAt(x,y-1)&&!grid.isWalkableAt(x-dx,y-1)||grid.isWalkableAt(x,y+1)&&!grid.isWalkableAt(x-dx,y+1))return[x,y]}else{if(0===dy)throw new Error("Only horizontal and vertical movements are allowed");if(grid.isWalkableAt(x-1,y)&&!grid.isWalkableAt(x-1,y-dy)||grid.isWalkableAt(x+1,y)&&!grid.isWalkableAt(x+1,y-dy))return[x,y];if(this._jump(x+1,y,x,y)||this._jump(x-1,y,x,y))return[x,y]}return this._jump(x+dx,y+dy,x,y)},JPFNeverMoveDiagonally.prototype._findNeighbors=function(node){var px,py,dx,dy,neighborNodes,neighborNode,i,l,parent=node.parent,x=node.x,y=node.y,grid=this.grid,neighbors=[];if(parent)px=parent.x,py=parent.y,dx=(x-px)/Math.max(Math.abs(x-px),1),dy=(y-py)/Math.max(Math.abs(y-py),1),0!==dx?(grid.isWalkableAt(x,y-1)&&neighbors.push([x,y-1]),grid.isWalkableAt(x,y+1)&&neighbors.push([x,y+1]),grid.isWalkableAt(x+dx,y)&&neighbors.push([x+dx,y])):0!==dy&&(grid.isWalkableAt(x-1,y)&&neighbors.push([x-1,y]),grid.isWalkableAt(x+1,y)&&neighbors.push([x+1,y]),grid.isWalkableAt(x,y+dy)&&neighbors.push([x,y+dy]));else for(i=0,l=(neighborNodes=grid.getNeighbors(node,DiagonalMovement.Never)).length;i<l;++i)neighborNode=neighborNodes[i],neighbors.push([neighborNode.x,neighborNode.y]);return neighbors},module.exports=JPFNeverMoveDiagonally},717:(module,__unused_webpack_exports,__webpack_require__)=>{var DiagonalMovement=__webpack_require__(506),JPFNeverMoveDiagonally=__webpack_require__(403),JPFAlwaysMoveDiagonally=__webpack_require__(524),JPFMoveDiagonallyIfNoObstacles=__webpack_require__(368),JPFMoveDiagonallyIfAtMostOneObstacle=__webpack_require__(405);module.exports=function(opt){return(opt=opt||{}).diagonalMovement===DiagonalMovement.Never?new JPFNeverMoveDiagonally(opt):opt.diagonalMovement===DiagonalMovement.Always?new JPFAlwaysMoveDiagonally(opt):opt.diagonalMovement===DiagonalMovement.OnlyWhenNoObstacles?new JPFMoveDiagonallyIfNoObstacles(opt):new JPFMoveDiagonallyIfAtMostOneObstacle(opt)}},10:(module,__unused_webpack_exports,__webpack_require__)=>{var Heap=__webpack_require__(485),Util=__webpack_require__(408),Heuristic=__webpack_require__(430);__webpack_require__(506);function JumpPointFinderBase(opt){opt=opt||{},this.heuristic=opt.heuristic||Heuristic.manhattan,this.trackJumpRecursion=opt.trackJumpRecursion||!1}JumpPointFinderBase.prototype.findPath=function(startX,startY,endX,endY,grid){var node,openList=this.openList=new Heap((function(nodeA,nodeB){return nodeA.f-nodeB.f})),startNode=this.startNode=grid.getNodeAt(startX,startY),endNode=this.endNode=grid.getNodeAt(endX,endY);for(this.grid=grid,startNode.g=0,startNode.f=0,openList.push(startNode),startNode.opened=!0;!openList.empty();){if((node=openList.pop()).closed=!0,node===endNode)return Util.expandPath(Util.backtrace(endNode));this._identifySuccessors(node)}return[]},JumpPointFinderBase.prototype._identifySuccessors=function(node){var neighbors,neighbor,jumpPoint,i,l,jx,jy,d,ng,jumpNode,grid=this.grid,heuristic=this.heuristic,openList=this.openList,endX=this.endNode.x,endY=this.endNode.y,x=node.x,y=node.y,abs=Math.abs;Math.max;for(i=0,l=(neighbors=this._findNeighbors(node)).length;i<l;++i)if(neighbor=neighbors[i],jumpPoint=this._jump(neighbor[0],neighbor[1],x,y)){if(jx=jumpPoint[0],jy=jumpPoint[1],(jumpNode=grid.getNodeAt(jx,jy)).closed)continue;d=Heuristic.octile(abs(jx-x),abs(jy-y)),ng=node.g+d,(!jumpNode.opened||ng<jumpNode.g)&&(jumpNode.g=ng,jumpNode.h=jumpNode.h||heuristic(abs(jx-endX),abs(jy-endY)),jumpNode.f=jumpNode.g+jumpNode.h,jumpNode.parent=node,jumpNode.opened?openList.updateItem(jumpNode):(openList.push(jumpNode),jumpNode.opened=!0))}},module.exports=JumpPointFinderBase},587:module=>{"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?Array.isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj}},361:module=>{"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?Object.keys(obj).map((function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return Array.isArray(obj[k])?obj[k].map((function(v){return ks+encodeURIComponent(stringifyPrimitive(v))})).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))})).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""}},673:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";exports.decode=exports.parse=__webpack_require__(587),exports.encode=exports.stringify=__webpack_require__(361)},223:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";const stripAnsi=__webpack_require__(3),isFullwidthCodePoint=__webpack_require__(903),emojiRegex=__webpack_require__(991),stringWidth=string=>{if("string"!=typeof string||0===string.length)return 0;if(0===(string=stripAnsi(string)).length)return 0;string=string.replace(emojiRegex(),"  ");let width=0;for(let i=0;i<string.length;i++){const code=string.codePointAt(i);code<=31||code>=127&&code<=159||(code>=768&&code<=879||(code>65535&&i++,width+=isFullwidthCodePoint(code)?2:1))}return width};module.exports=stringWidth,module.exports.default=stringWidth},3:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";const ansiRegex=__webpack_require__(277);module.exports=string=>"string"==typeof string?string.replace(ansiRegex(),""):string},511:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;module=__webpack_require__.nmd(module),function(root){exports&&exports.nodeType,module&&module.nodeType;var freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self;var punycode,maxInt=2147483647,regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";return parts.length>1&&(result=parts[0]+"@",string=parts[1]),result+map((string=string.replace(regexSeparators,".")).split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,(function(value){var output="";return value>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)})).join("")}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/700):delta>>1,delta+=floor(delta/numPoints);delta>455;k+=36)delta=floor(delta/35);return floor(k+36*delta/(delta+38))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,codePoint,output=[],inputLength=input.length,i=0,n=128,bias=72;for((basic=input.lastIndexOf("-"))<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=36;index>=inputLength&&error("invalid-input"),((digit=(codePoint=input.charCodeAt(index++))-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:36)>=36||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,!(digit<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)w>floor(maxInt/(baseMinusT=36-t))&&error("overflow"),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=128,delta=0,bias=72,j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push("-");handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)(currentValue=input[j])>=n&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=36;!(q<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)qMinusT=q-t,baseMinusT=36-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode,encode,toASCII:function(input){return mapDomain(input,(function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string}))},toUnicode:function(input){return mapDomain(input,(function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string}))}},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return punycode}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()},575:(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var punycode=__webpack_require__(511),util=__webpack_require__(502);function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.Qc=urlParse,exports.DB=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.WU=function(obj){util.isString(obj)&&(obj=urlParse(obj));return obj instanceof Url?obj.format():Url.prototype.format.call(obj)};var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=__webpack_require__(673);function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,(function(match){return encodeURIComponent(match)})))+(search=search.replace("#","%23"))+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic)result.hostname=result.host=srcPath.shift(),(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift());return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var authInHost,isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);psychotic&&(result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"",(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()));return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},502:module=>{"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},152:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";const stringWidth=__webpack_require__(223),stripAnsi=__webpack_require__(3),ansiStyles=__webpack_require__(629),ESCAPES=new Set(["",""]),wrapAnsi=code=>`${ESCAPES.values().next().value}[${code}m`,wrapAnsiHyperlink=uri=>`${ESCAPES.values().next().value}]8;;${uri}`,wrapWord=(rows,word,columns)=>{const characters=[...word];let isInsideEscape=!1,isInsideLinkEscape=!1,visible=stringWidth(stripAnsi(rows[rows.length-1]));for(const[index,character]of characters.entries()){const characterLength=stringWidth(character);visible+characterLength<=columns?rows[rows.length-1]+=character:(rows.push(character),visible=0),ESCAPES.has(character)&&(isInsideEscape=!0,isInsideLinkEscape=characters.slice(index+1).join("").startsWith("]8;;")),isInsideEscape?isInsideLinkEscape?""===character&&(isInsideEscape=!1,isInsideLinkEscape=!1):"m"===character&&(isInsideEscape=!1):(visible+=characterLength,visible===columns&&index<characters.length-1&&(rows.push(""),visible=0))}!visible&&rows[rows.length-1].length>0&&rows.length>1&&(rows[rows.length-2]+=rows.pop())},stringVisibleTrimSpacesRight=string=>{const words=string.split(" ");let last=words.length;for(;last>0&&!(stringWidth(words[last-1])>0);)last--;return last===words.length?string:words.slice(0,last).join(" ")+words.slice(last).join("")},exec=(string,columns,options={})=>{if(!1!==options.trim&&""===string.trim())return"";let escapeCode,escapeUrl,returnValue="";const lengths=(string=>string.split(" ").map((character=>stringWidth(character))))(string);let rows=[""];for(const[index,word]of string.split(" ").entries()){!1!==options.trim&&(rows[rows.length-1]=rows[rows.length-1].trimStart());let rowLength=stringWidth(rows[rows.length-1]);if(0!==index&&(rowLength>=columns&&(!1===options.wordWrap||!1===options.trim)&&(rows.push(""),rowLength=0),(rowLength>0||!1===options.trim)&&(rows[rows.length-1]+=" ",rowLength++)),options.hard&&lengths[index]>columns){const remainingColumns=columns-rowLength,breaksStartingThisLine=1+Math.floor((lengths[index]-remainingColumns-1)/columns);Math.floor((lengths[index]-1)/columns)<breaksStartingThisLine&&rows.push(""),wrapWord(rows,word,columns)}else{if(rowLength+lengths[index]>columns&&rowLength>0&&lengths[index]>0){if(!1===options.wordWrap&&rowLength<columns){wrapWord(rows,word,columns);continue}rows.push("")}rowLength+lengths[index]>columns&&!1===options.wordWrap?wrapWord(rows,word,columns):rows[rows.length-1]+=word}}!1!==options.trim&&(rows=rows.map(stringVisibleTrimSpacesRight));const pre=[...rows.join("\n")];for(const[index,character]of pre.entries()){if(returnValue+=character,ESCAPES.has(character)){const{groups}=new RegExp("(?:\\[(?<code>\\d+)m|\\]8;;(?<uri>.*))").exec(pre.slice(index).join(""))||{groups:{}};if(void 0!==groups.code){const code=Number.parseFloat(groups.code);escapeCode=39===code?void 0:code}else void 0!==groups.uri&&(escapeUrl=0===groups.uri.length?void 0:groups.uri)}const code=ansiStyles.codes.get(Number(escapeCode));"\n"===pre[index+1]?(escapeUrl&&(returnValue+=wrapAnsiHyperlink("")),escapeCode&&code&&(returnValue+=wrapAnsi(code))):"\n"===character&&(escapeCode&&code&&(returnValue+=wrapAnsi(escapeCode)),escapeUrl&&(returnValue+=wrapAnsiHyperlink(escapeUrl)))}return returnValue};module.exports=(string,columns,options)=>String(string).normalize().replace(/\r\n/g,"\n").split("\n").map((line=>exec(line,columns,options))).join("\n")},629:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module=__webpack_require__.nmd(module);const wrapAnsi16=(fn,offset)=>(...args)=>`[${fn(...args)+offset}m`,wrapAnsi256=(fn,offset)=>(...args)=>{const code=fn(...args);return`[${38+offset};5;${code}m`},wrapAnsi16m=(fn,offset)=>(...args)=>{const rgb=fn(...args);return`[${38+offset};2;${rgb[0]};${rgb[1]};${rgb[2]}m`},ansi2ansi=n=>n,rgb2rgb=(r,g,b)=>[r,g,b],setLazyProperty=(object,property,get)=>{Object.defineProperty(object,property,{get:()=>{const value=get();return Object.defineProperty(object,property,{value,enumerable:!0,configurable:!0}),value},enumerable:!0,configurable:!0})};let colorConvert;const makeDynamicStyles=(wrap,targetSpace,identity,isBackground)=>{void 0===colorConvert&&(colorConvert=__webpack_require__(722));const offset=isBackground?10:0,styles={};for(const[sourceSpace,suite]of Object.entries(colorConvert)){const name="ansi16"===sourceSpace?"ansi":sourceSpace;sourceSpace===targetSpace?styles[name]=wrap(identity,offset):"object"==typeof suite&&(styles[name]=wrap(suite[targetSpace],offset))}return styles};Object.defineProperty(module,"exports",{enumerable:!0,get:function(){const codes=new Map,styles={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};styles.color.gray=styles.color.blackBright,styles.bgColor.bgGray=styles.bgColor.bgBlackBright,styles.color.grey=styles.color.blackBright,styles.bgColor.bgGrey=styles.bgColor.bgBlackBright;for(const[groupName,group]of Object.entries(styles)){for(const[styleName,style]of Object.entries(group))styles[styleName]={open:`[${style[0]}m`,close:`[${style[1]}m`},group[styleName]=styles[styleName],codes.set(style[0],style[1]);Object.defineProperty(styles,groupName,{value:group,enumerable:!1})}return Object.defineProperty(styles,"codes",{value:codes,enumerable:!1}),styles.color.close="[39m",styles.bgColor.close="[49m",setLazyProperty(styles.color,"ansi",(()=>makeDynamicStyles(wrapAnsi16,"ansi16",ansi2ansi,!1))),setLazyProperty(styles.color,"ansi256",(()=>makeDynamicStyles(wrapAnsi256,"ansi256",ansi2ansi,!1))),setLazyProperty(styles.color,"ansi16m",(()=>makeDynamicStyles(wrapAnsi16m,"rgb",rgb2rgb,!1))),setLazyProperty(styles.bgColor,"ansi",(()=>makeDynamicStyles(wrapAnsi16,"ansi16",ansi2ansi,!0))),setLazyProperty(styles.bgColor,"ansi256",(()=>makeDynamicStyles(wrapAnsi256,"ansi256",ansi2ansi,!0))),setLazyProperty(styles.bgColor,"ansi16m",(()=>makeDynamicStyles(wrapAnsi16m,"rgb",rgb2rgb,!0))),styles}})},833:(module,__unused_webpack_exports,__webpack_require__)=>{const cssKeywords=__webpack_require__(509),reverseKeywords={};for(const key of Object.keys(cssKeywords))reverseKeywords[cssKeywords[key]]=key;const convert={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};module.exports=convert;for(const model of Object.keys(convert)){if(!("channels"in convert[model]))throw new Error("missing channels property: "+model);if(!("labels"in convert[model]))throw new Error("missing channel labels property: "+model);if(convert[model].labels.length!==convert[model].channels)throw new Error("channel and label counts mismatch: "+model);const{channels,labels}=convert[model];delete convert[model].channels,delete convert[model].labels,Object.defineProperty(convert[model],"channels",{value:channels}),Object.defineProperty(convert[model],"labels",{value:labels})}convert.rgb.hsl=function(rgb){const r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min;let h,s;max===min?h=0:r===max?h=(g-b)/delta:g===max?h=2+(b-r)/delta:b===max&&(h=4+(r-g)/delta),h=Math.min(60*h,360),h<0&&(h+=360);const l=(min+max)/2;return s=max===min?0:l<=.5?delta/(max+min):delta/(2-max-min),[h,100*s,100*l]},convert.rgb.hsv=function(rgb){let rdif,gdif,bdif,h,s;const r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,v=Math.max(r,g,b),diff=v-Math.min(r,g,b),diffc=function(c){return(v-c)/6/diff+.5};return 0===diff?(h=0,s=0):(s=diff/v,rdif=diffc(r),gdif=diffc(g),bdif=diffc(b),r===v?h=bdif-gdif:g===v?h=1/3+rdif-bdif:b===v&&(h=2/3+gdif-rdif),h<0?h+=1:h>1&&(h-=1)),[360*h,100*s,100*v]},convert.rgb.hwb=function(rgb){const r=rgb[0],g=rgb[1];let b=rgb[2];const h=convert.rgb.hsl(rgb)[0],w=1/255*Math.min(r,Math.min(g,b));return b=1-1/255*Math.max(r,Math.max(g,b)),[h,100*w,100*b]},convert.rgb.cmyk=function(rgb){const r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,k=Math.min(1-r,1-g,1-b);return[100*((1-r-k)/(1-k)||0),100*((1-g-k)/(1-k)||0),100*((1-b-k)/(1-k)||0),100*k]},convert.rgb.keyword=function(rgb){const reversed=reverseKeywords[rgb];if(reversed)return reversed;let currentClosestKeyword,currentClosestDistance=1/0;for(const keyword of Object.keys(cssKeywords)){const value=cssKeywords[keyword],distance=(y=value,((x=rgb)[0]-y[0])**2+(x[1]-y[1])**2+(x[2]-y[2])**2);distance<currentClosestDistance&&(currentClosestDistance=distance,currentClosestKeyword=keyword)}var x,y;return currentClosestKeyword},convert.keyword.rgb=function(keyword){return cssKeywords[keyword]},convert.rgb.xyz=function(rgb){let r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,g=g>.04045?((g+.055)/1.055)**2.4:g/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92;return[100*(.4124*r+.3576*g+.1805*b),100*(.2126*r+.7152*g+.0722*b),100*(.0193*r+.1192*g+.9505*b)]},convert.rgb.lab=function(rgb){const xyz=convert.rgb.xyz(rgb);let x=xyz[0],y=xyz[1],z=xyz[2];x/=95.047,y/=100,z/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*y-16,500*(x-y),200*(y-z)]},convert.hsl.rgb=function(hsl){const h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100;let t2,t3,val;if(0===s)return val=255*l,[val,val,val];t2=l<.5?l*(1+s):l+s-l*s;const t1=2*l-t2,rgb=[0,0,0];for(let i=0;i<3;i++)t3=h+1/3*-(i-1),t3<0&&t3++,t3>1&&t3--,val=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1,rgb[i]=255*val;return rgb},convert.hsl.hsv=function(hsl){const h=hsl[0];let s=hsl[1]/100,l=hsl[2]/100,smin=s;const lmin=Math.max(l,.01);l*=2,s*=l<=1?l:2-l,smin*=lmin<=1?lmin:2-lmin;return[h,100*(0===l?2*smin/(lmin+smin):2*s/(l+s)),100*((l+s)/2)]},convert.hsv.rgb=function(hsv){const h=hsv[0]/60,s=hsv[1]/100;let v=hsv[2]/100;const hi=Math.floor(h)%6,f=h-Math.floor(h),p=255*v*(1-s),q=255*v*(1-s*f),t=255*v*(1-s*(1-f));switch(v*=255,hi){case 0:return[v,t,p];case 1:return[q,v,p];case 2:return[p,v,t];case 3:return[p,q,v];case 4:return[t,p,v];case 5:return[v,p,q]}},convert.hsv.hsl=function(hsv){const h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,vmin=Math.max(v,.01);let sl,l;l=(2-s)*v;const lmin=(2-s)*vmin;return sl=s*vmin,sl/=lmin<=1?lmin:2-lmin,sl=sl||0,l/=2,[h,100*sl,100*l]},convert.hwb.rgb=function(hwb){const h=hwb[0]/360;let wh=hwb[1]/100,bl=hwb[2]/100;const ratio=wh+bl;let f;ratio>1&&(wh/=ratio,bl/=ratio);const i=Math.floor(6*h),v=1-bl;f=6*h-i,0!=(1&i)&&(f=1-f);const n=wh+f*(v-wh);let r,g,b;switch(i){default:case 6:case 0:r=v,g=n,b=wh;break;case 1:r=n,g=v,b=wh;break;case 2:r=wh,g=v,b=n;break;case 3:r=wh,g=n,b=v;break;case 4:r=n,g=wh,b=v;break;case 5:r=v,g=wh,b=n}return[255*r,255*g,255*b]},convert.cmyk.rgb=function(cmyk){const c=cmyk[0]/100,m=cmyk[1]/100,y=cmyk[2]/100,k=cmyk[3]/100;return[255*(1-Math.min(1,c*(1-k)+k)),255*(1-Math.min(1,m*(1-k)+k)),255*(1-Math.min(1,y*(1-k)+k))]},convert.xyz.rgb=function(xyz){const x=xyz[0]/100,y=xyz[1]/100,z=xyz[2]/100;let r,g,b;return r=3.2406*x+-1.5372*y+-.4986*z,g=-.9689*x+1.8758*y+.0415*z,b=.0557*x+-.204*y+1.057*z,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,b=b>.0031308?1.055*b**(1/2.4)-.055:12.92*b,r=Math.min(Math.max(0,r),1),g=Math.min(Math.max(0,g),1),b=Math.min(Math.max(0,b),1),[255*r,255*g,255*b]},convert.xyz.lab=function(xyz){let x=xyz[0],y=xyz[1],z=xyz[2];x/=95.047,y/=100,z/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*y-16,500*(x-y),200*(y-z)]},convert.lab.xyz=function(lab){let x,y,z;y=(lab[0]+16)/116,x=lab[1]/500+y,z=y-lab[2]/200;const y2=y**3,x2=x**3,z2=z**3;return y=y2>.008856?y2:(y-16/116)/7.787,x=x2>.008856?x2:(x-16/116)/7.787,z=z2>.008856?z2:(z-16/116)/7.787,x*=95.047,y*=100,z*=108.883,[x,y,z]},convert.lab.lch=function(lab){const l=lab[0],a=lab[1],b=lab[2];let h;h=360*Math.atan2(b,a)/2/Math.PI,h<0&&(h+=360);return[l,Math.sqrt(a*a+b*b),h]},convert.lch.lab=function(lch){const l=lch[0],c=lch[1],hr=lch[2]/360*2*Math.PI;return[l,c*Math.cos(hr),c*Math.sin(hr)]},convert.rgb.ansi16=function(args,saturation=null){const[r,g,b]=args;let value=null===saturation?convert.rgb.hsv(args)[2]:saturation;if(value=Math.round(value/50),0===value)return 30;let ansi=30+(Math.round(b/255)<<2|Math.round(g/255)<<1|Math.round(r/255));return 2===value&&(ansi+=60),ansi},convert.hsv.ansi16=function(args){return convert.rgb.ansi16(convert.hsv.rgb(args),args[2])},convert.rgb.ansi256=function(args){const r=args[0],g=args[1],b=args[2];if(r===g&&g===b)return r<8?16:r>248?231:Math.round((r-8)/247*24)+232;return 16+36*Math.round(r/255*5)+6*Math.round(g/255*5)+Math.round(b/255*5)},convert.ansi16.rgb=function(args){let color=args%10;if(0===color||7===color)return args>50&&(color+=3.5),color=color/10.5*255,[color,color,color];const mult=.5*(1+~~(args>50));return[(1&color)*mult*255,(color>>1&1)*mult*255,(color>>2&1)*mult*255]},convert.ansi256.rgb=function(args){if(args>=232){const c=10*(args-232)+8;return[c,c,c]}let rem;args-=16;return[Math.floor(args/36)/5*255,Math.floor((rem=args%36)/6)/5*255,rem%6/5*255]},convert.rgb.hex=function(args){const string=(((255&Math.round(args[0]))<<16)+((255&Math.round(args[1]))<<8)+(255&Math.round(args[2]))).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert.hex.rgb=function(args){const match=args.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!match)return[0,0,0];let colorString=match[0];3===match[0].length&&(colorString=colorString.split("").map((char=>char+char)).join(""));const integer=parseInt(colorString,16);return[integer>>16&255,integer>>8&255,255&integer]},convert.rgb.hcg=function(rgb){const r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,max=Math.max(Math.max(r,g),b),min=Math.min(Math.min(r,g),b),chroma=max-min;let grayscale,hue;return grayscale=chroma<1?min/(1-chroma):0,hue=chroma<=0?0:max===r?(g-b)/chroma%6:max===g?2+(b-r)/chroma:4+(r-g)/chroma,hue/=6,hue%=1,[360*hue,100*chroma,100*grayscale]},convert.hsl.hcg=function(hsl){const s=hsl[1]/100,l=hsl[2]/100,c=l<.5?2*s*l:2*s*(1-l);let f=0;return c<1&&(f=(l-.5*c)/(1-c)),[hsl[0],100*c,100*f]},convert.hsv.hcg=function(hsv){const s=hsv[1]/100,v=hsv[2]/100,c=s*v;let f=0;return c<1&&(f=(v-c)/(1-c)),[hsv[0],100*c,100*f]},convert.hcg.rgb=function(hcg){const h=hcg[0]/360,c=hcg[1]/100,g=hcg[2]/100;if(0===c)return[255*g,255*g,255*g];const pure=[0,0,0],hi=h%1*6,v=hi%1,w=1-v;let mg=0;switch(Math.floor(hi)){case 0:pure[0]=1,pure[1]=v,pure[2]=0;break;case 1:pure[0]=w,pure[1]=1,pure[2]=0;break;case 2:pure[0]=0,pure[1]=1,pure[2]=v;break;case 3:pure[0]=0,pure[1]=w,pure[2]=1;break;case 4:pure[0]=v,pure[1]=0,pure[2]=1;break;default:pure[0]=1,pure[1]=0,pure[2]=w}return mg=(1-c)*g,[255*(c*pure[0]+mg),255*(c*pure[1]+mg),255*(c*pure[2]+mg)]},convert.hcg.hsv=function(hcg){const c=hcg[1]/100,v=c+hcg[2]/100*(1-c);let f=0;return v>0&&(f=c/v),[hcg[0],100*f,100*v]},convert.hcg.hsl=function(hcg){const c=hcg[1]/100,l=hcg[2]/100*(1-c)+.5*c;let s=0;return l>0&&l<.5?s=c/(2*l):l>=.5&&l<1&&(s=c/(2*(1-l))),[hcg[0],100*s,100*l]},convert.hcg.hwb=function(hcg){const c=hcg[1]/100,v=c+hcg[2]/100*(1-c);return[hcg[0],100*(v-c),100*(1-v)]},convert.hwb.hcg=function(hwb){const w=hwb[1]/100,v=1-hwb[2]/100,c=v-w;let g=0;return c<1&&(g=(v-c)/(1-c)),[hwb[0],100*c,100*g]},convert.apple.rgb=function(apple){return[apple[0]/65535*255,apple[1]/65535*255,apple[2]/65535*255]},convert.rgb.apple=function(rgb){return[rgb[0]/255*65535,rgb[1]/255*65535,rgb[2]/255*65535]},convert.gray.rgb=function(args){return[args[0]/100*255,args[0]/100*255,args[0]/100*255]},convert.gray.hsl=function(args){return[0,0,args[0]]},convert.gray.hsv=convert.gray.hsl,convert.gray.hwb=function(gray){return[0,100,gray[0]]},convert.gray.cmyk=function(gray){return[0,0,0,gray[0]]},convert.gray.lab=function(gray){return[gray[0],0,0]},convert.gray.hex=function(gray){const val=255&Math.round(gray[0]/100*255),string=((val<<16)+(val<<8)+val).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert.rgb.gray=function(rgb){return[(rgb[0]+rgb[1]+rgb[2])/3/255*100]}},722:(module,__unused_webpack_exports,__webpack_require__)=>{const conversions=__webpack_require__(833),route=__webpack_require__(42),convert={};Object.keys(conversions).forEach((fromModel=>{convert[fromModel]={},Object.defineProperty(convert[fromModel],"channels",{value:conversions[fromModel].channels}),Object.defineProperty(convert[fromModel],"labels",{value:conversions[fromModel].labels});const routes=route(fromModel);Object.keys(routes).forEach((toModel=>{const fn=routes[toModel];convert[fromModel][toModel]=function(fn){const wrappedFn=function(...args){const arg0=args[0];if(null==arg0)return arg0;arg0.length>1&&(args=arg0);const result=fn(args);if("object"==typeof result)for(let len=result.length,i=0;i<len;i++)result[i]=Math.round(result[i]);return result};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn}(fn),convert[fromModel][toModel].raw=function(fn){const wrappedFn=function(...args){const arg0=args[0];return null==arg0?arg0:(arg0.length>1&&(args=arg0),fn(args))};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn}(fn)}))})),module.exports=convert},42:(module,__unused_webpack_exports,__webpack_require__)=>{const conversions=__webpack_require__(833);function deriveBFS(fromModel){const graph=function(){const graph={},models=Object.keys(conversions);for(let len=models.length,i=0;i<len;i++)graph[models[i]]={distance:-1,parent:null};return graph}(),queue=[fromModel];for(graph[fromModel].distance=0;queue.length;){const current=queue.pop(),adjacents=Object.keys(conversions[current]);for(let len=adjacents.length,i=0;i<len;i++){const adjacent=adjacents[i],node=graph[adjacent];-1===node.distance&&(node.distance=graph[current].distance+1,node.parent=current,queue.unshift(adjacent))}}return graph}function link(from,to){return function(args){return to(from(args))}}function wrapConversion(toModel,graph){const path=[graph[toModel].parent,toModel];let fn=conversions[graph[toModel].parent][toModel],cur=graph[toModel].parent;for(;graph[cur].parent;)path.unshift(graph[cur].parent),fn=link(conversions[graph[cur].parent][cur],fn),cur=graph[cur].parent;return fn.conversion=path,fn}module.exports=function(fromModel){const graph=deriveBFS(fromModel),conversion={},models=Object.keys(graph);for(let len=models.length,i=0;i<len;i++){const toModel=models[i];null!==graph[toModel].parent&&(conversion[toModel]=wrapConversion(toModel,graph))}return conversion}},509:module=>{"use strict";module.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={id:moduleId,loaded:!1,exports:{}};return __webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}__webpack_require__.n=module=>{var getter=module&&module.__esModule?()=>module.default:()=>module;return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop),__webpack_require__.r=exports=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.nmd=module=>(module.paths=[],module.children||(module.children=[]),module);var __webpack_exports__={};(()=>{"use strict";__webpack_require__.d(__webpack_exports__,{y:()=>getState,I:()=>setState});var utils_namespaceObject={};__webpack_require__.r(utils_namespaceObject),__webpack_require__.d(utils_namespaceObject,{BaseTextureCache:()=>BaseTextureCache,CanvasRenderTarget:()=>CanvasRenderTarget,DATA_URI:()=>DATA_URI,EventEmitter:()=>eventemitter3_default(),ProgramCache:()=>ProgramCache,TextureCache:()=>TextureCache,clearTextureCache:()=>clearTextureCache,correctBlendMode:()=>correctBlendMode,createIndicesForQuads:()=>createIndicesForQuads,decomposeDataUri:()=>decomposeDataUri,deprecation:()=>deprecation,destroyTextureCache:()=>destroyTextureCache,determineCrossOrigin:()=>determineCrossOrigin,earcut:()=>earcut_default(),getBufferType:()=>getBufferType,getResolutionOfUrl:()=>getResolutionOfUrl,hex2rgb:()=>hex2rgb,hex2string:()=>hex2string,interleaveTypedArrays:()=>interleaveTypedArrays,isMobile:()=>settings_isMobile,isPow2:()=>isPow2,isWebGLSupported:()=>isWebGLSupported,log2:()=>log2,nextPow2:()=>nextPow2,premultiplyBlendMode:()=>premultiplyBlendMode,premultiplyRgba:()=>premultiplyRgba,premultiplyTint:()=>premultiplyTint,premultiplyTintToRgba:()=>premultiplyTintToRgba,removeItems:()=>removeItems,rgb2hex:()=>rgb2hex,sayHello:()=>sayHello,sign:()=>sign,skipHello:()=>skipHello,string2hex:()=>string2hex,trimCanvas:()=>trimCanvas,uid:()=>uid,url:()=>utils_url});var pixi_legacy_namespaceObject={};__webpack_require__.r(pixi_legacy_namespaceObject),__webpack_require__.d(pixi_legacy_namespaceObject,{ALPHA_MODES:()=>constants_ALPHA_MODES,AbstractBatchRenderer:()=>AbstractBatchRenderer,AbstractMultiResource:()=>AbstractMultiResource,AbstractRenderer:()=>AbstractRenderer,AccessibilityManager:()=>AccessibilityManager,AnimatedSprite:()=>AnimatedSprite,AppLoaderPlugin:()=>AppLoaderPlugin,Application:()=>Application,ArrayResource:()=>ArrayResource,Attribute:()=>Attribute,BLEND_MODES:()=>constants_BLEND_MODES,BUFFER_BITS:()=>constants_BUFFER_BITS,BUFFER_TYPE:()=>constants_BUFFER_TYPE,BaseImageResource:()=>BaseImageResource,BasePrepare:()=>BasePrepare,BaseRenderTexture:()=>BaseRenderTexture,BaseTexture:()=>BaseTexture,BatchDrawCall:()=>BatchDrawCall,BatchGeometry:()=>BatchGeometry,BatchPluginFactory:()=>BatchPluginFactory,BatchRenderer:()=>BatchRenderer,BatchShaderGenerator:()=>BatchShaderGenerator,BatchSystem:()=>BatchSystem,BatchTextureArray:()=>BatchTextureArray,BitmapFont:()=>BitmapFont,BitmapFontData:()=>BitmapFontData,BitmapFontLoader:()=>BitmapFontLoader,BitmapText:()=>BitmapText,BlobResource:()=>BlobResource,Bounds:()=>Bounds,Buffer:()=>Buffer,BufferResource:()=>BufferResource,CLEAR_MODES:()=>constants_CLEAR_MODES,CanvasExtract:()=>CanvasExtract,CanvasGraphicsRenderer:()=>CanvasGraphicsRenderer,CanvasMeshRenderer:()=>CanvasMeshRenderer,CanvasPrepare:()=>CanvasPrepare,CanvasRenderer:()=>CanvasRenderer,CanvasResource:()=>CanvasResource,CanvasSpriteRenderer:()=>CanvasSpriteRenderer,Circle:()=>Circle,CompressedTextureLoader:()=>CompressedTextureLoader,CompressedTextureResource:()=>CompressedTextureResource,Container:()=>Container,ContextSystem:()=>ContextSystem,CountLimiter:()=>CountLimiter,CubeResource:()=>CubeResource,DDSLoader:()=>DDSLoader,DEG_TO_RAD:()=>DEG_TO_RAD,DRAW_MODES:()=>constants_DRAW_MODES,DisplayObject:()=>DisplayObject,ENV:()=>constants_ENV,Ellipse:()=>Ellipse,Extract:()=>Extract,FORMATS:()=>constants_FORMATS,FORMATS_TO_COMPONENTS:()=>FORMATS_TO_COMPONENTS,FillStyle:()=>FillStyle,Filter:()=>Filter,FilterState:()=>FilterState,FilterSystem:()=>FilterSystem,Framebuffer:()=>Framebuffer,FramebufferSystem:()=>FramebufferSystem,GC_MODES:()=>constants_GC_MODES,GLFramebuffer:()=>GLFramebuffer,GLProgram:()=>GLProgram,GLTexture:()=>GLTexture,GRAPHICS_CURVES:()=>GRAPHICS_CURVES,Geometry:()=>Geometry,GeometrySystem:()=>GeometrySystem,Graphics:()=>Graphics,GraphicsData:()=>GraphicsData,GraphicsGeometry:()=>GraphicsGeometry,IGLUniformData:()=>IGLUniformData,INSTALLED:()=>INSTALLED,INTERNAL_FORMATS:()=>INTERNAL_FORMATS,INTERNAL_FORMAT_TO_BYTES_PER_PIXEL:()=>INTERNAL_FORMAT_TO_BYTES_PER_PIXEL,ImageBitmapResource:()=>ImageBitmapResource,ImageResource:()=>ImageResource,InteractionData:()=>InteractionData,InteractionEvent:()=>InteractionEvent,InteractionManager:()=>InteractionManager,InteractionTrackingData:()=>InteractionTrackingData,KTXLoader:()=>KTXLoader,LINE_CAP:()=>LINE_CAP,LINE_JOIN:()=>LINE_JOIN,LineStyle:()=>LineStyle,Loader:()=>Loader,LoaderResource:()=>LoaderResource,MASK_TYPES:()=>constants_MASK_TYPES,MIPMAP_MODES:()=>constants_MIPMAP_MODES,MSAA_QUALITY:()=>constants_MSAA_QUALITY,MaskData:()=>MaskData,MaskSystem:()=>MaskSystem,Matrix:()=>Matrix,Mesh:()=>Mesh,MeshBatchUvs:()=>MeshBatchUvs,MeshGeometry:()=>MeshGeometry,MeshMaterial:()=>MeshMaterial,NineSlicePlane:()=>NineSlicePlane,ObjectRenderer:()=>ObjectRenderer,ObservablePoint:()=>ObservablePoint,PI_2:()=>PI_2,PRECISION:()=>constants_PRECISION,ParticleContainer:()=>ParticleContainer,ParticleRenderer:()=>ParticleRenderer,PlaneGeometry:()=>PlaneGeometry,Point:()=>Point,Polygon:()=>Polygon,Prepare:()=>Prepare,Program:()=>Program,ProjectionSystem:()=>ProjectionSystem,Quad:()=>Quad,QuadUv:()=>QuadUv,RAD_TO_DEG:()=>RAD_TO_DEG,RENDERER_TYPE:()=>constants_RENDERER_TYPE,Rectangle:()=>Rectangle,RenderTexture:()=>RenderTexture,RenderTexturePool:()=>RenderTexturePool,RenderTextureSystem:()=>RenderTextureSystem,Renderer:()=>Renderer,Resource:()=>Resource,RopeGeometry:()=>RopeGeometry,RoundedRectangle:()=>RoundedRectangle,Runner:()=>Runner,SAMPLER_TYPES:()=>constants_SAMPLER_TYPES,SCALE_MODES:()=>constants_SCALE_MODES,SHAPES:()=>SHAPES,SVGResource:()=>SVGResource,ScissorSystem:()=>ScissorSystem,Shader:()=>Shader,ShaderSystem:()=>ShaderSystem,SimpleMesh:()=>SimpleMesh,SimplePlane:()=>SimplePlane,SimpleRope:()=>SimpleRope,Sprite:()=>Sprite,SpriteMaskFilter:()=>SpriteMaskFilter,Spritesheet:()=>Spritesheet,SpritesheetLoader:()=>SpritesheetLoader,State:()=>State,StateSystem:()=>StateSystem,StencilSystem:()=>StencilSystem,System:()=>System,TARGETS:()=>constants_TARGETS,TEXT_GRADIENT:()=>TEXT_GRADIENT,TYPES:()=>constants_TYPES,TYPES_TO_BYTES_PER_COMPONENT:()=>TYPES_TO_BYTES_PER_COMPONENT,TYPES_TO_BYTES_PER_PIXEL:()=>TYPES_TO_BYTES_PER_PIXEL,TemporaryDisplayObject:()=>TemporaryDisplayObject,Text:()=>Text,TextMetrics:()=>TextMetrics,TextStyle:()=>TextStyle,Texture:()=>Texture,TextureGCSystem:()=>TextureGCSystem,TextureLoader:()=>TextureLoader,TextureMatrix:()=>TextureMatrix,TextureSystem:()=>TextureSystem,TextureUvs:()=>TextureUvs,Ticker:()=>Ticker,TickerPlugin:()=>TickerPlugin,TilingSprite:()=>TilingSprite,TilingSpriteRenderer:()=>TilingSpriteRenderer,TimeLimiter:()=>TimeLimiter,Transform:()=>Transform,UPDATE_PRIORITY:()=>UPDATE_PRIORITY,UniformGroup:()=>UniformGroup,VERSION:()=>pixi_VERSION,VideoResource:()=>VideoResource,ViewableBuffer:()=>ViewableBuffer,WRAP_MODES:()=>constants_WRAP_MODES,accessibleTarget:()=>accessibleTarget,autoDetectRenderer:()=>autoDetectRenderer,autoDetectResource:()=>autoDetectResource,canvasUtils:()=>canvasUtils,checkMaxIfStatementsInShader:()=>checkMaxIfStatementsInShader,createUBOElements:()=>createUBOElements,defaultFilterVertex:()=>defaultFilterVertex,defaultVertex:()=>defaultVertex$2,filters:()=>filters,generateProgram:()=>generateProgram,generateUniformBufferSync:()=>generateUniformBufferSync,getTestContext:()=>getTestContext,getUBOData:()=>getUBOData,graphicsUtils:()=>graphicsUtils,groupD8:()=>groupD8,interactiveTarget:()=>interactiveTarget,isMobile:()=>settings_isMobile,resources:()=>resources,settings:()=>settings,systems:()=>systems,uniformParsers:()=>uniformParsers,utils:()=>utils_namespaceObject});var moveTo_goal_namespaceObject={};__webpack_require__.r(moveTo_goal_namespaceObject),__webpack_require__.d(moveTo_goal_namespaceObject,{isFinished:()=>isFinished,isInvalid:()=>isInvalid,takeAction:()=>takeAction});var approachTarget_goal_namespaceObject={};__webpack_require__.r(approachTarget_goal_namespaceObject),__webpack_require__.d(approachTarget_goal_namespaceObject,{isFinished:()=>approachTarget_goal_isFinished,isInvalid:()=>approachTarget_goal_isInvalid,takeAction:()=>approachTarget_goal_takeAction});var killSomething_goal_namespaceObject={};__webpack_require__.r(killSomething_goal_namespaceObject),__webpack_require__.d(killSomething_goal_namespaceObject,{isFinished:()=>killSomething_goal_isFinished,isInvalid:()=>killSomething_goal_isInvalid,takeAction:()=>killSomething_goal_takeAction});var bored_goal_namespaceObject={};__webpack_require__.r(bored_goal_namespaceObject),__webpack_require__.d(bored_goal_namespaceObject,{isBored:()=>isBored,isFinished:()=>bored_goal_isFinished,isInvalid:()=>bored_goal_isInvalid,takeAction:()=>bored_goal_takeAction});var lodash=__webpack_require__(486),lodash_default=__webpack_require__.n(lodash);const src_finally=function(callback){var constructor=this.constructor;return this.then((function(value){return constructor.resolve(callback()).then((function(){return value}))}),(function(reason){return constructor.resolve(callback()).then((function(){return constructor.reject(reason)}))}))};const src_allSettled=function(arr){return new this((function(resolve,reject){if(!arr||void 0===arr.length)return reject(new TypeError(typeof arr+" "+arr+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var args=Array.prototype.slice.call(arr);if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,(function(val){res(i,val)}),(function(e){args[i]={status:"rejected",reason:e},0==--remaining&&resolve(args)}))}args[i]={status:"fulfilled",value:val},0==--remaining&&resolve(args)}for(var i=0;i<args.length;i++)res(i,args[i])}))};var setTimeoutFunc=setTimeout,setImmediateFunc="undefined"!=typeof setImmediate?setImmediate:null;function isArray(x){return Boolean(x&&void 0!==x.length)}function noop(){}function src_Promise(fn){if(!(this instanceof src_Promise))throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;0!==self._state?(self._handled=!0,src_Promise._immediateFn((function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null!==cb){var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}else(1===self._state?resolve:reject)(deferred.promise,self._value)}))):self._deferreds.push(deferred)}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if(newValue instanceof src_Promise)return self._state=3,self._value=newValue,void finale(self);if("function"==typeof then)return void doResolve((fn=then,thisArg=newValue,function(){fn.apply(thisArg,arguments)}),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}var fn,thisArg}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&src_Promise._immediateFn((function(){self._handled||src_Promise._unhandledRejectionFn(self._value)}));for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn((function(value){done||(done=!0,resolve(self,value))}),(function(reason){done||(done=!0,reject(self,reason))}))}catch(ex){if(done)return;done=!0,reject(self,ex)}}src_Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},src_Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},src_Promise.prototype.finally=src_finally,src_Promise.all=function(arr){return new src_Promise((function(resolve,reject){if(!isArray(arr))return reject(new TypeError("Promise.all accepts an array"));var args=Array.prototype.slice.call(arr);if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,(function(val){res(i,val)}),reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++)res(i,args[i])}))},src_Promise.allSettled=src_allSettled,src_Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===src_Promise?value:new src_Promise((function(resolve){resolve(value)}))},src_Promise.reject=function(value){return new src_Promise((function(resolve,reject){reject(value)}))},src_Promise.race=function(arr){return new src_Promise((function(resolve,reject){if(!isArray(arr))return reject(new TypeError("Promise.race accepts an array"));for(var i=0,len=arr.length;i<len;i++)src_Promise.resolve(arr[i]).then(resolve,reject)}))},src_Promise._immediateFn="function"==typeof setImmediateFunc&&function(fn){setImmediateFunc(fn)}||function(fn){setTimeoutFunc(fn,0)},src_Promise._unhandledRejectionFn=function(err){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",err)};const src=src_Promise;var object_assign=__webpack_require__(418),object_assign_default=__webpack_require__.n(object_assign);self.Promise||(self.Promise=src),Object.assign||(Object.assign=object_assign_default());if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!self.performance||!self.performance.now){var startTime_1=Date.now();self.performance||(self.performance={}),self.performance.now=function(){return Date.now()-startTime_1}}for(var lastTime=Date.now(),vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!self.requestAnimationFrame;++x){var p=vendors[x];self.requestAnimationFrame=self[p+"RequestAnimationFrame"],self.cancelAnimationFrame=self[p+"CancelAnimationFrame"]||self[p+"CancelRequestAnimationFrame"]}self.requestAnimationFrame||(self.requestAnimationFrame=function(callback){if("function"!=typeof callback)throw new TypeError(callback+"is not a function");var currentTime=Date.now(),delay=16+lastTime-currentTime;return delay<0&&(delay=0),lastTime=currentTime,self.setTimeout((function(){lastTime=Date.now(),callback(performance.now())}),delay)}),self.cancelAnimationFrame||(self.cancelAnimationFrame=function(id){return clearTimeout(id)}),Math.sign||(Math.sign=function(x){return 0===(x=Number(x))||isNaN(x)?x:x>0?1:-1}),Number.isInteger||(Number.isInteger=function(value){return"number"==typeof value&&isFinite(value)&&Math.floor(value)===value}),self.ArrayBuffer||(self.ArrayBuffer=Array),self.Float32Array||(self.Float32Array=Array),self.Uint32Array||(self.Uint32Array=Array),self.Uint16Array||(self.Uint16Array=Array),self.Uint8Array||(self.Uint8Array=Array),self.Int32Array||(self.Int32Array=Array);var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(navigator){return void 0!==navigator&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1&&"undefined"==typeof MSStream};var ENV,RENDERER_TYPE,BUFFER_BITS,BLEND_MODES,DRAW_MODES,FORMATS,TARGETS,TYPES,SAMPLER_TYPES,SCALE_MODES,WRAP_MODES,MIPMAP_MODES,ALPHA_MODES,CLEAR_MODES,GC_MODES,PRECISION,MASK_TYPES,MSAA_QUALITY,BUFFER_TYPE,settings_isMobile=function(param){var nav={userAgent:"",platform:"",maxTouchPoints:0};param||"undefined"==typeof navigator?"string"==typeof param?nav.userAgent=param:param&&param.userAgent&&(nav={userAgent:param.userAgent,platform:param.platform,maxTouchPoints:param.maxTouchPoints||0}):nav={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var userAgent=nav.userAgent,tmp=userAgent.split("[FBAN");void 0!==tmp[1]&&(userAgent=tmp[0]),void 0!==(tmp=userAgent.split("Twitter"))[1]&&(userAgent=tmp[0]);var match=function(userAgent){return function(regex){return regex.test(userAgent)}}(userAgent),result={apple:{phone:match(appleIphone)&&!match(windowsPhone),ipod:match(appleIpod),tablet:!match(appleIphone)&&(match(appleTablet)||isAppleTabletOnIos13(nav))&&!match(windowsPhone),universal:match(appleUniversal),device:(match(appleIphone)||match(appleIpod)||match(appleTablet)||match(appleUniversal)||isAppleTabletOnIos13(nav))&&!match(windowsPhone)},amazon:{phone:match(amazonPhone),tablet:!match(amazonPhone)&&match(amazonTablet),device:match(amazonPhone)||match(amazonTablet)},android:{phone:!match(windowsPhone)&&match(amazonPhone)||!match(windowsPhone)&&match(androidPhone),tablet:!match(windowsPhone)&&!match(amazonPhone)&&!match(androidPhone)&&(match(amazonTablet)||match(androidTablet)),device:!match(windowsPhone)&&(match(amazonPhone)||match(amazonTablet)||match(androidPhone)||match(androidTablet))||match(/\bokhttp\b/i)},windows:{phone:match(windowsPhone),tablet:match(windowsTablet),device:match(windowsPhone)||match(windowsTablet)},other:{blackberry:match(otherBlackBerry),blackberry10:match(otherBlackBerry10),opera:match(otherOpera),firefox:match(otherFirefox),chrome:match(otherChrome),device:match(otherBlackBerry)||match(otherBlackBerry10)||match(otherOpera)||match(otherFirefox)||match(otherChrome)},any:!1,phone:!1,tablet:!1};return result.any=result.apple.device||result.android.device||result.windows.device||result.other.device,result.phone=result.apple.phone||result.android.phone||result.windows.phone,result.tablet=result.apple.tablet||result.android.tablet||result.windows.tablet,result}(self.navigator);!function(ENV){ENV[ENV.WEBGL_LEGACY=0]="WEBGL_LEGACY",ENV[ENV.WEBGL=1]="WEBGL",ENV[ENV.WEBGL2=2]="WEBGL2"}(ENV||(ENV={})),function(RENDERER_TYPE){RENDERER_TYPE[RENDERER_TYPE.UNKNOWN=0]="UNKNOWN",RENDERER_TYPE[RENDERER_TYPE.WEBGL=1]="WEBGL",RENDERER_TYPE[RENDERER_TYPE.CANVAS=2]="CANVAS"}(RENDERER_TYPE||(RENDERER_TYPE={})),function(BUFFER_BITS){BUFFER_BITS[BUFFER_BITS.COLOR=16384]="COLOR",BUFFER_BITS[BUFFER_BITS.DEPTH=256]="DEPTH",BUFFER_BITS[BUFFER_BITS.STENCIL=1024]="STENCIL"}(BUFFER_BITS||(BUFFER_BITS={})),function(BLEND_MODES){BLEND_MODES[BLEND_MODES.NORMAL=0]="NORMAL",BLEND_MODES[BLEND_MODES.ADD=1]="ADD",BLEND_MODES[BLEND_MODES.MULTIPLY=2]="MULTIPLY",BLEND_MODES[BLEND_MODES.SCREEN=3]="SCREEN",BLEND_MODES[BLEND_MODES.OVERLAY=4]="OVERLAY",BLEND_MODES[BLEND_MODES.DARKEN=5]="DARKEN",BLEND_MODES[BLEND_MODES.LIGHTEN=6]="LIGHTEN",BLEND_MODES[BLEND_MODES.COLOR_DODGE=7]="COLOR_DODGE",BLEND_MODES[BLEND_MODES.COLOR_BURN=8]="COLOR_BURN",BLEND_MODES[BLEND_MODES.HARD_LIGHT=9]="HARD_LIGHT",BLEND_MODES[BLEND_MODES.SOFT_LIGHT=10]="SOFT_LIGHT",BLEND_MODES[BLEND_MODES.DIFFERENCE=11]="DIFFERENCE",BLEND_MODES[BLEND_MODES.EXCLUSION=12]="EXCLUSION",BLEND_MODES[BLEND_MODES.HUE=13]="HUE",BLEND_MODES[BLEND_MODES.SATURATION=14]="SATURATION",BLEND_MODES[BLEND_MODES.COLOR=15]="COLOR",BLEND_MODES[BLEND_MODES.LUMINOSITY=16]="LUMINOSITY",BLEND_MODES[BLEND_MODES.NORMAL_NPM=17]="NORMAL_NPM",BLEND_MODES[BLEND_MODES.ADD_NPM=18]="ADD_NPM",BLEND_MODES[BLEND_MODES.SCREEN_NPM=19]="SCREEN_NPM",BLEND_MODES[BLEND_MODES.NONE=20]="NONE",BLEND_MODES[BLEND_MODES.SRC_OVER=0]="SRC_OVER",BLEND_MODES[BLEND_MODES.SRC_IN=21]="SRC_IN",BLEND_MODES[BLEND_MODES.SRC_OUT=22]="SRC_OUT",BLEND_MODES[BLEND_MODES.SRC_ATOP=23]="SRC_ATOP",BLEND_MODES[BLEND_MODES.DST_OVER=24]="DST_OVER",BLEND_MODES[BLEND_MODES.DST_IN=25]="DST_IN",BLEND_MODES[BLEND_MODES.DST_OUT=26]="DST_OUT",BLEND_MODES[BLEND_MODES.DST_ATOP=27]="DST_ATOP",BLEND_MODES[BLEND_MODES.ERASE=26]="ERASE",BLEND_MODES[BLEND_MODES.SUBTRACT=28]="SUBTRACT",BLEND_MODES[BLEND_MODES.XOR=29]="XOR"}(BLEND_MODES||(BLEND_MODES={})),function(DRAW_MODES){DRAW_MODES[DRAW_MODES.POINTS=0]="POINTS",DRAW_MODES[DRAW_MODES.LINES=1]="LINES",DRAW_MODES[DRAW_MODES.LINE_LOOP=2]="LINE_LOOP",DRAW_MODES[DRAW_MODES.LINE_STRIP=3]="LINE_STRIP",DRAW_MODES[DRAW_MODES.TRIANGLES=4]="TRIANGLES",DRAW_MODES[DRAW_MODES.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",DRAW_MODES[DRAW_MODES.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(DRAW_MODES||(DRAW_MODES={})),function(FORMATS){FORMATS[FORMATS.RGBA=6408]="RGBA",FORMATS[FORMATS.RGB=6407]="RGB",FORMATS[FORMATS.RG=33319]="RG",FORMATS[FORMATS.RED=6403]="RED",FORMATS[FORMATS.RGBA_INTEGER=36249]="RGBA_INTEGER",FORMATS[FORMATS.RGB_INTEGER=36248]="RGB_INTEGER",FORMATS[FORMATS.RG_INTEGER=33320]="RG_INTEGER",FORMATS[FORMATS.RED_INTEGER=36244]="RED_INTEGER",FORMATS[FORMATS.ALPHA=6406]="ALPHA",FORMATS[FORMATS.LUMINANCE=6409]="LUMINANCE",FORMATS[FORMATS.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",FORMATS[FORMATS.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",FORMATS[FORMATS.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(FORMATS||(FORMATS={})),function(TARGETS){TARGETS[TARGETS.TEXTURE_2D=3553]="TEXTURE_2D",TARGETS[TARGETS.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",TARGETS[TARGETS.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(TARGETS||(TARGETS={})),function(TYPES){TYPES[TYPES.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",TYPES[TYPES.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",TYPES[TYPES.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",TYPES[TYPES.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",TYPES[TYPES.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",TYPES[TYPES.UNSIGNED_INT=5125]="UNSIGNED_INT",TYPES[TYPES.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",TYPES[TYPES.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",TYPES[TYPES.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",TYPES[TYPES.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",TYPES[TYPES.BYTE=5120]="BYTE",TYPES[TYPES.SHORT=5122]="SHORT",TYPES[TYPES.INT=5124]="INT",TYPES[TYPES.FLOAT=5126]="FLOAT",TYPES[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",TYPES[TYPES.HALF_FLOAT=36193]="HALF_FLOAT"}(TYPES||(TYPES={})),function(SAMPLER_TYPES){SAMPLER_TYPES[SAMPLER_TYPES.FLOAT=0]="FLOAT",SAMPLER_TYPES[SAMPLER_TYPES.INT=1]="INT",SAMPLER_TYPES[SAMPLER_TYPES.UINT=2]="UINT"}(SAMPLER_TYPES||(SAMPLER_TYPES={})),function(SCALE_MODES){SCALE_MODES[SCALE_MODES.NEAREST=0]="NEAREST",SCALE_MODES[SCALE_MODES.LINEAR=1]="LINEAR"}(SCALE_MODES||(SCALE_MODES={})),function(WRAP_MODES){WRAP_MODES[WRAP_MODES.CLAMP=33071]="CLAMP",WRAP_MODES[WRAP_MODES.REPEAT=10497]="REPEAT",WRAP_MODES[WRAP_MODES.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(WRAP_MODES||(WRAP_MODES={})),function(MIPMAP_MODES){MIPMAP_MODES[MIPMAP_MODES.OFF=0]="OFF",MIPMAP_MODES[MIPMAP_MODES.POW2=1]="POW2",MIPMAP_MODES[MIPMAP_MODES.ON=2]="ON",MIPMAP_MODES[MIPMAP_MODES.ON_MANUAL=3]="ON_MANUAL"}(MIPMAP_MODES||(MIPMAP_MODES={})),function(ALPHA_MODES){ALPHA_MODES[ALPHA_MODES.NPM=0]="NPM",ALPHA_MODES[ALPHA_MODES.UNPACK=1]="UNPACK",ALPHA_MODES[ALPHA_MODES.PMA=2]="PMA",ALPHA_MODES[ALPHA_MODES.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ALPHA_MODES[ALPHA_MODES.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ALPHA_MODES[ALPHA_MODES.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(ALPHA_MODES||(ALPHA_MODES={})),function(CLEAR_MODES){CLEAR_MODES[CLEAR_MODES.NO=0]="NO",CLEAR_MODES[CLEAR_MODES.YES=1]="YES",CLEAR_MODES[CLEAR_MODES.AUTO=2]="AUTO",CLEAR_MODES[CLEAR_MODES.BLEND=0]="BLEND",CLEAR_MODES[CLEAR_MODES.CLEAR=1]="CLEAR",CLEAR_MODES[CLEAR_MODES.BLIT=2]="BLIT"}(CLEAR_MODES||(CLEAR_MODES={})),function(GC_MODES){GC_MODES[GC_MODES.AUTO=0]="AUTO",GC_MODES[GC_MODES.MANUAL=1]="MANUAL"}(GC_MODES||(GC_MODES={})),function(PRECISION){PRECISION.LOW="lowp",PRECISION.MEDIUM="mediump",PRECISION.HIGH="highp"}(PRECISION||(PRECISION={})),function(MASK_TYPES){MASK_TYPES[MASK_TYPES.NONE=0]="NONE",MASK_TYPES[MASK_TYPES.SCISSOR=1]="SCISSOR",MASK_TYPES[MASK_TYPES.STENCIL=2]="STENCIL",MASK_TYPES[MASK_TYPES.SPRITE=3]="SPRITE"}(MASK_TYPES||(MASK_TYPES={})),function(MSAA_QUALITY){MSAA_QUALITY[MSAA_QUALITY.NONE=0]="NONE",MSAA_QUALITY[MSAA_QUALITY.LOW=2]="LOW",MSAA_QUALITY[MSAA_QUALITY.MEDIUM=4]="MEDIUM",MSAA_QUALITY[MSAA_QUALITY.HIGH=8]="HIGH"}(MSAA_QUALITY||(MSAA_QUALITY={})),function(BUFFER_TYPE){BUFFER_TYPE[BUFFER_TYPE.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",BUFFER_TYPE[BUFFER_TYPE.ARRAY_BUFFER=34962]="ARRAY_BUFFER",BUFFER_TYPE[BUFFER_TYPE.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(BUFFER_TYPE||(BUFFER_TYPE={}));var constants_ENV,constants_RENDERER_TYPE,constants_BUFFER_BITS,constants_BLEND_MODES,constants_DRAW_MODES,constants_FORMATS,constants_TARGETS,constants_TYPES,constants_SAMPLER_TYPES,constants_SCALE_MODES,constants_WRAP_MODES,constants_MIPMAP_MODES,constants_ALPHA_MODES,constants_CLEAR_MODES,constants_GC_MODES,constants_PRECISION,constants_MASK_TYPES,constants_MSAA_QUALITY,constants_BUFFER_TYPE,settings={MIPMAP_TEXTURES:MIPMAP_MODES.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:MSAA_QUALITY.NONE,SPRITE_MAX_TEXTURES:function(max){var allowMax=!0;if(settings_isMobile.tablet||settings_isMobile.phone){var match;if(settings_isMobile.apple.device)if(match=navigator.userAgent.match(/OS (\d+)_(\d+)?/))parseInt(match[1],10)<11&&(allowMax=!1);if(settings_isMobile.android.device)if(match=navigator.userAgent.match(/Android\s([0-9.]*)/))parseInt(match[1],10)<7&&(allowMax=!1)}return allowMax?max:4}(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:GC_MODES.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:WRAP_MODES.CLAMP,SCALE_MODE:SCALE_MODES.LINEAR,PRECISION_VERTEX:PRECISION.HIGH,PRECISION_FRAGMENT:settings_isMobile.apple.device?PRECISION.HIGH:PRECISION.MEDIUM,CAN_UPLOAD_SAME_BUFFER:!settings_isMobile.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},eventemitter3=__webpack_require__(718),eventemitter3_default=__webpack_require__.n(eventemitter3),earcut=__webpack_require__(187),earcut_default=__webpack_require__.n(earcut),url=__webpack_require__(575);!function(ENV){ENV[ENV.WEBGL_LEGACY=0]="WEBGL_LEGACY",ENV[ENV.WEBGL=1]="WEBGL",ENV[ENV.WEBGL2=2]="WEBGL2"}(constants_ENV||(constants_ENV={})),function(RENDERER_TYPE){RENDERER_TYPE[RENDERER_TYPE.UNKNOWN=0]="UNKNOWN",RENDERER_TYPE[RENDERER_TYPE.WEBGL=1]="WEBGL",RENDERER_TYPE[RENDERER_TYPE.CANVAS=2]="CANVAS"}(constants_RENDERER_TYPE||(constants_RENDERER_TYPE={})),function(BUFFER_BITS){BUFFER_BITS[BUFFER_BITS.COLOR=16384]="COLOR",BUFFER_BITS[BUFFER_BITS.DEPTH=256]="DEPTH",BUFFER_BITS[BUFFER_BITS.STENCIL=1024]="STENCIL"}(constants_BUFFER_BITS||(constants_BUFFER_BITS={})),function(BLEND_MODES){BLEND_MODES[BLEND_MODES.NORMAL=0]="NORMAL",BLEND_MODES[BLEND_MODES.ADD=1]="ADD",BLEND_MODES[BLEND_MODES.MULTIPLY=2]="MULTIPLY",BLEND_MODES[BLEND_MODES.SCREEN=3]="SCREEN",BLEND_MODES[BLEND_MODES.OVERLAY=4]="OVERLAY",BLEND_MODES[BLEND_MODES.DARKEN=5]="DARKEN",BLEND_MODES[BLEND_MODES.LIGHTEN=6]="LIGHTEN",BLEND_MODES[BLEND_MODES.COLOR_DODGE=7]="COLOR_DODGE",BLEND_MODES[BLEND_MODES.COLOR_BURN=8]="COLOR_BURN",BLEND_MODES[BLEND_MODES.HARD_LIGHT=9]="HARD_LIGHT",BLEND_MODES[BLEND_MODES.SOFT_LIGHT=10]="SOFT_LIGHT",BLEND_MODES[BLEND_MODES.DIFFERENCE=11]="DIFFERENCE",BLEND_MODES[BLEND_MODES.EXCLUSION=12]="EXCLUSION",BLEND_MODES[BLEND_MODES.HUE=13]="HUE",BLEND_MODES[BLEND_MODES.SATURATION=14]="SATURATION",BLEND_MODES[BLEND_MODES.COLOR=15]="COLOR",BLEND_MODES[BLEND_MODES.LUMINOSITY=16]="LUMINOSITY",BLEND_MODES[BLEND_MODES.NORMAL_NPM=17]="NORMAL_NPM",BLEND_MODES[BLEND_MODES.ADD_NPM=18]="ADD_NPM",BLEND_MODES[BLEND_MODES.SCREEN_NPM=19]="SCREEN_NPM",BLEND_MODES[BLEND_MODES.NONE=20]="NONE",BLEND_MODES[BLEND_MODES.SRC_OVER=0]="SRC_OVER",BLEND_MODES[BLEND_MODES.SRC_IN=21]="SRC_IN",BLEND_MODES[BLEND_MODES.SRC_OUT=22]="SRC_OUT",BLEND_MODES[BLEND_MODES.SRC_ATOP=23]="SRC_ATOP",BLEND_MODES[BLEND_MODES.DST_OVER=24]="DST_OVER",BLEND_MODES[BLEND_MODES.DST_IN=25]="DST_IN",BLEND_MODES[BLEND_MODES.DST_OUT=26]="DST_OUT",BLEND_MODES[BLEND_MODES.DST_ATOP=27]="DST_ATOP",BLEND_MODES[BLEND_MODES.ERASE=26]="ERASE",BLEND_MODES[BLEND_MODES.SUBTRACT=28]="SUBTRACT",BLEND_MODES[BLEND_MODES.XOR=29]="XOR"}(constants_BLEND_MODES||(constants_BLEND_MODES={})),function(DRAW_MODES){DRAW_MODES[DRAW_MODES.POINTS=0]="POINTS",DRAW_MODES[DRAW_MODES.LINES=1]="LINES",DRAW_MODES[DRAW_MODES.LINE_LOOP=2]="LINE_LOOP",DRAW_MODES[DRAW_MODES.LINE_STRIP=3]="LINE_STRIP",DRAW_MODES[DRAW_MODES.TRIANGLES=4]="TRIANGLES",DRAW_MODES[DRAW_MODES.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",DRAW_MODES[DRAW_MODES.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(constants_DRAW_MODES||(constants_DRAW_MODES={})),function(FORMATS){FORMATS[FORMATS.RGBA=6408]="RGBA",FORMATS[FORMATS.RGB=6407]="RGB",FORMATS[FORMATS.RG=33319]="RG",FORMATS[FORMATS.RED=6403]="RED",FORMATS[FORMATS.RGBA_INTEGER=36249]="RGBA_INTEGER",FORMATS[FORMATS.RGB_INTEGER=36248]="RGB_INTEGER",FORMATS[FORMATS.RG_INTEGER=33320]="RG_INTEGER",FORMATS[FORMATS.RED_INTEGER=36244]="RED_INTEGER",FORMATS[FORMATS.ALPHA=6406]="ALPHA",FORMATS[FORMATS.LUMINANCE=6409]="LUMINANCE",FORMATS[FORMATS.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",FORMATS[FORMATS.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",FORMATS[FORMATS.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(constants_FORMATS||(constants_FORMATS={})),function(TARGETS){TARGETS[TARGETS.TEXTURE_2D=3553]="TEXTURE_2D",TARGETS[TARGETS.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",TARGETS[TARGETS.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(constants_TARGETS||(constants_TARGETS={})),function(TYPES){TYPES[TYPES.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",TYPES[TYPES.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",TYPES[TYPES.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",TYPES[TYPES.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",TYPES[TYPES.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",TYPES[TYPES.UNSIGNED_INT=5125]="UNSIGNED_INT",TYPES[TYPES.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",TYPES[TYPES.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",TYPES[TYPES.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",TYPES[TYPES.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",TYPES[TYPES.BYTE=5120]="BYTE",TYPES[TYPES.SHORT=5122]="SHORT",TYPES[TYPES.INT=5124]="INT",TYPES[TYPES.FLOAT=5126]="FLOAT",TYPES[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",TYPES[TYPES.HALF_FLOAT=36193]="HALF_FLOAT"}(constants_TYPES||(constants_TYPES={})),function(SAMPLER_TYPES){SAMPLER_TYPES[SAMPLER_TYPES.FLOAT=0]="FLOAT",SAMPLER_TYPES[SAMPLER_TYPES.INT=1]="INT",SAMPLER_TYPES[SAMPLER_TYPES.UINT=2]="UINT"}(constants_SAMPLER_TYPES||(constants_SAMPLER_TYPES={})),function(SCALE_MODES){SCALE_MODES[SCALE_MODES.NEAREST=0]="NEAREST",SCALE_MODES[SCALE_MODES.LINEAR=1]="LINEAR"}(constants_SCALE_MODES||(constants_SCALE_MODES={})),function(WRAP_MODES){WRAP_MODES[WRAP_MODES.CLAMP=33071]="CLAMP",WRAP_MODES[WRAP_MODES.REPEAT=10497]="REPEAT",WRAP_MODES[WRAP_MODES.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(constants_WRAP_MODES||(constants_WRAP_MODES={})),function(MIPMAP_MODES){MIPMAP_MODES[MIPMAP_MODES.OFF=0]="OFF",MIPMAP_MODES[MIPMAP_MODES.POW2=1]="POW2",MIPMAP_MODES[MIPMAP_MODES.ON=2]="ON",MIPMAP_MODES[MIPMAP_MODES.ON_MANUAL=3]="ON_MANUAL"}(constants_MIPMAP_MODES||(constants_MIPMAP_MODES={})),function(ALPHA_MODES){ALPHA_MODES[ALPHA_MODES.NPM=0]="NPM",ALPHA_MODES[ALPHA_MODES.UNPACK=1]="UNPACK",ALPHA_MODES[ALPHA_MODES.PMA=2]="PMA",ALPHA_MODES[ALPHA_MODES.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ALPHA_MODES[ALPHA_MODES.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ALPHA_MODES[ALPHA_MODES.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(constants_ALPHA_MODES||(constants_ALPHA_MODES={})),function(CLEAR_MODES){CLEAR_MODES[CLEAR_MODES.NO=0]="NO",CLEAR_MODES[CLEAR_MODES.YES=1]="YES",CLEAR_MODES[CLEAR_MODES.AUTO=2]="AUTO",CLEAR_MODES[CLEAR_MODES.BLEND=0]="BLEND",CLEAR_MODES[CLEAR_MODES.CLEAR=1]="CLEAR",CLEAR_MODES[CLEAR_MODES.BLIT=2]="BLIT"}(constants_CLEAR_MODES||(constants_CLEAR_MODES={})),function(GC_MODES){GC_MODES[GC_MODES.AUTO=0]="AUTO",GC_MODES[GC_MODES.MANUAL=1]="MANUAL"}(constants_GC_MODES||(constants_GC_MODES={})),function(PRECISION){PRECISION.LOW="lowp",PRECISION.MEDIUM="mediump",PRECISION.HIGH="highp"}(constants_PRECISION||(constants_PRECISION={})),function(MASK_TYPES){MASK_TYPES[MASK_TYPES.NONE=0]="NONE",MASK_TYPES[MASK_TYPES.SCISSOR=1]="SCISSOR",MASK_TYPES[MASK_TYPES.STENCIL=2]="STENCIL",MASK_TYPES[MASK_TYPES.SPRITE=3]="SPRITE"}(constants_MASK_TYPES||(constants_MASK_TYPES={})),function(MSAA_QUALITY){MSAA_QUALITY[MSAA_QUALITY.NONE=0]="NONE",MSAA_QUALITY[MSAA_QUALITY.LOW=2]="LOW",MSAA_QUALITY[MSAA_QUALITY.MEDIUM=4]="MEDIUM",MSAA_QUALITY[MSAA_QUALITY.HIGH=8]="HIGH"}(constants_MSAA_QUALITY||(constants_MSAA_QUALITY={})),function(BUFFER_TYPE){BUFFER_TYPE[BUFFER_TYPE.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",BUFFER_TYPE[BUFFER_TYPE.ARRAY_BUFFER=34962]="ARRAY_BUFFER",BUFFER_TYPE[BUFFER_TYPE.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(constants_BUFFER_TYPE||(constants_BUFFER_TYPE={}));var utils_url={parse:url.Qc,format:url.WU,resolve:url.DB};settings.RETINA_PREFIX=/@([0-9\.]+)x/,settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var supported,saidHello=!1;function skipHello(){saidHello=!0}function sayHello(type){var _a;if(!saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["\n %c %c %c PixiJS 6.1.2 - ✰ "+type+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(_a=self.console).log.apply(_a,args)}else self.console&&self.console.log("PixiJS 6.1.2 - "+type+" - http://www.pixijs.com/");saidHello=!0}}function isWebGLSupported(){return void 0===supported&&(supported=function(){var contextOptions={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var canvas=document.createElement("canvas"),gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions),success=!(!gl||!gl.getContextAttributes().stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");loseContext&&loseContext.loseContext()}return gl=null,success}catch(e){return!1}}()),supported}var cssColorNames={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function hex2rgb(hex,out){return void 0===out&&(out=[]),out[0]=(hex>>16&255)/255,out[1]=(hex>>8&255)/255,out[2]=(255&hex)/255,out}function hex2string(hex){var hexString=hex.toString(16);return"#"+(hexString="000000".substr(0,6-hexString.length)+hexString)}function string2hex(string){return"string"==typeof string&&"#"===(string=cssColorNames[string.toLowerCase()]||string)[0]&&(string=string.substr(1)),parseInt(string,16)}function rgb2hex(rgb){return(255*rgb[0]<<16)+(255*rgb[1]<<8)+(255*rgb[2]|0)}var premultiplyBlendMode=function(){for(var pm=[],npm=[],i=0;i<32;i++)pm[i]=i,npm[i]=i;pm[constants_BLEND_MODES.NORMAL_NPM]=constants_BLEND_MODES.NORMAL,pm[constants_BLEND_MODES.ADD_NPM]=constants_BLEND_MODES.ADD,pm[constants_BLEND_MODES.SCREEN_NPM]=constants_BLEND_MODES.SCREEN,npm[constants_BLEND_MODES.NORMAL]=constants_BLEND_MODES.NORMAL_NPM,npm[constants_BLEND_MODES.ADD]=constants_BLEND_MODES.ADD_NPM,npm[constants_BLEND_MODES.SCREEN]=constants_BLEND_MODES.SCREEN_NPM;var array=[];return array.push(npm),array.push(pm),array}();function correctBlendMode(blendMode,premultiplied){return premultiplyBlendMode[premultiplied?1:0][blendMode]}function premultiplyRgba(rgb,alpha,out,premultiply){return out=out||new Float32Array(4),premultiply||void 0===premultiply?(out[0]=rgb[0]*alpha,out[1]=rgb[1]*alpha,out[2]=rgb[2]*alpha):(out[0]=rgb[0],out[1]=rgb[1],out[2]=rgb[2]),out[3]=alpha,out}function premultiplyTint(tint,alpha){if(1===alpha)return(255*alpha<<24)+tint;if(0===alpha)return 0;var R=tint>>16&255,G=tint>>8&255,B=255&tint;return(255*alpha<<24)+((R=R*alpha+.5|0)<<16)+((G=G*alpha+.5|0)<<8)+(B=B*alpha+.5|0)}function premultiplyTintToRgba(tint,alpha,out,premultiply){return(out=out||new Float32Array(4))[0]=(tint>>16&255)/255,out[1]=(tint>>8&255)/255,out[2]=(255&tint)/255,(premultiply||void 0===premultiply)&&(out[0]*=alpha,out[1]*=alpha,out[2]*=alpha),out[3]=alpha,out}function createIndicesForQuads(size,outBuffer){void 0===outBuffer&&(outBuffer=null);var totalIndices=6*size;if((outBuffer=outBuffer||new Uint16Array(totalIndices)).length!==totalIndices)throw new Error("Out buffer length is incorrect, got "+outBuffer.length+" and expected "+totalIndices);for(var i=0,j=0;i<totalIndices;i+=6,j+=4)outBuffer[i+0]=j+0,outBuffer[i+1]=j+1,outBuffer[i+2]=j+2,outBuffer[i+3]=j+0,outBuffer[i+4]=j+2,outBuffer[i+5]=j+3;return outBuffer}function getBufferType(array){if(4===array.BYTES_PER_ELEMENT)return array instanceof Float32Array?"Float32Array":array instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===array.BYTES_PER_ELEMENT){if(array instanceof Uint16Array)return"Uint16Array"}else if(1===array.BYTES_PER_ELEMENT&&array instanceof Uint8Array)return"Uint8Array";return null}var map={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(arrays,sizes){for(var outSize=0,stride=0,views={},i=0;i<arrays.length;i++)stride+=sizes[i],outSize+=arrays[i].length;var buffer=new ArrayBuffer(4*outSize),out=null,littleOffset=0;for(i=0;i<arrays.length;i++){var size=sizes[i],array=arrays[i],type=getBufferType(array);views[type]||(views[type]=new map[type](buffer)),out=views[type];for(var j=0;j<array.length;j++){out[(j/size|0)*stride+littleOffset+j%size]=array[j]}littleOffset+=size}return new Float32Array(buffer)}function nextPow2(v){return v+=0===v?1:0,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1}function isPow2(v){return!(v&v-1||!v)}function log2(v){var r=(v>65535?1:0)<<4,shift=((v>>>=r)>255?1:0)<<3;return r|=shift,r|=shift=((v>>>=shift)>15?1:0)<<2,(r|=shift=((v>>>=shift)>3?1:0)<<1)|(v>>>=shift)>>1}function removeItems(arr,startIdx,removeCount){var i,length=arr.length;if(!(startIdx>=length||0===removeCount)){var len=length-(removeCount=startIdx+removeCount>length?length-startIdx:removeCount);for(i=startIdx;i<len;++i)arr[i]=arr[i+removeCount];arr.length=len}}function sign(n){return 0===n?0:n<0?-1:1}var nextUid=0;function uid(){return++nextUid}var warnings={};function deprecation(version,message,ignoreDepth){if(void 0===ignoreDepth&&(ignoreDepth=3),!warnings[message]){var stack=(new Error).stack;void 0===stack?console.warn("PixiJS Deprecation Warning: ",message+"\nDeprecated since v"+version):(stack=stack.split("\n").splice(ignoreDepth).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",message+"\nDeprecated since v"+version),console.warn(stack),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",message+"\nDeprecated since v"+version),console.warn(stack))),warnings[message]=!0}}var ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);function destroyTextureCache(){var key;for(key in TextureCache)TextureCache[key].destroy();for(key in BaseTextureCache)BaseTextureCache[key].destroy()}function clearTextureCache(){var key;for(key in TextureCache)delete TextureCache[key];for(key in BaseTextureCache)delete BaseTextureCache[key]}var CanvasRenderTarget=function(){function CanvasRenderTarget(width,height,resolution){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=resolution||settings.RESOLUTION,this.resize(width,height)}return CanvasRenderTarget.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},CanvasRenderTarget.prototype.resize=function(desiredWidth,desiredHeight){this.canvas.width=Math.round(desiredWidth*this.resolution),this.canvas.height=Math.round(desiredHeight*this.resolution)},CanvasRenderTarget.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(CanvasRenderTarget.prototype,"width",{get:function(){return this.canvas.width},set:function(val){this.canvas.width=Math.round(val)},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasRenderTarget.prototype,"height",{get:function(){return this.canvas.height},set:function(val){this.canvas.height=Math.round(val)},enumerable:!1,configurable:!0}),CanvasRenderTarget}();function trimCanvas(canvas){var i,x,y,width=canvas.width,height=canvas.height,context=canvas.getContext("2d"),pixels=context.getImageData(0,0,width,height).data,len=pixels.length,bound={top:null,left:null,right:null,bottom:null},data=null;for(i=0;i<len;i+=4)0!==pixels[i+3]&&(x=i/4%width,y=~~(i/4/width),null===bound.top&&(bound.top=y),(null===bound.left||x<bound.left)&&(bound.left=x),(null===bound.right||bound.right<x)&&(bound.right=x+1),(null===bound.bottom||bound.bottom<y)&&(bound.bottom=y));return null!==bound.top&&(width=bound.right-bound.left,height=bound.bottom-bound.top+1,data=context.getImageData(bound.left,bound.top,width,height)),{height,width,data}}var tempAnchor,DATA_URI=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function decomposeDataUri(dataUri){var dataUriMatch=DATA_URI.exec(dataUri);if(dataUriMatch)return{mediaType:dataUriMatch[1]?dataUriMatch[1].toLowerCase():void 0,subType:dataUriMatch[2]?dataUriMatch[2].toLowerCase():void 0,charset:dataUriMatch[3]?dataUriMatch[3].toLowerCase():void 0,encoding:dataUriMatch[4]?dataUriMatch[4].toLowerCase():void 0,data:dataUriMatch[5]}}function determineCrossOrigin(url$1,loc){if(void 0===loc&&(loc=self.location),0===url$1.indexOf("data:"))return"";loc=loc||self.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=url$1;var parsedUrl=utils_url.parse(tempAnchor.href),samePort=!parsedUrl.port&&""===loc.port||parsedUrl.port===loc.port;return parsedUrl.hostname===loc.hostname&&samePort&&parsedUrl.protocol===loc.protocol?"":"anonymous"}function getResolutionOfUrl(url,defaultValue){var resolution=settings.RETINA_PREFIX.exec(url);return resolution?parseFloat(resolution[1]):void 0!==defaultValue?defaultValue:1}var SHAPES,PI_2=2*Math.PI,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180;!function(SHAPES){SHAPES[SHAPES.POLY=0]="POLY",SHAPES[SHAPES.RECT=1]="RECT",SHAPES[SHAPES.CIRC=2]="CIRC",SHAPES[SHAPES.ELIP=3]="ELIP",SHAPES[SHAPES.RREC=4]="RREC"}(SHAPES||(SHAPES={}));var Rectangle=function(){function Rectangle(x,y,width,height){void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),this.x=Number(x),this.y=Number(y),this.width=Number(width),this.height=Number(height),this.type=SHAPES.RECT}return Object.defineProperty(Rectangle.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle,"EMPTY",{get:function(){return new Rectangle(0,0,0,0)},enumerable:!1,configurable:!0}),Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)},Rectangle.prototype.copyFrom=function(rectangle){return this.x=rectangle.x,this.y=rectangle.y,this.width=rectangle.width,this.height=rectangle.height,this},Rectangle.prototype.copyTo=function(rectangle){return rectangle.x=this.x,rectangle.y=this.y,rectangle.width=this.width,rectangle.height=this.height,rectangle},Rectangle.prototype.contains=function(x,y){return!(this.width<=0||this.height<=0)&&(x>=this.x&&x<this.x+this.width&&y>=this.y&&y<this.y+this.height)},Rectangle.prototype.pad=function(paddingX,paddingY){return void 0===paddingX&&(paddingX=0),void 0===paddingY&&(paddingY=paddingX),this.x-=paddingX,this.y-=paddingY,this.width+=2*paddingX,this.height+=2*paddingY,this},Rectangle.prototype.fit=function(rectangle){var x1=Math.max(this.x,rectangle.x),x2=Math.min(this.x+this.width,rectangle.x+rectangle.width),y1=Math.max(this.y,rectangle.y),y2=Math.min(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=Math.max(x2-x1,0),this.y=y1,this.height=Math.max(y2-y1,0),this},Rectangle.prototype.ceil=function(resolution,eps){void 0===resolution&&(resolution=1),void 0===eps&&(eps=.001);var x2=Math.ceil((this.x+this.width-eps)*resolution)/resolution,y2=Math.ceil((this.y+this.height-eps)*resolution)/resolution;return this.x=Math.floor((this.x+eps)*resolution)/resolution,this.y=Math.floor((this.y+eps)*resolution)/resolution,this.width=x2-this.x,this.height=y2-this.y,this},Rectangle.prototype.enlarge=function(rectangle){var x1=Math.min(this.x,rectangle.x),x2=Math.max(this.x+this.width,rectangle.x+rectangle.width),y1=Math.min(this.y,rectangle.y),y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=x2-x1,this.y=y1,this.height=y2-y1,this},Rectangle.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},Rectangle}(),Circle=function(){function Circle(x,y,radius){void 0===x&&(x=0),void 0===y&&(y=0),void 0===radius&&(radius=0),this.x=x,this.y=y,this.radius=radius,this.type=SHAPES.CIRC}return Circle.prototype.clone=function(){return new Circle(this.x,this.y,this.radius)},Circle.prototype.contains=function(x,y){if(this.radius<=0)return!1;var r2=this.radius*this.radius,dx=this.x-x,dy=this.y-y;return(dx*=dx)+(dy*=dy)<=r2},Circle.prototype.getBounds=function(){return new Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},Circle.prototype.toString=function(){return"[@pixi/math:Circle x="+this.x+" y="+this.y+" radius="+this.radius+"]"},Circle}(),Ellipse=function(){function Ellipse(x,y,halfWidth,halfHeight){void 0===x&&(x=0),void 0===y&&(y=0),void 0===halfWidth&&(halfWidth=0),void 0===halfHeight&&(halfHeight=0),this.x=x,this.y=y,this.width=halfWidth,this.height=halfHeight,this.type=SHAPES.ELIP}return Ellipse.prototype.clone=function(){return new Ellipse(this.x,this.y,this.width,this.height)},Ellipse.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;var normx=(x-this.x)/this.width,normy=(y-this.y)/this.height;return(normx*=normx)+(normy*=normy)<=1},Ellipse.prototype.getBounds=function(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},Ellipse.prototype.toString=function(){return"[@pixi/math:Ellipse x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},Ellipse}(),Polygon=function(){function Polygon(){for(var arguments$1=arguments,points=[],_i=0;_i<arguments.length;_i++)points[_i]=arguments$1[_i];var flat=Array.isArray(points[0])?points[0]:points;if("number"!=typeof flat[0]){for(var p=[],i=0,il=flat.length;i<il;i++)p.push(flat[i].x,flat[i].y);flat=p}this.points=flat,this.type=SHAPES.POLY,this.closeStroke=!0}return Polygon.prototype.clone=function(){var polygon=new Polygon(this.points.slice());return polygon.closeStroke=this.closeStroke,polygon},Polygon.prototype.contains=function(x,y){for(var inside=!1,length=this.points.length/2,i=0,j=length-1;i<length;j=i++){var xi=this.points[2*i],yi=this.points[2*i+1],xj=this.points[2*j],yj=this.points[2*j+1];yi>y!=yj>y&&x<(y-yi)/(yj-yi)*(xj-xi)+xi&&(inside=!inside)}return inside},Polygon.prototype.toString=function(){return"[@pixi/math:PolygoncloseStroke="+this.closeStroke+"points="+this.points.reduce((function(pointsDesc,currentPoint){return pointsDesc+", "+currentPoint}),"")+"]"},Polygon}(),RoundedRectangle=function(){function RoundedRectangle(x,y,width,height,radius){void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),void 0===radius&&(radius=20),this.x=x,this.y=y,this.width=width,this.height=height,this.radius=radius,this.type=SHAPES.RREC}return RoundedRectangle.prototype.clone=function(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},RoundedRectangle.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;if(x>=this.x&&x<=this.x+this.width&&y>=this.y&&y<=this.y+this.height){if(y>=this.y+this.radius&&y<=this.y+this.height-this.radius||x>=this.x+this.radius&&x<=this.x+this.width-this.radius)return!0;var dx=x-(this.x+this.radius),dy=y-(this.y+this.radius),radius2=this.radius*this.radius;if(dx*dx+dy*dy<=radius2)return!0;if((dx=x-(this.x+this.width-this.radius))*dx+dy*dy<=radius2)return!0;if(dx*dx+(dy=y-(this.y+this.height-this.radius))*dy<=radius2)return!0;if((dx=x-(this.x+this.radius))*dx+dy*dy<=radius2)return!0}return!1},RoundedRectangle.prototype.toString=function(){return"[@pixi/math:RoundedRectangle x="+this.x+" y="+this.y+"width="+this.width+" height="+this.height+" radius="+this.radius+"]"},RoundedRectangle}(),Point=function(){function Point(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.x=0,this.y=0,this.x=x,this.y=y}return Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.copyFrom=function(p){return this.set(p.x,p.y),this},Point.prototype.copyTo=function(p){return p.set(this.x,this.y),p},Point.prototype.equals=function(p){return p.x===this.x&&p.y===this.y},Point.prototype.set=function(x,y){return void 0===x&&(x=0),void 0===y&&(y=x),this.x=x,this.y=y,this},Point.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},Point}(),ObservablePoint=function(){function ObservablePoint(cb,scope,x,y){void 0===x&&(x=0),void 0===y&&(y=0),this._x=x,this._y=y,this.cb=cb,this.scope=scope}return ObservablePoint.prototype.clone=function(cb,scope){return void 0===cb&&(cb=this.cb),void 0===scope&&(scope=this.scope),new ObservablePoint(cb,scope,this._x,this._y)},ObservablePoint.prototype.set=function(x,y){return void 0===x&&(x=0),void 0===y&&(y=x),this._x===x&&this._y===y||(this._x=x,this._y=y,this.cb.call(this.scope)),this},ObservablePoint.prototype.copyFrom=function(p){return this._x===p.x&&this._y===p.y||(this._x=p.x,this._y=p.y,this.cb.call(this.scope)),this},ObservablePoint.prototype.copyTo=function(p){return p.set(this._x,this._y),p},ObservablePoint.prototype.equals=function(p){return p.x===this._x&&p.y===this._y},ObservablePoint.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(ObservablePoint.prototype,"x",{get:function(){return this._x},set:function(value){this._x!==value&&(this._x=value,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(ObservablePoint.prototype,"y",{get:function(){return this._y},set:function(value){this._y!==value&&(this._y=value,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),ObservablePoint}(),Matrix=function(){function Matrix(a,b,c,d,tx,ty){void 0===a&&(a=1),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===tx&&(tx=0),void 0===ty&&(ty=0),this.array=null,this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty}return Matrix.prototype.fromArray=function(array){this.a=array[0],this.b=array[1],this.c=array[3],this.d=array[4],this.tx=array[2],this.ty=array[5]},Matrix.prototype.set=function(a,b,c,d,tx,ty){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this},Matrix.prototype.toArray=function(transpose,out){this.array||(this.array=new Float32Array(9));var array=out||this.array;return transpose?(array[0]=this.a,array[1]=this.b,array[2]=0,array[3]=this.c,array[4]=this.d,array[5]=0,array[6]=this.tx,array[7]=this.ty,array[8]=1):(array[0]=this.a,array[1]=this.c,array[2]=this.tx,array[3]=this.b,array[4]=this.d,array[5]=this.ty,array[6]=0,array[7]=0,array[8]=1),array},Matrix.prototype.apply=function(pos,newPos){newPos=newPos||new Point;var x=pos.x,y=pos.y;return newPos.x=this.a*x+this.c*y+this.tx,newPos.y=this.b*x+this.d*y+this.ty,newPos},Matrix.prototype.applyInverse=function(pos,newPos){newPos=newPos||new Point;var id=1/(this.a*this.d+this.c*-this.b),x=pos.x,y=pos.y;return newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id,newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id,newPos},Matrix.prototype.translate=function(x,y){return this.tx+=x,this.ty+=y,this},Matrix.prototype.scale=function(x,y){return this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this},Matrix.prototype.rotate=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this},Matrix.prototype.append=function(matrix){var a1=this.a,b1=this.b,c1=this.c,d1=this.d;return this.a=matrix.a*a1+matrix.b*c1,this.b=matrix.a*b1+matrix.b*d1,this.c=matrix.c*a1+matrix.d*c1,this.d=matrix.c*b1+matrix.d*d1,this.tx=matrix.tx*a1+matrix.ty*c1+this.tx,this.ty=matrix.tx*b1+matrix.ty*d1+this.ty,this},Matrix.prototype.setTransform=function(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){return this.a=Math.cos(rotation+skewY)*scaleX,this.b=Math.sin(rotation+skewY)*scaleX,this.c=-Math.sin(rotation-skewX)*scaleY,this.d=Math.cos(rotation-skewX)*scaleY,this.tx=x-(pivotX*this.a+pivotY*this.c),this.ty=y-(pivotX*this.b+pivotY*this.d),this},Matrix.prototype.prepend=function(matrix){var tx1=this.tx;if(1!==matrix.a||0!==matrix.b||0!==matrix.c||1!==matrix.d){var a1=this.a,c1=this.c;this.a=a1*matrix.a+this.b*matrix.c,this.b=a1*matrix.b+this.b*matrix.d,this.c=c1*matrix.a+this.d*matrix.c,this.d=c1*matrix.b+this.d*matrix.d}return this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty,this},Matrix.prototype.decompose=function(transform){var a=this.a,b=this.b,c=this.c,d=this.d,pivot=transform.pivot,skewX=-Math.atan2(-c,d),skewY=Math.atan2(b,a),delta=Math.abs(skewX+skewY);return delta<1e-5||Math.abs(PI_2-delta)<1e-5?(transform.rotation=skewY,transform.skew.x=transform.skew.y=0):(transform.rotation=0,transform.skew.x=skewX,transform.skew.y=skewY),transform.scale.x=Math.sqrt(a*a+b*b),transform.scale.y=Math.sqrt(c*c+d*d),transform.position.x=this.tx+(pivot.x*a+pivot.y*c),transform.position.y=this.ty+(pivot.x*b+pivot.y*d),transform},Matrix.prototype.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;return this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n,this},Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix.prototype.clone=function(){var matrix=new Matrix;return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix.prototype.copyTo=function(matrix){return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix.prototype.copyFrom=function(matrix){return this.a=matrix.a,this.b=matrix.b,this.c=matrix.c,this.d=matrix.d,this.tx=matrix.tx,this.ty=matrix.ty,this},Matrix.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(Matrix,"IDENTITY",{get:function(){return new Matrix},enumerable:!1,configurable:!0}),Object.defineProperty(Matrix,"TEMP_MATRIX",{get:function(){return new Matrix},enumerable:!1,configurable:!0}),Matrix}(),ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;!function(){for(var i=0;i<16;i++){var row=[];rotationCayley.push(row);for(var j=0;j<16;j++)for(var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]),_uy=signum(uy[i]*ux[j]+vy[i]*uy[j]),_vx=signum(ux[i]*vx[j]+vx[i]*vy[j]),_vy=signum(uy[i]*vx[j]+vy[i]*vy[j]),k=0;k<16;k++)if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break}}for(i=0;i<16;i++){var mat=new Matrix;mat.set(ux[i],uy[i],vx[i],vy[i],0,0),rotationMatrices.push(mat)}}();var groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(ind){return ux[ind]},uY:function(ind){return uy[ind]},vX:function(ind){return vx[ind]},vY:function(ind){return vy[ind]},inv:function(rotation){return 8&rotation?15&rotation:7&-rotation},add:function(rotationSecond,rotationFirst){return rotationCayley[rotationSecond][rotationFirst]},sub:function(rotationSecond,rotationFirst){return rotationCayley[rotationSecond][groupD8.inv(rotationFirst)]},rotate180:function(rotation){return 4^rotation},isVertical:function(rotation){return 2==(3&rotation)},byDirection:function(dx,dy){return 2*Math.abs(dx)<=Math.abs(dy)?dy>=0?groupD8.S:groupD8.N:2*Math.abs(dy)<=Math.abs(dx)?dx>0?groupD8.E:groupD8.W:dy>0?dx>0?groupD8.SE:groupD8.SW:dx>0?groupD8.NE:groupD8.NW},matrixAppendRotationInv:function(matrix,rotation,tx,ty){void 0===tx&&(tx=0),void 0===ty&&(ty=0);var mat=rotationMatrices[groupD8.inv(rotation)];mat.tx=tx,mat.ty=ty,matrix.append(mat)}},Transform=function(){function Transform(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return Transform.prototype.onChange=function(){this._localID++},Transform.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},Transform.prototype.toString=function(){return"[@pixi/math:Transform position=("+this.position.x+", "+this.position.y+") rotation="+this.rotation+" scale=("+this.scale.x+", "+this.scale.y+") skew=("+this.skew.x+", "+this.skew.y+") ]"},Transform.prototype.updateLocalTransform=function(){var lt=this.localTransform;this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1)},Transform.prototype.updateTransform=function(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform,wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c,wt.b=lt.a*pt.b+lt.b*pt.d,wt.c=lt.c*pt.a+lt.d*pt.c,wt.d=lt.c*pt.b+lt.d*pt.d,wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx,wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty,this._parentID=parentTransform._worldID,this._worldID++}},Transform.prototype.setFromMatrix=function(matrix){matrix.decompose(this),this._localID++},Object.defineProperty(Transform.prototype,"rotation",{get:function(){return this._rotation},set:function(value){this._rotation!==value&&(this._rotation=value,this.updateSkew())},enumerable:!1,configurable:!0}),Transform.IDENTITY=new Transform,Transform}();settings.SORTABLE_CHILDREN=!1;var Bounds=function(){function Bounds(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return Bounds.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},Bounds.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},Bounds.prototype.getRectangle=function(rect){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:((rect=rect||new Rectangle(0,0,1,1)).x=this.minX,rect.y=this.minY,rect.width=this.maxX-this.minX,rect.height=this.maxY-this.minY,rect)},Bounds.prototype.addPoint=function(point){this.minX=Math.min(this.minX,point.x),this.maxX=Math.max(this.maxX,point.x),this.minY=Math.min(this.minY,point.y),this.maxY=Math.max(this.maxY,point.y)},Bounds.prototype.addPointMatrix=function(matrix,point){var a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty,x=a*point.x+c*point.y+tx,y=b*point.x+d*point.y+ty;this.minX=Math.min(this.minX,x),this.maxX=Math.max(this.maxX,x),this.minY=Math.min(this.minY,y),this.maxY=Math.max(this.maxY,y)},Bounds.prototype.addQuad=function(vertices){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,x=vertices[0],y=vertices[1];minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,minX=(x=vertices[2])<minX?x:minX,minY=(y=vertices[3])<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,minX=(x=vertices[4])<minX?x:minX,minY=(y=vertices[5])<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,minX=(x=vertices[6])<minX?x:minX,minY=(y=vertices[7])<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds.prototype.addFrame=function(transform,x0,y0,x1,y1){this.addFrameMatrix(transform.worldTransform,x0,y0,x1,y1)},Bounds.prototype.addFrameMatrix=function(matrix,x0,y0,x1,y1){var a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty,minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,x=a*x0+c*y0+tx,y=b*x0+d*y0+ty;minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,minX=(x=a*x1+c*y0+tx)<minX?x:minX,minY=(y=b*x1+d*y0+ty)<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,minX=(x=a*x0+c*y1+tx)<minX?x:minX,minY=(y=b*x0+d*y1+ty)<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,minX=(x=a*x1+c*y1+tx)<minX?x:minX,minY=(y=b*x1+d*y1+ty)<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY,this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds.prototype.addVertexData=function(vertexData,beginOffset,endOffset){for(var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,i=beginOffset;i<endOffset;i+=2){var x=vertexData[i],y=vertexData[i+1];minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY}this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds.prototype.addVertices=function(transform,vertices,beginOffset,endOffset){this.addVerticesMatrix(transform.worldTransform,vertices,beginOffset,endOffset)},Bounds.prototype.addVerticesMatrix=function(matrix,vertices,beginOffset,endOffset,padX,padY){void 0===padX&&(padX=0),void 0===padY&&(padY=padX);for(var a=matrix.a,b=matrix.b,c=matrix.c,d=matrix.d,tx=matrix.tx,ty=matrix.ty,minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY,i=beginOffset;i<endOffset;i+=2){var rawX=vertices[i],rawY=vertices[i+1],x=a*rawX+c*rawY+tx,y=d*rawY+b*rawX+ty;minX=Math.min(minX,x-padX),maxX=Math.max(maxX,x+padX),minY=Math.min(minY,y-padY),maxY=Math.max(maxY,y+padY)}this.minX=minX,this.minY=minY,this.maxX=maxX,this.maxY=maxY},Bounds.prototype.addBounds=function(bounds){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=bounds.minX<minX?bounds.minX:minX,this.minY=bounds.minY<minY?bounds.minY:minY,this.maxX=bounds.maxX>maxX?bounds.maxX:maxX,this.maxY=bounds.maxY>maxY?bounds.maxY:maxY},Bounds.prototype.addBoundsMask=function(bounds,mask){var _minX=bounds.minX>mask.minX?bounds.minX:mask.minX,_minY=bounds.minY>mask.minY?bounds.minY:mask.minY,_maxX=bounds.maxX<mask.maxX?bounds.maxX:mask.maxX,_maxY=bounds.maxY<mask.maxY?bounds.maxY:mask.maxY;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=_minX<minX?_minX:minX,this.minY=_minY<minY?_minY:minY,this.maxX=_maxX>maxX?_maxX:maxX,this.maxY=_maxY>maxY?_maxY:maxY}},Bounds.prototype.addBoundsMatrix=function(bounds,matrix){this.addFrameMatrix(matrix,bounds.minX,bounds.minY,bounds.maxX,bounds.maxY)},Bounds.prototype.addBoundsArea=function(bounds,area){var _minX=bounds.minX>area.x?bounds.minX:area.x,_minY=bounds.minY>area.y?bounds.minY:area.y,_maxX=bounds.maxX<area.x+area.width?bounds.maxX:area.x+area.width,_maxY=bounds.maxY<area.y+area.height?bounds.maxY:area.y+area.height;if(_minX<=_maxX&&_minY<=_maxY){var minX=this.minX,minY=this.minY,maxX=this.maxX,maxY=this.maxY;this.minX=_minX<minX?_minX:minX,this.minY=_minY<minY?_minY:minY,this.maxX=_maxX>maxX?_maxX:maxX,this.maxY=_maxY>maxY?_maxY:maxY}},Bounds.prototype.pad=function(paddingX,paddingY){void 0===paddingX&&(paddingX=0),void 0===paddingY&&(paddingY=paddingX),this.isEmpty()||(this.minX-=paddingX,this.maxX+=paddingX,this.minY-=paddingY,this.maxY+=paddingY)},Bounds.prototype.addFramePad=function(x0,y0,x1,y1,padX,padY){x0-=padX,y0-=padY,x1+=padX,y1+=padY,this.minX=this.minX<x0?this.minX:x0,this.maxX=this.maxX>x1?this.maxX:x1,this.minY=this.minY<y0?this.minY:y0,this.maxY=this.maxY>y1?this.maxY:y1},Bounds}(),extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var DisplayObject=function(_super){function DisplayObject(){var _this=_super.call(this)||this;return _this.tempDisplayObjectParent=null,_this.transform=new Transform,_this.alpha=1,_this.visible=!0,_this.renderable=!0,_this.parent=null,_this.worldAlpha=1,_this._lastSortedIndex=0,_this._zIndex=0,_this.filterArea=null,_this.filters=null,_this._enabledFilters=null,_this._bounds=new Bounds,_this._localBounds=null,_this._boundsID=0,_this._boundsRect=null,_this._localBoundsRect=null,_this._mask=null,_this._destroyed=!1,_this.isSprite=!1,_this.isMask=!1,_this}return __extends(DisplayObject,_super),DisplayObject.mixin=function(source){for(var keys=Object.keys(source),i=0;i<keys.length;++i){var propertyName=keys[i];Object.defineProperty(DisplayObject.prototype,propertyName,Object.getOwnPropertyDescriptor(source,propertyName))}},Object.defineProperty(DisplayObject.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),DisplayObject.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},DisplayObject.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},DisplayObject.prototype.getBounds=function(skipUpdate,rect){return skipUpdate||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),rect||(this._boundsRect||(this._boundsRect=new Rectangle),rect=this._boundsRect),this._bounds.getRectangle(rect)},DisplayObject.prototype.getLocalBounds=function(rect){rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);var transformRef=this.transform,parentRef=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var worldBounds=this._bounds,worldBoundsID=this._boundsID;this._bounds=this._localBounds;var bounds=this.getBounds(!1,rect);return this.parent=parentRef,this.transform=transformRef,this._bounds=worldBounds,this._bounds.updateID+=this._boundsID-worldBoundsID,bounds},DisplayObject.prototype.toGlobal=function(position,point,skipUpdate){return void 0===skipUpdate&&(skipUpdate=!1),skipUpdate||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(position,point)},DisplayObject.prototype.toLocal=function(position,from,point,skipUpdate){return from&&(position=from.toGlobal(position,point,skipUpdate)),skipUpdate||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(position,point)},DisplayObject.prototype.setParent=function(container){if(!container||!container.addChild)throw new Error("setParent: Argument must be a Container");return container.addChild(this),container},DisplayObject.prototype.setTransform=function(x,y,scaleX,scaleY,rotation,skewX,skewY,pivotX,pivotY){return void 0===x&&(x=0),void 0===y&&(y=0),void 0===scaleX&&(scaleX=1),void 0===scaleY&&(scaleY=1),void 0===rotation&&(rotation=0),void 0===skewX&&(skewX=0),void 0===skewY&&(skewY=0),void 0===pivotX&&(pivotX=0),void 0===pivotY&&(pivotY=0),this.position.x=x,this.position.y=y,this.scale.x=scaleX||1,this.scale.y=scaleY||1,this.rotation=rotation,this.skew.x=skewX,this.skew.y=skewY,this.pivot.x=pivotX,this.pivot.y=pivotY,this},DisplayObject.prototype.destroy=function(_options){this.parent&&this.parent.removeChild(this),this.emit("destroyed"),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(DisplayObject.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),DisplayObject.prototype.enableTempParent=function(){var myParent=this.parent;return this.parent=this._tempDisplayObjectParent,myParent},DisplayObject.prototype.disableTempParent=function(cacheParent){this.parent=cacheParent},Object.defineProperty(DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(value){this.transform.position.x=value},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(value){this.transform.position.y=value},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"position",{get:function(){return this.transform.position},set:function(value){this.transform.position.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"scale",{get:function(){return this.transform.scale},set:function(value){this.transform.scale.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(value){this.transform.pivot.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"skew",{get:function(){return this.transform.skew},set:function(value){this.transform.skew.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(value){this.transform.rotation=value},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"angle",{get:function(){return this.transform.rotation*RAD_TO_DEG},set:function(value){this.transform.rotation=value*DEG_TO_RAD},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"zIndex",{get:function(){return this._zIndex},set:function(value){this._zIndex=value,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"worldVisible",{get:function(){var item=this;do{if(!item.visible)return!1;item=item.parent}while(item);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(value){var maskObject;this._mask&&((maskObject=this._mask.maskObject||this._mask).renderable=!0,maskObject.isMask=!1);(this._mask=value,this._mask)&&((maskObject=this._mask.maskObject||this._mask).renderable=!1,maskObject.isMask=!0)},enumerable:!1,configurable:!0}),DisplayObject}(eventemitter3_default()),TemporaryDisplayObject=function(_super){function TemporaryDisplayObject(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.sortDirty=null,_this}return __extends(TemporaryDisplayObject,_super),TemporaryDisplayObject}(DisplayObject);function sortChildren(a,b){return a.zIndex===b.zIndex?a._lastSortedIndex-b._lastSortedIndex:a.zIndex-b.zIndex}DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;var Container=function(_super){function Container(){var _this=_super.call(this)||this;return _this.children=[],_this.sortableChildren=settings.SORTABLE_CHILDREN,_this.sortDirty=!1,_this}return __extends(Container,_super),Container.prototype.onChildrenChange=function(_length){},Container.prototype.addChild=function(){for(var arguments$1=arguments,children=[],_i=0;_i<arguments.length;_i++)children[_i]=arguments$1[_i];if(children.length>1)for(var i=0;i<children.length;i++)this.addChild(children[i]);else{var child=children[0];child.parent&&child.parent.removeChild(child),child.parent=this,this.sortDirty=!0,child.transform._parentID=-1,this.children.push(child),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",child,this,this.children.length-1),child.emit("added",this)}return children[0]},Container.prototype.addChildAt=function(child,index){if(index<0||index>this.children.length)throw new Error(child+"addChildAt: The index "+index+" supplied is out of bounds "+this.children.length);return child.parent&&child.parent.removeChild(child),child.parent=this,this.sortDirty=!0,child.transform._parentID=-1,this.children.splice(index,0,child),this._boundsID++,this.onChildrenChange(index),child.emit("added",this),this.emit("childAdded",child,this,index),child},Container.prototype.swapChildren=function(child,child2){if(child!==child2){var index1=this.getChildIndex(child),index2=this.getChildIndex(child2);this.children[index1]=child2,this.children[index2]=child,this.onChildrenChange(index1<index2?index1:index2)}},Container.prototype.getChildIndex=function(child){var index=this.children.indexOf(child);if(-1===index)throw new Error("The supplied DisplayObject must be a child of the caller");return index},Container.prototype.setChildIndex=function(child,index){if(index<0||index>=this.children.length)throw new Error("The index "+index+" supplied is out of bounds "+this.children.length);var currentIndex=this.getChildIndex(child);removeItems(this.children,currentIndex,1),this.children.splice(index,0,child),this.onChildrenChange(index)},Container.prototype.getChildAt=function(index){if(index<0||index>=this.children.length)throw new Error("getChildAt: Index ("+index+") does not exist.");return this.children[index]},Container.prototype.removeChild=function(){for(var arguments$1=arguments,children=[],_i=0;_i<arguments.length;_i++)children[_i]=arguments$1[_i];if(children.length>1)for(var i=0;i<children.length;i++)this.removeChild(children[i]);else{var child=children[0],index=this.children.indexOf(child);if(-1===index)return null;child.parent=null,child.transform._parentID=-1,removeItems(this.children,index,1),this._boundsID++,this.onChildrenChange(index),child.emit("removed",this),this.emit("childRemoved",child,this,index)}return children[0]},Container.prototype.removeChildAt=function(index){var child=this.getChildAt(index);return child.parent=null,child.transform._parentID=-1,removeItems(this.children,index,1),this._boundsID++,this.onChildrenChange(index),child.emit("removed",this),this.emit("childRemoved",child,this,index),child},Container.prototype.removeChildren=function(beginIndex,endIndex){void 0===beginIndex&&(beginIndex=0),void 0===endIndex&&(endIndex=this.children.length);var removed,begin=beginIndex,range=endIndex-begin;if(range>0&&range<=endIndex){removed=this.children.splice(begin,range);for(var i=0;i<removed.length;++i)removed[i].parent=null,removed[i].transform&&(removed[i].transform._parentID=-1);this._boundsID++,this.onChildrenChange(beginIndex);for(i=0;i<removed.length;++i)removed[i].emit("removed",this),this.emit("childRemoved",removed[i],this,i);return removed}if(0===range&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},Container.prototype.sortChildren=function(){for(var sortRequired=!1,i=0,j=this.children.length;i<j;++i){var child=this.children[i];child._lastSortedIndex=i,sortRequired||0===child.zIndex||(sortRequired=!0)}sortRequired&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1},Container.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];child.visible&&child.updateTransform()}},Container.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.visible&&child.renderable)if(child.calculateBounds(),child._mask){var maskObject=child._mask.maskObject||child._mask;maskObject.calculateBounds(),this._bounds.addBoundsMask(child._bounds,maskObject._bounds)}else child.filterArea?this._bounds.addBoundsArea(child._bounds,child.filterArea):this._bounds.addBounds(child._bounds)}this._bounds.updateID=this._boundsID},Container.prototype.getLocalBounds=function(rect,skipChildrenUpdate){void 0===skipChildrenUpdate&&(skipChildrenUpdate=!1);var result=_super.prototype.getLocalBounds.call(this,rect);if(!skipChildrenUpdate)for(var i=0,j=this.children.length;i<j;++i){var child=this.children[i];child.visible&&child.updateTransform()}return result},Container.prototype._calculateBounds=function(){},Container.prototype.render=function(renderer){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(renderer);else{this._render(renderer);for(var i=0,j=this.children.length;i<j;++i)this.children[i].render(renderer)}},Container.prototype.renderAdvanced=function(renderer){renderer.batch.flush();var filters=this.filters,mask=this._mask;if(filters){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var i=0;i<filters.length;i++)filters[i].enabled&&this._enabledFilters.push(filters[i]);this._enabledFilters.length&&renderer.filter.push(this,this._enabledFilters)}mask&&renderer.mask.push(this,this._mask),this._render(renderer);i=0;for(var j=this.children.length;i<j;i++)this.children[i].render(renderer);renderer.batch.flush(),mask&&renderer.mask.pop(this),filters&&this._enabledFilters&&this._enabledFilters.length&&renderer.filter.pop()},Container.prototype._render=function(_renderer){},Container.prototype.destroy=function(options){_super.prototype.destroy.call(this),this.sortDirty=!1;var destroyChildren="boolean"==typeof options?options:options&&options.children,oldChildren=this.removeChildren(0,this.children.length);if(destroyChildren)for(var i=0;i<oldChildren.length;++i)oldChildren[i].destroy(options)},Object.defineProperty(Container.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(value){var width=this.getLocalBounds().width;this.scale.x=0!==width?value/width:1,this._width=value},enumerable:!1,configurable:!0}),Object.defineProperty(Container.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(value){var height=this.getLocalBounds().height;this.scale.y=0!==height?value/height:1,this._height=value},enumerable:!1,configurable:!0}),Container}(DisplayObject);Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;var accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};DisplayObject.mixin(accessibleTarget);var UPDATE_PRIORITY,AccessibilityManager=function(){function AccessibilityManager(renderer){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(settings_isMobile.tablet||settings_isMobile.phone)&&this.createTouchHook();var div=document.createElement("div");div.style.width="100px",div.style.height="100px",div.style.position="absolute",div.style.top="0px",div.style.left="0px",div.style.zIndex=2..toString(),this.div=div,this.renderer=renderer,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),self.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(AccessibilityManager.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(AccessibilityManager.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),AccessibilityManager.prototype.createTouchHook=function(){var _this=this,hookDiv=document.createElement("button");hookDiv.style.width="1px",hookDiv.style.height="1px",hookDiv.style.position="absolute",hookDiv.style.top="-1000px",hookDiv.style.left="-1000px",hookDiv.style.zIndex=2..toString(),hookDiv.style.backgroundColor="#FF0000",hookDiv.title="select to enable accessibility for this content",hookDiv.addEventListener("focus",(function(){_this._isMobileAccessibility=!0,_this.activate(),_this.destroyTouchHook()})),document.body.appendChild(hookDiv),this._hookDiv=hookDiv},AccessibilityManager.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},AccessibilityManager.prototype.activate=function(){var _a;this._isActive||(this._isActive=!0,self.document.addEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null===(_a=this.renderer.view.parentNode)||void 0===_a||_a.appendChild(this.div))},AccessibilityManager.prototype.deactivate=function(){var _a;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null===(_a=this.div.parentNode)||void 0===_a||_a.removeChild(this.div))},AccessibilityManager.prototype.updateAccessibleObjects=function(displayObject){if(displayObject.visible&&displayObject.accessibleChildren){displayObject.accessible&&displayObject.interactive&&(displayObject._accessibleActive||this.addChild(displayObject),displayObject.renderId=this.renderId);for(var children=displayObject.children,i=0;i<children.length;i++)this.updateAccessibleObjects(children[i])}},AccessibilityManager.prototype.update=function(){var now=performance.now();if(!(settings_isMobile.android.device&&now<this.androidUpdateCount)&&(this.androidUpdateCount=now+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var _a=this.renderer.view.getBoundingClientRect(),left=_a.left,top=_a.top,width=_a.width,height=_a.height,_b=this.renderer,viewWidth=_b.width,viewHeight=_b.height,resolution=_b.resolution,sx=width/viewWidth*resolution,sy=height/viewHeight*resolution,div=this.div;div.style.left=left+"px",div.style.top=top+"px",div.style.width=viewWidth+"px",div.style.height=viewHeight+"px";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId)child._accessibleActive=!1,removeItems(this.children,i,1),this.div.removeChild(child._accessibleDiv),this.pool.push(child._accessibleDiv),child._accessibleDiv=null,i--;else{div=child._accessibleDiv;var hitArea=child.hitArea,wt=child.worldTransform;child.hitArea?(div.style.left=(wt.tx+hitArea.x*wt.a)*sx+"px",div.style.top=(wt.ty+hitArea.y*wt.d)*sy+"px",div.style.width=hitArea.width*wt.a*sx+"px",div.style.height=hitArea.height*wt.d*sy+"px"):(hitArea=child.getBounds(),this.capHitArea(hitArea),div.style.left=hitArea.x*sx+"px",div.style.top=hitArea.y*sy+"px",div.style.width=hitArea.width*sx+"px",div.style.height=hitArea.height*sy+"px",div.title!==child.accessibleTitle&&null!==child.accessibleTitle&&(div.title=child.accessibleTitle),div.getAttribute("aria-label")!==child.accessibleHint&&null!==child.accessibleHint&&div.setAttribute("aria-label",child.accessibleHint)),child.accessibleTitle===div.title&&child.tabIndex===div.tabIndex||(div.title=child.accessibleTitle,div.tabIndex=child.tabIndex,this.debug&&this.updateDebugHTML(div))}}this.renderId++}},AccessibilityManager.prototype.updateDebugHTML=function(div){div.innerHTML="type: "+div.type+"</br> title : "+div.title+"</br> tabIndex: "+div.tabIndex},AccessibilityManager.prototype.capHitArea=function(hitArea){hitArea.x<0&&(hitArea.width+=hitArea.x,hitArea.x=0),hitArea.y<0&&(hitArea.height+=hitArea.y,hitArea.y=0);var _a=this.renderer,viewWidth=_a.width,viewHeight=_a.height;hitArea.x+hitArea.width>viewWidth&&(hitArea.width=viewWidth-hitArea.x),hitArea.y+hitArea.height>viewHeight&&(hitArea.height=viewHeight-hitArea.y)},AccessibilityManager.prototype.addChild=function(displayObject){var div=this.pool.pop();div||((div=document.createElement("button")).style.width="100px",div.style.height="100px",div.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",div.style.position="absolute",div.style.zIndex=2..toString(),div.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?div.setAttribute("aria-live","off"):div.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?div.setAttribute("aria-relevant","additions"):div.setAttribute("aria-relevant","text"),div.addEventListener("click",this._onClick.bind(this)),div.addEventListener("focus",this._onFocus.bind(this)),div.addEventListener("focusout",this._onFocusOut.bind(this))),div.style.pointerEvents=displayObject.accessiblePointerEvents,div.type=displayObject.accessibleType,displayObject.accessibleTitle&&null!==displayObject.accessibleTitle?div.title=displayObject.accessibleTitle:displayObject.accessibleHint&&null!==displayObject.accessibleHint||(div.title="displayObject "+displayObject.tabIndex),displayObject.accessibleHint&&null!==displayObject.accessibleHint&&div.setAttribute("aria-label",displayObject.accessibleHint),this.debug&&this.updateDebugHTML(div),displayObject._accessibleActive=!0,displayObject._accessibleDiv=div,div.displayObject=displayObject,this.children.push(displayObject),this.div.appendChild(displayObject._accessibleDiv),displayObject._accessibleDiv.tabIndex=displayObject.tabIndex},AccessibilityManager.prototype._onClick=function(e){var interactionManager=this.renderer.plugins.interaction,displayObject=e.target.displayObject,eventData=interactionManager.eventData;interactionManager.dispatchEvent(displayObject,"click",eventData),interactionManager.dispatchEvent(displayObject,"pointertap",eventData),interactionManager.dispatchEvent(displayObject,"tap",eventData)},AccessibilityManager.prototype._onFocus=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive");var interactionManager=this.renderer.plugins.interaction,displayObject=e.target.displayObject,eventData=interactionManager.eventData;interactionManager.dispatchEvent(displayObject,"mouseover",eventData)},AccessibilityManager.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite");var interactionManager=this.renderer.plugins.interaction,displayObject=e.target.displayObject,eventData=interactionManager.eventData;interactionManager.dispatchEvent(displayObject,"mouseout",eventData)},AccessibilityManager.prototype._onKeyDown=function(e){9===e.keyCode&&this.activate()},AccessibilityManager.prototype._onMouseMove=function(e){0===e.movementX&&0===e.movementY||this.deactivate()},AccessibilityManager.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,self.document.removeEventListener("mousemove",this._onMouseMove,!0),self.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},AccessibilityManager}();settings.TARGET_FPMS=.06,function(UPDATE_PRIORITY){UPDATE_PRIORITY[UPDATE_PRIORITY.INTERACTION=50]="INTERACTION",UPDATE_PRIORITY[UPDATE_PRIORITY.HIGH=25]="HIGH",UPDATE_PRIORITY[UPDATE_PRIORITY.NORMAL=0]="NORMAL",UPDATE_PRIORITY[UPDATE_PRIORITY.LOW=-25]="LOW",UPDATE_PRIORITY[UPDATE_PRIORITY.UTILITY=-50]="UTILITY"}(UPDATE_PRIORITY||(UPDATE_PRIORITY={}));var TickerListener=function(){function TickerListener(fn,context,priority,once){void 0===context&&(context=null),void 0===priority&&(priority=0),void 0===once&&(once=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=fn,this.context=context,this.priority=priority,this.once=once}return TickerListener.prototype.match=function(fn,context){return void 0===context&&(context=null),this.fn===fn&&this.context===context},TickerListener.prototype.emit=function(deltaTime){this.fn&&(this.context?this.fn.call(this.context,deltaTime):this.fn(deltaTime));var redirect=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),redirect},TickerListener.prototype.connect=function(previous){this.previous=previous,previous.next&&(previous.next.previous=this),this.next=previous.next,previous.next=this},TickerListener.prototype.destroy=function(hard){void 0===hard&&(hard=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var redirect=this.next;return this.next=hard?null:redirect,this.previous=null,redirect},TickerListener}(),Ticker=function(){function Ticker(){var _this=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=function(time){_this._requestId=null,_this.started&&(_this.update(time),_this.started&&null===_this._requestId&&_this._head.next&&(_this._requestId=requestAnimationFrame(_this._tick)))}}return Ticker.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},Ticker.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},Ticker.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},Ticker.prototype.add=function(fn,context,priority){return void 0===priority&&(priority=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(fn,context,priority))},Ticker.prototype.addOnce=function(fn,context,priority){return void 0===priority&&(priority=UPDATE_PRIORITY.NORMAL),this._addListener(new TickerListener(fn,context,priority,!0))},Ticker.prototype._addListener=function(listener){var current=this._head.next,previous=this._head;if(current){for(;current;){if(listener.priority>current.priority){listener.connect(previous);break}previous=current,current=current.next}listener.previous||listener.connect(previous)}else listener.connect(previous);return this._startIfPossible(),this},Ticker.prototype.remove=function(fn,context){for(var listener=this._head.next;listener;)listener=listener.match(fn,context)?listener.destroy():listener.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(Ticker.prototype,"count",{get:function(){if(!this._head)return 0;for(var count=0,current=this._head;current=current.next;)count++;return count},enumerable:!1,configurable:!0}),Ticker.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},Ticker.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},Ticker.prototype.destroy=function(){if(!this._protected){this.stop();for(var listener=this._head.next;listener;)listener=listener.destroy(!0);this._head.destroy(),this._head=null}},Ticker.prototype.update=function(currentTime){var elapsedMS;if(void 0===currentTime&&(currentTime=performance.now()),currentTime>this.lastTime){if((elapsedMS=this.elapsedMS=currentTime-this.lastTime)>this._maxElapsedMS&&(elapsedMS=this._maxElapsedMS),elapsedMS*=this.speed,this._minElapsedMS){var delta=currentTime-this._lastFrame|0;if(delta<this._minElapsedMS)return;this._lastFrame=currentTime-delta%this._minElapsedMS}this.deltaMS=elapsedMS,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;for(var head=this._head,listener=head.next;listener;)listener=listener.emit(this.deltaTime);head.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=currentTime},Object.defineProperty(Ticker.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(fps){var minFPS=Math.min(this.maxFPS,fps),minFPMS=Math.min(Math.max(0,minFPS)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/minFPMS},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(fps){if(0===fps)this._minElapsedMS=0;else{var maxFPS=Math.max(this.minFPS,fps);this._minElapsedMS=1/(maxFPS/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker,"shared",{get:function(){if(!Ticker._shared){var shared=Ticker._shared=new Ticker;shared.autoStart=!0,shared._protected=!0}return Ticker._shared},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker,"system",{get:function(){if(!Ticker._system){var system=Ticker._system=new Ticker;system.autoStart=!0,system._protected=!0}return Ticker._system},enumerable:!1,configurable:!0}),Ticker}(),TickerPlugin=function(){function TickerPlugin(){}return TickerPlugin.init=function(options){var _this=this;options=Object.assign({autoStart:!0,sharedTicker:!1},options),Object.defineProperty(this,"ticker",{set:function(ticker){this._ticker&&this._ticker.remove(this.render,this),this._ticker=ticker,ticker&&ticker.add(this.render,this,UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){_this._ticker.stop()},this.start=function(){_this._ticker.start()},this._ticker=null,this.ticker=options.sharedTicker?Ticker.shared:new Ticker,options.autoStart&&this.start()},TickerPlugin.destroy=function(){if(this._ticker){var oldTicker=this._ticker;this.ticker=null,oldTicker.destroy()}},TickerPlugin}(),InteractionData=function(){function InteractionData(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Point,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(InteractionData.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),InteractionData.prototype.getLocalPosition=function(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)},InteractionData.prototype.copyEvent=function(event){"isPrimary"in event&&event.isPrimary&&(this.isPrimary=!0),this.button="button"in event&&event.button;var buttons="buttons"in event&&event.buttons;this.buttons=Number.isInteger(buttons)?buttons:"which"in event&&event.which,this.width="width"in event&&event.width,this.height="height"in event&&event.height,this.tiltX="tiltX"in event&&event.tiltX,this.tiltY="tiltY"in event&&event.tiltY,this.pointerType="pointerType"in event&&event.pointerType,this.pressure="pressure"in event&&event.pressure,this.rotationAngle="rotationAngle"in event&&event.rotationAngle,this.twist="twist"in event&&event.twist||0,this.tangentialPressure="tangentialPressure"in event&&event.tangentialPressure||0},InteractionData.prototype.reset=function(){this.isPrimary=!1},InteractionData}(),interaction_extendStatics=function(d,b){return interaction_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},interaction_extendStatics(d,b)};var InteractionEvent=function(){function InteractionEvent(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return InteractionEvent.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},InteractionEvent.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},InteractionEvent}(),InteractionTrackingData=function(){function InteractionTrackingData(pointerId){this._pointerId=pointerId,this._flags=InteractionTrackingData.FLAGS.NONE}return InteractionTrackingData.prototype._doSet=function(flag,yn){this._flags=yn?this._flags|flag:this._flags&~flag},Object.defineProperty(InteractionTrackingData.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData.prototype,"flags",{get:function(){return this._flags},set:function(flags){this._flags=flags},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData.prototype,"none",{get:function(){return this._flags===InteractionTrackingData.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData.prototype,"over",{get:function(){return 0!=(this._flags&InteractionTrackingData.FLAGS.OVER)},set:function(yn){this._doSet(InteractionTrackingData.FLAGS.OVER,yn)},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData.prototype,"rightDown",{get:function(){return 0!=(this._flags&InteractionTrackingData.FLAGS.RIGHT_DOWN)},set:function(yn){this._doSet(InteractionTrackingData.FLAGS.RIGHT_DOWN,yn)},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionTrackingData.prototype,"leftDown",{get:function(){return 0!=(this._flags&InteractionTrackingData.FLAGS.LEFT_DOWN)},set:function(yn){this._doSet(InteractionTrackingData.FLAGS.LEFT_DOWN,yn)},enumerable:!1,configurable:!0}),InteractionTrackingData.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),InteractionTrackingData}(),TreeSearch=function(){function TreeSearch(){this._tempPoint=new Point}return TreeSearch.prototype.recursiveFindHit=function(interactionEvent,displayObject,func,hitTest,interactive){if(!displayObject||!displayObject.visible)return!1;var point=interactionEvent.data.global,hit=!1,interactiveParent=interactive=displayObject.interactive||interactive,hitTestChildren=!0;if(displayObject.hitArea?(hitTest&&(displayObject.worldTransform.applyInverse(point,this._tempPoint),displayObject.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?hit=!0:(hitTest=!1,hitTestChildren=!1)),interactiveParent=!1):displayObject._mask&&hitTest&&(displayObject._mask.containsPoint&&displayObject._mask.containsPoint(point)||(hitTest=!1)),hitTestChildren&&displayObject.interactiveChildren&&displayObject.children)for(var children=displayObject.children,i=children.length-1;i>=0;i--){var child=children[i],childHit=this.recursiveFindHit(interactionEvent,child,func,hitTest,interactiveParent);if(childHit){if(!child.parent)continue;interactiveParent=!1,childHit&&(interactionEvent.target&&(hitTest=!1),hit=!0)}}return interactive&&(hitTest&&!interactionEvent.target&&!displayObject.hitArea&&displayObject.containsPoint&&displayObject.containsPoint(point)&&(hit=!0),displayObject.interactive&&(hit&&!interactionEvent.target&&(interactionEvent.target=displayObject),func&&func(interactionEvent,displayObject,!!hit))),hit},TreeSearch.prototype.findHit=function(interactionEvent,displayObject,func,hitTest){this.recursiveFindHit(interactionEvent,displayObject,func,hitTest,!1)},TreeSearch}(),interactiveTarget={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(value){value?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};DisplayObject.mixin(interactiveTarget);var hitTestEvent={target:null,data:{global:null}},InteractionManager=function(_super){function InteractionManager(renderer,options){var _this=_super.call(this)||this;return options=options||{},_this.renderer=renderer,_this.autoPreventDefault=void 0===options.autoPreventDefault||options.autoPreventDefault,_this.interactionFrequency=options.interactionFrequency||10,_this.mouse=new InteractionData,_this.mouse.identifier=1,_this.mouse.global.set(-999999),_this.activeInteractionData={},_this.activeInteractionData[1]=_this.mouse,_this.interactionDataPool=[],_this.eventData=new InteractionEvent,_this.interactionDOMElement=null,_this.moveWhenInside=!1,_this.eventsAdded=!1,_this.tickerAdded=!1,_this.mouseOverRenderer=!("PointerEvent"in self),_this.supportsTouchEvents="ontouchstart"in self,_this.supportsPointerEvents=!!self.PointerEvent,_this.onPointerUp=_this.onPointerUp.bind(_this),_this.processPointerUp=_this.processPointerUp.bind(_this),_this.onPointerCancel=_this.onPointerCancel.bind(_this),_this.processPointerCancel=_this.processPointerCancel.bind(_this),_this.onPointerDown=_this.onPointerDown.bind(_this),_this.processPointerDown=_this.processPointerDown.bind(_this),_this.onPointerMove=_this.onPointerMove.bind(_this),_this.processPointerMove=_this.processPointerMove.bind(_this),_this.onPointerOut=_this.onPointerOut.bind(_this),_this.processPointerOverOut=_this.processPointerOverOut.bind(_this),_this.onPointerOver=_this.onPointerOver.bind(_this),_this.cursorStyles={default:"inherit",pointer:"pointer"},_this.currentCursorMode=null,_this.cursor=null,_this.resolution=1,_this.delayedEvents=[],_this.search=new TreeSearch,_this._tempDisplayObject=new TemporaryDisplayObject,_this._eventListenerOptions={capture:!0,passive:!1},_this._useSystemTicker=void 0===options.useSystemTicker||options.useSystemTicker,_this.setTargetElement(_this.renderer.view,_this.renderer.resolution),_this}return function(d,b){function __(){this.constructor=d}interaction_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(InteractionManager,_super),Object.defineProperty(InteractionManager.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(useSystemTicker){this._useSystemTicker=useSystemTicker,useSystemTicker?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(InteractionManager.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),InteractionManager.prototype.hitTest=function(globalPoint,root){return hitTestEvent.target=null,hitTestEvent.data.global=globalPoint,root||(root=this.lastObjectRendered),this.processInteractive(hitTestEvent,root,null,!0),hitTestEvent.target},InteractionManager.prototype.setTargetElement=function(element,resolution){void 0===resolution&&(resolution=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=element,this.resolution=resolution,this.addEvents(),this.addTickerListener()},InteractionManager.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(Ticker.system.add(this.tickerUpdate,this,UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},InteractionManager.prototype.removeTickerListener=function(){this.tickerAdded&&(Ticker.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},InteractionManager.prototype.addEvents=function(){if(!this.eventsAdded&&this.interactionDOMElement){var style=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(style.msContentZooming="none",style.msTouchAction="none"):this.supportsPointerEvents&&(style.touchAction="none"),this.supportsPointerEvents?(self.document.addEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.addEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.addEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.addEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.eventsAdded=!0}},InteractionManager.prototype.removeEvents=function(){if(this.eventsAdded&&this.interactionDOMElement){var style=this.interactionDOMElement.style;self.navigator.msPointerEnabled?(style.msContentZooming="",style.msTouchAction=""):this.supportsPointerEvents&&(style.touchAction=""),this.supportsPointerEvents?(self.document.removeEventListener("pointermove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("pointercancel",this.onPointerCancel,this._eventListenerOptions),self.removeEventListener("pointerup",this.onPointerUp,this._eventListenerOptions)):(self.document.removeEventListener("mousemove",this.onPointerMove,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,this._eventListenerOptions),self.removeEventListener("mouseup",this.onPointerUp,this._eventListenerOptions)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,this._eventListenerOptions),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,this._eventListenerOptions)),this.interactionDOMElement=null,this.eventsAdded=!1}},InteractionManager.prototype.tickerUpdate=function(deltaTime){this._deltaTime+=deltaTime,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},InteractionManager.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var k in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(k)){var interactionData=this.activeInteractionData[k];if(interactionData.originalEvent&&"touch"!==interactionData.pointerType){var interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,interactionData.originalEvent,interactionData);this.processInteractive(interactionEvent,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},InteractionManager.prototype.setCursorMode=function(mode){mode=mode||"default";var applyStyles=!0;if(self.OffscreenCanvas&&this.interactionDOMElement instanceof OffscreenCanvas&&(applyStyles=!1),this.currentCursorMode!==mode){this.currentCursorMode=mode;var style=this.cursorStyles[mode];if(style)switch(typeof style){case"string":applyStyles&&(this.interactionDOMElement.style.cursor=style);break;case"function":style(mode);break;case"object":applyStyles&&Object.assign(this.interactionDOMElement.style,style)}else applyStyles&&"string"==typeof mode&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,mode)&&(this.interactionDOMElement.style.cursor=mode)}},InteractionManager.prototype.dispatchEvent=function(displayObject,eventString,eventData){eventData.stopPropagationHint&&displayObject!==eventData.stopsPropagatingAt||(eventData.currentTarget=displayObject,eventData.type=eventString,displayObject.emit(eventString,eventData),displayObject[eventString]&&displayObject[eventString](eventData))},InteractionManager.prototype.delayDispatchEvent=function(displayObject,eventString,eventData){this.delayedEvents.push({displayObject,eventString,eventData})},InteractionManager.prototype.mapPositionToPoint=function(point,x,y){var rect;rect=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:this.interactionDOMElement.width,height:this.interactionDOMElement.height,left:0,top:0};var resolutionMultiplier=1/this.resolution;point.x=(x-rect.left)*(this.interactionDOMElement.width/rect.width)*resolutionMultiplier,point.y=(y-rect.top)*(this.interactionDOMElement.height/rect.height)*resolutionMultiplier},InteractionManager.prototype.processInteractive=function(interactionEvent,displayObject,func,hitTest){var hit=this.search.findHit(interactionEvent,displayObject,func,hitTest),delayedEvents=this.delayedEvents;if(!delayedEvents.length)return hit;interactionEvent.stopPropagationHint=!1;var delayedLen=delayedEvents.length;this.delayedEvents=[];for(var i=0;i<delayedLen;i++){var _a=delayedEvents[i],displayObject_1=_a.displayObject,eventString=_a.eventString,eventData=_a.eventData;eventData.stopsPropagatingAt===displayObject_1&&(eventData.stopPropagationHint=!0),this.dispatchEvent(displayObject_1,eventString,eventData)}return hit},InteractionManager.prototype.onPointerDown=function(originalEvent){if(!this.supportsTouchEvents||"touch"!==originalEvent.pointerType){var events=this.normalizeToPointerData(originalEvent);if(this.autoPreventDefault&&events[0].isNormalized)(originalEvent.cancelable||!("cancelable"in originalEvent))&&originalEvent.preventDefault();for(var eventLen=events.length,i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);if(interactionEvent.data.originalEvent=originalEvent,this.processInteractive(interactionEvent,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",interactionEvent),"touch"===event.pointerType)this.emit("touchstart",interactionEvent);else if("mouse"===event.pointerType||"pen"===event.pointerType){var isRightButton=2===event.button;this.emit(isRightButton?"rightdown":"mousedown",this.eventData)}}}},InteractionManager.prototype.processPointerDown=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier;if(hit)if(displayObject.trackedPointers[id]||(displayObject.trackedPointers[id]=new InteractionTrackingData(id)),this.dispatchEvent(displayObject,"pointerdown",interactionEvent),"touch"===data.pointerType)this.dispatchEvent(displayObject,"touchstart",interactionEvent);else if("mouse"===data.pointerType||"pen"===data.pointerType){var isRightButton=2===data.button;isRightButton?displayObject.trackedPointers[id].rightDown=!0:displayObject.trackedPointers[id].leftDown=!0,this.dispatchEvent(displayObject,isRightButton?"rightdown":"mousedown",interactionEvent)}},InteractionManager.prototype.onPointerComplete=function(originalEvent,cancelled,func){for(var events=this.normalizeToPointerData(originalEvent),eventLen=events.length,eventAppend=originalEvent.target!==this.interactionDOMElement?"outside":"",i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);if(interactionEvent.data.originalEvent=originalEvent,this.processInteractive(interactionEvent,this.lastObjectRendered,func,cancelled||!eventAppend),this.emit(cancelled?"pointercancel":"pointerup"+eventAppend,interactionEvent),"mouse"===event.pointerType||"pen"===event.pointerType){var isRightButton=2===event.button;this.emit(isRightButton?"rightup"+eventAppend:"mouseup"+eventAppend,interactionEvent)}else"touch"===event.pointerType&&(this.emit(cancelled?"touchcancel":"touchend"+eventAppend,interactionEvent),this.releaseInteractionDataForPointerId(event.pointerId))}},InteractionManager.prototype.onPointerCancel=function(event){this.supportsTouchEvents&&"touch"===event.pointerType||this.onPointerComplete(event,!0,this.processPointerCancel)},InteractionManager.prototype.processPointerCancel=function(interactionEvent,displayObject){var data=interactionEvent.data,id=interactionEvent.data.identifier;void 0!==displayObject.trackedPointers[id]&&(delete displayObject.trackedPointers[id],this.dispatchEvent(displayObject,"pointercancel",interactionEvent),"touch"===data.pointerType&&this.dispatchEvent(displayObject,"touchcancel",interactionEvent))},InteractionManager.prototype.onPointerUp=function(event){this.supportsTouchEvents&&"touch"===event.pointerType||this.onPointerComplete(event,!1,this.processPointerUp)},InteractionManager.prototype.processPointerUp=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier,trackingData=displayObject.trackedPointers[id],isTouch="touch"===data.pointerType,isMouse="mouse"===data.pointerType||"pen"===data.pointerType,isMouseTap=!1;if(isMouse){var isRightButton=2===data.button,flags=InteractionTrackingData.FLAGS,test=isRightButton?flags.RIGHT_DOWN:flags.LEFT_DOWN,isDown=void 0!==trackingData&&trackingData.flags&test;hit?(this.dispatchEvent(displayObject,isRightButton?"rightup":"mouseup",interactionEvent),isDown&&(this.dispatchEvent(displayObject,isRightButton?"rightclick":"click",interactionEvent),isMouseTap=!0)):isDown&&this.dispatchEvent(displayObject,isRightButton?"rightupoutside":"mouseupoutside",interactionEvent),trackingData&&(isRightButton?trackingData.rightDown=!1:trackingData.leftDown=!1)}hit?(this.dispatchEvent(displayObject,"pointerup",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchend",interactionEvent),trackingData&&(isMouse&&!isMouseTap||this.dispatchEvent(displayObject,"pointertap",interactionEvent),isTouch&&(this.dispatchEvent(displayObject,"tap",interactionEvent),trackingData.over=!1))):trackingData&&(this.dispatchEvent(displayObject,"pointerupoutside",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchendoutside",interactionEvent)),trackingData&&trackingData.none&&delete displayObject.trackedPointers[id]},InteractionManager.prototype.onPointerMove=function(originalEvent){if(!this.supportsTouchEvents||"touch"!==originalEvent.pointerType){var events=this.normalizeToPointerData(originalEvent);"mouse"!==events[0].pointerType&&"pen"!==events[0].pointerType||(this._didMove=!0,this.cursor=null);for(var eventLen=events.length,i=0;i<eventLen;i++){var event=events[i],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=originalEvent,this.processInteractive(interactionEvent,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",interactionEvent),"touch"===event.pointerType&&this.emit("touchmove",interactionEvent),"mouse"!==event.pointerType&&"pen"!==event.pointerType||this.emit("mousemove",interactionEvent)}"mouse"===events[0].pointerType&&this.setCursorMode(this.cursor)}},InteractionManager.prototype.processPointerMove=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,isTouch="touch"===data.pointerType,isMouse="mouse"===data.pointerType||"pen"===data.pointerType;isMouse&&this.processPointerOverOut(interactionEvent,displayObject,hit),this.moveWhenInside&&!hit||(this.dispatchEvent(displayObject,"pointermove",interactionEvent),isTouch&&this.dispatchEvent(displayObject,"touchmove",interactionEvent),isMouse&&this.dispatchEvent(displayObject,"mousemove",interactionEvent))},InteractionManager.prototype.onPointerOut=function(originalEvent){if(!this.supportsTouchEvents||"touch"!==originalEvent.pointerType){var event=this.normalizeToPointerData(originalEvent)[0];"mouse"===event.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event,this.processInteractive(interactionEvent,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",interactionEvent),"mouse"===event.pointerType||"pen"===event.pointerType?this.emit("mouseout",interactionEvent):this.releaseInteractionDataForPointerId(interactionData.identifier)}},InteractionManager.prototype.processPointerOverOut=function(interactionEvent,displayObject,hit){var data=interactionEvent.data,id=interactionEvent.data.identifier,isMouse="mouse"===data.pointerType||"pen"===data.pointerType,trackingData=displayObject.trackedPointers[id];hit&&!trackingData&&(trackingData=displayObject.trackedPointers[id]=new InteractionTrackingData(id)),void 0!==trackingData&&(hit&&this.mouseOverRenderer?(trackingData.over||(trackingData.over=!0,this.delayDispatchEvent(displayObject,"pointerover",interactionEvent),isMouse&&this.delayDispatchEvent(displayObject,"mouseover",interactionEvent)),isMouse&&null===this.cursor&&(this.cursor=displayObject.cursor)):trackingData.over&&(trackingData.over=!1,this.dispatchEvent(displayObject,"pointerout",this.eventData),isMouse&&this.dispatchEvent(displayObject,"mouseout",interactionEvent),trackingData.none&&delete displayObject.trackedPointers[id]))},InteractionManager.prototype.onPointerOver=function(originalEvent){var event=this.normalizeToPointerData(originalEvent)[0],interactionData=this.getInteractionDataForPointerId(event),interactionEvent=this.configureInteractionEventForDOMEvent(this.eventData,event,interactionData);interactionEvent.data.originalEvent=event,"mouse"===event.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",interactionEvent),"mouse"!==event.pointerType&&"pen"!==event.pointerType||this.emit("mouseover",interactionEvent)},InteractionManager.prototype.getInteractionDataForPointerId=function(event){var interactionData,pointerId=event.pointerId;return 1===pointerId||"mouse"===event.pointerType?interactionData=this.mouse:this.activeInteractionData[pointerId]?interactionData=this.activeInteractionData[pointerId]:((interactionData=this.interactionDataPool.pop()||new InteractionData).identifier=pointerId,this.activeInteractionData[pointerId]=interactionData),interactionData.copyEvent(event),interactionData},InteractionManager.prototype.releaseInteractionDataForPointerId=function(pointerId){var interactionData=this.activeInteractionData[pointerId];interactionData&&(delete this.activeInteractionData[pointerId],interactionData.reset(),this.interactionDataPool.push(interactionData))},InteractionManager.prototype.configureInteractionEventForDOMEvent=function(interactionEvent,pointerEvent,interactionData){return interactionEvent.data=interactionData,this.mapPositionToPoint(interactionData.global,pointerEvent.clientX,pointerEvent.clientY),"touch"===pointerEvent.pointerType&&(pointerEvent.globalX=interactionData.global.x,pointerEvent.globalY=interactionData.global.y),interactionData.originalEvent=pointerEvent,interactionEvent.reset(),interactionEvent},InteractionManager.prototype.normalizeToPointerData=function(event){var normalizedEvents=[];if(this.supportsTouchEvents&&event instanceof TouchEvent)for(var i=0,li=event.changedTouches.length;i<li;i++){var touch=event.changedTouches[i];void 0===touch.button&&(touch.button=event.touches.length?1:0),void 0===touch.buttons&&(touch.buttons=event.touches.length?1:0),void 0===touch.isPrimary&&(touch.isPrimary=1===event.touches.length&&"touchstart"===event.type),void 0===touch.width&&(touch.width=touch.radiusX||1),void 0===touch.height&&(touch.height=touch.radiusY||1),void 0===touch.tiltX&&(touch.tiltX=0),void 0===touch.tiltY&&(touch.tiltY=0),void 0===touch.pointerType&&(touch.pointerType="touch"),void 0===touch.pointerId&&(touch.pointerId=touch.identifier||0),void 0===touch.pressure&&(touch.pressure=touch.force||.5),void 0===touch.twist&&(touch.twist=0),void 0===touch.tangentialPressure&&(touch.tangentialPressure=0),void 0===touch.layerX&&(touch.layerX=touch.offsetX=touch.clientX),void 0===touch.layerY&&(touch.layerY=touch.offsetY=touch.clientY),touch.isNormalized=!0,normalizedEvents.push(touch)}else if(self.MouseEvent&&(!(event instanceof MouseEvent)||this.supportsPointerEvents&&event instanceof self.PointerEvent))normalizedEvents.push(event);else{var tempEvent=event;void 0===tempEvent.isPrimary&&(tempEvent.isPrimary=!0),void 0===tempEvent.width&&(tempEvent.width=1),void 0===tempEvent.height&&(tempEvent.height=1),void 0===tempEvent.tiltX&&(tempEvent.tiltX=0),void 0===tempEvent.tiltY&&(tempEvent.tiltY=0),void 0===tempEvent.pointerType&&(tempEvent.pointerType="mouse"),void 0===tempEvent.pointerId&&(tempEvent.pointerId=1),void 0===tempEvent.pressure&&(tempEvent.pressure=.5),void 0===tempEvent.twist&&(tempEvent.twist=0),void 0===tempEvent.tangentialPressure&&(tempEvent.tangentialPressure=0),tempEvent.isNormalized=!0,normalizedEvents.push(tempEvent)}return normalizedEvents},InteractionManager.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},InteractionManager}(eventemitter3_default()),Runner=function(){function Runner(name){this.items=[],this._name=name,this._aliasCount=0}return Runner.prototype.emit=function(a0,a1,a2,a3,a4,a5,a6,a7){if(arguments.length>8)throw new Error("max arguments reached");var _a=this,name=_a.name,items=_a.items;this._aliasCount++;for(var i=0,len=items.length;i<len;i++)items[i][name](a0,a1,a2,a3,a4,a5,a6,a7);return items===this.items&&this._aliasCount--,this},Runner.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},Runner.prototype.add=function(item){return item[this._name]&&(this.ensureNonAliasedItems(),this.remove(item),this.items.push(item)),this},Runner.prototype.remove=function(item){var index=this.items.indexOf(item);return-1!==index&&(this.ensureNonAliasedItems(),this.items.splice(index,1)),this},Runner.prototype.contains=function(item){return-1!==this.items.indexOf(item)},Runner.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},Runner.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(Runner.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(Runner.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Runner}();Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}}),settings.PREFER_ENV=settings_isMobile.any?constants_ENV.WEBGL:constants_ENV.WEBGL2,settings.STRICT_TEXTURE_CACHE=!1;var INSTALLED=[];function autoDetectResource(source,options){if(!source)return null;var extension="";if("string"==typeof source){var result=/\.(\w{3,4})(?:$|\?|#)/i.exec(source);result&&(extension=result[1].toLowerCase())}for(var i=INSTALLED.length-1;i>=0;--i){var ResourcePlugin=INSTALLED[i];if(ResourcePlugin.test&&ResourcePlugin.test(source,extension))return new ResourcePlugin(source,options)}throw new Error("Unrecognized source type to auto-detect Resource")}var core_extendStatics=function(d,b){return core_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},core_extendStatics(d,b)};function core_extends(d,b){function __(){this.constructor=d}core_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function(t){for(var s,arguments$1=arguments,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments$1[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};var Resource=function(){function Resource(width,height){void 0===width&&(width=0),void 0===height&&(height=0),this._width=width,this._height=height,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}return Resource.prototype.bind=function(baseTexture){this.onResize.add(baseTexture),this.onUpdate.add(baseTexture),this.onError.add(baseTexture),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},Resource.prototype.unbind=function(baseTexture){this.onResize.remove(baseTexture),this.onUpdate.remove(baseTexture),this.onError.remove(baseTexture)},Resource.prototype.resize=function(width,height){width===this._width&&height===this._height||(this._width=width,this._height=height,this.onResize.emit(width,height))},Object.defineProperty(Resource.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),Resource.prototype.update=function(){this.destroyed||this.onUpdate.emit()},Resource.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(Resource.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(Resource.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Resource.prototype.style=function(_renderer,_baseTexture,_glTexture){return!1},Resource.prototype.dispose=function(){},Resource.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Resource.test=function(_source,_extension){return!1},Resource}(),BufferResource=function(_super){function BufferResource(source,options){var _this=this,_a=options||{},width=_a.width,height=_a.height;if(!width||!height)throw new Error("BufferResource width or height invalid");return(_this=_super.call(this,width,height)||this).data=source,_this}return core_extends(BufferResource,_super),BufferResource.prototype.upload=function(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===constants_ALPHA_MODES.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data)),!0},BufferResource.prototype.dispose=function(){this.data=null},BufferResource.test=function(source){return source instanceof Float32Array||source instanceof Uint8Array||source instanceof Uint32Array},BufferResource}(Resource),defaultBufferOptions={scaleMode:constants_SCALE_MODES.NEAREST,format:constants_FORMATS.RGBA,alphaMode:constants_ALPHA_MODES.NPM},BaseTexture=function(_super){function BaseTexture(resource,options){void 0===resource&&(resource=null),void 0===options&&(options=null);var _this=_super.call(this)||this,alphaMode=(options=options||{}).alphaMode,mipmap=options.mipmap,anisotropicLevel=options.anisotropicLevel,scaleMode=options.scaleMode,width=options.width,height=options.height,wrapMode=options.wrapMode,format=options.format,type=options.type,target=options.target,resolution=options.resolution,resourceOptions=options.resourceOptions;return!resource||resource instanceof Resource||((resource=autoDetectResource(resource,resourceOptions)).internal=!0),_this.resolution=resolution||settings.RESOLUTION,_this.width=Math.round((width||0)*_this.resolution)/_this.resolution,_this.height=Math.round((height||0)*_this.resolution)/_this.resolution,_this._mipmap=void 0!==mipmap?mipmap:settings.MIPMAP_TEXTURES,_this.anisotropicLevel=void 0!==anisotropicLevel?anisotropicLevel:settings.ANISOTROPIC_LEVEL,_this._wrapMode=wrapMode||settings.WRAP_MODE,_this._scaleMode=void 0!==scaleMode?scaleMode:settings.SCALE_MODE,_this.format=format||constants_FORMATS.RGBA,_this.type=type||constants_TYPES.UNSIGNED_BYTE,_this.target=target||constants_TARGETS.TEXTURE_2D,_this.alphaMode=void 0!==alphaMode?alphaMode:constants_ALPHA_MODES.UNPACK,_this.uid=uid(),_this.touched=0,_this.isPowerOfTwo=!1,_this._refreshPOT(),_this._glTextures={},_this.dirtyId=0,_this.dirtyStyleId=0,_this.cacheId=null,_this.valid=width>0&&height>0,_this.textureCacheIds=[],_this.destroyed=!1,_this.resource=null,_this._batchEnabled=0,_this._batchLocation=0,_this.parentTextureArray=null,_this.setResource(resource),_this}return core_extends(BaseTexture,_super),Object.defineProperty(BaseTexture.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"mipmap",{get:function(){return this._mipmap},set:function(value){this._mipmap!==value&&(this._mipmap=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(value){this._scaleMode!==value&&(this._scaleMode=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(value){this._wrapMode!==value&&(this._wrapMode=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),BaseTexture.prototype.setStyle=function(scaleMode,mipmap){var dirty;return void 0!==scaleMode&&scaleMode!==this.scaleMode&&(this.scaleMode=scaleMode,dirty=!0),void 0!==mipmap&&mipmap!==this.mipmap&&(this.mipmap=mipmap,dirty=!0),dirty&&this.dirtyStyleId++,this},BaseTexture.prototype.setSize=function(desiredWidth,desiredHeight,resolution){return resolution=resolution||this.resolution,this.setRealSize(desiredWidth*resolution,desiredHeight*resolution,resolution)},BaseTexture.prototype.setRealSize=function(realWidth,realHeight,resolution){return this.resolution=resolution||this.resolution,this.width=Math.round(realWidth)/this.resolution,this.height=Math.round(realHeight)/this.resolution,this._refreshPOT(),this.update(),this},BaseTexture.prototype._refreshPOT=function(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)},BaseTexture.prototype.setResolution=function(resolution){var oldResolution=this.resolution;return oldResolution===resolution||(this.resolution=resolution,this.valid&&(this.width=Math.round(this.width*oldResolution)/resolution,this.height=Math.round(this.height*oldResolution)/resolution,this.emit("update",this)),this._refreshPOT()),this},BaseTexture.prototype.setResource=function(resource){if(this.resource===resource)return this;if(this.resource)throw new Error("Resource can be set only once");return resource.bind(this),this.resource=resource,this},BaseTexture.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},BaseTexture.prototype.onError=function(event){this.emit("error",this,event)},BaseTexture.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.dispose(),BaseTexture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},BaseTexture.prototype.dispose=function(){this.emit("dispose",this)},BaseTexture.prototype.castToBaseTexture=function(){return this},BaseTexture.from=function(source,options,strict){void 0===strict&&(strict=settings.STRICT_TEXTURE_CACHE);var isFrame="string"==typeof source,cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){var prefix=options&&options.pixiIdPrefix||"pixiid";source._pixiId=prefix+"_"+uid()}cacheId=source._pixiId}var baseTexture=BaseTextureCache[cacheId];if(isFrame&&strict&&!baseTexture)throw new Error('The cacheId "'+cacheId+'" does not exist in BaseTextureCache.');return baseTexture||((baseTexture=new BaseTexture(source,options)).cacheId=cacheId,BaseTexture.addToCache(baseTexture,cacheId)),baseTexture},BaseTexture.fromBuffer=function(buffer,width,height,options){buffer=buffer||new Float32Array(width*height*4);var resource=new BufferResource(buffer,{width,height}),type=buffer instanceof Float32Array?constants_TYPES.FLOAT:constants_TYPES.UNSIGNED_BYTE;return new BaseTexture(resource,Object.assign(defaultBufferOptions,options||{width,height,type}))},BaseTexture.addToCache=function(baseTexture,id){id&&(-1===baseTexture.textureCacheIds.indexOf(id)&&baseTexture.textureCacheIds.push(id),BaseTextureCache[id]&&console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry"),BaseTextureCache[id]=baseTexture)},BaseTexture.removeFromCache=function(baseTexture){if("string"==typeof baseTexture){var baseTextureFromCache=BaseTextureCache[baseTexture];if(baseTextureFromCache){var index=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);return index>-1&&baseTextureFromCache.textureCacheIds.splice(index,1),delete BaseTextureCache[baseTexture],baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i)delete BaseTextureCache[baseTexture.textureCacheIds[i]];return baseTexture.textureCacheIds.length=0,baseTexture}return null},BaseTexture._globalBatch=0,BaseTexture}(eventemitter3_default()),AbstractMultiResource=function(_super){function AbstractMultiResource(length,options){var _this=this,_a=options||{},width=_a.width,height=_a.height;(_this=_super.call(this,width,height)||this).items=[],_this.itemDirtyIds=[];for(var i=0;i<length;i++){var partTexture=new BaseTexture;_this.items.push(partTexture),_this.itemDirtyIds.push(-2)}return _this.length=length,_this._load=null,_this.baseTexture=null,_this}return core_extends(AbstractMultiResource,_super),AbstractMultiResource.prototype.initFromArray=function(resources,options){for(var i=0;i<this.length;i++)resources[i]&&(resources[i].castToBaseTexture?this.addBaseTextureAt(resources[i].castToBaseTexture(),i):resources[i]instanceof Resource?this.addResourceAt(resources[i],i):this.addResourceAt(autoDetectResource(resources[i],options),i))},AbstractMultiResource.prototype.dispose=function(){for(var i=0,len=this.length;i<len;i++)this.items[i].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},AbstractMultiResource.prototype.addResourceAt=function(resource,index){if(!this.items[index])throw new Error("Index "+index+" is out of bounds");return resource.valid&&!this.valid&&this.resize(resource.width,resource.height),this.items[index].setResource(resource),this},AbstractMultiResource.prototype.bind=function(baseTexture){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");_super.prototype.bind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=baseTexture,this.items[i].on("update",baseTexture.update,baseTexture)},AbstractMultiResource.prototype.unbind=function(baseTexture){_super.prototype.unbind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",baseTexture.update,baseTexture)},AbstractMultiResource.prototype.load=function(){var _this=this;if(this._load)return this._load;var promises=this.items.map((function(item){return item.resource})).filter((function(item){return item})).map((function(item){return item.load()}));return this._load=Promise.all(promises).then((function(){var _a=_this.items[0],realWidth=_a.realWidth,realHeight=_a.realHeight;return _this.resize(realWidth,realHeight),Promise.resolve(_this)})),this._load},AbstractMultiResource}(Resource),ArrayResource=function(_super){function ArrayResource(source,options){var urls,length,_this=this,_a=options||{},width=_a.width,height=_a.height;return Array.isArray(source)?(urls=source,length=source.length):length=source,_this=_super.call(this,length,{width,height})||this,urls&&_this.initFromArray(urls,options),_this}return core_extends(ArrayResource,_super),ArrayResource.prototype.addBaseTextureAt=function(baseTexture,index){if(!baseTexture.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(baseTexture.resource,index),this},ArrayResource.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture),baseTexture.target=constants_TARGETS.TEXTURE_2D_ARRAY},ArrayResource.prototype.upload=function(renderer,texture,glTexture){var length=this.length,itemDirtyIds=this.itemDirtyIds,items=this.items,gl=renderer.gl;glTexture.dirtyId<0&&gl.texImage3D(gl.TEXTURE_2D_ARRAY,0,glTexture.internalFormat,this._width,this._height,length,0,texture.format,glTexture.type,null);for(var i=0;i<length;i++){var item=items[i];itemDirtyIds[i]<item.dirtyId&&(itemDirtyIds[i]=item.dirtyId,item.valid&&gl.texSubImage3D(gl.TEXTURE_2D_ARRAY,0,0,0,i,item.resource.width,item.resource.height,1,texture.format,glTexture.type,item.resource.source))}return!0},ArrayResource}(AbstractMultiResource),BaseImageResource=function(_super){function BaseImageResource(source){var _this=this,sourceAny=source,width=sourceAny.naturalWidth||sourceAny.videoWidth||sourceAny.width,height=sourceAny.naturalHeight||sourceAny.videoHeight||sourceAny.height;return(_this=_super.call(this,width,height)||this).source=source,_this.noSubImage=!1,_this}return core_extends(BaseImageResource,_super),BaseImageResource.crossOrigin=function(element,url,crossorigin){void 0===crossorigin&&0!==url.indexOf("data:")?element.crossOrigin=determineCrossOrigin(url):!1!==crossorigin&&(element.crossOrigin="string"==typeof crossorigin?crossorigin:"anonymous")},BaseImageResource.prototype.upload=function(renderer,baseTexture,glTexture,source){var gl=renderer.gl,width=baseTexture.realWidth,height=baseTexture.realHeight;return source=source||this.source,gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===constants_ALPHA_MODES.UNPACK),this.noSubImage||baseTexture.target!==gl.TEXTURE_2D||glTexture.width!==width||glTexture.height!==height?(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,baseTexture.format,glTexture.type,source)):gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,baseTexture.format,glTexture.type,source),!0},BaseImageResource.prototype.update=function(){if(!this.destroyed){var source=this.source,width=source.naturalWidth||source.videoWidth||source.width,height=source.naturalHeight||source.videoHeight||source.height;this.resize(width,height),_super.prototype.update.call(this)}},BaseImageResource.prototype.dispose=function(){this.source=null},BaseImageResource}(Resource),CanvasResource=function(_super){function CanvasResource(source){return _super.call(this,source)||this}return core_extends(CanvasResource,_super),CanvasResource.test=function(source){var OffscreenCanvas=self.OffscreenCanvas;return!!(OffscreenCanvas&&source instanceof OffscreenCanvas)||self.HTMLCanvasElement&&source instanceof HTMLCanvasElement},CanvasResource}(BaseImageResource),CubeResource=function(_super){function CubeResource(source,options){var _this=this,_a=options||{},width=_a.width,height=_a.height,autoLoad=_a.autoLoad,linkBaseTexture=_a.linkBaseTexture;if(source&&source.length!==CubeResource.SIDES)throw new Error("Invalid length. Got "+source.length+", expected 6");_this=_super.call(this,6,{width,height})||this;for(var i=0;i<CubeResource.SIDES;i++)_this.items[i].target=constants_TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+i;return _this.linkBaseTexture=!1!==linkBaseTexture,source&&_this.initFromArray(source,options),!1!==autoLoad&&_this.load(),_this}return core_extends(CubeResource,_super),CubeResource.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture),baseTexture.target=constants_TARGETS.TEXTURE_CUBE_MAP},CubeResource.prototype.addBaseTextureAt=function(baseTexture,index,linkBaseTexture){if(void 0===linkBaseTexture&&(linkBaseTexture=this.linkBaseTexture),!this.items[index])throw new Error("Index "+index+" is out of bounds");if(!this.linkBaseTexture||baseTexture.parentTextureArray||Object.keys(baseTexture._glTextures).length>0){if(!baseTexture.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(baseTexture.resource,index)}else baseTexture.target=constants_TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+index,baseTexture.parentTextureArray=this.baseTexture,this.items[index]=baseTexture;return baseTexture.valid&&!this.valid&&this.resize(baseTexture.realWidth,baseTexture.realHeight),this.items[index]=baseTexture,this},CubeResource.prototype.upload=function(renderer,_baseTexture,glTexture){for(var dirty=this.itemDirtyIds,i=0;i<CubeResource.SIDES;i++){var side=this.items[i];dirty[i]<side.dirtyId&&(side.valid&&side.resource?(side.resource.upload(renderer,side,glTexture),dirty[i]=side.dirtyId):dirty[i]<-1&&(renderer.gl.texImage2D(side.target,0,glTexture.internalFormat,_baseTexture.realWidth,_baseTexture.realHeight,0,_baseTexture.format,glTexture.type,null),dirty[i]=-1))}return!0},CubeResource.test=function(source){return Array.isArray(source)&&source.length===CubeResource.SIDES},CubeResource.SIDES=6,CubeResource}(AbstractMultiResource),ImageResource=function(_super){function ImageResource(source,options){var _this=this;if(options=options||{},!(source instanceof HTMLImageElement)){var imageElement=new Image;BaseImageResource.crossOrigin(imageElement,source,options.crossorigin),imageElement.src=source,source=imageElement}return _this=_super.call(this,source)||this,!source.complete&&_this._width&&_this._height&&(_this._width=0,_this._height=0),_this.url=source.src,_this._process=null,_this.preserveBitmap=!1,_this.createBitmap=(void 0!==options.createBitmap?options.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,_this.alphaMode="number"==typeof options.alphaMode?options.alphaMode:null,_this.bitmap=null,_this._load=null,!1!==options.autoLoad&&_this.load(),_this}return core_extends(ImageResource,_super),ImageResource.prototype.load=function(createBitmap){var _this=this;return this._load||(void 0!==createBitmap&&(this.createBitmap=createBitmap),this._load=new Promise((function(resolve,reject){var source=_this.source;_this.url=source.src;var completed=function(){_this.destroyed||(source.onload=null,source.onerror=null,_this.resize(source.width,source.height),_this._load=null,_this.createBitmap?resolve(_this.process()):resolve(_this))};source.complete&&source.src?completed():(source.onload=completed,source.onerror=function(event){reject(event),_this.onError.emit(event)})}))),this._load},ImageResource.prototype.process=function(){var _this=this,source=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var createImageBitmap=self.createImageBitmap,cors=!source.crossOrigin||"anonymous"===source.crossOrigin;return this._process=fetch(source.src,{mode:cors?"cors":"no-cors"}).then((function(r){return r.blob()})).then((function(blob){return createImageBitmap(blob,0,0,source.width,source.height,{premultiplyAlpha:_this.alphaMode===constants_ALPHA_MODES.UNPACK?"premultiply":"none"})})).then((function(bitmap){return _this.destroyed?Promise.reject():(_this.bitmap=bitmap,_this.update(),_this._process=null,Promise.resolve(_this))})),this._process},ImageResource.prototype.upload=function(renderer,baseTexture,glTexture){if("number"==typeof this.alphaMode&&(baseTexture.alphaMode=this.alphaMode),!this.createBitmap)return _super.prototype.upload.call(this,renderer,baseTexture,glTexture);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(_super.prototype.upload.call(this,renderer,baseTexture,glTexture,this.bitmap),!this.preserveBitmap){var flag=!0,glTextures=baseTexture._glTextures;for(var key in glTextures){var otherTex=glTextures[key];if(otherTex!==glTexture&&otherTex.dirtyId!==baseTexture.dirtyId){flag=!1;break}}flag&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},ImageResource.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,_super.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},ImageResource.test=function(source){return"string"==typeof source||source instanceof HTMLImageElement},ImageResource}(BaseImageResource),SVGResource=function(_super){function SVGResource(sourceBase64,options){var _this=this;return options=options||{},(_this=_super.call(this,document.createElement("canvas"))||this)._width=0,_this._height=0,_this.svg=sourceBase64,_this.scale=options.scale||1,_this._overrideWidth=options.width,_this._overrideHeight=options.height,_this._resolve=null,_this._crossorigin=options.crossorigin,_this._load=null,!1!==options.autoLoad&&_this.load(),_this}return core_extends(SVGResource,_super),SVGResource.prototype.load=function(){var _this=this;return this._load||(this._load=new Promise((function(resolve){if(_this._resolve=function(){_this.resize(_this.source.width,_this.source.height),resolve(_this)},/^\<svg/.test(_this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");_this.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(_this.svg)))}_this._loadSvg()}))),this._load},SVGResource.prototype._loadSvg=function(){var _this=this,tempImage=new Image;BaseImageResource.crossOrigin(tempImage,this.svg,this._crossorigin),tempImage.src=this.svg,tempImage.onerror=function(event){_this._resolve&&(tempImage.onerror=null,_this.onError.emit(event))},tempImage.onload=function(){if(_this._resolve){var svgWidth=tempImage.width,svgHeight=tempImage.height;if(!svgWidth||!svgHeight)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var width=svgWidth*_this.scale,height=svgHeight*_this.scale;(_this._overrideWidth||_this._overrideHeight)&&(width=_this._overrideWidth||_this._overrideHeight/svgHeight*svgWidth,height=_this._overrideHeight||_this._overrideWidth/svgWidth*svgHeight),width=Math.round(width),height=Math.round(height);var canvas=_this.source;canvas.width=width,canvas.height=height,canvas._pixiId="canvas_"+uid(),canvas.getContext("2d").drawImage(tempImage,0,0,svgWidth,svgHeight,0,0,width,height),_this._resolve(),_this._resolve=null}}},SVGResource.getSize=function(svgString){var sizeMatch=SVGResource.SVG_SIZE.exec(svgString),size={};return sizeMatch&&(size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3])),size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]))),size},SVGResource.prototype.dispose=function(){_super.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},SVGResource.test=function(source,extension){return"svg"===extension||"string"==typeof source&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(source)||"string"==typeof source&&SVGResource.SVG_XML.test(source)},SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,SVGResource}(BaseImageResource),VideoResource=function(_super){function VideoResource(source,options){var _this=this;if(options=options||{},!(source instanceof HTMLVideoElement)){var videoElement=document.createElement("video");videoElement.setAttribute("preload","auto"),videoElement.setAttribute("webkit-playsinline",""),videoElement.setAttribute("playsinline",""),"string"==typeof source&&(source=[source]);var firstSrc=source[0].src||source[0];BaseImageResource.crossOrigin(videoElement,firstSrc,options.crossorigin);for(var i=0;i<source.length;++i){var sourceElement=document.createElement("source"),_a=source[i],src=_a.src,mime=_a.mime,baseSrc=(src=src||source[i]).split("?").shift().toLowerCase(),ext=baseSrc.substr(baseSrc.lastIndexOf(".")+1);mime=mime||VideoResource.MIME_TYPES[ext]||"video/"+ext,sourceElement.src=src,sourceElement.type=mime,videoElement.appendChild(sourceElement)}source=videoElement}return(_this=_super.call(this,source)||this).noSubImage=!0,_this._autoUpdate=!0,_this._isConnectedToTicker=!1,_this._updateFPS=options.updateFPS||0,_this._msToNextUpdate=0,_this.autoPlay=!1!==options.autoPlay,_this._load=null,_this._resolve=null,_this._onCanPlay=_this._onCanPlay.bind(_this),_this._onError=_this._onError.bind(_this),!1!==options.autoLoad&&_this.load(),_this}return core_extends(VideoResource,_super),VideoResource.prototype.update=function(_deltaTime){if(!this.destroyed){var elapsedMS=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-elapsedMS),(!this._updateFPS||this._msToNextUpdate<=0)&&(_super.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},VideoResource.prototype.load=function(){var _this=this;if(this._load)return this._load;var source=this.source;return(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0),source.addEventListener("play",this._onPlayStart.bind(this)),source.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(source.addEventListener("canplay",this._onCanPlay),source.addEventListener("canplaythrough",this._onCanPlay),source.addEventListener("error",this._onError,!0)),this._load=new Promise((function(resolve){_this.valid?resolve(_this):(_this._resolve=resolve,source.load())})),this._load},VideoResource.prototype._onError=function(event){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(event)},VideoResource.prototype._isSourcePlaying=function(){var source=this.source;return source.currentTime>0&&!1===source.paused&&!1===source.ended&&source.readyState>2},VideoResource.prototype._isSourceReady=function(){var source=this.source;return 3===source.readyState||4===source.readyState},VideoResource.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)},VideoResource.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)},VideoResource.prototype._onCanPlay=function(){var source=this.source;source.removeEventListener("canplay",this._onCanPlay),source.removeEventListener("canplaythrough",this._onCanPlay);var valid=this.valid;this.resize(source.videoWidth,source.videoHeight),!valid&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&source.play()},VideoResource.prototype.dispose=function(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1);var source=this.source;source&&(source.removeEventListener("error",this._onError,!0),source.pause(),source.src="",source.load()),_super.prototype.dispose.call(this)},Object.defineProperty(VideoResource.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(VideoResource.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(value){value!==this._updateFPS&&(this._updateFPS=value)},enumerable:!1,configurable:!0}),VideoResource.test=function(source,extension){return self.HTMLVideoElement&&source instanceof HTMLVideoElement||VideoResource.TYPES.indexOf(extension)>-1},VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},VideoResource}(BaseImageResource),ImageBitmapResource=function(_super){function ImageBitmapResource(source){return _super.call(this,source)||this}return core_extends(ImageBitmapResource,_super),ImageBitmapResource.test=function(source){return!!self.createImageBitmap&&source instanceof ImageBitmap},ImageBitmapResource}(BaseImageResource);INSTALLED.push(ImageResource,ImageBitmapResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var _resources={__proto__:null,Resource,BaseImageResource,INSTALLED,autoDetectResource,AbstractMultiResource,ArrayResource,BufferResource,CanvasResource,CubeResource,ImageResource,SVGResource,VideoResource,ImageBitmapResource},DepthResource=function(_super){function DepthResource(){return null!==_super&&_super.apply(this,arguments)||this}return core_extends(DepthResource,_super),DepthResource.prototype.upload=function(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===constants_ALPHA_MODES.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data)),!0},DepthResource}(BufferResource),Framebuffer=function(){function Framebuffer(width,height){this.width=Math.round(width||100),this.height=Math.round(height||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=constants_MSAA_QUALITY.NONE}return Object.defineProperty(Framebuffer.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),Framebuffer.prototype.addColorTexture=function(index,texture){return void 0===index&&(index=0),this.colorTextures[index]=texture||new BaseTexture(null,{scaleMode:constants_SCALE_MODES.NEAREST,resolution:1,mipmap:constants_MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Framebuffer.prototype.addDepthTexture=function(texture){return this.depthTexture=texture||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:constants_SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:constants_MIPMAP_MODES.OFF,format:constants_FORMATS.DEPTH_COMPONENT,type:constants_TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Framebuffer.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Framebuffer.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Framebuffer.prototype.resize=function(width,height){if(width=Math.round(width),height=Math.round(height),width!==this.width||height!==this.height){this.width=width,this.height=height,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var texture=this.colorTextures[i],resolution=texture.resolution;texture.setSize(width/resolution,height/resolution)}if(this.depthTexture){resolution=this.depthTexture.resolution;this.depthTexture.setSize(width/resolution,height/resolution)}}},Framebuffer.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Framebuffer.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},Framebuffer}(),BaseRenderTexture=function(_super){function BaseRenderTexture(options){var _this=this;if("number"==typeof options){var width=arguments[0],height=arguments[1],scaleMode=arguments[2],resolution=arguments[3];options={width,height,scaleMode,resolution}}return options.width=options.width||100,options.height=options.height||100,options.multisample=void 0!==options.multisample?options.multisample:constants_MSAA_QUALITY.NONE,(_this=_super.call(this,null,options)||this).mipmap=constants_MIPMAP_MODES.OFF,_this.valid=!0,_this.clearColor=[0,0,0,0],_this.framebuffer=new Framebuffer(_this.realWidth,_this.realHeight).addColorTexture(0,_this),_this.framebuffer.multisample=options.multisample,_this.maskStack=[],_this.filterStack=[{}],_this}return core_extends(BaseRenderTexture,_super),BaseRenderTexture.prototype.resize=function(desiredWidth,desiredHeight){this.framebuffer.resize(desiredWidth*this.resolution,desiredHeight*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},BaseRenderTexture.prototype.dispose=function(){this.framebuffer.dispose(),_super.prototype.dispose.call(this)},BaseRenderTexture.prototype.destroy=function(){_super.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},BaseRenderTexture}(BaseTexture),TextureUvs=function(){function TextureUvs(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return TextureUvs.prototype.set=function(frame,baseFrame,rotate){var tw=baseFrame.width,th=baseFrame.height;if(rotate){var w2=frame.width/2/tw,h2=frame.height/2/th,cX=frame.x/tw+w2,cY=frame.y/th+h2;rotate=groupD8.add(rotate,groupD8.NW),this.x0=cX+w2*groupD8.uX(rotate),this.y0=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x1=cX+w2*groupD8.uX(rotate),this.y1=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x2=cX+w2*groupD8.uX(rotate),this.y2=cY+h2*groupD8.uY(rotate),rotate=groupD8.add(rotate,2),this.x3=cX+w2*groupD8.uX(rotate),this.y3=cY+h2*groupD8.uY(rotate)}else this.x0=frame.x/tw,this.y0=frame.y/th,this.x1=(frame.x+frame.width)/tw,this.y1=frame.y/th,this.x2=(frame.x+frame.width)/tw,this.y2=(frame.y+frame.height)/th,this.x3=frame.x/tw,this.y3=(frame.y+frame.height)/th;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},TextureUvs.prototype.toString=function(){return"[@pixi/core:TextureUvs x0="+this.x0+" y0="+this.y0+" x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+" x3="+this.x3+" y3="+this.y3+"]"},TextureUvs}(),DEFAULT_UVS=new TextureUvs,Texture=function(_super){function Texture(baseTexture,frame,orig,trim,rotate,anchor){var _this=_super.call(this)||this;if(_this.noFrame=!1,frame||(_this.noFrame=!0,frame=new Rectangle(0,0,1,1)),baseTexture instanceof Texture&&(baseTexture=baseTexture.baseTexture),_this.baseTexture=baseTexture,_this._frame=frame,_this.trim=trim,_this.valid=!1,_this._uvs=DEFAULT_UVS,_this.uvMatrix=null,_this.orig=orig||frame,_this._rotate=Number(rotate||0),!0===rotate)_this._rotate=2;else if(_this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return _this.defaultAnchor=anchor?new Point(anchor.x,anchor.y):new Point(0,0),_this._updateID=0,_this.textureCacheIds=[],baseTexture.valid?_this.noFrame?baseTexture.valid&&_this.onBaseTextureUpdated(baseTexture):_this.frame=frame:baseTexture.once("loaded",_this.onBaseTextureUpdated,_this),_this.noFrame&&baseTexture.on("update",_this.onBaseTextureUpdated,_this),_this}return core_extends(Texture,_super),Texture.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},Texture.prototype.onBaseTextureUpdated=function(baseTexture){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=baseTexture.width,this._frame.height=baseTexture.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},Texture.prototype.destroy=function(destroyBase){if(this.baseTexture){if(destroyBase){var resource=this.baseTexture.resource;resource&&resource.url&&TextureCache[resource.url]&&Texture.removeFromCache(resource.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null},Texture.prototype.clone=function(){var clonedFrame=this._frame.clone(),clonedOrig=this._frame===this.orig?clonedFrame:this.orig.clone(),clonedTexture=new Texture(this.baseTexture,!this.noFrame&&clonedFrame,clonedOrig,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(clonedTexture._frame=clonedFrame),clonedTexture},Texture.prototype.updateUvs=function(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},Texture.from=function(source,options,strict){void 0===options&&(options={}),void 0===strict&&(strict=settings.STRICT_TEXTURE_CACHE);var isFrame="string"==typeof source,cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){var prefix=options&&options.pixiIdPrefix||"pixiid";source._pixiId=prefix+"_"+uid()}cacheId=source._pixiId}var texture=TextureCache[cacheId];if(isFrame&&strict&&!texture)throw new Error('The cacheId "'+cacheId+'" does not exist in TextureCache.');return texture||(options.resolution||(options.resolution=getResolutionOfUrl(source)),(texture=new Texture(new BaseTexture(source,options))).baseTexture.cacheId=cacheId,BaseTexture.addToCache(texture.baseTexture,cacheId),Texture.addToCache(texture,cacheId)),texture},Texture.fromURL=function(url,options){var resourceOptions=Object.assign({autoLoad:!1},null==options?void 0:options.resourceOptions),texture=Texture.from(url,Object.assign({resourceOptions},options),!1),resource=texture.baseTexture.resource;return texture.baseTexture.valid?Promise.resolve(texture):resource.load().then((function(){return Promise.resolve(texture)}))},Texture.fromBuffer=function(buffer,width,height,options){return new Texture(BaseTexture.fromBuffer(buffer,width,height,options))},Texture.fromLoader=function(source,imageUrl,name,options){var baseTexture=new BaseTexture(source,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl(imageUrl)},options)),resource=baseTexture.resource;resource instanceof ImageResource&&(resource.url=imageUrl);var texture=new Texture(baseTexture);return name||(name=imageUrl),BaseTexture.addToCache(texture.baseTexture,name),Texture.addToCache(texture,name),name!==imageUrl&&(BaseTexture.addToCache(texture.baseTexture,imageUrl),Texture.addToCache(texture,imageUrl)),texture.baseTexture.valid?Promise.resolve(texture):new Promise((function(resolve){texture.baseTexture.once("loaded",(function(){return resolve(texture)}))}))},Texture.addToCache=function(texture,id){id&&(-1===texture.textureCacheIds.indexOf(id)&&texture.textureCacheIds.push(id),TextureCache[id]&&console.warn("Texture added to the cache with an id ["+id+"] that already had an entry"),TextureCache[id]=texture)},Texture.removeFromCache=function(texture){if("string"==typeof texture){var textureFromCache=TextureCache[texture];if(textureFromCache){var index=textureFromCache.textureCacheIds.indexOf(texture);return index>-1&&textureFromCache.textureCacheIds.splice(index,1),delete TextureCache[texture],textureFromCache}}else if(texture&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i)TextureCache[texture.textureCacheIds[i]]===texture&&delete TextureCache[texture.textureCacheIds[i]];return texture.textureCacheIds.length=0,texture}return null},Object.defineProperty(Texture.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(Texture.prototype,"frame",{get:function(){return this._frame},set:function(frame){this._frame=frame,this.noFrame=!1;var x=frame.x,y=frame.y,width=frame.width,height=frame.height,xNotFit=x+width>this.baseTexture.width,yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or",errorX="X: "+x+" + "+width+" = "+(x+width)+" > "+this.baseTexture.width,errorY="Y: "+y+" + "+height+" = "+(y+height)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+errorX+" "+relationship+" "+errorY)}this.valid=width&&height&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=frame),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Texture.prototype,"rotate",{get:function(){return this._rotate},set:function(rotate){this._rotate=rotate,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Texture.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(Texture.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),Texture.prototype.castToBaseTexture=function(){return this.baseTexture},Texture}(eventemitter3_default());function removeAllHandlers(tex){tex.destroy=function(){},tex.on=function(){},tex.once=function(){},tex.emit=function(){}}Texture.EMPTY=new Texture(new BaseTexture),removeAllHandlers(Texture.EMPTY),removeAllHandlers(Texture.EMPTY.baseTexture),Texture.WHITE=function(){var canvas=document.createElement("canvas");canvas.width=16,canvas.height=16;var context=canvas.getContext("2d");return context.fillStyle="white",context.fillRect(0,0,16,16),new Texture(new BaseTexture(new CanvasResource(canvas)))}(),removeAllHandlers(Texture.WHITE),removeAllHandlers(Texture.WHITE.baseTexture);var RenderTexture=function(_super){function RenderTexture(baseRenderTexture,frame){var _this=_super.call(this,baseRenderTexture,frame)||this;return _this.valid=!0,_this.filterFrame=null,_this.filterPoolKey=null,_this.updateUvs(),_this}return core_extends(RenderTexture,_super),Object.defineProperty(RenderTexture.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(RenderTexture.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(value){this.framebuffer.multisample=value},enumerable:!1,configurable:!0}),RenderTexture.prototype.resize=function(desiredWidth,desiredHeight,resizeBaseTexture){void 0===resizeBaseTexture&&(resizeBaseTexture=!0);var resolution=this.baseTexture.resolution,width=Math.round(desiredWidth*resolution)/resolution,height=Math.round(desiredHeight*resolution)/resolution;this.valid=width>0&&height>0,this._frame.width=this.orig.width=width,this._frame.height=this.orig.height=height,resizeBaseTexture&&this.baseTexture.resize(width,height),this.updateUvs()},RenderTexture.prototype.setResolution=function(resolution){var baseTexture=this.baseTexture;baseTexture.resolution!==resolution&&(baseTexture.setResolution(resolution),this.resize(baseTexture.width,baseTexture.height,!1))},RenderTexture.create=function(options){for(var arguments$1=arguments,rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments$1[_i];return"number"==typeof options&&(deprecation("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),options={width:options,height:rest[0],scaleMode:rest[1],resolution:rest[2]}),new RenderTexture(new BaseRenderTexture(options))},RenderTexture}(Texture),RenderTexturePool=function(){function RenderTexturePool(textureOptions){this.texturePool={},this.textureOptions=textureOptions||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return RenderTexturePool.prototype.createTexture=function(realWidth,realHeight,multisample){void 0===multisample&&(multisample=constants_MSAA_QUALITY.NONE);var baseRenderTexture=new BaseRenderTexture(Object.assign({width:realWidth,height:realHeight,resolution:1,multisample},this.textureOptions));return new RenderTexture(baseRenderTexture)},RenderTexturePool.prototype.getOptimalTexture=function(minWidth,minHeight,resolution,multisample){var key;void 0===resolution&&(resolution=1),void 0===multisample&&(multisample=constants_MSAA_QUALITY.NONE),minWidth=Math.ceil(minWidth*resolution),minHeight=Math.ceil(minHeight*resolution),this.enableFullScreen&&minWidth===this._pixelsWidth&&minHeight===this._pixelsHeight?key=multisample>1?-multisample:-1:(key=((65535&(minWidth=nextPow2(minWidth)))<<16|65535&(minHeight=nextPow2(minHeight)))>>>0,multisample>1&&(key+=4294967296*multisample)),this.texturePool[key]||(this.texturePool[key]=[]);var renderTexture=this.texturePool[key].pop();return renderTexture||(renderTexture=this.createTexture(minWidth,minHeight,multisample)),renderTexture.filterPoolKey=key,renderTexture.setResolution(resolution),renderTexture},RenderTexturePool.prototype.getFilterTexture=function(input,resolution,multisample){var filterTexture=this.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||constants_MSAA_QUALITY.NONE);return filterTexture.filterFrame=input.filterFrame,filterTexture},RenderTexturePool.prototype.returnTexture=function(renderTexture){var key=renderTexture.filterPoolKey;renderTexture.filterFrame=null,this.texturePool[key].push(renderTexture)},RenderTexturePool.prototype.returnFilterTexture=function(renderTexture){this.returnTexture(renderTexture)},RenderTexturePool.prototype.clear=function(destroyTextures){if(destroyTextures=!1!==destroyTextures)for(var i in this.texturePool){var textures=this.texturePool[i];if(textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0)}this.texturePool={}},RenderTexturePool.prototype.setScreenSize=function(size){if(size.width!==this._pixelsWidth||size.height!==this._pixelsHeight){for(var i in this.enableFullScreen=size.width>0&&size.height>0,this.texturePool)if(Number(i)<0){var textures=this.texturePool[i];if(textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=size.width,this._pixelsHeight=size.height}},RenderTexturePool.SCREEN_KEY=-1,RenderTexturePool}(),Attribute=function(){function Attribute(buffer,size,normalized,type,stride,start,instance){void 0===size&&(size=0),void 0===normalized&&(normalized=!1),void 0===type&&(type=constants_TYPES.FLOAT),this.buffer=buffer,this.size=size,this.normalized=normalized,this.type=type,this.stride=stride,this.start=start,this.instance=instance}return Attribute.prototype.destroy=function(){this.buffer=null},Attribute.from=function(buffer,size,normalized,type,stride){return new Attribute(buffer,size,normalized,type,stride)},Attribute}(),UID=0,Buffer=function(){function Buffer(data,_static,index){void 0===_static&&(_static=!0),void 0===index&&(index=!1),this.data=data||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=index,this.static=_static,this.id=UID++,this.disposeRunner=new Runner("disposeBuffer")}return Buffer.prototype.update=function(data){data instanceof Array&&(data=new Float32Array(data)),this.data=data||this.data,this._updateID++},Buffer.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Buffer.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(Buffer.prototype,"index",{get:function(){return this.type===constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER},set:function(value){this.type=value?constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:constants_BUFFER_TYPE.ARRAY_BUFFER},enumerable:!1,configurable:!0}),Buffer.from=function(data){return data instanceof Array&&(data=new Float32Array(data)),new Buffer(data)},Buffer}(),core_map={Float32Array,Uint32Array,Int32Array,Uint8Array};var byteSizeMap={5126:4,5123:2,5121:1},UID$1=0,map$1={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Geometry=function(){function Geometry(buffers,attributes){void 0===buffers&&(buffers=[]),void 0===attributes&&(attributes={}),this.buffers=buffers,this.indexBuffer=null,this.attributes=attributes,this.glVertexArrayObjects={},this.id=UID$1++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}return Geometry.prototype.addAttribute=function(id,buffer,size,normalized,type,stride,start,instance){if(void 0===size&&(size=0),void 0===normalized&&(normalized=!1),void 0===instance&&(instance=!1),!buffer)throw new Error("You must pass a buffer when creating an attribute");buffer instanceof Buffer||(buffer instanceof Array&&(buffer=new Float32Array(buffer)),buffer=new Buffer(buffer));var ids=id.split("|");if(ids.length>1){for(var i=0;i<ids.length;i++)this.addAttribute(ids[i],buffer,size,normalized,type);return this}var bufferIndex=this.buffers.indexOf(buffer);return-1===bufferIndex&&(this.buffers.push(buffer),bufferIndex=this.buffers.length-1),this.attributes[id]=new Attribute(bufferIndex,size,normalized,type,stride,start,instance),this.instanced=this.instanced||instance,this},Geometry.prototype.getAttribute=function(id){return this.attributes[id]},Geometry.prototype.getBuffer=function(id){return this.buffers[this.getAttribute(id).buffer]},Geometry.prototype.addIndex=function(buffer){return buffer instanceof Buffer||(buffer instanceof Array&&(buffer=new Uint16Array(buffer)),buffer=new Buffer(buffer)),buffer.type=constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=buffer,-1===this.buffers.indexOf(buffer)&&this.buffers.push(buffer),this},Geometry.prototype.getIndex=function(){return this.indexBuffer},Geometry.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var i,arrays=[],sizes=[],interleavedBuffer=new Buffer;for(i in this.attributes){var attribute=this.attributes[i],buffer=this.buffers[attribute.buffer];arrays.push(buffer.data),sizes.push(attribute.size*byteSizeMap[attribute.type]/4),attribute.buffer=0}for(interleavedBuffer.data=function(arrays,sizes){for(var outSize=0,stride=0,views={},i=0;i<arrays.length;i++)stride+=sizes[i],outSize+=arrays[i].length;var buffer=new ArrayBuffer(4*outSize),out=null,littleOffset=0;for(i=0;i<arrays.length;i++){var size=sizes[i],array=arrays[i],type=getBufferType(array);views[type]||(views[type]=new core_map[type](buffer)),out=views[type];for(var j=0;j<array.length;j++)out[(j/size|0)*stride+littleOffset+j%size]=array[j];littleOffset+=size}return new Float32Array(buffer)}(arrays,sizes),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[interleavedBuffer],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},Geometry.prototype.getSize=function(){for(var i in this.attributes){var attribute=this.attributes[i];return this.buffers[attribute.buffer].data.length/(attribute.stride/4||attribute.size)}return 0},Geometry.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Geometry.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},Geometry.prototype.clone=function(){for(var geometry=new Geometry,i=0;i<this.buffers.length;i++)geometry.buffers[i]=new Buffer(this.buffers[i].data.slice(0));for(var i in this.attributes){var attrib=this.attributes[i];geometry.attributes[i]=new Attribute(attrib.buffer,attrib.size,attrib.normalized,attrib.type,attrib.stride,attrib.start,attrib.instance)}return this.indexBuffer&&(geometry.indexBuffer=geometry.buffers[this.buffers.indexOf(this.indexBuffer)],geometry.indexBuffer.type=constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),geometry},Geometry.merge=function(geometries){for(var geometry,geometryOut=new Geometry,arrays=[],sizes=[],offsets=[],i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++)sizes[j]=sizes[j]||0,sizes[j]+=geometry.buffers[j].data.length,offsets[j]=0}for(i=0;i<geometry.buffers.length;i++)arrays[i]=new(map$1[getBufferType(geometry.buffers[i].data)])(sizes[i]),geometryOut.buffers[i]=new Buffer(arrays[i]);for(i=0;i<geometries.length;i++){geometry=geometries[i];for(j=0;j<geometry.buffers.length;j++)arrays[j].set(geometry.buffers[j].data,offsets[j]),offsets[j]+=geometry.buffers[j].data.length}if(geometryOut.attributes=geometry.attributes,geometry.indexBuffer){geometryOut.indexBuffer=geometryOut.buffers[geometry.buffers.indexOf(geometry.indexBuffer)],geometryOut.indexBuffer.type=constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;var offset=0,stride=0,offset2=0,bufferIndexToCount=0;for(i=0;i<geometry.buffers.length;i++)if(geometry.buffers[i]!==geometry.indexBuffer){bufferIndexToCount=i;break}for(var i in geometry.attributes){var attribute=geometry.attributes[i];(0|attribute.buffer)===bufferIndexToCount&&(stride+=attribute.size*byteSizeMap[attribute.type]/4)}for(i=0;i<geometries.length;i++){var indexBufferData=geometries[i].indexBuffer.data;for(j=0;j<indexBufferData.length;j++)geometryOut.indexBuffer.data[j+offset2]+=offset;offset+=geometries[i].buffers[bufferIndexToCount].data.length/stride,offset2+=indexBufferData.length}}return geometryOut},Geometry}(),Quad=function(_super){function Quad(){var _this=_super.call(this)||this;return _this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),_this}return core_extends(Quad,_super),Quad}(Geometry),QuadUv=function(_super){function QuadUv(){var _this=_super.call(this)||this;return _this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),_this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),_this.vertexBuffer=new Buffer(_this.vertices),_this.uvBuffer=new Buffer(_this.uvs),_this.addAttribute("aVertexPosition",_this.vertexBuffer).addAttribute("aTextureCoord",_this.uvBuffer).addIndex([0,1,2,0,2,3]),_this}return core_extends(QuadUv,_super),QuadUv.prototype.map=function(targetTextureFrame,destinationFrame){var x=0,y=0;return this.uvs[0]=x,this.uvs[1]=y,this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[3]=y,this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height,this.uvs[6]=x,this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height,x=destinationFrame.x,y=destinationFrame.y,this.vertices[0]=x,this.vertices[1]=y,this.vertices[2]=x+destinationFrame.width,this.vertices[3]=y,this.vertices[4]=x+destinationFrame.width,this.vertices[5]=y+destinationFrame.height,this.vertices[6]=x,this.vertices[7]=y+destinationFrame.height,this.invalidate(),this},QuadUv.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},QuadUv}(Geometry),UID$2=0,UniformGroup=function(){function UniformGroup(uniforms,isStatic,isUbo){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$2++,this.static=!!isStatic,this.ubo=!!isUbo,uniforms instanceof Buffer?(this.buffer=uniforms,this.buffer.type=constants_BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=uniforms,this.ubo&&(this.buffer=new Buffer(new Float32Array(1)),this.buffer.type=constants_BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}return UniformGroup.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},UniformGroup.prototype.add=function(name,uniforms,_static){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[name]=new UniformGroup(uniforms,_static)},UniformGroup.from=function(uniforms,_static,_ubo){return new UniformGroup(uniforms,_static,_ubo)},UniformGroup.uboFrom=function(uniforms,_static){return new UniformGroup(uniforms,null==_static||_static,!0)},UniformGroup}(),FilterState=function(){function FilterState(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=constants_MSAA_QUALITY.NONE,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}return FilterState.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},FilterState}(),tempPoints=[new Point,new Point,new Point,new Point],tempMatrix=new Matrix,FilterSystem=function(){function FilterSystem(renderer){this.renderer=renderer,this.defaultFilterStack=[{}],this.texturePool=new RenderTexturePool,this.texturePool.setScreenSize(renderer.view),this.statePool=[],this.quad=new Quad,this.quadUv=new QuadUv,this.tempRect=new Rectangle,this.activeState={},this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return FilterSystem.prototype.push=function(target,filters){for(var renderer=this.renderer,filterStack=this.defaultFilterStack,state=this.statePool.pop()||new FilterState,renderTextureSystem=this.renderer.renderTexture,resolution=filters[0].resolution,multisample=filters[0].multisample,padding=filters[0].padding,autoFit=filters[0].autoFit,legacy=filters[0].legacy,i=1;i<filters.length;i++){var filter=filters[i];resolution=Math.min(resolution,filter.resolution),multisample=Math.min(multisample,filter.multisample),padding=this.useMaxPadding?Math.max(padding,filter.padding):padding+filter.padding,autoFit=autoFit&&filter.autoFit,legacy=legacy||filter.legacy}if(1===filterStack.length&&(this.defaultFilterStack[0].renderTexture=renderTextureSystem.current),filterStack.push(state),state.resolution=resolution,state.multisample=multisample,state.legacy=legacy,state.target=target,state.sourceFrame.copyFrom(target.filterArea||target.getBounds(!0)),state.sourceFrame.pad(padding),autoFit){var sourceFrameProjected=this.tempRect.copyFrom(renderTextureSystem.sourceFrame);renderer.projection.transform&&this.transformAABB(tempMatrix.copyFrom(renderer.projection.transform).invert(),sourceFrameProjected),state.sourceFrame.fit(sourceFrameProjected)}this.roundFrame(state.sourceFrame,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform),state.renderTexture=this.getOptimalFilterTexture(state.sourceFrame.width,state.sourceFrame.height,resolution,multisample),state.filters=filters,state.destinationFrame.width=state.renderTexture.width,state.destinationFrame.height=state.renderTexture.height;var destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=state.sourceFrame.width,destinationFrame.height=state.sourceFrame.height,state.renderTexture.filterFrame=state.sourceFrame,state.bindingSourceFrame.copyFrom(renderTextureSystem.sourceFrame),state.bindingDestinationFrame.copyFrom(renderTextureSystem.destinationFrame),state.transform=renderer.projection.transform,renderer.projection.transform=null,renderTextureSystem.bind(state.renderTexture,state.sourceFrame,destinationFrame),renderer.framebuffer.clear(0,0,0,0)},FilterSystem.prototype.pop=function(){var filterStack=this.defaultFilterStack,state=filterStack.pop(),filters=state.filters;this.activeState=state;var globalUniforms=this.globalUniforms.uniforms;globalUniforms.outputFrame=state.sourceFrame,globalUniforms.resolution=state.resolution;var inputSize=globalUniforms.inputSize,inputPixel=globalUniforms.inputPixel,inputClamp=globalUniforms.inputClamp;if(inputSize[0]=state.destinationFrame.width,inputSize[1]=state.destinationFrame.height,inputSize[2]=1/inputSize[0],inputSize[3]=1/inputSize[1],inputPixel[0]=Math.round(inputSize[0]*state.resolution),inputPixel[1]=Math.round(inputSize[1]*state.resolution),inputPixel[2]=1/inputPixel[0],inputPixel[3]=1/inputPixel[1],inputClamp[0]=.5*inputPixel[2],inputClamp[1]=.5*inputPixel[3],inputClamp[2]=state.sourceFrame.width*inputSize[2]-.5*inputPixel[2],inputClamp[3]=state.sourceFrame.height*inputSize[3]-.5*inputPixel[3],state.legacy){var filterArea=globalUniforms.filterArea;filterArea[0]=state.destinationFrame.width,filterArea[1]=state.destinationFrame.height,filterArea[2]=state.sourceFrame.x,filterArea[3]=state.sourceFrame.y,globalUniforms.filterClamp=globalUniforms.inputClamp}this.globalUniforms.update();var lastState=filterStack[filterStack.length-1];if(this.renderer.framebuffer.blit(),1===filters.length)filters[0].apply(this,state.renderTexture,lastState.renderTexture,constants_CLEAR_MODES.BLEND,state),this.returnFilterTexture(state.renderTexture);else{var flip=state.renderTexture,flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution);flop.filterFrame=flip.filterFrame;var i=0;for(i=0;i<filters.length-1;++i){1===i&&state.multisample>1&&((flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution)).filterFrame=flip.filterFrame),filters[i].apply(this,flip,flop,constants_CLEAR_MODES.CLEAR,state);var t=flip;flip=flop,flop=t}filters[i].apply(this,flip,lastState.renderTexture,constants_CLEAR_MODES.BLEND,state),i>1&&state.multisample>1&&this.returnFilterTexture(state.renderTexture),this.returnFilterTexture(flip),this.returnFilterTexture(flop)}state.clear(),this.statePool.push(state)},FilterSystem.prototype.bindAndClear=function(filterTexture,clearMode){void 0===clearMode&&(clearMode=constants_CLEAR_MODES.CLEAR);var _a=this.renderer,renderTextureSystem=_a.renderTexture,stateSystem=_a.state;if(filterTexture===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,filterTexture&&filterTexture.filterFrame){var destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=filterTexture.filterFrame.width,destinationFrame.height=filterTexture.filterFrame.height,renderTextureSystem.bind(filterTexture,filterTexture.filterFrame,destinationFrame)}else filterTexture!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?renderTextureSystem.bind(filterTexture):this.renderer.renderTexture.bind(filterTexture,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var autoClear=1&stateSystem.stateId||this.forceClear;(clearMode===constants_CLEAR_MODES.CLEAR||clearMode===constants_CLEAR_MODES.BLIT&&autoClear)&&this.renderer.framebuffer.clear(0,0,0,0)},FilterSystem.prototype.applyFilter=function(filter,input,output,clearMode){var renderer=this.renderer;renderer.state.set(filter.state),this.bindAndClear(output,clearMode),filter.uniforms.uSampler=input,filter.uniforms.filterGlobals=this.globalUniforms,renderer.shader.bind(filter),filter.legacy=!!filter.program.attributeData.aTextureCoord,filter.legacy?(this.quadUv.map(input._frame,input.filterFrame),renderer.geometry.bind(this.quadUv),renderer.geometry.draw(constants_DRAW_MODES.TRIANGLES)):(renderer.geometry.bind(this.quad),renderer.geometry.draw(constants_DRAW_MODES.TRIANGLE_STRIP))},FilterSystem.prototype.calculateSpriteMatrix=function(outputMatrix,sprite){var _a=this.activeState,sourceFrame=_a.sourceFrame,destinationFrame=_a.destinationFrame,orig=sprite._texture.orig,mappedMatrix=outputMatrix.set(destinationFrame.width,0,0,destinationFrame.height,sourceFrame.x,sourceFrame.y),worldTransform=sprite.worldTransform.copyTo(Matrix.TEMP_MATRIX);return worldTransform.invert(),mappedMatrix.prepend(worldTransform),mappedMatrix.scale(1/orig.width,1/orig.height),mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y),mappedMatrix},FilterSystem.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},FilterSystem.prototype.getOptimalFilterTexture=function(minWidth,minHeight,resolution,multisample){return void 0===resolution&&(resolution=1),void 0===multisample&&(multisample=constants_MSAA_QUALITY.NONE),this.texturePool.getOptimalTexture(minWidth,minHeight,resolution,multisample)},FilterSystem.prototype.getFilterTexture=function(input,resolution,multisample){if("number"==typeof input){var swap=input;input=resolution,resolution=swap}input=input||this.activeState.renderTexture;var filterTexture=this.texturePool.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||constants_MSAA_QUALITY.NONE);return filterTexture.filterFrame=input.filterFrame,filterTexture},FilterSystem.prototype.returnFilterTexture=function(renderTexture){this.texturePool.returnTexture(renderTexture)},FilterSystem.prototype.emptyPool=function(){this.texturePool.clear(!0)},FilterSystem.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},FilterSystem.prototype.transformAABB=function(matrix,rect){var lt=tempPoints[0],lb=tempPoints[1],rt=tempPoints[2],rb=tempPoints[3];lt.set(rect.left,rect.top),lb.set(rect.left,rect.bottom),rt.set(rect.right,rect.top),rb.set(rect.right,rect.bottom),matrix.apply(lt,lt),matrix.apply(lb,lb),matrix.apply(rt,rt),matrix.apply(rb,rb);var x0=Math.min(lt.x,lb.x,rt.x,rb.x),y0=Math.min(lt.y,lb.y,rt.y,rb.y),x1=Math.max(lt.x,lb.x,rt.x,rb.x),y1=Math.max(lt.y,lb.y,rt.y,rb.y);rect.x=x0,rect.y=y0,rect.width=x1-x0,rect.height=y1-y0},FilterSystem.prototype.roundFrame=function(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){if(transform){var a=transform.a,b=transform.b,c=transform.c,d=transform.d;if((Math.abs(b)>1e-4||Math.abs(c)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(d)>1e-4))return}(transform=transform?tempMatrix.copyFrom(transform):tempMatrix.identity()).translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y),this.transformAABB(transform,frame),frame.ceil(resolution),this.transformAABB(transform.invert(),frame)},FilterSystem}(),ObjectRenderer=function(){function ObjectRenderer(renderer){this.renderer=renderer}return ObjectRenderer.prototype.flush=function(){},ObjectRenderer.prototype.destroy=function(){this.renderer=null},ObjectRenderer.prototype.start=function(){},ObjectRenderer.prototype.stop=function(){this.flush()},ObjectRenderer.prototype.render=function(_object){},ObjectRenderer}(),BatchSystem=function(){function BatchSystem(renderer){this.renderer=renderer,this.emptyRenderer=new ObjectRenderer(renderer),this.currentRenderer=this.emptyRenderer}return BatchSystem.prototype.setObjectRenderer=function(objectRenderer){this.currentRenderer!==objectRenderer&&(this.currentRenderer.stop(),this.currentRenderer=objectRenderer,this.currentRenderer.start())},BatchSystem.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem.prototype.copyBoundTextures=function(arr,maxTextures){for(var boundTextures=this.renderer.texture.boundTextures,i=maxTextures-1;i>=0;--i)arr[i]=boundTextures[i]||null,arr[i]&&(arr[i]._batchLocation=i)},BatchSystem.prototype.boundArray=function(texArray,boundTextures,batchId,maxTextures){for(var elements=texArray.elements,ids=texArray.ids,count=texArray.count,j=0,i=0;i<count;i++){var tex=elements[i],loc=tex._batchLocation;if(loc>=0&&loc<maxTextures&&boundTextures[loc]===tex)ids[i]=loc;else for(;j<maxTextures;){var bound=boundTextures[j];if(!bound||bound._batchEnabled!==batchId||bound._batchLocation!==j){ids[i]=j,tex._batchLocation=j,boundTextures[j]=tex;break}j++}}},BatchSystem.prototype.destroy=function(){this.renderer=null},BatchSystem}(),CONTEXT_UID_COUNTER=0,ContextSystem=function(){function ContextSystem(renderer){this.renderer=renderer,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),renderer.view.addEventListener("webglcontextlost",this.handleContextLost,!1),renderer.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(ContextSystem.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),ContextSystem.prototype.contextChange=function(gl){this.gl=gl,this.renderer.gl=gl,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")&&gl.getExtension("WEBGL_lose_context").restoreContext()},ContextSystem.prototype.initFromContext=function(gl){this.gl=gl,this.validateContext(gl),this.renderer.gl=gl,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(gl)},ContextSystem.prototype.initFromOptions=function(options){var gl=this.createContext(this.renderer.view,options);this.initFromContext(gl)},ContextSystem.prototype.createContext=function(canvas,options){var gl;if(settings.PREFER_ENV>=constants_ENV.WEBGL2&&(gl=canvas.getContext("webgl2",options)),gl)this.webGLVersion=2;else if(this.webGLVersion=1,!(gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=gl,this.getExtensions(),this.gl},ContextSystem.prototype.getExtensions=function(){var gl=this.gl,common={anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,common,{drawBuffers:gl.getExtension("WEBGL_draw_buffers"),depthTexture:gl.getExtension("WEBGL_depth_texture"),loseContext:gl.getExtension("WEBGL_lose_context"),vertexArrayObject:gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:gl.getExtension("OES_element_index_uint"),floatTexture:gl.getExtension("OES_texture_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),textureHalfFloat:gl.getExtension("OES_texture_half_float"),textureHalfFloatLinear:gl.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,common,{colorBufferFloat:gl.getExtension("EXT_color_buffer_float")})},ContextSystem.prototype.handleContextLost=function(event){event.preventDefault()},ContextSystem.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},ContextSystem.prototype.destroy=function(){var view=this.renderer.view;this.renderer=null,view.removeEventListener("webglcontextlost",this.handleContextLost),view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},ContextSystem.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},ContextSystem.prototype.validateContext=function(gl){var attributes=gl.getContextAttributes(),isWebGl2="WebGL2RenderingContext"in self&&gl instanceof self.WebGL2RenderingContext;isWebGl2&&(this.webGLVersion=2),attributes.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var hasuint32=isWebGl2||!!gl.getExtension("OES_element_index_uint");this.supports.uint32Indices=hasuint32,hasuint32||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},ContextSystem}(),GLFramebuffer=function(framebuffer){this.framebuffer=framebuffer,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=constants_MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0},tempRectangle=new Rectangle,FramebufferSystem=function(){function FramebufferSystem(renderer){this.renderer=renderer,this.managedFramebuffers=[],this.unknownFramebuffer=new Framebuffer(10,10),this.msaaSamples=null}return FramebufferSystem.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var nativeDrawBuffersExtension_1=this.renderer.context.extensions.drawBuffers,nativeDepthTextureExtension=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===constants_ENV.WEBGL_LEGACY&&(nativeDrawBuffersExtension_1=null,nativeDepthTextureExtension=null),nativeDrawBuffersExtension_1?gl.drawBuffers=function(activeTextures){return nativeDrawBuffersExtension_1.drawBuffersWEBGL(activeTextures)}:(this.hasMRT=!1,gl.drawBuffers=function(){}),nativeDepthTextureExtension||(this.writeDepthTexture=!1)}else this.msaaSamples=gl.getInternalformatParameter(gl.RENDERBUFFER,gl.RGBA8,gl.SAMPLES)},FramebufferSystem.prototype.bind=function(framebuffer,frame,mipLevel){void 0===mipLevel&&(mipLevel=0);var gl=this.gl;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(framebuffer);this.current!==framebuffer&&(this.current=framebuffer,gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.framebuffer)),fbo.mipLevel!==mipLevel&&(framebuffer.dirtyId++,framebuffer.dirtyFormat++,fbo.mipLevel=mipLevel),fbo.dirtyId!==framebuffer.dirtyId&&(fbo.dirtyId=framebuffer.dirtyId,fbo.dirtyFormat!==framebuffer.dirtyFormat?(fbo.dirtyFormat=framebuffer.dirtyFormat,fbo.dirtySize=framebuffer.dirtySize,this.updateFramebuffer(framebuffer,mipLevel)):fbo.dirtySize!==framebuffer.dirtySize&&(fbo.dirtySize=framebuffer.dirtySize,this.resizeFramebuffer(framebuffer)));for(var i=0;i<framebuffer.colorTextures.length;i++){var tex=framebuffer.colorTextures[i];this.renderer.texture.unbind(tex.parentTextureArray||tex)}if(framebuffer.depthTexture&&this.renderer.texture.unbind(framebuffer.depthTexture),frame){var mipWidth=frame.width>>mipLevel,mipHeight=frame.height>>mipLevel,scale=mipWidth/frame.width;this.setViewport(frame.x*scale,frame.y*scale,mipWidth,mipHeight)}else{mipWidth=framebuffer.width>>mipLevel,mipHeight=framebuffer.height>>mipLevel;this.setViewport(0,0,mipWidth,mipHeight)}}else this.current&&(this.current=null,gl.bindFramebuffer(gl.FRAMEBUFFER,null)),frame?this.setViewport(frame.x,frame.y,frame.width,frame.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},FramebufferSystem.prototype.setViewport=function(x,y,width,height){var v=this.viewport;x=Math.round(x),y=Math.round(y),width=Math.round(width),height=Math.round(height),v.width===width&&v.height===height&&v.x===x&&v.y===y||(v.x=x,v.y=y,v.width=width,v.height=height,this.gl.viewport(x,y,width,height))},Object.defineProperty(FramebufferSystem.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),FramebufferSystem.prototype.clear=function(r,g,b,a,mask){void 0===mask&&(mask=constants_BUFFER_BITS.COLOR|constants_BUFFER_BITS.DEPTH);var gl=this.gl;gl.clearColor(r,g,b,a),gl.clear(mask)},FramebufferSystem.prototype.initFramebuffer=function(framebuffer){var gl=this.gl,fbo=new GLFramebuffer(gl.createFramebuffer());return fbo.multisample=this.detectSamples(framebuffer.multisample),framebuffer.glFramebuffers[this.CONTEXT_UID]=fbo,this.managedFramebuffers.push(framebuffer),framebuffer.disposeRunner.add(this),fbo},FramebufferSystem.prototype.resizeFramebuffer=function(framebuffer){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];fbo.msaaBuffer&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.RGBA8,framebuffer.width,framebuffer.height)),fbo.stencil&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,framebuffer.width,framebuffer.height):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height));var colorTextures=framebuffer.colorTextures,count=colorTextures.length;gl.drawBuffers||(count=Math.min(count,1));for(var i=0;i<count;i++){var texture=colorTextures[i],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0)}framebuffer.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(framebuffer.depthTexture,0)},FramebufferSystem.prototype.updateFramebuffer=function(framebuffer,mipLevel){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],colorTextures=framebuffer.colorTextures,count=colorTextures.length;gl.drawBuffers||(count=Math.min(count,1)),fbo.multisample>1&&this.canMultisampleFramebuffer(framebuffer)?(fbo.msaaBuffer=fbo.msaaBuffer||gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.RGBA8,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,fbo.msaaBuffer)):fbo.msaaBuffer&&(gl.deleteRenderbuffer(fbo.msaaBuffer),fbo.msaaBuffer=null);for(var activeTextures=[],i=0;i<count;i++){var texture=colorTextures[i],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0),0===i&&fbo.msaaBuffer||(gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i,texture.target,parentTexture._glTextures[this.CONTEXT_UID].texture,mipLevel),activeTextures.push(gl.COLOR_ATTACHMENT0+i))}if((activeTextures.length>1&&gl.drawBuffers(activeTextures),framebuffer.depthTexture)&&this.writeDepthTexture){var depthTexture=framebuffer.depthTexture;this.renderer.texture.bind(depthTexture,0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,depthTexture._glTextures[this.CONTEXT_UID].texture,mipLevel)}!framebuffer.stencil&&!framebuffer.depth||framebuffer.depthTexture&&this.writeDepthTexture?fbo.stencil&&(gl.deleteRenderbuffer(fbo.stencil),fbo.stencil=null):(fbo.stencil=fbo.stencil||gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,framebuffer.width,framebuffer.height):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,fbo.stencil))},FramebufferSystem.prototype.canMultisampleFramebuffer=function(framebuffer){return 1!==this.renderer.context.webGLVersion&&framebuffer.colorTextures.length<=1&&!framebuffer.depthTexture},FramebufferSystem.prototype.detectSamples=function(samples){var msaaSamples=this.msaaSamples,res=constants_MSAA_QUALITY.NONE;if(samples<=1||null===msaaSamples)return res;for(var i=0;i<msaaSamples.length;i++)if(msaaSamples[i]<=samples){res=msaaSamples[i];break}return 1===res&&(res=constants_MSAA_QUALITY.NONE),res},FramebufferSystem.prototype.blit=function(framebuffer,sourcePixels,destPixels){var current=this.current,renderer=this.renderer,gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;if(2===renderer.context.webGLVersion&&current){var fbo=current.glFramebuffers[CONTEXT_UID];if(fbo){if(!framebuffer){if(!fbo.msaaBuffer)return;fbo.blitFramebuffer||(fbo.blitFramebuffer=new Framebuffer(current.width,current.height),fbo.blitFramebuffer.addColorTexture(0,current.colorTextures[0])),(framebuffer=fbo.blitFramebuffer).width=current.width,framebuffer.height=current.height}sourcePixels||((sourcePixels=tempRectangle).width=current.width,sourcePixels.height=current.height),destPixels||(destPixels=sourcePixels);var sameSize=sourcePixels.width===destPixels.width&&sourcePixels.height===destPixels.height;this.bind(framebuffer),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,fbo.framebuffer),gl.blitFramebuffer(sourcePixels.x,sourcePixels.y,sourcePixels.width,sourcePixels.height,destPixels.x,destPixels.y,destPixels.width,destPixels.height,gl.COLOR_BUFFER_BIT,sameSize?gl.NEAREST:gl.LINEAR)}}},FramebufferSystem.prototype.disposeFramebuffer=function(framebuffer,contextLost){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],gl=this.gl;if(fbo){delete framebuffer.glFramebuffers[this.CONTEXT_UID];var index=this.managedFramebuffers.indexOf(framebuffer);index>=0&&this.managedFramebuffers.splice(index,1),framebuffer.disposeRunner.remove(this),contextLost||(gl.deleteFramebuffer(fbo.framebuffer),fbo.msaaBuffer&&gl.deleteRenderbuffer(fbo.msaaBuffer),fbo.stencil&&gl.deleteRenderbuffer(fbo.stencil))}},FramebufferSystem.prototype.disposeAll=function(contextLost){var list=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<list.length;i++)this.disposeFramebuffer(list[i],contextLost)},FramebufferSystem.prototype.forceStencil=function(){var framebuffer=this.current;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(fbo&&!fbo.stencil){framebuffer.stencil=!0;var w=framebuffer.width,h=framebuffer.height,gl=this.gl,stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,w,h):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,w,h),fbo.stencil=stencil,gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,stencil)}}},FramebufferSystem.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle},FramebufferSystem.prototype.destroy=function(){this.renderer=null},FramebufferSystem}(),byteSizeMap$1={5126:4,5123:2,5121:1},GeometrySystem=function(){function GeometrySystem(renderer){this.renderer=renderer,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return GeometrySystem.prototype.contextChange=function(){this.disposeAll(!0);var gl=this.gl=this.renderer.gl,context=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==context.webGLVersion){var nativeVaoExtension_1=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===constants_ENV.WEBGL_LEGACY&&(nativeVaoExtension_1=null),nativeVaoExtension_1?(gl.createVertexArray=function(){return nativeVaoExtension_1.createVertexArrayOES()},gl.bindVertexArray=function(vao){return nativeVaoExtension_1.bindVertexArrayOES(vao)},gl.deleteVertexArray=function(vao){return nativeVaoExtension_1.deleteVertexArrayOES(vao)}):(this.hasVao=!1,gl.createVertexArray=function(){return null},gl.bindVertexArray=function(){return null},gl.deleteVertexArray=function(){return null})}if(2!==context.webGLVersion){var instanceExt_1=gl.getExtension("ANGLE_instanced_arrays");instanceExt_1?(gl.vertexAttribDivisor=function(a,b){return instanceExt_1.vertexAttribDivisorANGLE(a,b)},gl.drawElementsInstanced=function(a,b,c,d,e){return instanceExt_1.drawElementsInstancedANGLE(a,b,c,d,e)},gl.drawArraysInstanced=function(a,b,c,d){return instanceExt_1.drawArraysInstancedANGLE(a,b,c,d)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===context.webGLVersion||!!context.extensions.uint32ElementIndex},GeometrySystem.prototype.bind=function(geometry,shader){shader=shader||this.renderer.shader.shader;var gl=this.gl,vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],incRefCount=!1;vaos||(this.managedGeometries[geometry.id]=geometry,geometry.disposeRunner.add(this),geometry.glVertexArrayObjects[this.CONTEXT_UID]=vaos={},incRefCount=!0);var vao=vaos[shader.program.id]||this.initGeometryVao(geometry,shader,incRefCount);this._activeGeometry=geometry,this._activeVao!==vao&&(this._activeVao=vao,this.hasVao?gl.bindVertexArray(vao):this.activateVao(geometry,shader.program)),this.updateBuffers()},GeometrySystem.prototype.reset=function(){this.unbind()},GeometrySystem.prototype.updateBuffers=function(){for(var geometry=this._activeGeometry,bufferSystem=this.renderer.buffer,i=0;i<geometry.buffers.length;i++){var buffer=geometry.buffers[i];bufferSystem.update(buffer)}},GeometrySystem.prototype.checkCompatibility=function(geometry,program){var geometryAttributes=geometry.attributes,shaderAttributes=program.attributeData;for(var j in shaderAttributes)if(!geometryAttributes[j])throw new Error('shader and geometry incompatible, geometry missing the "'+j+'" attribute')},GeometrySystem.prototype.getSignature=function(geometry,program){var attribs=geometry.attributes,shaderAttributes=program.attributeData,strings=["g",geometry.id];for(var i in attribs)shaderAttributes[i]&&strings.push(i);return strings.join("-")},GeometrySystem.prototype.initGeometryVao=function(geometry,shader,incRefCount){void 0===incRefCount&&(incRefCount=!0);var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,bufferSystem=this.renderer.buffer,program=shader.program;program.glPrograms[CONTEXT_UID]||this.renderer.shader.generateProgram(shader),this.checkCompatibility(geometry,program);var signature=this.getSignature(geometry,program),vaoObjectHash=geometry.glVertexArrayObjects[this.CONTEXT_UID],vao=vaoObjectHash[signature];if(vao)return vaoObjectHash[program.id]=vao,vao;var buffers=geometry.buffers,attributes=geometry.attributes,tempStride={},tempStart={};for(var j in buffers)tempStride[j]=0,tempStart[j]=0;for(var j in attributes)!attributes[j].size&&program.attributeData[j]?attributes[j].size=program.attributeData[j].size:attributes[j].size||console.warn("PIXI Geometry attribute '"+j+"' size cannot be determined (likely the bound shader does not have the attribute)"),tempStride[attributes[j].buffer]+=attributes[j].size*byteSizeMap$1[attributes[j].type];for(var j in attributes){var attribute=attributes[j],attribSize=attribute.size;void 0===attribute.stride&&(tempStride[attribute.buffer]===attribSize*byteSizeMap$1[attribute.type]?attribute.stride=0:attribute.stride=tempStride[attribute.buffer]),void 0===attribute.start&&(attribute.start=tempStart[attribute.buffer],tempStart[attribute.buffer]+=attribSize*byteSizeMap$1[attribute.type])}vao=gl.createVertexArray(),gl.bindVertexArray(vao);for(var i=0;i<buffers.length;i++){var buffer=buffers[i];bufferSystem.bind(buffer),incRefCount&&buffer._glBuffers[CONTEXT_UID].refCount++}return this.activateVao(geometry,program),this._activeVao=vao,vaoObjectHash[program.id]=vao,vaoObjectHash[signature]=vao,vao},GeometrySystem.prototype.disposeGeometry=function(geometry,contextLost){var _a;if(this.managedGeometries[geometry.id]){delete this.managedGeometries[geometry.id];var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],gl=this.gl,buffers=geometry.buffers,bufferSystem=null===(_a=this.renderer)||void 0===_a?void 0:_a.buffer;if(geometry.disposeRunner.remove(this),vaos){if(bufferSystem)for(var i=0;i<buffers.length;i++){var buf=buffers[i]._glBuffers[this.CONTEXT_UID];buf&&(buf.refCount--,0!==buf.refCount||contextLost||bufferSystem.dispose(buffers[i],contextLost))}if(!contextLost)for(var vaoId in vaos)if("g"===vaoId[0]){var vao=vaos[vaoId];this._activeVao===vao&&this.unbind(),gl.deleteVertexArray(vao)}delete geometry.glVertexArrayObjects[this.CONTEXT_UID]}}},GeometrySystem.prototype.disposeAll=function(contextLost){for(var all=Object.keys(this.managedGeometries),i=0;i<all.length;i++)this.disposeGeometry(this.managedGeometries[all[i]],contextLost)},GeometrySystem.prototype.activateVao=function(geometry,program){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,bufferSystem=this.renderer.buffer,buffers=geometry.buffers,attributes=geometry.attributes;geometry.indexBuffer&&bufferSystem.bind(geometry.indexBuffer);var lastBuffer=null;for(var j in attributes){var attribute=attributes[j],buffer=buffers[attribute.buffer],glBuffer=buffer._glBuffers[CONTEXT_UID];if(program.attributeData[j]){lastBuffer!==glBuffer&&(bufferSystem.bind(buffer),lastBuffer=glBuffer);var location=program.attributeData[j].location;if(gl.enableVertexAttribArray(location),gl.vertexAttribPointer(location,attribute.size,attribute.type||gl.FLOAT,attribute.normalized,attribute.stride,attribute.start),attribute.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");gl.vertexAttribDivisor(location,1)}}}},GeometrySystem.prototype.draw=function(type,size,start,instanceCount){var gl=this.gl,geometry=this._activeGeometry;if(geometry.indexBuffer){var byteSize=geometry.indexBuffer.data.BYTES_PER_ELEMENT,glType=2===byteSize?gl.UNSIGNED_SHORT:gl.UNSIGNED_INT;2===byteSize||4===byteSize&&this.canUseUInt32ElementIndex?geometry.instanced?gl.drawElementsInstanced(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize,instanceCount||1):gl.drawElements(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize):console.warn("unsupported index buffer type: uint32")}else geometry.instanced?gl.drawArraysInstanced(type,start,size||geometry.getSize(),instanceCount||1):gl.drawArrays(type,start,size||geometry.getSize());return this},GeometrySystem.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},GeometrySystem.prototype.destroy=function(){this.renderer=null},GeometrySystem}(),MaskData=function(){function MaskData(maskObject){void 0===maskObject&&(maskObject=null),this.type=constants_MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=maskObject||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=settings.FILTER_MULTISAMPLE,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return MaskData.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=constants_MASK_TYPES.NONE,this.autoDetect=!0),this._target=null},MaskData.prototype.copyCountersOrReset=function(maskAbove){maskAbove?(this._stencilCounter=maskAbove._stencilCounter,this._scissorCounter=maskAbove._scissorCounter,this._scissorRect=maskAbove._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},MaskData}();function compileShader(gl,type,src){var shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),shader}function logPrettyShaderError(gl,shader){var shaderSrc=gl.getShaderSource(shader).split("\n").map((function(line,index){return index+": "+line})),shaderLog=gl.getShaderInfoLog(shader),splitShader=shaderLog.split("\n"),dedupe={},lineNumbers=splitShader.map((function(line){return parseFloat(line.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))})).filter((function(n){return!(!n||dedupe[n])&&(dedupe[n]=!0,!0)})),logArgs=[""];lineNumbers.forEach((function(number){shaderSrc[number-1]="%c"+shaderSrc[number-1]+"%c",logArgs.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));var fragmentSourceToLog=shaderSrc.join("\n");logArgs[0]=fragmentSourceToLog,console.error(shaderLog),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,logArgs),console.groupEnd()}function booleanArray(size){for(var array=new Array(size),i=0;i<array.length;i++)array[i]=!1;return array}function defaultValue(type,size){switch(type){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"uvec2":return new Uint32Array(2*size);case"uvec3":return new Uint32Array(3*size);case"uvec4":return new Uint32Array(4*size);case"bool":return!1;case"bvec2":return booleanArray(2*size);case"bvec3":return booleanArray(3*size);case"bvec4":return booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var maxFragmentPrecision,unknownContext={},context=unknownContext;function getTestContext(){if(context===unknownContext||context&&context.isContextLost()){var canvas=document.createElement("canvas"),gl=void 0;settings.PREFER_ENV>=constants_ENV.WEBGL2&&(gl=canvas.getContext("webgl2",{})),gl||((gl=canvas.getContext("webgl",{})||canvas.getContext("experimental-webgl",{}))?gl.getExtension("WEBGL_draw_buffers"):gl=null),context=gl}return context}function setPrecision(src,requestedPrecision,maxSupportedPrecision){if("precision"!==src.substring(0,9)){var precision=requestedPrecision;return requestedPrecision===constants_PRECISION.HIGH&&maxSupportedPrecision!==constants_PRECISION.HIGH&&(precision=constants_PRECISION.MEDIUM),"precision "+precision+" float;\n"+src}return maxSupportedPrecision!==constants_PRECISION.HIGH&&"precision highp"===src.substring(0,15)?src.replace("precision highp","precision mediump"):src}var GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(type){return GLSL_TO_SIZE[type]}var GL_TABLE=null,GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]}var uniformParsers=[{test:function(data){return"float"===data.type&&1===data.size},code:function(name){return'\n            if(uv["'+name+'"] !== ud["'+name+'"].value)\n            {\n                ud["'+name+'"].value = uv["'+name+'"]\n                gl.uniform1f(ud["'+name+'"].location, uv["'+name+'"])\n            }\n            '}},{test:function(data){return("sampler2D"===data.type||"samplerCube"===data.type||"sampler2DArray"===data.type)&&1===data.size&&!data.isArray},code:function(name){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+name+'"], t);\n\n            if(ud["'+name+'"].value !== t)\n            {\n                ud["'+name+'"].value = t;\n                gl.uniform1i(ud["'+name+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(data,uniform){return"mat3"===data.type&&1===data.size&&void 0!==uniform.a},code:function(name){return'\n            gl.uniformMatrix3fv(ud["'+name+'"].location, false, uv["'+name+'"].toArray(true));\n            '},codeUbo:function(name){return"\n                var "+name+"_matrix = uv."+name+".toArray(true);\n\n                data[offset] = "+name+"_matrix[0];\n                data[offset+1] = "+name+"_matrix[1];\n                data[offset+2] = "+name+"_matrix[2];\n        \n                data[offset + 4] = "+name+"_matrix[3];\n                data[offset + 5] = "+name+"_matrix[4];\n                data[offset + 6] = "+name+"_matrix[5];\n        \n                data[offset + 8] = "+name+"_matrix[6];\n                data[offset + 9] = "+name+"_matrix[7];\n                data[offset + 10] = "+name+"_matrix[8];\n            "}},{test:function(data,uniform){return"vec2"===data.type&&1===data.size&&void 0!==uniform.x},code:function(name){return'\n                cv = ud["'+name+'"].value;\n                v = uv["'+name+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+name+'"].location, v.x, v.y);\n                }'},codeUbo:function(name){return"\n                v = uv."+name+";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            "}},{test:function(data){return"vec2"===data.type&&1===data.size},code:function(name){return'\n                cv = ud["'+name+'"].value;\n                v = uv["'+name+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+name+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(data,uniform){return"vec4"===data.type&&1===data.size&&void 0!==uniform.width},code:function(name){return'\n                cv = ud["'+name+'"].value;\n                v = uv["'+name+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+name+'"].location, v.x, v.y, v.width, v.height)\n                }'},codeUbo:function(name){return"\n                    v = uv."+name+";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                "}},{test:function(data){return"vec4"===data.type&&1===data.size},code:function(name){return'\n                cv = ud["'+name+'"].value;\n                v = uv["'+name+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+name+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],GLSL_TO_SINGLE_SETTERS_CACHED={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",uint:"gl.uniform1ui(location, v)",uvec2:"gl.uniform2ui(location, v[0], v[1])",uvec3:"gl.uniform3ui(location, v[0], v[1], v[2])",uvec4:"gl.uniform4ui(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var unsafeEval,fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function generateIfTestSrc(maxIfs){for(var src="",i=0;i<maxIfs;++i)i>0&&(src+="\nelse "),i<maxIfs-1&&(src+="if(test == "+i+".0){}");return src}function checkMaxIfStatementsInShader(maxIfs,gl){if(0===maxIfs)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var shader=gl.createShader(gl.FRAGMENT_SHADER);;){var fragmentSrc=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(maxIfs));if(gl.shaderSource(shader,fragmentSrc),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS))break;maxIfs=maxIfs/2|0}return maxIfs}var UID$3=0,nameCache={},Program=function(){function Program(vertexSrc,fragmentSrc,name){void 0===name&&(name="pixi-shader"),this.id=UID$3++,this.vertexSrc=vertexSrc||Program.defaultVertexSrc,this.fragmentSrc=fragmentSrc||Program.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(name=name.replace(/\s+/g,"-"),nameCache[name]?(nameCache[name]++,name+="-"+nameCache[name]):nameCache[name]=1,this.vertexSrc="#define SHADER_NAME "+name+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+name+"\n"+this.fragmentSrc,this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,constants_PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,function(){if(!maxFragmentPrecision){maxFragmentPrecision=constants_PRECISION.MEDIUM;var gl=getTestContext();if(gl&&gl.getShaderPrecisionFormat){var shaderFragment=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);maxFragmentPrecision=shaderFragment.precision?constants_PRECISION.HIGH:constants_PRECISION.MEDIUM}}return maxFragmentPrecision}())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(Program,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(Program,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),Program.from=function(vertexSrc,fragmentSrc,name){var key=vertexSrc+fragmentSrc,program=ProgramCache[key];return program||(ProgramCache[key]=program=new Program(vertexSrc,fragmentSrc,name)),program},Program}(),Shader=function(){function Shader(program,uniforms){this.uniformBindCount=0,this.program=program,this.uniformGroup=uniforms?uniforms instanceof UniformGroup?uniforms:new UniformGroup(uniforms):new UniformGroup({})}return Shader.prototype.checkUniformExists=function(name,group){if(group.uniforms[name])return!0;for(var i in group.uniforms){var uniform=group.uniforms[i];if(uniform.group&&this.checkUniformExists(name,uniform))return!0}return!1},Shader.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(Shader.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),Shader.from=function(vertexSrc,fragmentSrc,uniforms){return new Shader(Program.from(vertexSrc,fragmentSrc),uniforms)},Shader}(),State=function(){function State(){this.data=0,this.blendMode=constants_BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(State.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(value){!!(1&this.data)!==value&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(value){!!(2&this.data)!==value&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(value){!!(4&this.data)!==value&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(value){!!(8&this.data)!==value&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"depthMask",{get:function(){return!!(32&this.data)},set:function(value){!!(32&this.data)!==value&&(this.data^=32)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(value){!!(16&this.data)!==value&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"blendMode",{get:function(){return this._blendMode},set:function(value){this.blend=value!==constants_BLEND_MODES.NONE,this._blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(value){this.offsets=!!value,this._polygonOffset=value},enumerable:!1,configurable:!0}),State.prototype.toString=function(){return"[@pixi/core:State blendMode="+this.blendMode+" clockwiseFrontFace="+this.clockwiseFrontFace+" culling="+this.culling+" depthMask="+this.depthMask+" polygonOffset="+this.polygonOffset+"]"},State.for2d=function(){var state=new State;return state.depthTest=!1,state.blend=!0,state},State}(),Filter=function(_super){function Filter(vertexSrc,fragmentSrc,uniforms){var _this=this,program=Program.from(vertexSrc||Filter.defaultVertexSrc,fragmentSrc||Filter.defaultFragmentSrc);return(_this=_super.call(this,program,uniforms)||this).padding=0,_this.resolution=settings.FILTER_RESOLUTION,_this.multisample=settings.FILTER_MULTISAMPLE,_this.enabled=!0,_this.autoFit=!0,_this.state=new State,_this}return core_extends(Filter,_super),Filter.prototype.apply=function(filterManager,input,output,clearMode,_currentState){filterManager.applyFilter(this,input,output,clearMode)},Object.defineProperty(Filter.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Filter,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(Filter,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),Filter}(Shader),tempMat=new Matrix,TextureMatrix=function(){function TextureMatrix(texture,clampMargin){this._texture=texture,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===clampMargin?.5:clampMargin,this.isSimple=!1}return Object.defineProperty(TextureMatrix.prototype,"texture",{get:function(){return this._texture},set:function(value){this._texture=value,this._textureID=-1},enumerable:!1,configurable:!0}),TextureMatrix.prototype.multiplyUvs=function(uvs,out){void 0===out&&(out=uvs);for(var mat=this.mapCoord,i=0;i<uvs.length;i+=2){var x=uvs[i],y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx,out[i+1]=x*mat.b+y*mat.d+mat.ty}return out},TextureMatrix.prototype.update=function(forceUpdate){var tex=this._texture;if(!tex||!tex.valid)return!1;if(!forceUpdate&&this._textureID===tex._updateID)return!1;this._textureID=tex._updateID,this._updateID++;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig,trim=tex.trim;trim&&(tempMat.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height),this.mapCoord.append(tempMat));var texBase=tex.baseTexture,frame=this.uClampFrame,margin=this.clampMargin/texBase.resolution,offset=this.clampOffset;return frame[0]=(tex._frame.x+margin+offset)/texBase.width,frame[1]=(tex._frame.y+margin+offset)/texBase.height,frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width,frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height,this.uClampOffset[0]=offset/texBase.realWidth,this.uClampOffset[1]=offset/texBase.realHeight,this.isSimple=tex._frame.width===texBase.width&&tex._frame.height===texBase.height&&0===tex.rotate,!0},TextureMatrix}(),SpriteMaskFilter=function(_super){function SpriteMaskFilter(sprite){var _this=this,maskMatrix=new Matrix;return _this=_super.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n")||this,sprite.renderable=!1,_this.maskSprite=sprite,_this.maskMatrix=maskMatrix,_this}return core_extends(SpriteMaskFilter,_super),SpriteMaskFilter.prototype.apply=function(filterManager,input,output,clearMode){var maskSprite=this.maskSprite,tex=maskSprite._texture;tex.valid&&(tex.uvMatrix||(tex.uvMatrix=new TextureMatrix(tex,0)),tex.uvMatrix.update(),this.uniforms.npmAlpha=tex.baseTexture.alphaMode?0:1,this.uniforms.mask=tex,this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.uvMatrix.mapCoord),this.uniforms.alpha=maskSprite.worldAlpha,this.uniforms.maskClamp=tex.uvMatrix.uClampFrame,filterManager.applyFilter(this,input,output,clearMode))},SpriteMaskFilter}(Filter),MaskSystem=function(){function MaskSystem(renderer){this.renderer=renderer,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return MaskSystem.prototype.setMaskStack=function(maskStack){this.maskStack=maskStack,this.renderer.scissor.setMaskStack(maskStack),this.renderer.stencil.setMaskStack(maskStack)},MaskSystem.prototype.push=function(target,maskDataOrTarget){var maskData=maskDataOrTarget;if(!maskData.isMaskData){var d=this.maskDataPool.pop()||new MaskData;d.pooled=!0,d.maskObject=maskDataOrTarget,maskData=d}switch(maskData.autoDetect&&this.detect(maskData),maskData.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),maskData._target=target,maskData.type){case constants_MASK_TYPES.SCISSOR:this.maskStack.push(maskData),this.renderer.scissor.push(maskData);break;case constants_MASK_TYPES.STENCIL:this.maskStack.push(maskData),this.renderer.stencil.push(maskData);break;case constants_MASK_TYPES.SPRITE:maskData.copyCountersOrReset(null),this.pushSpriteMask(maskData),this.maskStack.push(maskData)}},MaskSystem.prototype.pop=function(target){var maskData=this.maskStack.pop();if(maskData&&maskData._target===target){switch(maskData.type){case constants_MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case constants_MASK_TYPES.STENCIL:this.renderer.stencil.pop(maskData.maskObject);break;case constants_MASK_TYPES.SPRITE:this.popSpriteMask()}maskData.reset(),maskData.pooled&&this.maskDataPool.push(maskData)}},MaskSystem.prototype.detect=function(maskData){var maskObject=maskData.maskObject;if(maskObject.isSprite)maskData.type=constants_MASK_TYPES.SPRITE;else if(maskData.type=constants_MASK_TYPES.STENCIL,this.enableScissor&&maskObject.isFastRect&&maskObject.isFastRect()){var matrix=maskObject.worldTransform,rotX=Math.atan2(matrix.b,matrix.a),rotXY=Math.atan2(matrix.d,matrix.c);rotX=Math.round(rotX*(180/Math.PI)*100),rotXY=((rotXY=Math.round(rotXY*(180/Math.PI)*100)-rotX)%18e3+18e3)%18e3,0===(rotX=(rotX%9e3+9e3)%9e3)&&9e3===rotXY&&(maskData.type=constants_MASK_TYPES.SCISSOR)}},MaskSystem.prototype.pushSpriteMask=function(maskData){var _a,_b,maskObject=maskData.maskObject,target=maskData._target,alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];alphaMaskFilter||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter(maskObject)]);var resolution,multisample,renderer=this.renderer,renderTextureSystem=renderer.renderTexture;if(renderTextureSystem.current){var renderTexture=renderTextureSystem.current;resolution=maskData.resolution||renderTexture.resolution,multisample=null!==(_a=maskData.multisample)&&void 0!==_a?_a:renderTexture.multisample}else resolution=maskData.resolution||renderer.resolution,multisample=null!==(_b=maskData.multisample)&&void 0!==_b?_b:renderer.multisample;alphaMaskFilter[0].resolution=resolution,alphaMaskFilter[0].multisample=multisample,alphaMaskFilter[0].maskSprite=maskObject;var stashFilterArea=target.filterArea;target.filterArea=maskObject.getBounds(!0),renderer.filter.push(target,alphaMaskFilter),target.filterArea=stashFilterArea,this.alphaMaskIndex++},MaskSystem.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},MaskSystem.prototype.destroy=function(){this.renderer=null},MaskSystem}(),AbstractMaskSystem=function(){function AbstractMaskSystem(renderer){this.renderer=renderer,this.maskStack=[],this.glConst=0}return AbstractMaskSystem.prototype.getStackLength=function(){return this.maskStack.length},AbstractMaskSystem.prototype.setMaskStack=function(maskStack){var gl=this.renderer.gl,curStackLen=this.getStackLength();this.maskStack=maskStack;var newStackLen=this.getStackLength();newStackLen!==curStackLen&&(0===newStackLen?gl.disable(this.glConst):(gl.enable(this.glConst),this._useCurrent()))},AbstractMaskSystem.prototype._useCurrent=function(){},AbstractMaskSystem.prototype.destroy=function(){this.renderer=null,this.maskStack=null},AbstractMaskSystem}(),ScissorSystem=function(_super){function ScissorSystem(renderer){var _this=_super.call(this,renderer)||this;return _this.glConst=WebGLRenderingContext.SCISSOR_TEST,_this}return core_extends(ScissorSystem,_super),ScissorSystem.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._scissorCounter:0},ScissorSystem.prototype.push=function(maskData){var maskObject=maskData.maskObject;maskObject.renderable=!0;var prevData=maskData._scissorRect,bounds=maskObject.getBounds(!0),gl=this.renderer.gl;maskObject.renderable=!1,prevData?bounds.fit(prevData):gl.enable(gl.SCISSOR_TEST),maskData._scissorCounter++,maskData._scissorRect=bounds,this._useCurrent()},ScissorSystem.prototype.pop=function(){var gl=this.renderer.gl;this.getStackLength()>0?this._useCurrent():gl.disable(gl.SCISSOR_TEST)},ScissorSystem.prototype._useCurrent=function(){var rect=this.maskStack[this.maskStack.length-1]._scissorRect,rt=this.renderer.renderTexture.current,_a=this.renderer.projection,transform=_a.transform,sourceFrame=_a.sourceFrame,destinationFrame=_a.destinationFrame,resolution=rt?rt.resolution:this.renderer.resolution,sx=destinationFrame.width/sourceFrame.width,sy=destinationFrame.height/sourceFrame.height,x=((rect.x-sourceFrame.x)*sx+destinationFrame.x)*resolution,y=((rect.y-sourceFrame.y)*sy+destinationFrame.y)*resolution,width=rect.width*sx*resolution,height=rect.height*sy*resolution;transform&&(x+=transform.tx*resolution,y+=transform.ty*resolution),rt||(y=this.renderer.height-height-y),x=Math.round(x),y=Math.round(y),width=Math.round(width),height=Math.round(height),this.renderer.gl.scissor(x,y,width,height)},ScissorSystem}(AbstractMaskSystem),StencilSystem=function(_super){function StencilSystem(renderer){var _this=_super.call(this,renderer)||this;return _this.glConst=WebGLRenderingContext.STENCIL_TEST,_this}return core_extends(StencilSystem,_super),StencilSystem.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._stencilCounter:0},StencilSystem.prototype.push=function(maskData){var maskObject=maskData.maskObject,gl=this.renderer.gl,prevMaskCount=maskData._stencilCounter;0===prevMaskCount&&(this.renderer.framebuffer.forceStencil(),gl.enable(gl.STENCIL_TEST)),maskData._stencilCounter++,gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.EQUAL,prevMaskCount,this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),maskObject.renderable=!1,this._useCurrent()},StencilSystem.prototype.pop=function(maskObject){var gl=this.renderer.gl;0===this.getStackLength()?(gl.disable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),gl.clearStencil(0)):(gl.colorMask(!1,!1,!1,!1),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),maskObject.renderable=!1,this._useCurrent())},StencilSystem.prototype._useCurrent=function(){var gl=this.renderer.gl;gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(gl.EQUAL,this.getStackLength(),this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)},StencilSystem.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},StencilSystem}(AbstractMaskSystem),ProjectionSystem=function(){function ProjectionSystem(renderer){this.renderer=renderer,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Matrix,this.transform=null}return ProjectionSystem.prototype.update=function(destinationFrame,sourceFrame,resolution,root){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame,this.sourceFrame=sourceFrame||this.sourceFrame||destinationFrame,this.calculateProjection(this.destinationFrame,this.sourceFrame,resolution,root),this.transform&&this.projectionMatrix.append(this.transform);var renderer=this.renderer;renderer.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,renderer.globalUniforms.update(),renderer.shader.shader&&renderer.shader.syncUniformGroup(renderer.shader.shader.uniforms.globals)},ProjectionSystem.prototype.calculateProjection=function(_destinationFrame,sourceFrame,_resolution,root){var pm=this.projectionMatrix,sign=root?-1:1;pm.identity(),pm.a=1/sourceFrame.width*2,pm.d=sign*(1/sourceFrame.height*2),pm.tx=-1-sourceFrame.x*pm.a,pm.ty=-sign-sourceFrame.y*pm.d},ProjectionSystem.prototype.setTransform=function(_matrix){},ProjectionSystem.prototype.destroy=function(){this.renderer=null},ProjectionSystem}(),tempRect=new Rectangle,tempRect2=new Rectangle,RenderTextureSystem=function(){function RenderTextureSystem(renderer){this.renderer=renderer,this.clearColor=renderer._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.viewportFrame=new Rectangle}return RenderTextureSystem.prototype.bind=function(renderTexture,sourceFrame,destinationFrame){void 0===renderTexture&&(renderTexture=null);var baseTexture,framebuffer,resolution,renderer=this.renderer;this.current=renderTexture,renderTexture?(resolution=(baseTexture=renderTexture.baseTexture).resolution,sourceFrame||(tempRect.width=renderTexture.frame.width,tempRect.height=renderTexture.frame.height,sourceFrame=tempRect),destinationFrame||(tempRect2.x=renderTexture.frame.x,tempRect2.y=renderTexture.frame.y,tempRect2.width=sourceFrame.width,tempRect2.height=sourceFrame.height,destinationFrame=tempRect2),framebuffer=baseTexture.framebuffer):(resolution=renderer.resolution,sourceFrame||(tempRect.width=renderer.screen.width,tempRect.height=renderer.screen.height,sourceFrame=tempRect),destinationFrame||((destinationFrame=tempRect).width=sourceFrame.width,destinationFrame.height=sourceFrame.height));var viewportFrame=this.viewportFrame;viewportFrame.x=destinationFrame.x*resolution,viewportFrame.y=destinationFrame.y*resolution,viewportFrame.width=destinationFrame.width*resolution,viewportFrame.height=destinationFrame.height*resolution,renderTexture||(viewportFrame.y=renderer.view.height-(viewportFrame.y+viewportFrame.height)),viewportFrame.ceil(),this.renderer.framebuffer.bind(framebuffer,viewportFrame),this.renderer.projection.update(destinationFrame,sourceFrame,resolution,!framebuffer),renderTexture?this.renderer.mask.setMaskStack(baseTexture.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(sourceFrame),this.destinationFrame.copyFrom(destinationFrame)},RenderTextureSystem.prototype.clear=function(clearColor,mask){clearColor=this.current?clearColor||this.current.baseTexture.clearColor:clearColor||this.clearColor;var destinationFrame=this.destinationFrame,baseFrame=this.current?this.current.baseTexture:this.renderer.screen,clearMask=destinationFrame.width!==baseFrame.width||destinationFrame.height!==baseFrame.height;if(clearMask){var _a=this.viewportFrame,x=_a.x,y=_a.y,width=_a.width,height=_a.height;x=Math.round(x),y=Math.round(y),width=Math.round(width),height=Math.round(height),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(x,y,width,height)}this.renderer.framebuffer.clear(clearColor[0],clearColor[1],clearColor[2],clearColor[3],mask),clearMask&&this.renderer.scissor.pop()},RenderTextureSystem.prototype.resize=function(){this.bind(null)},RenderTextureSystem.prototype.reset=function(){this.bind(null)},RenderTextureSystem.prototype.destroy=function(){this.renderer=null},RenderTextureSystem}();function uboUpdate(_ud,_uv,_renderer,_syncData,buffer){_renderer.buffer.update(buffer)}var UBO_TO_SINGLE_SETTERS={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function createUBOElements(uniformData){for(var uboElements=uniformData.map((function(data){return{data,offset:0,dataLen:0,dirty:0}})),size=0,chunkSize=0,offset=0,i=0;i<uboElements.length;i++){var uboElement=uboElements[i];if(size=GLSL_TO_STD40_SIZE[uboElement.data.type],uboElement.data.size>1&&(size=Math.max(size,16)*uboElement.data.size),uboElement.dataLen=size,chunkSize%size!=0&&chunkSize<16){var lineUpValue=chunkSize%size%16;chunkSize+=lineUpValue,offset+=lineUpValue}chunkSize+size>16?(offset=16*Math.ceil(offset/16),uboElement.offset=offset,offset+=size,chunkSize=size):(uboElement.offset=offset,chunkSize+=size,offset+=size)}return{uboElements,size:offset=16*Math.ceil(offset/16)}}function getUBOData(uniforms,uniformData){var usedUniformDatas=[];for(var i in uniforms)uniformData[i]&&usedUniformDatas.push(uniformData[i]);return usedUniformDatas.sort((function(a,b){return a.index-b.index})),usedUniformDatas}function generateUniformBufferSync(group,uniformData){if(!group.autoManage)return{size:0,syncFunc:uboUpdate};for(var _a=createUBOElements(getUBOData(group.uniforms,uniformData)),uboElements=_a.uboElements,size=_a.size,funcFragments=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "],i=0;i<uboElements.length;i++){for(var uboElement=uboElements[i],uniform=group.uniforms[uboElement.data.name],name=uboElement.data.name,parsed=!1,j=0;j<uniformParsers.length;j++){var uniformParser=uniformParsers[j];if(uniformParser.codeUbo&&uniformParser.test(uboElement.data,uniform)){funcFragments.push("offset = "+uboElement.offset/4+";",uniformParsers[j].codeUbo(uboElement.data.name,uniform)),parsed=!0;break}}if(!parsed)if(uboElement.data.size>1){var size_1=mapSize(uboElement.data.type),rowSize=Math.max(GLSL_TO_STD40_SIZE[uboElement.data.type]/16,1),elementSize=size_1/rowSize,remainder=(4-elementSize%4)%4;funcFragments.push("\n                cv = ud."+name+".value;\n                v = uv."+name+";\n                offset = "+uboElement.offset/4+";\n\n                t = 0;\n\n                for(var i=0; i < "+uboElement.data.size*rowSize+"; i++)\n                {\n                    for(var j = 0; j < "+elementSize+"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += "+remainder+";\n                }\n\n                ")}else{var template=UBO_TO_SINGLE_SETTERS[uboElement.data.type];funcFragments.push("\n                cv = ud."+name+".value;\n                v = uv."+name+";\n                offset = "+uboElement.offset/4+";\n                "+template+";\n                ")}}return funcFragments.push("\n       renderer.buffer.update(buffer);\n    "),{size,syncFunc:new Function("ud","uv","renderer","syncData","buffer",funcFragments.join("\n"))}}var IGLUniformData=function(){},GLProgram=function(){function GLProgram(program,uniformData){this.program=program,this.uniformData=uniformData,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return GLProgram.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},GLProgram}();function generateProgram(gl,program){var glVertShader=compileShader(gl,gl.VERTEX_SHADER,program.vertexSrc),glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,program.fragmentSrc),webGLProgram=gl.createProgram();gl.attachShader(webGLProgram,glVertShader),gl.attachShader(webGLProgram,glFragShader),gl.linkProgram(webGLProgram),gl.getProgramParameter(webGLProgram,gl.LINK_STATUS)||function(gl,program,vertexShader,fragmentShader){gl.getProgramParameter(program,gl.LINK_STATUS)||(gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)||logPrettyShaderError(gl,vertexShader),gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)||logPrettyShaderError(gl,fragmentShader),console.error("PixiJS Error: Could not initialize shader."),""!==gl.getProgramInfoLog(program)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program)))}(gl,webGLProgram,glVertShader,glFragShader),program.attributeData=function(program,gl){for(var attributes={},totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i);if(!attribData.name.startsWith("gl_")){var type=mapType(gl,attribData.type),data={type,name:attribData.name,size:mapSize(type),location:i};attributes[attribData.name]=data}}return attributes}(webGLProgram,gl),program.uniformData=function(program,gl){for(var uniforms={},totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i),name=uniformData.name.replace(/\[.*?\]$/,""),isArray=!!uniformData.name.match(/\[.*?\]$/),type=mapType(gl,uniformData.type);uniforms[name]={name,index:i,type,size:uniformData.size,isArray,value:defaultValue(type,uniformData.size)}}return uniforms}(webGLProgram,gl);var keys=Object.keys(program.attributeData);keys.sort((function(a,b){return a>b?1:-1}));for(var i=0;i<keys.length;i++)program.attributeData[keys[i]].location=i,gl.bindAttribLocation(webGLProgram,i,keys[i]);gl.linkProgram(webGLProgram),gl.deleteShader(glVertShader),gl.deleteShader(glFragShader);var uniformData={};for(var i in program.uniformData){var data=program.uniformData[i];uniformData[i]={location:gl.getUniformLocation(webGLProgram,i),value:defaultValue(data.type,data.size)}}return new GLProgram(webGLProgram,uniformData)}var UID$4=0,defaultSyncData={textureCount:0,uboCount:0},ShaderSystem=function(){function ShaderSystem(renderer){this.destroyed=!1,this.renderer=renderer,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=UID$4++}return ShaderSystem.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof unsafeEval)return unsafeEval;try{var func=new Function("param1","param2","param3","return param1[param2] === param3;");unsafeEval=!0===func({a:"b"},"a","b")}catch(e){unsafeEval=!1}return unsafeEval}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},ShaderSystem.prototype.contextChange=function(gl){this.gl=gl,this.reset()},ShaderSystem.prototype.bind=function(shader,dontSync){shader.uniforms.globals=this.renderer.globalUniforms;var program=shader.program,glProgram=program.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(shader);return this.shader=shader,this.program!==program&&(this.program=program,this.gl.useProgram(glProgram.program)),dontSync||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(shader.uniformGroup,defaultSyncData)),glProgram},ShaderSystem.prototype.setUniforms=function(uniforms){var shader=this.shader.program,glProgram=shader.glPrograms[this.renderer.CONTEXT_UID];shader.syncUniforms(glProgram.uniformData,uniforms,this.renderer)},ShaderSystem.prototype.syncUniformGroup=function(group,syncData){var glProgram=this.getGlProgram();group.static&&group.dirtyId===glProgram.uniformDirtyGroups[group.id]||(glProgram.uniformDirtyGroups[group.id]=group.dirtyId,this.syncUniforms(group,glProgram,syncData))},ShaderSystem.prototype.syncUniforms=function(group,glProgram,syncData){(group.syncUniforms[this.shader.program.id]||this.createSyncGroups(group))(glProgram.uniformData,group.uniforms,this.renderer,syncData)},ShaderSystem.prototype.createSyncGroups=function(group){var id=this.getSignature(group,this.shader.program.uniformData,"u");return this.cache[id]||(this.cache[id]=function(group,uniformData){var funcFragments=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var i in group.uniforms){var data=uniformData[i];if(data){for(var uniform=group.uniforms[i],parsed=!1,j=0;j<uniformParsers.length;j++)if(uniformParsers[j].test(data,uniform)){funcFragments.push(uniformParsers[j].code(i,uniform)),parsed=!0;break}if(!parsed){var template=(1===data.size?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[data.type].replace("location",'ud["'+i+'"].location');funcFragments.push('\n            cv = ud["'+i+'"].value;\n            v = uv["'+i+'"];\n            '+template+";")}}else group.uniforms[i].group&&(group.uniforms[i].ubo?funcFragments.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+i+", '"+i+"');\n                    "):funcFragments.push("\n                        renderer.shader.syncUniformGroup(uv."+i+", syncData);\n                    "))}return new Function("ud","uv","renderer","syncData",funcFragments.join("\n"))}(group,this.shader.program.uniformData)),group.syncUniforms[this.shader.program.id]=this.cache[id],group.syncUniforms[this.shader.program.id]},ShaderSystem.prototype.syncUniformBufferGroup=function(group,name){var glProgram=this.getGlProgram();if(!group.static||0!==group.dirtyId||!glProgram.uniformGroups[group.id]){group.dirtyId=0;var syncFunc=glProgram.uniformGroups[group.id]||this.createSyncBufferGroup(group,glProgram,name);group.buffer.update(),syncFunc(glProgram.uniformData,group.uniforms,this.renderer,defaultSyncData,group.buffer)}this.renderer.buffer.bindBufferBase(group.buffer,glProgram.uniformBufferBindings[name])},ShaderSystem.prototype.createSyncBufferGroup=function(group,glProgram,name){var gl=this.renderer.gl;this.renderer.buffer.bind(group.buffer);var uniformBlockIndex=this.gl.getUniformBlockIndex(glProgram.program,name);glProgram.uniformBufferBindings[name]=this.shader.uniformBindCount,gl.uniformBlockBinding(glProgram.program,uniformBlockIndex,this.shader.uniformBindCount),this.shader.uniformBindCount++;var id=this.getSignature(group,this.shader.program.uniformData,"ubo"),uboData=this._uboCache[id];if(uboData||(uboData=this._uboCache[id]=generateUniformBufferSync(group,this.shader.program.uniformData)),group.autoManage){var data=new Float32Array(uboData.size/4);group.buffer.update(data)}return glProgram.uniformGroups[group.id]=uboData.syncFunc,glProgram.uniformGroups[group.id]},ShaderSystem.prototype.getSignature=function(group,uniformData,preFix){var uniforms=group.uniforms,strings=[preFix+"-"];for(var i in uniforms)strings.push(i),uniformData[i]&&strings.push(uniformData[i].type);return strings.join("-")},ShaderSystem.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},ShaderSystem.prototype.generateProgram=function(shader){var gl=this.gl,program=shader.program,glProgram=generateProgram(gl,program);return program.glPrograms[this.renderer.CONTEXT_UID]=glProgram,glProgram},ShaderSystem.prototype.reset=function(){this.program=null,this.shader=null},ShaderSystem.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},ShaderSystem}();var StateSystem=function(){function StateSystem(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=constants_BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new State,this.defaultState.blend=!0}return StateSystem.prototype.contextChange=function(gl){this.gl=gl,this.blendModes=function(gl,array){return void 0===array&&(array=[]),array[constants_BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.ADD]=[gl.ONE,gl.ONE],array[constants_BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.NONE]=[0,0],array[constants_BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE],array[constants_BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SRC_IN]=[gl.DST_ALPHA,gl.ZERO],array[constants_BLEND_MODES.SRC_OUT]=[gl.ONE_MINUS_DST_ALPHA,gl.ZERO],array[constants_BLEND_MODES.SRC_ATOP]=[gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.DST_OVER]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE],array[constants_BLEND_MODES.DST_IN]=[gl.ZERO,gl.SRC_ALPHA],array[constants_BLEND_MODES.DST_OUT]=[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.DST_ATOP]=[gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA],array[constants_BLEND_MODES.XOR]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SUBTRACT]=[gl.ONE,gl.ONE,gl.ONE,gl.ONE,gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD],array}(gl),this.set(this.defaultState),this.reset()},StateSystem.prototype.set=function(state){if(state=state||this.defaultState,this.stateId!==state.data){for(var diff=this.stateId^state.data,i=0;diff;)1&diff&&this.map[i].call(this,!!(state.data&1<<i)),diff>>=1,i++;this.stateId=state.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,state)},StateSystem.prototype.forceState=function(state){state=state||this.defaultState;for(var i=0;i<this.map.length;i++)this.map[i].call(this,!!(state.data&1<<i));for(i=0;i<this.checks.length;i++)this.checks[i](this,state);this.stateId=state.data},StateSystem.prototype.setBlend=function(value){this.updateCheck(StateSystem.checkBlendMode,value),this.gl[value?"enable":"disable"](this.gl.BLEND)},StateSystem.prototype.setOffset=function(value){this.updateCheck(StateSystem.checkPolygonOffset,value),this.gl[value?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},StateSystem.prototype.setDepthTest=function(value){this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)},StateSystem.prototype.setDepthMask=function(value){this.gl.depthMask(value)},StateSystem.prototype.setCullFace=function(value){this.gl[value?"enable":"disable"](this.gl.CULL_FACE)},StateSystem.prototype.setFrontFace=function(value){this.gl.frontFace(this.gl[value?"CW":"CCW"])},StateSystem.prototype.setBlendMode=function(value){if(value!==this.blendMode){this.blendMode=value;var mode=this.blendModes[value],gl=this.gl;2===mode.length?gl.blendFunc(mode[0],mode[1]):gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3]),6===mode.length?(this._blendEq=!0,gl.blendEquationSeparate(mode[4],mode[5])):this._blendEq&&(this._blendEq=!1,gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD))}},StateSystem.prototype.setPolygonOffset=function(value,scale){this.gl.polygonOffset(value,scale)},StateSystem.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},StateSystem.prototype.updateCheck=function(func,value){var index=this.checks.indexOf(func);value&&-1===index?this.checks.push(func):value||-1===index||this.checks.splice(index,1)},StateSystem.checkBlendMode=function(system,state){system.setBlendMode(state.blendMode)},StateSystem.checkPolygonOffset=function(system,state){system.setPolygonOffset(1,state.polygonOffset)},StateSystem.prototype.destroy=function(){this.gl=null},StateSystem}(),TextureGCSystem=function(){function TextureGCSystem(renderer){this.renderer=renderer,this.count=0,this.checkCount=0,this.maxIdle=settings.GC_MAX_IDLE,this.checkCountMax=settings.GC_MAX_CHECK_COUNT,this.mode=settings.GC_MODE}return TextureGCSystem.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==constants_GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},TextureGCSystem.prototype.run=function(){for(var tm=this.renderer.texture,managedTextures=tm.managedTextures,wasRemoved=!1,i=0;i<managedTextures.length;i++){var texture=managedTextures[i];!texture.framebuffer&&this.count-texture.touched>this.maxIdle&&(tm.destroyTexture(texture,!0),managedTextures[i]=null,wasRemoved=!0)}if(wasRemoved){var j=0;for(i=0;i<managedTextures.length;i++)null!==managedTextures[i]&&(managedTextures[j++]=managedTextures[i]);managedTextures.length=j}},TextureGCSystem.prototype.unload=function(displayObject){var tm=this.renderer.texture,texture=displayObject._texture;texture&&!texture.framebuffer&&tm.destroyTexture(texture);for(var i=displayObject.children.length-1;i>=0;i--)this.unload(displayObject.children[i])},TextureGCSystem.prototype.destroy=function(){this.renderer=null},TextureGCSystem}();var GLTexture=function(texture){this.texture=texture,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=constants_TYPES.UNSIGNED_BYTE,this.internalFormat=constants_FORMATS.RGBA,this.samplerType=0},TextureSystem=function(){function TextureSystem(renderer){this.renderer=renderer,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new BaseTexture,this.hasIntegerTextures=!1}return TextureSystem.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(gl){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,table;return"WebGL2RenderingContext"in self&&gl instanceof self.WebGL2RenderingContext?((_a={})[constants_TYPES.UNSIGNED_BYTE]=((_b={})[constants_FORMATS.RGBA]=gl.RGBA8,_b[constants_FORMATS.RGB]=gl.RGB8,_b[constants_FORMATS.RG]=gl.RG8,_b[constants_FORMATS.RED]=gl.R8,_b[constants_FORMATS.RGBA_INTEGER]=gl.RGBA8UI,_b[constants_FORMATS.RGB_INTEGER]=gl.RGB8UI,_b[constants_FORMATS.RG_INTEGER]=gl.RG8UI,_b[constants_FORMATS.RED_INTEGER]=gl.R8UI,_b[constants_FORMATS.ALPHA]=gl.ALPHA,_b[constants_FORMATS.LUMINANCE]=gl.LUMINANCE,_b[constants_FORMATS.LUMINANCE_ALPHA]=gl.LUMINANCE_ALPHA,_b),_a[constants_TYPES.BYTE]=((_c={})[constants_FORMATS.RGBA]=gl.RGBA8_SNORM,_c[constants_FORMATS.RGB]=gl.RGB8_SNORM,_c[constants_FORMATS.RG]=gl.RG8_SNORM,_c[constants_FORMATS.RED]=gl.R8_SNORM,_c[constants_FORMATS.RGBA_INTEGER]=gl.RGBA8I,_c[constants_FORMATS.RGB_INTEGER]=gl.RGB8I,_c[constants_FORMATS.RG_INTEGER]=gl.RG8I,_c[constants_FORMATS.RED_INTEGER]=gl.R8I,_c),_a[constants_TYPES.UNSIGNED_SHORT]=((_d={})[constants_FORMATS.RGBA_INTEGER]=gl.RGBA16UI,_d[constants_FORMATS.RGB_INTEGER]=gl.RGB16UI,_d[constants_FORMATS.RG_INTEGER]=gl.RG16UI,_d[constants_FORMATS.RED_INTEGER]=gl.R16UI,_d[constants_FORMATS.DEPTH_COMPONENT]=gl.DEPTH_COMPONENT16,_d),_a[constants_TYPES.SHORT]=((_e={})[constants_FORMATS.RGBA_INTEGER]=gl.RGBA16I,_e[constants_FORMATS.RGB_INTEGER]=gl.RGB16I,_e[constants_FORMATS.RG_INTEGER]=gl.RG16I,_e[constants_FORMATS.RED_INTEGER]=gl.R16I,_e),_a[constants_TYPES.UNSIGNED_INT]=((_f={})[constants_FORMATS.RGBA_INTEGER]=gl.RGBA32UI,_f[constants_FORMATS.RGB_INTEGER]=gl.RGB32UI,_f[constants_FORMATS.RG_INTEGER]=gl.RG32UI,_f[constants_FORMATS.RED_INTEGER]=gl.R32UI,_f[constants_FORMATS.DEPTH_COMPONENT]=gl.DEPTH_COMPONENT24,_f),_a[constants_TYPES.INT]=((_g={})[constants_FORMATS.RGBA_INTEGER]=gl.RGBA32I,_g[constants_FORMATS.RGB_INTEGER]=gl.RGB32I,_g[constants_FORMATS.RG_INTEGER]=gl.RG32I,_g[constants_FORMATS.RED_INTEGER]=gl.R32I,_g),_a[constants_TYPES.FLOAT]=((_h={})[constants_FORMATS.RGBA]=gl.RGBA32F,_h[constants_FORMATS.RGB]=gl.RGB32F,_h[constants_FORMATS.RG]=gl.RG32F,_h[constants_FORMATS.RED]=gl.R32F,_h[constants_FORMATS.DEPTH_COMPONENT]=gl.DEPTH_COMPONENT32F,_h),_a[constants_TYPES.HALF_FLOAT]=((_j={})[constants_FORMATS.RGBA]=gl.RGBA16F,_j[constants_FORMATS.RGB]=gl.RGB16F,_j[constants_FORMATS.RG]=gl.RG16F,_j[constants_FORMATS.RED]=gl.R16F,_j),_a[constants_TYPES.UNSIGNED_SHORT_5_6_5]=((_k={})[constants_FORMATS.RGB]=gl.RGB565,_k),_a[constants_TYPES.UNSIGNED_SHORT_4_4_4_4]=((_l={})[constants_FORMATS.RGBA]=gl.RGBA4,_l),_a[constants_TYPES.UNSIGNED_SHORT_5_5_5_1]=((_m={})[constants_FORMATS.RGBA]=gl.RGB5_A1,_m),_a[constants_TYPES.UNSIGNED_INT_2_10_10_10_REV]=((_o={})[constants_FORMATS.RGBA]=gl.RGB10_A2,_o[constants_FORMATS.RGBA_INTEGER]=gl.RGB10_A2UI,_o),_a[constants_TYPES.UNSIGNED_INT_10F_11F_11F_REV]=((_p={})[constants_FORMATS.RGB]=gl.R11F_G11F_B10F,_p),_a[constants_TYPES.UNSIGNED_INT_5_9_9_9_REV]=((_q={})[constants_FORMATS.RGB]=gl.RGB9_E5,_q),_a[constants_TYPES.UNSIGNED_INT_24_8]=((_r={})[constants_FORMATS.DEPTH_STENCIL]=gl.DEPTH24_STENCIL8,_r),_a[constants_TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]=((_s={})[constants_FORMATS.DEPTH_STENCIL]=gl.DEPTH32F_STENCIL8,_s),table=_a):((_t={})[constants_TYPES.UNSIGNED_BYTE]=((_u={})[constants_FORMATS.RGBA]=gl.RGBA,_u[constants_FORMATS.RGB]=gl.RGB,_u[constants_FORMATS.ALPHA]=gl.ALPHA,_u[constants_FORMATS.LUMINANCE]=gl.LUMINANCE,_u[constants_FORMATS.LUMINANCE_ALPHA]=gl.LUMINANCE_ALPHA,_u),_t[constants_TYPES.UNSIGNED_SHORT_5_6_5]=((_v={})[constants_FORMATS.RGB]=gl.RGB,_v),_t[constants_TYPES.UNSIGNED_SHORT_4_4_4_4]=((_w={})[constants_FORMATS.RGBA]=gl.RGBA,_w),_t[constants_TYPES.UNSIGNED_SHORT_5_5_5_1]=((_x={})[constants_FORMATS.RGBA]=gl.RGBA,_x),table=_t),table}(gl);var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=maxTextures;for(var i=0;i<maxTextures;i++)this.boundTextures[i]=null;this.emptyTextures={};var emptyTexture2D=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_2D,emptyTexture2D.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[gl.TEXTURE_2D]=emptyTexture2D,this.emptyTextures[gl.TEXTURE_CUBE_MAP]=new GLTexture(gl.createTexture()),gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.emptyTextures[gl.TEXTURE_CUBE_MAP].texture);for(i=0;i<6;i++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR);for(i=0;i<this.boundTextures.length;i++)this.bind(null,i)},TextureSystem.prototype.bind=function(texture,location){void 0===location&&(location=0);var gl=this.gl;if((texture=null==texture?void 0:texture.castToBaseTexture())&&texture.valid&&!texture.parentTextureArray){texture.touched=this.renderer.textureGC.count;var glTexture=texture._glTextures[this.CONTEXT_UID]||this.initTexture(texture);this.boundTextures[location]!==texture&&(this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),gl.bindTexture(texture.target,glTexture.texture)),glTexture.dirtyId!==texture.dirtyId&&(this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),this.updateTexture(texture)),this.boundTextures[location]=texture}else this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[gl.TEXTURE_2D].texture),this.boundTextures[location]=null},TextureSystem.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var i=0;i<this.boundTextures.length;i++)this.boundTextures[i]=this.unknownTexture},TextureSystem.prototype.unbind=function(texture){var gl=this.gl,boundTextures=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var i=0;i<boundTextures.length;i++)boundTextures[i]===this.unknownTexture&&this.bind(null,i)}for(i=0;i<boundTextures.length;i++)boundTextures[i]===texture&&(this.currentLocation!==i&&(gl.activeTexture(gl.TEXTURE0+i),this.currentLocation=i),gl.bindTexture(texture.target,this.emptyTextures[texture.target].texture),boundTextures[i]=null)},TextureSystem.prototype.ensureSamplerType=function(maxTextures){var boundTextures=this.boundTextures,hasIntegerTextures=this.hasIntegerTextures,CONTEXT_UID=this.CONTEXT_UID;if(hasIntegerTextures)for(var i=maxTextures-1;i>=0;--i){var tex=boundTextures[i];if(tex)tex._glTextures[CONTEXT_UID].samplerType!==constants_SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(tex)}},TextureSystem.prototype.initTexture=function(texture){var glTexture=new GLTexture(this.gl.createTexture());return glTexture.dirtyId=-1,texture._glTextures[this.CONTEXT_UID]=glTexture,this.managedTextures.push(texture),texture.on("dispose",this.destroyTexture,this),glTexture},TextureSystem.prototype.initTextureType=function(texture,glTexture){var _a,_b;glTexture.internalFormat=null!==(_b=null===(_a=this.internalFormats[texture.type])||void 0===_a?void 0:_a[texture.format])&&void 0!==_b?_b:texture.format,2===this.webGLVersion&&texture.type===constants_TYPES.HALF_FLOAT?glTexture.type=this.gl.HALF_FLOAT:glTexture.type=texture.type},TextureSystem.prototype.updateTexture=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];if(glTexture){var renderer=this.renderer;if(this.initTextureType(texture,glTexture),texture.resource&&texture.resource.upload(renderer,texture,glTexture))glTexture.samplerType!==constants_SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var width=texture.realWidth,height=texture.realHeight,gl=renderer.gl;(glTexture.width!==width||glTexture.height!==height||glTexture.dirtyId<0)&&(glTexture.width=width,glTexture.height=height,gl.texImage2D(texture.target,0,glTexture.internalFormat,width,height,0,texture.format,glTexture.type,null))}texture.dirtyStyleId!==glTexture.dirtyStyleId&&this.updateTextureStyle(texture),glTexture.dirtyId=texture.dirtyId}},TextureSystem.prototype.destroyTexture=function(texture,skipRemove){var gl=this.gl;if((texture=texture.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(texture),gl.deleteTexture(texture._glTextures[this.CONTEXT_UID].texture),texture.off("dispose",this.destroyTexture,this),delete texture._glTextures[this.CONTEXT_UID],!skipRemove)){var i=this.managedTextures.indexOf(texture);-1!==i&&removeItems(this.managedTextures,i,1)}},TextureSystem.prototype.updateTextureStyle=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];glTexture&&(texture.mipmap!==constants_MIPMAP_MODES.POW2&&2===this.webGLVersion||texture.isPowerOfTwo?glTexture.mipmap=texture.mipmap>=1:glTexture.mipmap=!1,2===this.webGLVersion||texture.isPowerOfTwo?glTexture.wrapMode=texture.wrapMode:glTexture.wrapMode=constants_WRAP_MODES.CLAMP,texture.resource&&texture.resource.style(this.renderer,texture,glTexture)||this.setStyle(texture,glTexture),glTexture.dirtyStyleId=texture.dirtyStyleId)},TextureSystem.prototype.setStyle=function(texture,glTexture){var gl=this.gl;if(glTexture.mipmap&&texture.mipmap!==constants_MIPMAP_MODES.ON_MANUAL&&gl.generateMipmap(texture.target),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_S,glTexture.wrapMode),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_T,glTexture.wrapMode),glTexture.mipmap){gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===constants_SCALE_MODES.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST);var anisotropicExt=this.renderer.context.extensions.anisotropicFiltering;if(anisotropicExt&&texture.anisotropicLevel>0&&texture.scaleMode===constants_SCALE_MODES.LINEAR){var level=Math.min(texture.anisotropicLevel,gl.getParameter(anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT));gl.texParameterf(texture.target,anisotropicExt.TEXTURE_MAX_ANISOTROPY_EXT,level)}}else gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===constants_SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);gl.texParameteri(texture.target,gl.TEXTURE_MAG_FILTER,texture.scaleMode===constants_SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST)},TextureSystem.prototype.destroy=function(){this.renderer=null},TextureSystem}(),_systems={__proto__:null,FilterSystem,BatchSystem,ContextSystem,FramebufferSystem,GeometrySystem,MaskSystem,ScissorSystem,StencilSystem,ProjectionSystem,RenderTextureSystem,ShaderSystem,StateSystem,TextureGCSystem,TextureSystem},tempMatrix$1=new Matrix,AbstractRenderer=function(_super){function AbstractRenderer(type,options){void 0===type&&(type=constants_RENDERER_TYPE.UNKNOWN);var _this=_super.call(this)||this;return options=Object.assign({},settings.RENDER_OPTIONS,options),_this.options=options,_this.type=type,_this.screen=new Rectangle(0,0,options.width,options.height),_this.view=options.view||document.createElement("canvas"),_this.resolution=options.resolution||settings.RESOLUTION,_this.useContextAlpha=options.useContextAlpha,_this.autoDensity=!!options.autoDensity,_this.preserveDrawingBuffer=options.preserveDrawingBuffer,_this.clearBeforeRender=options.clearBeforeRender,_this._backgroundColor=0,_this._backgroundColorRgba=[0,0,0,1],_this._backgroundColorString="#000000",_this.backgroundColor=options.backgroundColor||_this._backgroundColor,_this.backgroundAlpha=options.backgroundAlpha,void 0!==options.transparent&&(deprecation("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),_this.useContextAlpha=options.transparent,_this.backgroundAlpha=options.transparent?0:1),_this._lastObjectRendered=null,_this.plugins={},_this}return core_extends(AbstractRenderer,_super),AbstractRenderer.prototype.initPlugins=function(staticMap){for(var o in staticMap)this.plugins[o]=new staticMap[o](this)},Object.defineProperty(AbstractRenderer.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(AbstractRenderer.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),AbstractRenderer.prototype.resize=function(desiredScreenWidth,desiredScreenHeight){this.view.width=Math.round(desiredScreenWidth*this.resolution),this.view.height=Math.round(desiredScreenHeight*this.resolution);var screenWidth=this.view.width/this.resolution,screenHeight=this.view.height/this.resolution;this.screen.width=screenWidth,this.screen.height=screenHeight,this.autoDensity&&(this.view.style.width=screenWidth+"px",this.view.style.height=screenHeight+"px"),this.emit("resize",screenWidth,screenHeight)},AbstractRenderer.prototype.generateTexture=function(displayObject,options,resolution,region){void 0===options&&(options={}),"number"==typeof options&&(deprecation("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),options={scaleMode:options,resolution,region});var manualRegion=options.region,textureOptions=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&(t[p[i]]=s[p[i]])}return t}(options,["region"]);0===(region=manualRegion||displayObject.getLocalBounds(null,!0)).width&&(region.width=1),0===region.height&&(region.height=1);var renderTexture=RenderTexture.create(__assign({width:region.width,height:region.height},textureOptions));return tempMatrix$1.tx=-region.x,tempMatrix$1.ty=-region.y,this.render(displayObject,{renderTexture,clear:!1,transform:tempMatrix$1,skipUpdateTransform:!!displayObject.parent}),renderTexture},AbstractRenderer.prototype.destroy=function(removeView){for(var o in this.plugins)this.plugins[o].destroy(),this.plugins[o]=null;removeView&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);this.plugins=null,this.type=constants_RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this._tempDisplayObjectParent=null,this.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(AbstractRenderer.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(value){this._backgroundColor=value,this._backgroundColorString=hex2string(value),hex2rgb(value,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(AbstractRenderer.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(value){this._backgroundColorRgba[3]=value},enumerable:!1,configurable:!0}),AbstractRenderer}(eventemitter3_default()),GLBuffer=function(buffer){this.buffer=buffer||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},BufferSystem=function(){function BufferSystem(renderer){this.renderer=renderer,this.managedBuffers={},this.boundBufferBases={}}return BufferSystem.prototype.destroy=function(){this.renderer=null},BufferSystem.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},BufferSystem.prototype.bind=function(buffer){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);gl.bindBuffer(buffer.type,glBuffer.buffer)},BufferSystem.prototype.bindBufferBase=function(buffer,index){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;if(this.boundBufferBases[index]!==buffer){var glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);this.boundBufferBases[index]=buffer,gl.bindBufferBase(gl.UNIFORM_BUFFER,index,glBuffer.buffer)}},BufferSystem.prototype.bindBufferRange=function(buffer,index,offset){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;offset=offset||0;var glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);gl.bindBufferRange(gl.UNIFORM_BUFFER,index||0,glBuffer.buffer,256*offset,256)},BufferSystem.prototype.update=function(buffer){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,glBuffer=buffer._glBuffers[CONTEXT_UID];if(buffer._updateID!==glBuffer.updateID)if(glBuffer.updateID=buffer._updateID,gl.bindBuffer(buffer.type,glBuffer.buffer),glBuffer.byteLength>=buffer.data.byteLength)gl.bufferSubData(buffer.type,0,buffer.data);else{var drawType=buffer.static?gl.STATIC_DRAW:gl.DYNAMIC_DRAW;glBuffer.byteLength=buffer.data.byteLength,gl.bufferData(buffer.type,buffer.data,drawType)}},BufferSystem.prototype.dispose=function(buffer,contextLost){if(this.managedBuffers[buffer.id]){delete this.managedBuffers[buffer.id];var glBuffer=buffer._glBuffers[this.CONTEXT_UID],gl=this.gl;buffer.disposeRunner.remove(this),glBuffer&&(contextLost||gl.deleteBuffer(glBuffer.buffer),delete buffer._glBuffers[this.CONTEXT_UID])}},BufferSystem.prototype.disposeAll=function(contextLost){for(var all=Object.keys(this.managedBuffers),i=0;i<all.length;i++)this.dispose(this.managedBuffers[all[i]],contextLost)},BufferSystem.prototype.createGLBuffer=function(buffer){var CONTEXT_UID=this.CONTEXT_UID,gl=this.gl;return buffer._glBuffers[CONTEXT_UID]=new GLBuffer(gl.createBuffer()),this.managedBuffers[buffer.id]=buffer,buffer.disposeRunner.add(this),buffer._glBuffers[CONTEXT_UID]},BufferSystem}(),Renderer=function(_super){function Renderer(options){var _this=_super.call(this,constants_RENDERER_TYPE.WEBGL,options)||this;return options=_this.options,_this.gl=null,_this.CONTEXT_UID=0,_this.runners={destroy:new Runner("destroy"),contextChange:new Runner("contextChange"),reset:new Runner("reset"),update:new Runner("update"),postrender:new Runner("postrender"),prerender:new Runner("prerender"),resize:new Runner("resize")},_this.runners.contextChange.add(_this),_this.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0),_this.addSystem(MaskSystem,"mask").addSystem(ContextSystem,"context").addSystem(StateSystem,"state").addSystem(ShaderSystem,"shader").addSystem(TextureSystem,"texture").addSystem(BufferSystem,"buffer").addSystem(GeometrySystem,"geometry").addSystem(FramebufferSystem,"framebuffer").addSystem(ScissorSystem,"scissor").addSystem(StencilSystem,"stencil").addSystem(ProjectionSystem,"projection").addSystem(TextureGCSystem,"textureGC").addSystem(FilterSystem,"filter").addSystem(RenderTextureSystem,"renderTexture").addSystem(BatchSystem,"batch"),_this.initPlugins(Renderer.__plugins),_this.multisample=void 0,options.context?_this.context.initFromContext(options.context):_this.context.initFromOptions({alpha:!!_this.useContextAlpha,antialias:options.antialias,premultipliedAlpha:_this.useContextAlpha&&"notMultiplied"!==_this.useContextAlpha,stencil:!0,preserveDrawingBuffer:options.preserveDrawingBuffer,powerPreference:_this.options.powerPreference}),_this.renderingToScreen=!0,sayHello(2===_this.context.webGLVersion?"WebGL 2":"WebGL 1"),_this.resize(_this.options.width,_this.options.height),_this}return core_extends(Renderer,_super),Renderer.create=function(options){if(isWebGLSupported())return new Renderer(options);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},Renderer.prototype.contextChange=function(){var samples,gl=this.gl;if(1===this.context.webGLVersion){var framebuffer=gl.getParameter(gl.FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.FRAMEBUFFER,null),samples=gl.getParameter(gl.SAMPLES),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)}else{framebuffer=gl.getParameter(gl.DRAW_FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null),samples=gl.getParameter(gl.SAMPLES),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,framebuffer)}samples>=constants_MSAA_QUALITY.HIGH?this.multisample=constants_MSAA_QUALITY.HIGH:samples>=constants_MSAA_QUALITY.MEDIUM?this.multisample=constants_MSAA_QUALITY.MEDIUM:samples>=constants_MSAA_QUALITY.LOW?this.multisample=constants_MSAA_QUALITY.LOW:this.multisample=constants_MSAA_QUALITY.NONE},Renderer.prototype.addSystem=function(ClassRef,name){var system=new ClassRef(this);if(this[name])throw new Error('Whoops! The name "'+name+'" is already in use');for(var i in this[name]=system,this.runners)this.runners[i].add(system);return this},Renderer.prototype.render=function(displayObject,options){var renderTexture,clear,transform,skipUpdateTransform;if(options&&(options instanceof RenderTexture?(deprecation("6.0.0","Renderer#render arguments changed, use options instead."),renderTexture=options,clear=arguments[2],transform=arguments[3],skipUpdateTransform=arguments[4]):(renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform)),this.renderingToScreen=!renderTexture,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=transform,!this.context.isLost){if(renderTexture||(this._lastObjectRendered=displayObject),!skipUpdateTransform){var cacheParent=displayObject.enableTempParent();displayObject.updateTransform(),displayObject.disableTempParent(cacheParent)}this.renderTexture.bind(renderTexture),this.batch.currentRenderer.start(),(void 0!==clear?clear:this.clearBeforeRender)&&this.renderTexture.clear(),displayObject.render(this),this.batch.currentRenderer.flush(),renderTexture&&renderTexture.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},Renderer.prototype.generateTexture=function(displayObject,options,resolution,region){void 0===options&&(options={});var renderTexture=_super.prototype.generateTexture.call(this,displayObject,options,resolution,region);return this.framebuffer.blit(),renderTexture},Renderer.prototype.resize=function(desiredScreenWidth,desiredScreenHeight){_super.prototype.resize.call(this,desiredScreenWidth,desiredScreenHeight),this.runners.resize.emit(this.screen.height,this.screen.width)},Renderer.prototype.reset=function(){return this.runners.reset.emit(),this},Renderer.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},Renderer.prototype.destroy=function(removeView){for(var r in this.runners.destroy.emit(),this.runners)this.runners[r].destroy();_super.prototype.destroy.call(this,removeView),this.gl=null},Object.defineProperty(Renderer.prototype,"extract",{get:function(){return deprecation("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),Renderer.registerPlugin=function(pluginName,ctor){Renderer.__plugins=Renderer.__plugins||{},Renderer.__plugins[pluginName]=ctor},Renderer}(AbstractRenderer);function autoDetectRenderer(options){return Renderer.create(options)}var defaultVertex$2="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",defaultFilterVertex="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",System=function(){function System(renderer){deprecation("6.1.0","System class is deprecated, implemement ISystem interface instead."),this.renderer=renderer}return System.prototype.destroy=function(){this.renderer=null},System}(),BatchDrawCall=function(){this.texArray=null,this.blend=0,this.type=constants_DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null},BatchTextureArray=function(){function BatchTextureArray(){this.elements=[],this.ids=[],this.count=0}return BatchTextureArray.prototype.clear=function(){for(var i=0;i<this.count;i++)this.elements[i]=null;this.count=0},BatchTextureArray}(),ViewableBuffer=function(){function ViewableBuffer(sizeOrBuffer){"number"==typeof sizeOrBuffer?this.rawBinaryData=new ArrayBuffer(sizeOrBuffer):sizeOrBuffer instanceof Uint8Array?this.rawBinaryData=sizeOrBuffer.buffer:this.rawBinaryData=sizeOrBuffer,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(ViewableBuffer.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),ViewableBuffer.prototype.view=function(type){return this[type+"View"]},ViewableBuffer.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},ViewableBuffer.sizeOf=function(type){switch(type){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(type+" isn't a valid view type")}},ViewableBuffer}(),AbstractBatchRenderer=function(_super){function AbstractBatchRenderer(renderer){var _this=_super.call(this,renderer)||this;return _this.shaderGenerator=null,_this.geometryClass=null,_this.vertexSize=null,_this.state=State.for2d(),_this.size=4*settings.SPRITE_BATCH_SIZE,_this._vertexCount=0,_this._indexCount=0,_this._bufferedElements=[],_this._bufferedTextures=[],_this._bufferSize=0,_this._shader=null,_this._packedGeometries=[],_this._packedGeometryPoolSize=2,_this._flushId=0,_this._aBuffers={},_this._iBuffers={},_this.MAX_TEXTURES=1,_this.renderer.on("prerender",_this.onPrerender,_this),renderer.runners.contextChange.add(_this),_this._dcIndex=0,_this._aIndex=0,_this._iIndex=0,_this._attributeBuffer=null,_this._indexBuffer=null,_this._tempBoundTextures=[],_this}return core_extends(AbstractBatchRenderer,_super),AbstractBatchRenderer.prototype.contextChange=function(){var gl=this.renderer.gl;settings.PREFER_ENV===constants_ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,gl)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},AbstractBatchRenderer.prototype.initFlushBuffers=function(){for(var _drawCallPool=AbstractBatchRenderer._drawCallPool,_textureArrayPool=AbstractBatchRenderer._textureArrayPool,MAX_SPRITES=this.size/4,MAX_TA=Math.floor(MAX_SPRITES/this.MAX_TEXTURES)+1;_drawCallPool.length<MAX_SPRITES;)_drawCallPool.push(new BatchDrawCall);for(;_textureArrayPool.length<MAX_TA;)_textureArrayPool.push(new BatchTextureArray);for(var i=0;i<this.MAX_TEXTURES;i++)this._tempBoundTextures[i]=null},AbstractBatchRenderer.prototype.onPrerender=function(){this._flushId=0},AbstractBatchRenderer.prototype.render=function(element){element._texture.valid&&(this._vertexCount+element.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=element.vertexData.length/2,this._indexCount+=element.indices.length,this._bufferedTextures[this._bufferSize]=element._texture.baseTexture,this._bufferedElements[this._bufferSize++]=element)},AbstractBatchRenderer.prototype.buildTexturesAndDrawCalls=function(){var textures=this._bufferedTextures,MAX_TEXTURES=this.MAX_TEXTURES,textureArrays=AbstractBatchRenderer._textureArrayPool,batch=this.renderer.batch,boundTextures=this._tempBoundTextures,touch=this.renderer.textureGC.count,TICK=++BaseTexture._globalBatch,countTexArrays=0,texArray=textureArrays[0],start=0;batch.copyBoundTextures(boundTextures,MAX_TEXTURES);for(var i=0;i<this._bufferSize;++i){var tex=textures[i];textures[i]=null,tex._batchEnabled!==TICK&&(texArray.count>=MAX_TEXTURES&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start,i),start=i,texArray=textureArrays[++countTexArrays],++TICK),tex._batchEnabled=TICK,tex.touched=touch,texArray.elements[texArray.count++]=tex)}texArray.count>0&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start,this._bufferSize),++countTexArrays,++TICK);for(i=0;i<boundTextures.length;i++)boundTextures[i]=null;BaseTexture._globalBatch=TICK},AbstractBatchRenderer.prototype.buildDrawCalls=function(texArray,start,finish){var elements=this._bufferedElements,_attributeBuffer=this._attributeBuffer,_indexBuffer=this._indexBuffer,vertexSize=this.vertexSize,drawCalls=AbstractBatchRenderer._drawCallPool,dcIndex=this._dcIndex,aIndex=this._aIndex,iIndex=this._iIndex,drawCall=drawCalls[dcIndex];drawCall.start=this._iIndex,drawCall.texArray=texArray;for(var i=start;i<finish;++i){var sprite=elements[i],tex=sprite._texture.baseTexture,spriteBlendMode=premultiplyBlendMode[tex.alphaMode?1:0][sprite.blendMode];elements[i]=null,start<i&&drawCall.blend!==spriteBlendMode&&(drawCall.size=iIndex-drawCall.start,start=i,(drawCall=drawCalls[++dcIndex]).texArray=texArray,drawCall.start=iIndex),this.packInterleavedGeometry(sprite,_attributeBuffer,_indexBuffer,aIndex,iIndex),aIndex+=sprite.vertexData.length/2*vertexSize,iIndex+=sprite.indices.length,drawCall.blend=spriteBlendMode}start<finish&&(drawCall.size=iIndex-drawCall.start,++dcIndex),this._dcIndex=dcIndex,this._aIndex=aIndex,this._iIndex=iIndex},AbstractBatchRenderer.prototype.bindAndClearTexArray=function(texArray){for(var textureSystem=this.renderer.texture,j=0;j<texArray.count;j++)textureSystem.bind(texArray.elements[j],texArray.ids[j]),texArray.elements[j]=null;texArray.count=0},AbstractBatchRenderer.prototype.updateGeometry=function(){var packedGeometries=this._packedGeometries,attributeBuffer=this._attributeBuffer,indexBuffer=this._indexBuffer;settings.CAN_UPLOAD_SAME_BUFFER?(packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,packedGeometries[this._flushId]=new this.geometryClass),packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.bind(packedGeometries[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},AbstractBatchRenderer.prototype.drawBatches=function(){for(var dcCount=this._dcIndex,_a=this.renderer,gl=_a.gl,stateSystem=_a.state,drawCalls=AbstractBatchRenderer._drawCallPool,curTexArray=null,i=0;i<dcCount;i++){var _b=drawCalls[i],texArray=_b.texArray,type=_b.type,size=_b.size,start=_b.start,blend=_b.blend;curTexArray!==texArray&&(curTexArray=texArray,this.bindAndClearTexArray(texArray)),this.state.blendMode=blend,stateSystem.set(this.state),gl.drawElements(type,size,gl.UNSIGNED_SHORT,2*start)}},AbstractBatchRenderer.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},AbstractBatchRenderer.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},AbstractBatchRenderer.prototype.stop=function(){this.flush()},AbstractBatchRenderer.prototype.destroy=function(){for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),_super.prototype.destroy.call(this)},AbstractBatchRenderer.prototype.getAttributeBuffer=function(size){var roundedP2=nextPow2(Math.ceil(size/8)),roundedSizeIndex=log2(roundedP2),roundedSize=8*roundedP2;this._aBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._aBuffers[roundedSize];return buffer||(this._aBuffers[roundedSize]=buffer=new ViewableBuffer(roundedSize*this.vertexSize*4)),buffer},AbstractBatchRenderer.prototype.getIndexBuffer=function(size){var roundedP2=nextPow2(Math.ceil(size/12)),roundedSizeIndex=log2(roundedP2),roundedSize=12*roundedP2;this._iBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._iBuffers[roundedSizeIndex];return buffer||(this._iBuffers[roundedSizeIndex]=buffer=new Uint16Array(roundedSize)),buffer},AbstractBatchRenderer.prototype.packInterleavedGeometry=function(element,attributeBuffer,indexBuffer,aIndex,iIndex){for(var uint32View=attributeBuffer.uint32View,float32View=attributeBuffer.float32View,packedVertices=aIndex/this.vertexSize,uvs=element.uvs,indicies=element.indices,vertexData=element.vertexData,textureId=element._texture.baseTexture._batchLocation,alpha=Math.min(element.worldAlpha,1),argb=alpha<1&&element._texture.baseTexture.alphaMode?premultiplyTint(element._tintRGB,alpha):element._tintRGB+(255*alpha<<24),i=0;i<vertexData.length;i+=2)float32View[aIndex++]=vertexData[i],float32View[aIndex++]=vertexData[i+1],float32View[aIndex++]=uvs[i],float32View[aIndex++]=uvs[i+1],uint32View[aIndex++]=argb,float32View[aIndex++]=textureId;for(i=0;i<indicies.length;i++)indexBuffer[iIndex++]=packedVertices+indicies[i]},AbstractBatchRenderer._drawCallPool=[],AbstractBatchRenderer._textureArrayPool=[],AbstractBatchRenderer}(ObjectRenderer),BatchShaderGenerator=function(){function BatchShaderGenerator(vertexSrc,fragTemplate){if(this.vertexSrc=vertexSrc,this.fragTemplate=fragTemplate,this.programCache={},this.defaultGroupCache={},fragTemplate.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(fragTemplate.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return BatchShaderGenerator.prototype.generateShader=function(maxTextures){if(!this.programCache[maxTextures]){for(var sampleValues=new Int32Array(maxTextures),i=0;i<maxTextures;i++)sampleValues[i]=i;this.defaultGroupCache[maxTextures]=UniformGroup.from({uSamplers:sampleValues},!0);var fragmentSrc=this.fragTemplate;fragmentSrc=(fragmentSrc=fragmentSrc.replace(/%count%/gi,""+maxTextures)).replace(/%forloop%/gi,this.generateSampleSrc(maxTextures)),this.programCache[maxTextures]=new Program(this.vertexSrc,fragmentSrc)}var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[maxTextures]};return new Shader(this.programCache[maxTextures],uniforms)},BatchShaderGenerator.prototype.generateSampleSrc=function(maxTextures){var src="";src+="\n",src+="\n";for(var i=0;i<maxTextures;i++)i>0&&(src+="\nelse "),i<maxTextures-1&&(src+="if(vTextureId < "+i+".5)"),src+="\n{",src+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",src+="\n}";return src+="\n",src+="\n"},BatchShaderGenerator}(),BatchGeometry=function(_super){function BatchGeometry(_static){void 0===_static&&(_static=!1);var _this=_super.call(this)||this;return _this._buffer=new Buffer(null,_static,!1),_this._indexBuffer=new Buffer(null,_static,!0),_this.addAttribute("aVertexPosition",_this._buffer,2,!1,constants_TYPES.FLOAT).addAttribute("aTextureCoord",_this._buffer,2,!1,constants_TYPES.FLOAT).addAttribute("aColor",_this._buffer,4,!0,constants_TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",_this._buffer,1,!0,constants_TYPES.FLOAT).addIndex(_this._indexBuffer),_this}return core_extends(BatchGeometry,_super),BatchGeometry}(Geometry),defaultVertex$3="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",defaultFragment$2="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",BatchPluginFactory=function(){function BatchPluginFactory(){}return BatchPluginFactory.create=function(options){var _a=Object.assign({vertex:defaultVertex$3,fragment:defaultFragment$2,geometryClass:BatchGeometry,vertexSize:6},options),vertex=_a.vertex,fragment=_a.fragment,vertexSize=_a.vertexSize,geometryClass=_a.geometryClass;return function(_super){function BatchPlugin(renderer){var _this=_super.call(this,renderer)||this;return _this.shaderGenerator=new BatchShaderGenerator(vertex,fragment),_this.geometryClass=geometryClass,_this.vertexSize=vertexSize,_this}return core_extends(BatchPlugin,_super),BatchPlugin}(AbstractBatchRenderer)},Object.defineProperty(BatchPluginFactory,"defaultVertexSrc",{get:function(){return defaultVertex$3},enumerable:!1,configurable:!0}),Object.defineProperty(BatchPluginFactory,"defaultFragmentTemplate",{get:function(){return defaultFragment$2},enumerable:!1,configurable:!0}),BatchPluginFactory}(),BatchRenderer=BatchPluginFactory.create(),resources={},_loop_1=function(name){Object.defineProperty(resources,name,{get:function(){return deprecation("6.0.0","PIXI.systems."+name+" has moved to PIXI."+name),_resources[name]}})};for(var core_name in _resources)_loop_1(core_name);var systems={},_loop_2=function(name){Object.defineProperty(systems,name,{get:function(){return deprecation("6.0.0","PIXI.resources."+name+" has moved to PIXI."+name),_systems[name]}})};for(var core_name in _systems)_loop_2(core_name);var Application=function(){function Application(options){var _this=this;this.stage=new Container,options=Object.assign({forceCanvas:!1},options),this.renderer=autoDetectRenderer(options),Application._plugins.forEach((function(plugin){plugin.init.call(_this,options)}))}return Application.registerPlugin=function(plugin){Application._plugins.push(plugin)},Application.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(Application.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(Application.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),Application.prototype.destroy=function(removeView,stageOptions){var _this=this,plugins=Application._plugins.slice(0);plugins.reverse(),plugins.forEach((function(plugin){plugin.destroy.call(_this)})),this.stage.destroy(stageOptions),this.stage=null,this.renderer.destroy(removeView),this.renderer=null},Application._plugins=[],Application}(),ResizePlugin=function(){function ResizePlugin(){}return ResizePlugin.init=function(options){var _this=this;Object.defineProperty(this,"resizeTo",{set:function(dom){self.removeEventListener("resize",this.queueResize),this._resizeTo=dom,dom&&(self.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){_this._resizeTo&&(_this.cancelResize(),_this._resizeId=requestAnimationFrame((function(){return _this.resize()})))},this.cancelResize=function(){_this._resizeId&&(cancelAnimationFrame(_this._resizeId),_this._resizeId=null)},this.resize=function(){if(_this._resizeTo){var width,height;if(_this.cancelResize(),_this._resizeTo===self)width=self.innerWidth,height=self.innerHeight;else{var _a=_this._resizeTo;width=_a.clientWidth,height=_a.clientHeight}_this.renderer.resize(width,height)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=options.resizeTo||null},ResizePlugin.destroy=function(){self.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},ResizePlugin}();Application.registerPlugin(ResizePlugin);var TEMP_RECT=new Rectangle,Extract=function(){function Extract(renderer){this.renderer=renderer}return Extract.prototype.image=function(target,format,quality){var image=new Image;return image.src=this.base64(target,format,quality),image},Extract.prototype.base64=function(target,format,quality){return this.canvas(target).toDataURL(format,quality)},Extract.prototype.canvas=function(target){var resolution,frame,renderTexture,renderer=this.renderer,flipY=!1,generated=!1;target&&(target instanceof RenderTexture?renderTexture=target:(renderTexture=this.renderer.generateTexture(target),generated=!0)),renderTexture?(resolution=renderTexture.baseTexture.resolution,frame=renderTexture.frame,flipY=!1,renderer.renderTexture.bind(renderTexture)):(resolution=this.renderer.resolution,flipY=!0,(frame=TEMP_RECT).width=this.renderer.width,frame.height=this.renderer.height,renderer.renderTexture.bind(null));var width=Math.floor(frame.width*resolution+1e-4),height=Math.floor(frame.height*resolution+1e-4),canvasBuffer=new CanvasRenderTarget(width,height,1),webglPixels=new Uint8Array(4*width*height),gl=renderer.gl;gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels);var canvasData=canvasBuffer.context.getImageData(0,0,width,height);if(Extract.arrayPostDivide(webglPixels,canvasData.data),canvasBuffer.context.putImageData(canvasData,0,0),flipY){var target_1=new CanvasRenderTarget(canvasBuffer.width,canvasBuffer.height,1);target_1.context.scale(1,-1),target_1.context.drawImage(canvasBuffer.canvas,0,-height),canvasBuffer.destroy(),canvasBuffer=target_1}return generated&&renderTexture.destroy(!0),canvasBuffer.canvas},Extract.prototype.pixels=function(target){var resolution,frame,renderTexture,renderer=this.renderer,generated=!1;target&&(target instanceof RenderTexture?renderTexture=target:(renderTexture=this.renderer.generateTexture(target),generated=!0)),renderTexture?(resolution=renderTexture.baseTexture.resolution,frame=renderTexture.frame,renderer.renderTexture.bind(renderTexture)):(resolution=renderer.resolution,(frame=TEMP_RECT).width=renderer.width,frame.height=renderer.height,renderer.renderTexture.bind(null));var width=frame.width*resolution,height=frame.height*resolution,webglPixels=new Uint8Array(4*width*height),gl=renderer.gl;return gl.readPixels(frame.x*resolution,frame.y*resolution,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webglPixels),generated&&renderTexture.destroy(!0),Extract.arrayPostDivide(webglPixels,webglPixels),webglPixels},Extract.prototype.destroy=function(){this.renderer=null},Extract.arrayPostDivide=function(pixels,out){for(var i=0;i<pixels.length;i+=4){var alpha=out[i+3]=pixels[i+3];0!==alpha?(out[i]=Math.round(Math.min(255*pixels[i]/alpha,255)),out[i+1]=Math.round(Math.min(255*pixels[i+1]/alpha,255)),out[i+2]=Math.round(Math.min(255*pixels[i+2]/alpha,255))):(out[i]=pixels[i],out[i+1]=pixels[i+1],out[i+2]=pixels[i+2])}},Extract}(),SignalBinding=function(){function SignalBinding(fn,once,thisArg){void 0===once&&(once=!1),this._fn=fn,this._once=once,this._thisArg=thisArg,this._next=this._prev=this._owner=null}return SignalBinding.prototype.detach=function(){return null!==this._owner&&(this._owner.detach(this),!0)},SignalBinding}();function _addSignalBinding(self,node){return self._head?(self._tail._next=node,node._prev=self._tail,self._tail=node):(self._head=node,self._tail=node),node._owner=self,node}var Signal=function(){function Signal(){this._head=this._tail=void 0}return Signal.prototype.handlers=function(exists){void 0===exists&&(exists=!1);var node=this._head;if(exists)return!!node;for(var ee=[];node;)ee.push(node),node=node._next;return ee},Signal.prototype.has=function(node){if(!(node instanceof SignalBinding))throw new Error("MiniSignal#has(): First arg must be a SignalBinding object.");return node._owner===this},Signal.prototype.dispatch=function(){for(var arguments$1=arguments,args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments$1[_i];var node=this._head;if(!node)return!1;for(;node;)node._once&&this.detach(node),node._fn.apply(node._thisArg,args),node=node._next;return!0},Signal.prototype.add=function(fn,thisArg){if(void 0===thisArg&&(thisArg=null),"function"!=typeof fn)throw new Error("MiniSignal#add(): First arg must be a Function.");return _addSignalBinding(this,new SignalBinding(fn,!1,thisArg))},Signal.prototype.once=function(fn,thisArg){if(void 0===thisArg&&(thisArg=null),"function"!=typeof fn)throw new Error("MiniSignal#once(): First arg must be a Function.");return _addSignalBinding(this,new SignalBinding(fn,!0,thisArg))},Signal.prototype.detach=function(node){if(!(node instanceof SignalBinding))throw new Error("MiniSignal#detach(): First arg must be a SignalBinding object.");return node._owner!==this||(node._prev&&(node._prev._next=node._next),node._next&&(node._next._prev=node._prev),node===this._head?(this._head=node._next,null===node._next&&(this._tail=null)):node===this._tail&&(this._tail=node._prev,this._tail._next=null),node._owner=null),this},Signal.prototype.detachAll=function(){var node=this._head;if(!node)return this;for(this._head=this._tail=null;node;)node._owner=null,node=node._next;return this},Signal}();function parseUri(str,opts){opts=opts||{};for(var o={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser[opts.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,(function(_t0,t1,t2){t1&&(uri[o.q.name][t1]=t2)})),uri}var useXdr=!(!self.XDomainRequest||"withCredentials"in new XMLHttpRequest),loaders_tempAnchor=null;function _noop(){}function setExtMap(map,extname,val){extname&&0===extname.indexOf(".")&&(extname=extname.substring(1)),extname&&(map[extname]=val)}function reqType(xhr){return xhr.toString().replace("object ","")}var LoaderResource=function(){function LoaderResource(name,url,options){if(this._dequeue=_noop,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=null,this._boundOnError=null,this._boundOnProgress=null,this._boundOnTimeout=null,this._boundXhrOnError=null,this._boundXhrOnTimeout=null,this._boundXhrOnAbort=null,this._boundXhrOnLoad=null,"string"!=typeof name||"string"!=typeof url)throw new Error("Both name and url are required for constructing a resource.");options=options||{},this._flags=0,this._setFlag(LoaderResource.STATUS_FLAGS.DATA_URL,0===url.indexOf("data:")),this.name=name,this.url=url,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===options.crossOrigin?"anonymous":options.crossOrigin,this.timeout=options.timeout||0,this.loadType=options.loadType||this._determineLoadType(),this.xhrType=options.xhrType,this.metadata=options.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=LoaderResource.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=_noop,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Signal,this.onProgress=new Signal,this.onComplete=new Signal,this.onAfterMiddleware=new Signal}return LoaderResource.setExtensionLoadType=function(extname,loadType){setExtMap(LoaderResource._loadTypeMap,extname,loadType)},LoaderResource.setExtensionXhrType=function(extname,xhrType){setExtMap(LoaderResource._xhrTypeMap,extname,xhrType)},Object.defineProperty(LoaderResource.prototype,"isDataUrl",{get:function(){return this._hasFlag(LoaderResource.STATUS_FLAGS.DATA_URL)},enumerable:!1,configurable:!0}),Object.defineProperty(LoaderResource.prototype,"isComplete",{get:function(){return this._hasFlag(LoaderResource.STATUS_FLAGS.COMPLETE)},enumerable:!1,configurable:!0}),Object.defineProperty(LoaderResource.prototype,"isLoading",{get:function(){return this._hasFlag(LoaderResource.STATUS_FLAGS.LOADING)},enumerable:!1,configurable:!0}),LoaderResource.prototype.complete=function(){this._clearEvents(),this._finish()},LoaderResource.prototype.abort=function(message){if(!this.error){if(this.error=new Error(message),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=LoaderResource.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},LoaderResource.prototype.load=function(cb){var _this=this;if(!this.isLoading)if(this.isComplete)cb&&setTimeout((function(){return cb(_this)}),1);else switch(cb&&this.onComplete.once(cb),this._setFlag(LoaderResource.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case LoaderResource.LOAD_TYPE.IMAGE:this.type=LoaderResource.TYPE.IMAGE,this._loadElement("image");break;case LoaderResource.LOAD_TYPE.AUDIO:this.type=LoaderResource.TYPE.AUDIO,this._loadSourceElement("audio");break;case LoaderResource.LOAD_TYPE.VIDEO:this.type=LoaderResource.TYPE.VIDEO,this._loadSourceElement("video");break;case LoaderResource.LOAD_TYPE.XHR:default:useXdr&&this.crossOrigin?this._loadXdr():this._loadXhr()}},LoaderResource.prototype._hasFlag=function(flag){return 0!=(this._flags&flag)},LoaderResource.prototype._setFlag=function(flag,value){this._flags=value?this._flags|flag:this._flags&~flag},LoaderResource.prototype._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},LoaderResource.prototype._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(LoaderResource.STATUS_FLAGS.COMPLETE,!0),this._setFlag(LoaderResource.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},LoaderResource.prototype._loadElement=function(type){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===type&&void 0!==self.Image?this.data=new Image:this.data=document.createElement(type),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},LoaderResource.prototype._loadSourceElement=function(type){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===type&&void 0!==self.Audio?this.data=new Audio:this.data=document.createElement(type),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var mimeTypes=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(type,this.url[i],Array.isArray(mimeTypes)?mimeTypes[i]:mimeTypes));else{mimeTypes=this.metadata.mimeType;this.data.appendChild(this._createSource(type,this.url,Array.isArray(mimeTypes)?mimeTypes[0]:mimeTypes))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+type)},LoaderResource.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,!0),xhr.timeout=this.timeout,this.xhrType===LoaderResource.XHR_RESPONSE_TYPE.JSON||this.xhrType===LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT?xhr.responseType=LoaderResource.XHR_RESPONSE_TYPE.TEXT:xhr.responseType=this.xhrType,xhr.addEventListener("error",this._boundXhrOnError,!1),xhr.addEventListener("timeout",this._boundXhrOnTimeout,!1),xhr.addEventListener("abort",this._boundXhrOnAbort,!1),xhr.addEventListener("progress",this._boundOnProgress,!1),xhr.addEventListener("load",this._boundXhrOnLoad,!1),xhr.send()},LoaderResource.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var xdr=this.xhr=new self.XDomainRequest;xdr.timeout=this.timeout||5e3,xdr.onerror=this._boundXhrOnError,xdr.ontimeout=this._boundXhrOnTimeout,xdr.onprogress=this._boundOnProgress,xdr.onload=this._boundXhrOnLoad,xdr.open("GET",this.url,!0),setTimeout((function(){return xdr.send()}),1)},LoaderResource.prototype._createSource=function(type,url,mime){mime||(mime=type+"/"+this._getExtension(url));var source=document.createElement("source");return source.src=url,source.type=mime,source},LoaderResource.prototype._onError=function(event){this.abort("Failed to load element using: "+event.target.nodeName)},LoaderResource.prototype._onProgress=function(event){event&&event.lengthComputable&&this.onProgress.dispatch(this,event.loaded/event.total)},LoaderResource.prototype._onTimeout=function(){this.abort("Load timed out.")},LoaderResource.prototype._xhrOnError=function(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request failed. Status: "+xhr.status+', text: "'+xhr.statusText+'"')},LoaderResource.prototype._xhrOnTimeout=function(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request timed out.")},LoaderResource.prototype._xhrOnAbort=function(){var xhr=this.xhr;this.abort(reqType(xhr)+" Request was aborted by the user.")},LoaderResource.prototype._xhrOnLoad=function(){var xhr=this.xhr,text="",status=void 0===xhr.status?200:xhr.status;if(""!==xhr.responseType&&"text"!==xhr.responseType&&void 0!==xhr.responseType||(text=xhr.responseText),0===status&&(text.length>0||xhr.responseType===LoaderResource.XHR_RESPONSE_TYPE.BUFFER)?status=200:1223===status&&(status=204),2===(status/100|0)){if(this.xhrType===LoaderResource.XHR_RESPONSE_TYPE.TEXT)this.data=text,this.type=LoaderResource.TYPE.TEXT;else if(this.xhrType===LoaderResource.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(text),this.type=LoaderResource.TYPE.JSON}catch(e){return void this.abort("Error trying to parse loaded json: "+e)}else if(this.xhrType===LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT)try{if(self.DOMParser){var domparser=new DOMParser;this.data=domparser.parseFromString(text,"text/xml")}else{var div=document.createElement("div");div.innerHTML=text,this.data=div}this.type=LoaderResource.TYPE.XML}catch(e$1){return void this.abort("Error trying to parse loaded xml: "+e$1)}else this.data=xhr.response||text;this.complete()}else this.abort("["+xhr.status+"] "+xhr.statusText+": "+xhr.responseURL)},LoaderResource.prototype._determineCrossOrigin=function(url,loc){if(0===url.indexOf("data:"))return"";if(self.origin!==self.location.origin)return"anonymous";loc=loc||self.location,loaders_tempAnchor||(loaders_tempAnchor=document.createElement("a")),loaders_tempAnchor.href=url;var parsedUrl=parseUri(loaders_tempAnchor.href,{strictMode:!0}),samePort=!parsedUrl.port&&""===loc.port||parsedUrl.port===loc.port,protocol=parsedUrl.protocol?parsedUrl.protocol+":":"";return parsedUrl.host===loc.hostname&&samePort&&protocol===loc.protocol?"":"anonymous"},LoaderResource.prototype._determineXhrType=function(){return LoaderResource._xhrTypeMap[this.extension]||LoaderResource.XHR_RESPONSE_TYPE.TEXT},LoaderResource.prototype._determineLoadType=function(){return LoaderResource._loadTypeMap[this.extension]||LoaderResource.LOAD_TYPE.XHR},LoaderResource.prototype._getExtension=function(url){void 0===url&&(url=this.url);var ext="";if(this.isDataUrl){var slashIndex=url.indexOf("/");ext=url.substring(slashIndex+1,url.indexOf(";",slashIndex))}else{var queryStart=url.indexOf("?"),hashStart=url.indexOf("#"),index=Math.min(queryStart>-1?queryStart:url.length,hashStart>-1?hashStart:url.length);ext=(url=url.substring(0,index)).substring(url.lastIndexOf(".")+1)}return ext.toLowerCase()},LoaderResource.prototype._getMimeFromXhrType=function(type){switch(type){case LoaderResource.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case LoaderResource.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case LoaderResource.XHR_RESPONSE_TYPE.JSON:return"application/json";case LoaderResource.XHR_RESPONSE_TYPE.DEFAULT:case LoaderResource.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},LoaderResource}();function _noop$1(){}function onlyOnce(fn){return function(){for(var arguments$1=arguments,args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments$1[_i];if(null===fn)throw new Error("Callback was already called.");var callFn=fn;fn=null,callFn.apply(this,args)}}!function(LoaderResource){!function(STATUS_FLAGS){STATUS_FLAGS[STATUS_FLAGS.NONE=0]="NONE",STATUS_FLAGS[STATUS_FLAGS.DATA_URL=1]="DATA_URL",STATUS_FLAGS[STATUS_FLAGS.COMPLETE=2]="COMPLETE",STATUS_FLAGS[STATUS_FLAGS.LOADING=4]="LOADING"}(LoaderResource.STATUS_FLAGS||(LoaderResource.STATUS_FLAGS={})),function(TYPE){TYPE[TYPE.UNKNOWN=0]="UNKNOWN",TYPE[TYPE.JSON=1]="JSON",TYPE[TYPE.XML=2]="XML",TYPE[TYPE.IMAGE=3]="IMAGE",TYPE[TYPE.AUDIO=4]="AUDIO",TYPE[TYPE.VIDEO=5]="VIDEO",TYPE[TYPE.TEXT=6]="TEXT"}(LoaderResource.TYPE||(LoaderResource.TYPE={})),function(LOAD_TYPE){LOAD_TYPE[LOAD_TYPE.XHR=1]="XHR",LOAD_TYPE[LOAD_TYPE.IMAGE=2]="IMAGE",LOAD_TYPE[LOAD_TYPE.AUDIO=3]="AUDIO",LOAD_TYPE[LOAD_TYPE.VIDEO=4]="VIDEO"}(LoaderResource.LOAD_TYPE||(LoaderResource.LOAD_TYPE={})),function(XHR_RESPONSE_TYPE){XHR_RESPONSE_TYPE.DEFAULT="text",XHR_RESPONSE_TYPE.BUFFER="arraybuffer",XHR_RESPONSE_TYPE.BLOB="blob",XHR_RESPONSE_TYPE.DOCUMENT="document",XHR_RESPONSE_TYPE.JSON="json",XHR_RESPONSE_TYPE.TEXT="text"}(LoaderResource.XHR_RESPONSE_TYPE||(LoaderResource.XHR_RESPONSE_TYPE={})),LoaderResource._loadTypeMap={gif:LoaderResource.LOAD_TYPE.IMAGE,png:LoaderResource.LOAD_TYPE.IMAGE,bmp:LoaderResource.LOAD_TYPE.IMAGE,jpg:LoaderResource.LOAD_TYPE.IMAGE,jpeg:LoaderResource.LOAD_TYPE.IMAGE,tif:LoaderResource.LOAD_TYPE.IMAGE,tiff:LoaderResource.LOAD_TYPE.IMAGE,webp:LoaderResource.LOAD_TYPE.IMAGE,tga:LoaderResource.LOAD_TYPE.IMAGE,svg:LoaderResource.LOAD_TYPE.IMAGE,"svg+xml":LoaderResource.LOAD_TYPE.IMAGE,mp3:LoaderResource.LOAD_TYPE.AUDIO,ogg:LoaderResource.LOAD_TYPE.AUDIO,wav:LoaderResource.LOAD_TYPE.AUDIO,mp4:LoaderResource.LOAD_TYPE.VIDEO,webm:LoaderResource.LOAD_TYPE.VIDEO},LoaderResource._xhrTypeMap={xhtml:LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT,html:LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT,htm:LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT,xml:LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT,tmx:LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT,svg:LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT,tsx:LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT,gif:LoaderResource.XHR_RESPONSE_TYPE.BLOB,png:LoaderResource.XHR_RESPONSE_TYPE.BLOB,bmp:LoaderResource.XHR_RESPONSE_TYPE.BLOB,jpg:LoaderResource.XHR_RESPONSE_TYPE.BLOB,jpeg:LoaderResource.XHR_RESPONSE_TYPE.BLOB,tif:LoaderResource.XHR_RESPONSE_TYPE.BLOB,tiff:LoaderResource.XHR_RESPONSE_TYPE.BLOB,webp:LoaderResource.XHR_RESPONSE_TYPE.BLOB,tga:LoaderResource.XHR_RESPONSE_TYPE.BLOB,json:LoaderResource.XHR_RESPONSE_TYPE.JSON,text:LoaderResource.XHR_RESPONSE_TYPE.TEXT,txt:LoaderResource.XHR_RESPONSE_TYPE.TEXT,ttf:LoaderResource.XHR_RESPONSE_TYPE.BUFFER,otf:LoaderResource.XHR_RESPONSE_TYPE.BUFFER},LoaderResource.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="}(LoaderResource||(LoaderResource={}));var AsyncQueueItem=function(data,callback){this.data=data,this.callback=callback},AsyncQueue=function(){function AsyncQueue(worker,concurrency){var _this=this;if(void 0===concurrency&&(concurrency=1),this.workers=0,this.saturated=_noop$1,this.unsaturated=_noop$1,this.empty=_noop$1,this.drain=_noop$1,this.error=_noop$1,this.started=!1,this.paused=!1,this._tasks=[],this._insert=function(data,insertAtFront,callback){if(callback&&"function"!=typeof callback)throw new Error("task callback must be a function");if(_this.started=!0,null==data&&_this.idle())setTimeout((function(){return _this.drain()}),1);else{var item=new AsyncQueueItem(data,"function"==typeof callback?callback:_noop$1);insertAtFront?_this._tasks.unshift(item):_this._tasks.push(item),setTimeout(_this.process,1)}},this.process=function(){for(;!_this.paused&&_this.workers<_this.concurrency&&_this._tasks.length;){var task=_this._tasks.shift();0===_this._tasks.length&&_this.empty(),_this.workers+=1,_this.workers===_this.concurrency&&_this.saturated(),_this._worker(task.data,onlyOnce(_this._next(task)))}},this._worker=worker,0===concurrency)throw new Error("Concurrency must not be zero");this.concurrency=concurrency,this.buffer=concurrency/4}return AsyncQueue.prototype._next=function(task){var _this=this;return function(){for(var arguments$1=arguments,args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments$1[_i];_this.workers-=1,task.callback.apply(task,args),null!=args[0]&&_this.error(args[0],task.data),_this.workers<=_this.concurrency-_this.buffer&&_this.unsaturated(),_this.idle()&&_this.drain(),_this.process()}},AsyncQueue.prototype.push=function(data,callback){this._insert(data,!1,callback)},AsyncQueue.prototype.kill=function(){this.workers=0,this.drain=_noop$1,this.started=!1,this._tasks=[]},AsyncQueue.prototype.unshift=function(data,callback){this._insert(data,!0,callback)},AsyncQueue.prototype.length=function(){return this._tasks.length},AsyncQueue.prototype.running=function(){return this.workers},AsyncQueue.prototype.idle=function(){return this._tasks.length+this.workers===0},AsyncQueue.prototype.pause=function(){!0!==this.paused&&(this.paused=!0)},AsyncQueue.prototype.resume=function(){if(!1!==this.paused){this.paused=!1;for(var w=1;w<=this.concurrency;w++)this.process()}},AsyncQueue.eachSeries=function(array,iterator,callback,deferNext){var i=0,len=array.length;!function next(err){err||i===len?callback&&callback(err):deferNext?setTimeout((function(){iterator(array[i++],next)}),1):iterator(array[i++],next)}()},AsyncQueue.queue=function(worker,concurrency){return new AsyncQueue(worker,concurrency)},AsyncQueue}(),rgxExtractUrlHash=/(#[\w-]+)?$/,Loader=function(){function Loader(baseUrl,concurrency){var _this=this;void 0===baseUrl&&(baseUrl=""),void 0===concurrency&&(concurrency=10),this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(r,d){return _this._loadResource(r,d)},this.resources={},this.baseUrl=baseUrl,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(r,d){return _this._loadResource(r,d)},this._queue=AsyncQueue.queue(this._boundLoadResource,concurrency),this._queue.pause(),this.resources={},this.onProgress=new Signal,this.onError=new Signal,this.onLoad=new Signal,this.onStart=new Signal,this.onComplete=new Signal;for(var i=0;i<Loader._plugins.length;++i){var plugin=Loader._plugins[i],pre=plugin.pre,use=plugin.use;pre&&this.pre(pre),use&&this.use(use)}this._protected=!1}return Loader.prototype._add=function(name,url,options,callback){if(this.loading&&(!options||!options.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[name])throw new Error('Resource named "'+name+'" already exists.');if(url=this._prepareUrl(url),this.resources[name]=new LoaderResource(name,url,options),"function"==typeof callback&&this.resources[name].onAfterMiddleware.once(callback),this.loading){for(var parent=options.parentResource,incompleteChildren=[],i=0;i<parent.children.length;++i)parent.children[i].isComplete||incompleteChildren.push(parent.children[i]);var eachChunk=parent.progressChunk*(incompleteChildren.length+1)/(incompleteChildren.length+2);parent.children.push(this.resources[name]),parent.progressChunk=eachChunk;for(i=0;i<incompleteChildren.length;++i)incompleteChildren[i].progressChunk=eachChunk;this.resources[name].progressChunk=eachChunk}return this._queue.push(this.resources[name]),this},Loader.prototype.pre=function(fn){return this._beforeMiddleware.push(fn),this},Loader.prototype.use=function(fn){return this._afterMiddleware.push(fn),this},Loader.prototype.reset=function(){for(var k in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var res=this.resources[k];res._onLoadBinding&&res._onLoadBinding.detach(),res.isLoading&&res.abort("loader reset")}return this.resources={},this},Loader.prototype.load=function(cb){if("function"==typeof cb&&this.onComplete.once(cb),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var chunk=100/this._queue._tasks.length,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=chunk;this._onStart(),this._queue.resume()}return this},Object.defineProperty(Loader.prototype,"concurrency",{get:function(){return this._queue.concurrency},set:function(concurrency){this._queue.concurrency=concurrency},enumerable:!1,configurable:!0}),Loader.prototype._prepareUrl=function(url){var result,parsedUrl=parseUri(url,{strictMode:!0});if(result=parsedUrl.protocol||!parsedUrl.path||0===url.indexOf("//")?url:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==url.charAt(0)?this.baseUrl+"/"+url:this.baseUrl+url,this.defaultQueryString){var hash=rgxExtractUrlHash.exec(result)[0];-1!==(result=result.substr(0,result.length-hash.length)).indexOf("?")?result+="&"+this.defaultQueryString:result+="?"+this.defaultQueryString,result+=hash}return result},Loader.prototype._loadResource=function(resource,dequeue){var _this=this;resource._dequeue=dequeue,AsyncQueue.eachSeries(this._beforeMiddleware,(function(fn,next){fn.call(_this,resource,(function(){next(resource.isComplete?{}:null)}))}),(function(){resource.isComplete?_this._onLoad(resource):(resource._onLoadBinding=resource.onComplete.once(_this._onLoad,_this),resource.load())}),!0)},Loader.prototype._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},Loader.prototype._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},Loader.prototype._onLoad=function(resource){var _this=this;resource._onLoadBinding=null,this._resourcesParsing.push(resource),resource._dequeue(),AsyncQueue.eachSeries(this._afterMiddleware,(function(fn,next){fn.call(_this,resource,next)}),(function(){resource.onAfterMiddleware.dispatch(resource),_this.progress=Math.min(100,_this.progress+resource.progressChunk),_this.onProgress.dispatch(_this,resource),resource.error?_this.onError.dispatch(resource.error,_this,resource):_this.onLoad.dispatch(_this,resource),_this._resourcesParsing.splice(_this._resourcesParsing.indexOf(resource),1),_this._queue.idle()&&0===_this._resourcesParsing.length&&_this._onComplete()}),!0)},Loader.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(Loader,"shared",{get:function(){var shared=Loader._shared;return shared||((shared=new Loader)._protected=!0,Loader._shared=shared),shared},enumerable:!1,configurable:!0}),Loader.registerPlugin=function(plugin){return Loader._plugins.push(plugin),plugin.add&&plugin.add(),Loader},Loader._plugins=[],Loader}();Loader.prototype.add=function(name,url,options,callback){if(Array.isArray(name)){for(var i=0;i<name.length;++i)this.add(name[i]);return this}if("object"==typeof name&&(options=name,callback=url||options.callback||options.onComplete,url=options.url,name=options.name||options.key||options.url),"string"!=typeof url&&(callback=options,options=url,url=name),"string"!=typeof url)throw new Error("No url passed to add resource to loader.");return"function"==typeof options&&(callback=options,options=null),this._add(name,url,options,callback)};var AppLoaderPlugin=function(){function AppLoaderPlugin(){}return AppLoaderPlugin.init=function(options){options=Object.assign({sharedLoader:!1},options),this.loader=options.sharedLoader?Loader.shared:new Loader},AppLoaderPlugin.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},AppLoaderPlugin}(),TextureLoader=function(){function TextureLoader(){}return TextureLoader.add=function(){LoaderResource.setExtensionLoadType("svg",LoaderResource.LOAD_TYPE.XHR),LoaderResource.setExtensionXhrType("svg",LoaderResource.XHR_RESPONSE_TYPE.TEXT)},TextureLoader.use=function(resource,next){if(!resource.data||resource.type!==LoaderResource.TYPE.IMAGE&&"svg"!==resource.extension)next();else{var data=resource.data,url=resource.url,name=resource.name,metadata=resource.metadata;Texture.fromLoader(data,url,name,metadata).then((function(texture){resource.texture=texture,next()})).catch(next)}},TextureLoader}();var _a,INTERNAL_FORMATS,Url=self.URL||self.webkitURL;Loader.registerPlugin({use:function(resource,next){if(resource.data){if(resource.xhr&&resource.xhrType===LoaderResource.XHR_RESPONSE_TYPE.BLOB)if(self.Blob&&"string"!=typeof resource.data){if(0===resource.data.type.indexOf("image")){var src_1=Url.createObjectURL(resource.data);return resource.blob=resource.data,resource.data=new Image,resource.data.src=src_1,resource.type=LoaderResource.TYPE.IMAGE,void(resource.data.onload=function(){Url.revokeObjectURL(src_1),resource.data.onload=null,next()})}}else{var type=resource.xhr.getResponseHeader("content-type");if(type&&0===type.indexOf("image"))return resource.data=new Image,resource.data.src="data:"+type+";base64,"+function(input){for(var output="",inx=0;inx<input.length;){for(var bytebuffer=[0,0,0],encodedCharIndexes=[0,0,0,0],jnx=0;jnx<bytebuffer.length;++jnx)inx<input.length?bytebuffer[jnx]=255&input.charCodeAt(inx++):bytebuffer[jnx]=0;switch(encodedCharIndexes[0]=bytebuffer[0]>>2,encodedCharIndexes[1]=(3&bytebuffer[0])<<4|bytebuffer[1]>>4,encodedCharIndexes[2]=(15&bytebuffer[1])<<2|bytebuffer[2]>>6,encodedCharIndexes[3]=63&bytebuffer[2],inx-(input.length-1)){case 2:encodedCharIndexes[3]=64,encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64}for(jnx=0;jnx<encodedCharIndexes.length;++jnx)output+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(encodedCharIndexes[jnx])}return output}(resource.xhr.responseText),resource.type=LoaderResource.TYPE.IMAGE,void(resource.data.onload=function(){resource.data.onload=null,next()})}next()}else next()}}),Loader.registerPlugin(TextureLoader),function(INTERNAL_FORMATS){INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",INTERNAL_FORMATS[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"}(INTERNAL_FORMATS||(INTERNAL_FORMATS={}));var INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=((_a={})[INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,_a[INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,_a[INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,_a[INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,_a),compressed_textures_extendStatics=function(d,b){return compressed_textures_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},compressed_textures_extendStatics(d,b)};function compressed_textures_extends(d,b){function __(){this.constructor=d}compressed_textures_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var _a$1,_b,BlobResource=function(_super){function BlobResource(source,options){void 0===options&&(options={width:1,height:1,autoLoad:!0});var origin,data,_this=this;return"string"==typeof source?(origin=source,data=new Uint8Array):(origin=null,data=source),(_this=_super.call(this,data,options)||this).origin=origin,_this.buffer=data?new ViewableBuffer(data):null,_this.origin&&!1!==options.autoLoad&&_this.load(),data&&data.length&&(_this.loaded=!0,_this.onBlobLoaded(_this.buffer.rawBinaryData)),_this}return compressed_textures_extends(BlobResource,_super),BlobResource.prototype.onBlobLoaded=function(_data){},BlobResource.prototype.load=function(){return thisArg=this,_arguments=void 0,generator=function(){var arrayBuffer;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,fetch(this.origin)];case 1:return[4,_a.sent().blob()];case 2:return[4,_a.sent().arrayBuffer()];case 3:return arrayBuffer=_a.sent(),this.data=new Uint32Array(arrayBuffer),this.buffer=new ViewableBuffer(arrayBuffer),this.loaded=!0,this.onBlobLoaded(arrayBuffer),this.update(),[2,this]}}))},new((P=Promise)||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P((function(resolve){resolve(result.value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}));var thisArg,_arguments,P,generator},BlobResource}(BufferResource),CompressedTextureResource=function(_super){function CompressedTextureResource(source,options){var _this=_super.call(this,source,options)||this;return _this.format=options.format,_this.levels=options.levels||1,_this._width=options.width,_this._height=options.height,_this._extension=CompressedTextureResource._formatToExtension(_this.format),(options.levelBuffers||_this.buffer)&&(_this._levelBuffers=options.levelBuffers||CompressedTextureResource._createLevelBuffers(source instanceof Uint8Array?source:_this.buffer.uint8View,_this.format,_this.levels,4,4,_this.width,_this.height)),_this}return compressed_textures_extends(CompressedTextureResource,_super),CompressedTextureResource.prototype.upload=function(renderer,_texture,_glTexture){var gl=renderer.gl;if(!renderer.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var i=0,j=this.levels;i<j;i++){var _a=this._levelBuffers[i],levelID=_a.levelID,levelWidth=_a.levelWidth,levelHeight=_a.levelHeight,levelBuffer=_a.levelBuffer;gl.compressedTexImage2D(gl.TEXTURE_2D,levelID,this.format,levelWidth,levelHeight,0,levelBuffer)}return!0},CompressedTextureResource.prototype.onBlobLoaded=function(){this._levelBuffers=CompressedTextureResource._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},CompressedTextureResource._formatToExtension=function(format){if(format>=33776&&format<=33779)return"s3tc";if(format>=37488&&format<=37497)return"etc";if(format>=35840&&format<=35843)return"pvrtc";if(format>=36196)return"etc1";if(format>=35986&&format<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},CompressedTextureResource._createLevelBuffers=function(buffer,format,levels,blockWidth,blockHeight,imageWidth,imageHeight){for(var buffers=new Array(levels),offset=buffer.byteOffset,levelWidth=imageWidth,levelHeight=imageHeight,alignedLevelWidth=levelWidth+blockWidth-1&~(blockWidth-1),alignedLevelHeight=levelHeight+blockHeight-1&~(blockHeight-1),levelSize=alignedLevelWidth*alignedLevelHeight*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[format],i=0;i<levels;i++)buffers[i]={levelID:i,levelWidth:levels>1?levelWidth:alignedLevelWidth,levelHeight:levels>1?levelHeight:alignedLevelHeight,levelBuffer:new Uint8Array(buffer.buffer,offset,levelSize)},offset+=levelSize,levelSize=(alignedLevelWidth=(levelWidth=levelWidth>>1||1)+blockWidth-1&~(blockWidth-1))*(alignedLevelHeight=(levelHeight=levelHeight>>1||1)+blockHeight-1&~(blockHeight-1))*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[format];return buffers},CompressedTextureResource}(BlobResource),CompressedTextureLoader=function(){function CompressedTextureLoader(){}return CompressedTextureLoader.use=function(resource,next){var data=resource.data;if(resource.type===LoaderResource.TYPE.JSON&&data&&data.cacheID&&data.textures){for(var textures=data.textures,textureURL=void 0,fallbackURL=void 0,i=0,j=textures.length;i<j;i++){var texture=textures[i],url_1=texture.src,format=texture.format;if(format||(fallbackURL=url_1),CompressedTextureLoader.textureFormats[format]){textureURL=url_1;break}}if(!(textureURL=textureURL||fallbackURL))return void next(new Error("Cannot load compressed-textures in "+resource.url+", make sure you provide a fallback"));if(textureURL===resource.url)return void next(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var loadOptions={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata,parentResource:resource},resourcePath=utils_url.resolve(resource.url.replace(this.baseUrl,""),textureURL),resourceName=data.cacheID;this.add(resourceName,resourcePath,loadOptions,(function(res){if(res.error)next(res.error);else{var _a=res.texture,texture=void 0===_a?null:_a,_b=res.textures,textures=void 0===_b?{}:_b;Object.assign(resource,{texture,textures}),next()}}))}else next()},CompressedTextureLoader.add=function(){var gl=document.createElement("canvas").getContext("webgl");if(gl){var extensions={s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};for(var extensionName in CompressedTextureLoader.textureExtensions=extensions,CompressedTextureLoader.textureFormats={},extensions){var extension=extensions[extensionName];extension&&Object.assign(CompressedTextureLoader.textureFormats,Object.getPrototypeOf(extension))}}else console.warn("WebGL not available for compressed textures. Silently failing.")},CompressedTextureLoader}();function registerCompressedTextures(url,resources,metadata){var result={textures:{},texture:null};return resources?(resources.map((function(resource){return new Texture(new BaseTexture(resource,Object.assign({mipmap:constants_MIPMAP_MODES.OFF,alphaMode:constants_ALPHA_MODES.NO_PREMULTIPLIED_ALPHA},metadata)))})).forEach((function(texture,i){var baseTexture=texture.baseTexture,cacheID=url+"-"+(i+1);BaseTexture.addToCache(baseTexture,cacheID),Texture.addToCache(texture,cacheID),0===i&&(BaseTexture.addToCache(baseTexture,url),Texture.addToCache(texture,url),result.texture=texture),result.textures[cacheID]=texture})),result):result}LoaderResource.setExtensionXhrType("dds",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var DXGI_FORMAT,D3D10_RESOURCE_DIMENSION,DDS_FIELDS_HEIGHT=3,DDS_FIELDS_WIDTH=4,DDS_FIELDS_MIPMAP_COUNT=7,DDS_FIELDS_PIXEL_FORMAT=19,DDS_PF_FIELDS_FOURCC=2,DDS_DX10_FIELDS_DXGI_FORMAT=0,DDS_DX10_FIELDS_RESOURCE_DIMENSION=1,DDS_DX10_FIELDS_MISC_FLAG=2,DDS_DX10_FIELDS_ARRAY_SIZE=3;!function(DXGI_FORMAT){DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",DXGI_FORMAT[DXGI_FORMAT.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"}(DXGI_FORMAT||(DXGI_FORMAT={})),function(D3D10_RESOURCE_DIMENSION){D3D10_RESOURCE_DIMENSION[D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",D3D10_RESOURCE_DIMENSION[D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",D3D10_RESOURCE_DIMENSION[D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"}(D3D10_RESOURCE_DIMENSION||(D3D10_RESOURCE_DIMENSION={}));var _a$2,_b$1,_c,FOURCC_TO_FORMAT=((_a$1={})[827611204]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_a$1[861165636]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_a$1[894720068]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_a$1),DXGI_TO_FORMAT=((_b={})[DXGI_FORMAT.DXGI_FORMAT_BC1_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_TYPELESS]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM]=INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM_SRGB]=INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,_b),DDSLoader=function(){function DDSLoader(){}return DDSLoader.use=function(resource,next){if("dds"===resource.extension&&resource.data)try{Object.assign(resource,registerCompressedTextures(resource.name||resource.url,DDSLoader.parse(resource.data),resource.metadata))}catch(err){return void next(err)}next()},DDSLoader.parse=function(arrayBuffer){var data=new Uint32Array(arrayBuffer);if(542327876!==data[0])throw new Error("Invalid DDS file magic word");var header=new Uint32Array(arrayBuffer,0,124/Uint32Array.BYTES_PER_ELEMENT),height=header[DDS_FIELDS_HEIGHT],width=header[DDS_FIELDS_WIDTH],mipmapCount=header[DDS_FIELDS_MIPMAP_COUNT],pixelFormat=new Uint32Array(arrayBuffer,DDS_FIELDS_PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),formatFlags=pixelFormat[1];if(4&formatFlags){var fourCC=pixelFormat[DDS_PF_FIELDS_FOURCC];if(808540228!==fourCC){var internalFormat_1=FOURCC_TO_FORMAT[fourCC],texData=new Uint8Array(arrayBuffer,128);return[new CompressedTextureResource(texData,{format:internalFormat_1,width,height,levels:mipmapCount})]}var dx10Header=new Uint32Array(data.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),dxgiFormat=dx10Header[DDS_DX10_FIELDS_DXGI_FORMAT],resourceDimension=dx10Header[DDS_DX10_FIELDS_RESOURCE_DIMENSION],miscFlag=dx10Header[DDS_DX10_FIELDS_MISC_FLAG],arraySize=dx10Header[DDS_DX10_FIELDS_ARRAY_SIZE],internalFormat_2=DXGI_TO_FORMAT[dxgiFormat];if(void 0===internalFormat_2)throw new Error("DDSLoader cannot parse texture data with DXGI format "+dxgiFormat);if(4===miscFlag)throw new Error("DDSLoader does not support cubemap textures");if(resourceDimension===D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var imageBuffers=new Array;if(1===arraySize)imageBuffers.push(new Uint8Array(arrayBuffer,148));else{for(var pixelSize=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[internalFormat_2],imageSize=0,levelWidth=width,levelHeight=height,i=0;i<mipmapCount;i++){imageSize+=Math.max(1,levelWidth+3&-4)*Math.max(1,levelHeight+3&-4)*pixelSize,levelWidth>>>=1,levelHeight>>>=1}var imageOffset=148;for(i=0;i<arraySize;i++)imageBuffers.push(new Uint8Array(arrayBuffer,imageOffset,imageSize)),imageOffset+=imageSize}return imageBuffers.map((function(buffer){return new CompressedTextureResource(buffer,{format:internalFormat_2,width,height,levels:mipmapCount})}))}if(64&formatFlags)throw new Error("DDSLoader does not support uncompressed texture data.");if(512&formatFlags)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(131072&formatFlags)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(2&formatFlags)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},DDSLoader}();LoaderResource.setExtensionXhrType("ktx",LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],KTX_FIELDS_ENDIANNESS=12,KTX_FIELDS_GL_TYPE=16,KTX_FIELDS_GL_FORMAT=24,KTX_FIELDS_GL_INTERNAL_FORMAT=28,KTX_FIELDS_PIXEL_WIDTH=36,KTX_FIELDS_PIXEL_HEIGHT=40,KTX_FIELDS_PIXEL_DEPTH=44,KTX_FIELDS_NUMBER_OF_ARRAY_ELEMENTS=48,KTX_FIELDS_NUMBER_OF_FACES=52,KTX_FIELDS_NUMBER_OF_MIPMAP_LEVELS=56,KTX_FIELDS_BYTES_OF_KEY_VALUE_DATA=60,TYPES_TO_BYTES_PER_COMPONENT=((_a$2={})[constants_TYPES.UNSIGNED_BYTE]=1,_a$2[constants_TYPES.UNSIGNED_SHORT]=2,_a$2[constants_TYPES.FLOAT]=4,_a$2[constants_TYPES.HALF_FLOAT]=8,_a$2),FORMATS_TO_COMPONENTS=((_b$1={})[constants_FORMATS.RGBA]=4,_b$1[constants_FORMATS.RGB]=3,_b$1[constants_FORMATS.LUMINANCE]=1,_b$1[constants_FORMATS.LUMINANCE_ALPHA]=2,_b$1[constants_FORMATS.ALPHA]=1,_b$1),TYPES_TO_BYTES_PER_PIXEL=((_c={})[constants_TYPES.UNSIGNED_SHORT_4_4_4_4]=2,_c[constants_TYPES.UNSIGNED_SHORT_5_5_5_1]=2,_c[constants_TYPES.UNSIGNED_SHORT_5_6_5]=2,_c),KTXLoader=function(){function KTXLoader(){}return KTXLoader.use=function(resource,next){if("ktx"===resource.extension&&resource.data)try{var url=resource.name||resource.url;Object.assign(resource,registerCompressedTextures(url,KTXLoader.parse(url,resource.data),resource.metadata))}catch(err){return void next(err)}next()},KTXLoader.parse=function(url,arrayBuffer){var dataView=new DataView(arrayBuffer);if(!KTXLoader.validate(url,dataView))return null;var littleEndian=67305985===dataView.getUint32(KTX_FIELDS_ENDIANNESS,!0),glType=dataView.getUint32(KTX_FIELDS_GL_TYPE,littleEndian),glFormat=dataView.getUint32(KTX_FIELDS_GL_FORMAT,littleEndian),glInternalFormat=dataView.getUint32(KTX_FIELDS_GL_INTERNAL_FORMAT,littleEndian),pixelWidth=dataView.getUint32(KTX_FIELDS_PIXEL_WIDTH,littleEndian),pixelHeight=dataView.getUint32(KTX_FIELDS_PIXEL_HEIGHT,littleEndian)||1,pixelDepth=dataView.getUint32(KTX_FIELDS_PIXEL_DEPTH,littleEndian)||1,numberOfArrayElements=dataView.getUint32(KTX_FIELDS_NUMBER_OF_ARRAY_ELEMENTS,littleEndian)||1,numberOfFaces=dataView.getUint32(KTX_FIELDS_NUMBER_OF_FACES,littleEndian),numberOfMipmapLevels=dataView.getUint32(KTX_FIELDS_NUMBER_OF_MIPMAP_LEVELS,littleEndian),bytesOfKeyValueData=dataView.getUint32(KTX_FIELDS_BYTES_OF_KEY_VALUE_DATA,littleEndian);if(0===pixelHeight||1!==pixelDepth)throw new Error("Only 2D textures are supported");if(1!==numberOfFaces)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==numberOfArrayElements)throw new Error("WebGL does not support array textures");var imagePixelByteSize,alignedWidth=pixelWidth+3&-4,alignedHeight=pixelHeight+3&-4,imageBuffers=new Array(numberOfArrayElements),imagePixels=pixelWidth*pixelHeight;if(0===glType&&(imagePixels=alignedWidth*alignedHeight),void 0===(imagePixelByteSize=0!==glType?TYPES_TO_BYTES_PER_COMPONENT[glType]?TYPES_TO_BYTES_PER_COMPONENT[glType]*FORMATS_TO_COMPONENTS[glFormat]:TYPES_TO_BYTES_PER_PIXEL[glType]:INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[glInternalFormat]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var mipByteSize=imagePixels*imagePixelByteSize,mipWidth=pixelWidth,mipHeight=pixelHeight,alignedMipWidth=alignedWidth,alignedMipHeight=alignedHeight,imageOffset=64+bytesOfKeyValueData,mipmapLevel=0;mipmapLevel<numberOfMipmapLevels;mipmapLevel++){for(var imageSize=dataView.getUint32(imageOffset,littleEndian),elementOffset=imageOffset+4,arrayElement=0;arrayElement<numberOfArrayElements;arrayElement++){var mips=imageBuffers[arrayElement];mips||(mips=imageBuffers[arrayElement]=new Array(numberOfMipmapLevels)),mips[mipmapLevel]={levelID:mipmapLevel,levelWidth:numberOfMipmapLevels>1?mipWidth:alignedMipWidth,levelHeight:numberOfMipmapLevels>1?mipHeight:alignedMipHeight,levelBuffer:new Uint8Array(arrayBuffer,elementOffset,mipByteSize)},elementOffset+=mipByteSize}imageOffset=(imageOffset+=imageSize+4)%4!=0?imageOffset+4-imageOffset%4:imageOffset,mipByteSize=(alignedMipWidth=(mipWidth=mipWidth>>1||1)+4-1&-4)*(alignedMipHeight=(mipHeight=mipHeight>>1||1)+4-1&-4)*imagePixelByteSize}if(0!==glType)throw new Error("TODO: Uncompressed");return imageBuffers.map((function(levelBuffers){return new CompressedTextureResource(null,{format:glInternalFormat,width:pixelWidth,height:pixelHeight,levels:numberOfMipmapLevels,levelBuffers})}))},KTXLoader.validate=function(url,dataView){for(var i=0;i<FILE_IDENTIFIER.length;i++)if(dataView.getUint8(i)!==FILE_IDENTIFIER[i])return console.error(url+" is not a valid *.ktx file!"),!1;return!0},KTXLoader}(),particle_container_extendStatics=function(d,b){return particle_container_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},particle_container_extendStatics(d,b)};function particle_container_extends(d,b){function __(){this.constructor=d}particle_container_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var LINE_JOIN,LINE_CAP,ParticleContainer=function(_super){function ParticleContainer(maxSize,properties,batchSize,autoResize){void 0===maxSize&&(maxSize=1500),void 0===batchSize&&(batchSize=16384),void 0===autoResize&&(autoResize=!1);var _this=_super.call(this)||this;return batchSize>16384&&(batchSize=16384),_this._properties=[!1,!0,!1,!1,!1],_this._maxSize=maxSize,_this._batchSize=batchSize,_this._buffers=null,_this._bufferUpdateIDs=[],_this._updateID=0,_this.interactiveChildren=!1,_this.blendMode=constants_BLEND_MODES.NORMAL,_this.autoResize=autoResize,_this.roundPixels=!0,_this.baseTexture=null,_this.setProperties(properties),_this._tint=0,_this.tintRgb=new Float32Array(4),_this.tint=16777215,_this}return particle_container_extends(ParticleContainer,_super),ParticleContainer.prototype.setProperties=function(properties){properties&&(this._properties[0]="vertices"in properties||"scale"in properties?!!properties.vertices||!!properties.scale:this._properties[0],this._properties[1]="position"in properties?!!properties.position:this._properties[1],this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2],this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3],this._properties[4]="tint"in properties||"alpha"in properties?!!properties.tint||!!properties.alpha:this._properties[4])},ParticleContainer.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(ParticleContainer.prototype,"tint",{get:function(){return this._tint},set:function(value){this._tint=value,hex2rgb(value,this.tintRgb)},enumerable:!1,configurable:!0}),ParticleContainer.prototype.render=function(renderer){var _this=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return _this.onChildrenChange(0)}))),renderer.batch.setObjectRenderer(renderer.plugins.particle),renderer.plugins.particle.render(this))},ParticleContainer.prototype.onChildrenChange=function(smallestChildIndex){for(var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);this._bufferUpdateIDs.length<bufferIndex;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[bufferIndex]=++this._updateID},ParticleContainer.prototype.dispose=function(){if(this._buffers){for(var i=0;i<this._buffers.length;++i)this._buffers[i].destroy();this._buffers=null}},ParticleContainer.prototype.destroy=function(options){_super.prototype.destroy.call(this,options),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},ParticleContainer}(Container),ParticleBuffer=function(){function ParticleBuffer(properties,dynamicPropertyFlags,size){this.geometry=new Geometry,this.indexBuffer=null,this.size=size,this.dynamicProperties=[],this.staticProperties=[];for(var i=0;i<properties.length;++i){var property=properties[i];property={attributeName:property.attributeName,size:property.size,uploadFunction:property.uploadFunction,type:property.type||constants_TYPES.FLOAT,offset:property.offset},dynamicPropertyFlags[i]?this.dynamicProperties.push(property):this.staticProperties.push(property)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return ParticleBuffer.prototype.initBuffers=function(){var geometry=this.geometry,dynamicOffset=0;this.indexBuffer=new Buffer(createIndicesForQuads(this.size),!0,!0),geometry.addIndex(this.indexBuffer),this.dynamicStride=0;for(var i=0;i<this.dynamicProperties.length;++i){(property=this.dynamicProperties[i]).offset=dynamicOffset,dynamicOffset+=property.size,this.dynamicStride+=property.size}var dynBuffer=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(dynBuffer),this.dynamicDataUint32=new Uint32Array(dynBuffer),this.dynamicBuffer=new Buffer(this.dynamicData,!1,!1);var staticOffset=0;this.staticStride=0;for(i=0;i<this.staticProperties.length;++i){(property=this.staticProperties[i]).offset=staticOffset,staticOffset+=property.size,this.staticStride+=property.size}var statBuffer=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(statBuffer),this.staticDataUint32=new Uint32Array(statBuffer),this.staticBuffer=new Buffer(this.staticData,!0,!1);for(i=0;i<this.dynamicProperties.length;++i){var property=this.dynamicProperties[i];geometry.addAttribute(property.attributeName,this.dynamicBuffer,0,property.type===constants_TYPES.UNSIGNED_BYTE,property.type,4*this.dynamicStride,4*property.offset)}for(i=0;i<this.staticProperties.length;++i){property=this.staticProperties[i];geometry.addAttribute(property.attributeName,this.staticBuffer,0,property.type===constants_TYPES.UNSIGNED_BYTE,property.type,4*this.staticStride,4*property.offset)}},ParticleBuffer.prototype.uploadDynamic=function(children,startIndex,amount){for(var i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,property.type===constants_TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,property.offset)}this.dynamicBuffer._updateID++},ParticleBuffer.prototype.uploadStatic=function(children,startIndex,amount){for(var i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,property.type===constants_TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,property.offset)}this.staticBuffer._updateID++},ParticleBuffer.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},ParticleBuffer}(),ParticleRenderer=function(_super){function ParticleRenderer(renderer){var _this=_super.call(this,renderer)||this;return _this.shader=null,_this.properties=null,_this.tempMatrix=new Matrix,_this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:_this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:_this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:_this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:_this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:constants_TYPES.UNSIGNED_BYTE,uploadFunction:_this.uploadTint,offset:0}],_this.shader=Shader.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),_this.state=State.for2d(),_this}return particle_container_extends(ParticleRenderer,_super),ParticleRenderer.prototype.render=function(container){var children=container.children,maxSize=container._maxSize,batchSize=container._batchSize,renderer=this.renderer,totalChildren=children.length;if(0!==totalChildren){totalChildren>maxSize&&!container.autoResize&&(totalChildren=maxSize);var buffers=container._buffers;buffers||(buffers=container._buffers=this.generateBuffers(container));var baseTexture=children[0]._texture.baseTexture;this.state.blendMode=correctBlendMode(container.blendMode,baseTexture.alphaMode),renderer.state.set(this.state);var gl=renderer.gl,m=container.worldTransform.copyTo(this.tempMatrix);m.prepend(renderer.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=m.toArray(!0),this.shader.uniforms.uColor=premultiplyRgba(container.tintRgb,container.worldAlpha,this.shader.uniforms.uColor,baseTexture.alphaMode),this.shader.uniforms.uSampler=baseTexture,this.renderer.shader.bind(this.shader);for(var updateStatic=!1,i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;amount>batchSize&&(amount=batchSize),j>=buffers.length&&buffers.push(this._generateOneMoreBuffer(container));var buffer=buffers[j];buffer.uploadDynamic(children,i,amount);var bid=container._bufferUpdateIDs[j]||0;(updateStatic=updateStatic||buffer._updateID<bid)&&(buffer._updateID=container._updateID,buffer.uploadStatic(children,i,amount)),renderer.geometry.bind(buffer.geometry),gl.drawElements(gl.TRIANGLES,6*amount,gl.UNSIGNED_SHORT,0)}}},ParticleRenderer.prototype.generateBuffers=function(container){for(var buffers=[],size=container._maxSize,batchSize=container._batchSize,dynamicPropertyFlags=container._properties,i=0;i<size;i+=batchSize)buffers.push(new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize));return buffers},ParticleRenderer.prototype._generateOneMoreBuffer=function(container){var batchSize=container._batchSize,dynamicPropertyFlags=container._properties;return new ParticleBuffer(this.properties,dynamicPropertyFlags,batchSize)},ParticleRenderer.prototype.uploadVertices=function(children,startIndex,amount,array,stride,offset){for(var w0=0,w1=0,h0=0,h1=0,i=0;i<amount;++i){var sprite=children[startIndex+i],texture=sprite._texture,sx=sprite.scale.x,sy=sprite.scale.y,trim=texture.trim,orig=texture.orig;trim?(w0=(w1=trim.x-sprite.anchor.x*orig.width)+trim.width,h0=(h1=trim.y-sprite.anchor.y*orig.height)+trim.height):(w0=orig.width*(1-sprite.anchor.x),w1=orig.width*-sprite.anchor.x,h0=orig.height*(1-sprite.anchor.y),h1=orig.height*-sprite.anchor.y),array[offset]=w1*sx,array[offset+1]=h1*sy,array[offset+stride]=w0*sx,array[offset+stride+1]=h1*sy,array[offset+2*stride]=w0*sx,array[offset+2*stride+1]=h0*sy,array[offset+3*stride]=w1*sx,array[offset+3*stride+1]=h0*sy,offset+=4*stride}},ParticleRenderer.prototype.uploadPosition=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x,array[offset+1]=spritePosition.y,array[offset+stride]=spritePosition.x,array[offset+stride+1]=spritePosition.y,array[offset+2*stride]=spritePosition.x,array[offset+2*stride+1]=spritePosition.y,array[offset+3*stride]=spritePosition.x,array[offset+3*stride+1]=spritePosition.y,offset+=4*stride}},ParticleRenderer.prototype.uploadRotation=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation,array[offset+stride]=spriteRotation,array[offset+2*stride]=spriteRotation,array[offset+3*stride]=spriteRotation,offset+=4*stride}},ParticleRenderer.prototype.uploadUvs=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var textureUvs=children[startIndex+i]._texture._uvs;textureUvs?(array[offset]=textureUvs.x0,array[offset+1]=textureUvs.y0,array[offset+stride]=textureUvs.x1,array[offset+stride+1]=textureUvs.y1,array[offset+2*stride]=textureUvs.x2,array[offset+2*stride+1]=textureUvs.y2,array[offset+3*stride]=textureUvs.x3,array[offset+3*stride+1]=textureUvs.y3,offset+=4*stride):(array[offset]=0,array[offset+1]=0,array[offset+stride]=0,array[offset+stride+1]=0,array[offset+2*stride]=0,array[offset+2*stride+1]=0,array[offset+3*stride]=0,array[offset+3*stride+1]=0,offset+=4*stride)}},ParticleRenderer.prototype.uploadTint=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;++i){var sprite=children[startIndex+i],premultiplied=sprite._texture.baseTexture.alphaMode>0,alpha=sprite.alpha,argb=alpha<1&&premultiplied?premultiplyTint(sprite._tintRGB,alpha):sprite._tintRGB+(255*alpha<<24);array[offset]=argb,array[offset+stride]=argb,array[offset+2*stride]=argb,array[offset+3*stride]=argb,offset+=4*stride}},ParticleRenderer.prototype.destroy=function(){_super.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},ParticleRenderer}(ObjectRenderer);!function(LINE_JOIN){LINE_JOIN.MITER="miter",LINE_JOIN.BEVEL="bevel",LINE_JOIN.ROUND="round"}(LINE_JOIN||(LINE_JOIN={})),function(LINE_CAP){LINE_CAP.BUTT="butt",LINE_CAP.ROUND="round",LINE_CAP.SQUARE="square"}(LINE_CAP||(LINE_CAP={}));var GRAPHICS_CURVES={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(length,defaultSegments){if(void 0===defaultSegments&&(defaultSegments=20),!this.adaptive||!length||isNaN(length))return defaultSegments;var result=Math.ceil(length/this.maxLength);return result<this.minSegments?result=this.minSegments:result>this.maxSegments&&(result=this.maxSegments),result}},FillStyle=function(){function FillStyle(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}return FillStyle.prototype.clone=function(){var obj=new FillStyle;return obj.color=this.color,obj.alpha=this.alpha,obj.texture=this.texture,obj.matrix=this.matrix,obj.visible=this.visible,obj},FillStyle.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1},FillStyle.prototype.destroy=function(){this.texture=null,this.matrix=null},FillStyle}(),graphics_extendStatics=function(d,b){return graphics_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},graphics_extendStatics(d,b)};function graphics_extends(d,b){function __(){this.constructor=d}graphics_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var buildPoly={build:function(graphicsData){graphicsData.points=graphicsData.shape.points.slice()},triangulate:function(graphicsData,graphicsGeometry){var points=graphicsData.points,holes=graphicsData.holes,verts=graphicsGeometry.points,indices=graphicsGeometry.indices;if(points.length>=6){for(var holeArray=[],i=0;i<holes.length;i++){var hole=holes[i];holeArray.push(points.length/2),points=points.concat(hole.points)}var triangles=earcut_default()(points,holeArray,2);if(!triangles)return;var vertPos=verts.length/2;for(i=0;i<triangles.length;i+=3)indices.push(triangles[i]+vertPos),indices.push(triangles[i+1]+vertPos),indices.push(triangles[i+2]+vertPos);for(i=0;i<points.length;i++)verts.push(points[i])}}},buildCircle={build:function(graphicsData){var width,height,circleData=graphicsData.shape,points=graphicsData.points,x=circleData.x,y=circleData.y;if(points.length=0,graphicsData.type===SHAPES.CIRC)width=circleData.radius,height=circleData.radius;else{var ellipseData=graphicsData.shape;width=ellipseData.width,height=ellipseData.height}if(0!==width&&0!==height){var totalSegs=Math.floor(30*Math.sqrt(circleData.radius))||Math.floor(15*Math.sqrt(width+height));totalSegs/=2.3;for(var seg=2*Math.PI/totalSegs,i=0;i<totalSegs-.5;i++)points.push(x+Math.sin(-seg*i)*width,y+Math.cos(-seg*i)*height);points.push(points[0],points[1])}},triangulate:function(graphicsData,graphicsGeometry){var points=graphicsData.points,verts=graphicsGeometry.points,indices=graphicsGeometry.indices,vertPos=verts.length/2,center=vertPos,circle=graphicsData.shape,matrix=graphicsData.matrix,x=circle.x,y=circle.y;verts.push(graphicsData.matrix?matrix.a*x+matrix.c*y+matrix.tx:x,graphicsData.matrix?matrix.b*x+matrix.d*y+matrix.ty:y);for(var i=0;i<points.length;i+=2)verts.push(points[i],points[i+1]),indices.push(vertPos++,center,vertPos)}},buildRectangle={build:function(graphicsData){var rectData=graphicsData.shape,x=rectData.x,y=rectData.y,width=rectData.width,height=rectData.height,points=graphicsData.points;points.length=0,points.push(x,y,x+width,y,x+width,y+height,x,y+height)},triangulate:function(graphicsData,graphicsGeometry){var points=graphicsData.points,verts=graphicsGeometry.points,vertPos=verts.length/2;verts.push(points[0],points[1],points[2],points[3],points[6],points[7],points[4],points[5]),graphicsGeometry.indices.push(vertPos,vertPos+1,vertPos+2,vertPos+1,vertPos+2,vertPos+3)}};function getPt(n1,n2,perc){return n1+(n2-n1)*perc}function quadraticBezierCurve(fromX,fromY,cpX,cpY,toX,toY,out){void 0===out&&(out=[]);for(var points=out,xa=0,ya=0,xb=0,yb=0,x=0,y=0,i=0,j=0;i<=20;++i)xa=getPt(fromX,cpX,j=i/20),ya=getPt(fromY,cpY,j),xb=getPt(cpX,toX,j),yb=getPt(cpY,toY,j),x=getPt(xa,xb,j),y=getPt(ya,yb,j),0===i&&points[points.length-2]===x&&points[points.length-1]===y||points.push(x,y);return points}var buildRoundedRectangle={build:function(graphicsData){var rrectData=graphicsData.shape,points=graphicsData.points,x=rrectData.x,y=rrectData.y,width=rrectData.width,height=rrectData.height,radius=Math.max(0,Math.min(rrectData.radius,Math.min(width,height)/2));points.length=0,radius?(quadraticBezierCurve(x,y+radius,x,y,x+radius,y,points),quadraticBezierCurve(x+width-radius,y,x+width,y,x+width,y+radius,points),quadraticBezierCurve(x+width,y+height-radius,x+width,y+height,x+width-radius,y+height,points),quadraticBezierCurve(x+radius,y+height,x,y+height,x,y+height-radius,points)):points.push(x,y,x+width,y,x+width,y+height,x,y+height)},triangulate:function(graphicsData,graphicsGeometry){for(var points=graphicsData.points,verts=graphicsGeometry.points,indices=graphicsGeometry.indices,vecPos=verts.length/2,triangles=earcut_default()(points,null,2),i=0,j=triangles.length;i<j;i+=3)indices.push(triangles[i]+vecPos),indices.push(triangles[i+1]+vecPos),indices.push(triangles[i+2]+vecPos);for(i=0,j=points.length;i<j;i++)verts.push(points[i],points[++i])}};function square(x,y,nx,ny,innerWeight,outerWeight,clockwise,verts){var exx,eyy;clockwise?(exx=ny,eyy=-nx):(exx=-ny,eyy=nx);var eix=x-nx*innerWeight+exx,eiy=y-ny*innerWeight+eyy,eox=x+nx*outerWeight+exx,eoy=y+ny*outerWeight+eyy;return verts.push(eix,eiy),verts.push(eox,eoy),2}function round(cx,cy,sx,sy,ex,ey,verts,clockwise){var cx2p0x=sx-cx,cy2p0y=sy-cy,angle0=Math.atan2(cx2p0x,cy2p0y),angle1=Math.atan2(ex-cx,ey-cy);clockwise&&angle0<angle1?angle0+=2*Math.PI:!clockwise&&angle0>angle1&&(angle1+=2*Math.PI);var startAngle=angle0,angleDiff=angle1-angle0,absAngleDiff=Math.abs(angleDiff),radius=Math.sqrt(cx2p0x*cx2p0x+cy2p0y*cy2p0y),segCount=1+(15*absAngleDiff*Math.sqrt(radius)/Math.PI>>0),angleInc=angleDiff/segCount;if(startAngle+=angleInc,clockwise){verts.push(cx,cy),verts.push(sx,sy);for(var i=1,angle=startAngle;i<segCount;i++,angle+=angleInc)verts.push(cx,cy),verts.push(cx+Math.sin(angle)*radius,cy+Math.cos(angle)*radius);verts.push(cx,cy),verts.push(ex,ey)}else{verts.push(sx,sy),verts.push(cx,cy);for(i=1,angle=startAngle;i<segCount;i++,angle+=angleInc)verts.push(cx+Math.sin(angle)*radius,cy+Math.cos(angle)*radius),verts.push(cx,cy);verts.push(ex,ey),verts.push(cx,cy)}return 2*segCount}function buildLine(graphicsData,graphicsGeometry){graphicsData.lineStyle.native?function(graphicsData,graphicsGeometry){var i=0,shape=graphicsData.shape,points=graphicsData.points||shape.points,closedShape=shape.type!==SHAPES.POLY||shape.closeStroke;if(0!==points.length){var verts=graphicsGeometry.points,indices=graphicsGeometry.indices,length=points.length/2,startIndex=verts.length/2,currentIndex=startIndex;for(verts.push(points[0],points[1]),i=1;i<length;i++)verts.push(points[2*i],points[2*i+1]),indices.push(currentIndex,currentIndex+1),currentIndex++;closedShape&&indices.push(currentIndex,startIndex)}}(graphicsData,graphicsGeometry):function(graphicsData,graphicsGeometry){var shape=graphicsData.shape,points=graphicsData.points||shape.points.slice(),eps=graphicsGeometry.closePointEps;if(0!==points.length){var style=graphicsData.lineStyle,firstPoint=new Point(points[0],points[1]),lastPoint=new Point(points[points.length-2],points[points.length-1]),closedShape=shape.type!==SHAPES.POLY||shape.closeStroke,closedPath=Math.abs(firstPoint.x-lastPoint.x)<eps&&Math.abs(firstPoint.y-lastPoint.y)<eps;if(closedShape){points=points.slice(),closedPath&&(points.pop(),points.pop(),lastPoint.set(points[points.length-2],points[points.length-1]));var midPointX=.5*(firstPoint.x+lastPoint.x),midPointY=.5*(lastPoint.y+firstPoint.y);points.unshift(midPointX,midPointY),points.push(midPointX,midPointY)}var verts=graphicsGeometry.points,length=points.length/2,indexCount=points.length,indexStart=verts.length/2,width=style.width/2,widthSquared=width*width,miterLimitSquared=style.miterLimit*style.miterLimit,x0=points[0],y0=points[1],x1=points[2],y1=points[3],x2=0,y2=0,perpx=-(y0-y1),perpy=x0-x1,perp1x=0,perp1y=0,dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist,perpy/=dist,perpx*=width,perpy*=width;var ratio=style.alignment,innerWeight=2*(1-ratio),outerWeight=2*ratio;closedShape||(style.cap===LINE_CAP.ROUND?indexCount+=round(x0-perpx*(innerWeight-outerWeight)*.5,y0-perpy*(innerWeight-outerWeight)*.5,x0-perpx*innerWeight,y0-perpy*innerWeight,x0+perpx*outerWeight,y0+perpy*outerWeight,verts,!0)+2:style.cap===LINE_CAP.SQUARE&&(indexCount+=square(x0,y0,perpx,perpy,innerWeight,outerWeight,!0,verts))),verts.push(x0-perpx*innerWeight,y0-perpy*innerWeight),verts.push(x0+perpx*outerWeight,y0+perpy*outerWeight);for(var i=1;i<length-1;++i){x0=points[2*(i-1)],y0=points[2*(i-1)+1],x1=points[2*i],y1=points[2*i+1],x2=points[2*(i+1)],y2=points[2*(i+1)+1],perpx=-(y0-y1),perpy=x0-x1,perpx/=dist=Math.sqrt(perpx*perpx+perpy*perpy),perpy/=dist,perpx*=width,perpy*=width,perp1x=-(y1-y2),perp1y=x1-x2,perp1x/=dist=Math.sqrt(perp1x*perp1x+perp1y*perp1y),perp1y/=dist,perp1x*=width,perp1y*=width;var dx0=x1-x0,dy0=y0-y1,dx1=x1-x2,dy1=y2-y1,cross=dy0*dx1-dy1*dx0,clockwise=cross<0;if(Math.abs(cross)<.1)verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight);else{var c1=(-perpx+x0)*(-perpy+y1)-(-perpx+x1)*(-perpy+y0),c2=(-perp1x+x2)*(-perp1y+y1)-(-perp1x+x1)*(-perp1y+y2),px=(dx0*c2-dx1*c1)/cross,py=(dy1*c1-dy0*c2)/cross,pdist=(px-x1)*(px-x1)+(py-y1)*(py-y1),imx=x1+(px-x1)*innerWeight,imy=y1+(py-y1)*innerWeight,omx=x1-(px-x1)*outerWeight,omy=y1-(py-y1)*outerWeight,insideWeight=clockwise?innerWeight:outerWeight;pdist<=Math.min(dx0*dx0+dy0*dy0,dx1*dx1+dy1*dy1)+insideWeight*insideWeight*widthSquared?style.join===LINE_JOIN.BEVEL||pdist/widthSquared>miterLimitSquared?(clockwise?(verts.push(imx,imy),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight),verts.push(imx,imy),verts.push(x1+perp1x*outerWeight,y1+perp1y*outerWeight)):(verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(omx,omy),verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight),verts.push(omx,omy)),indexCount+=2):style.join===LINE_JOIN.ROUND?clockwise?(verts.push(imx,imy),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight),indexCount+=round(x1,y1,x1+perpx*outerWeight,y1+perpy*outerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight,verts,!0)+4,verts.push(imx,imy),verts.push(x1+perp1x*outerWeight,y1+perp1y*outerWeight)):(verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(omx,omy),indexCount+=round(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,!1)+4,verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight),verts.push(omx,omy)):(verts.push(imx,imy),verts.push(omx,omy)):(verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight),style.join===LINE_JOIN.BEVEL||pdist/widthSquared>miterLimitSquared||(style.join===LINE_JOIN.ROUND?indexCount+=clockwise?round(x1,y1,x1+perpx*outerWeight,y1+perpy*outerWeight,x1+perp1x*outerWeight,y1+perp1y*outerWeight,verts,!0)+2:round(x1,y1,x1-perpx*innerWeight,y1-perpy*innerWeight,x1-perp1x*innerWeight,y1-perp1y*innerWeight,verts,!1)+2:(clockwise?(verts.push(omx,omy),verts.push(omx,omy)):(verts.push(imx,imy),verts.push(imx,imy)),indexCount+=2)),verts.push(x1-perp1x*innerWeight,y1-perp1y*innerWeight),verts.push(x1+perp1x*outerWeight,y1+perp1y*outerWeight),indexCount+=2)}}x0=points[2*(length-2)],y0=points[2*(length-2)+1],x1=points[2*(length-1)],perpx=-(y0-(y1=points[2*(length-1)+1])),perpy=x0-x1,perpx/=dist=Math.sqrt(perpx*perpx+perpy*perpy),perpy/=dist,perpx*=width,perpy*=width,verts.push(x1-perpx*innerWeight,y1-perpy*innerWeight),verts.push(x1+perpx*outerWeight,y1+perpy*outerWeight),closedShape||(style.cap===LINE_CAP.ROUND?indexCount+=round(x1-perpx*(innerWeight-outerWeight)*.5,y1-perpy*(innerWeight-outerWeight)*.5,x1-perpx*innerWeight,y1-perpy*innerWeight,x1+perpx*outerWeight,y1+perpy*outerWeight,verts,!1)+2:style.cap===LINE_CAP.SQUARE&&(indexCount+=square(x1,y1,perpx,perpy,innerWeight,outerWeight,!1,verts)));var indices=graphicsGeometry.indices,eps2=GRAPHICS_CURVES.epsilon*GRAPHICS_CURVES.epsilon;for(i=indexStart;i<indexCount+indexStart-2;++i)x0=verts[2*i],y0=verts[2*i+1],x1=verts[2*(i+1)],y1=verts[2*(i+1)+1],x2=verts[2*(i+2)],y2=verts[2*(i+2)+1],Math.abs(x0*(y1-y2)+x1*(y2-y0)+x2*(y0-y1))<eps2||indices.push(i,i+1,i+2)}}(graphicsData,graphicsGeometry)}var graphics_a,ArcUtils=function(){function ArcUtils(){}return ArcUtils.curveTo=function(x1,y1,x2,y2,radius,points){var fromX=points[points.length-2],a1=points[points.length-1]-y1,b1=fromX-x1,a2=y2-y1,b2=x2-x1,mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||0===radius)return points[points.length-2]===x1&&points[points.length-1]===y1||points.push(x1,y1),null;var dd=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=radius*Math.sqrt(dd)/mm,k2=radius*Math.sqrt(cc)/mm,j1=k1*tt/dd,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2);return{cx:cx+x1,cy:cy+y1,radius,startAngle:Math.atan2(py-cy,px-cx),endAngle:Math.atan2(qy-cy,qx-cx),anticlockwise:b1*a2>b2*a1}},ArcUtils.arc=function(_startX,_startY,cx,cy,radius,startAngle,endAngle,_anticlockwise,points){for(var sweep=endAngle-startAngle,n=GRAPHICS_CURVES._segmentsCount(Math.abs(sweep)*radius,40*Math.ceil(Math.abs(sweep)/PI_2)),theta=sweep/(2*n),theta2=2*theta,cTheta=Math.cos(theta),sTheta=Math.sin(theta),segMinus=n-1,remainder=segMinus%1/segMinus,i=0;i<=segMinus;++i){var angle=theta+startAngle+theta2*(i+remainder*i),c=Math.cos(angle),s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}},ArcUtils}(),BezierUtils=function(){function BezierUtils(){}return BezierUtils.curveLength=function(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY){for(var result=0,t=0,t2=0,t3=0,nt=0,nt2=0,nt3=0,x=0,y=0,dx=0,dy=0,prevX=fromX,prevY=fromY,i=1;i<=10;++i)dx=prevX-(x=(nt3=(nt2=(nt=1-(t=i/10))*nt)*nt)*fromX+3*nt2*t*cpX+3*nt*(t2=t*t)*cpX2+(t3=t2*t)*toX),dy=prevY-(y=nt3*fromY+3*nt2*t*cpY+3*nt*t2*cpY2+t3*toY),prevX=x,prevY=y,result+=Math.sqrt(dx*dx+dy*dy);return result},BezierUtils.curveTo=function(cpX,cpY,cpX2,cpY2,toX,toY,points){var fromX=points[points.length-2],fromY=points[points.length-1];points.length-=2;var n=GRAPHICS_CURVES._segmentsCount(BezierUtils.curveLength(fromX,fromY,cpX,cpY,cpX2,cpY2,toX,toY)),dt=0,dt2=0,dt3=0,t2=0,t3=0;points.push(fromX,fromY);for(var i=1,j=0;i<=n;++i)dt3=(dt2=(dt=1-(j=i/n))*dt)*dt,t3=(t2=j*j)*j,points.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY)},BezierUtils}(),QuadraticUtils=function(){function QuadraticUtils(){}return QuadraticUtils.curveLength=function(fromX,fromY,cpX,cpY,toX,toY){var ax=fromX-2*cpX+toX,ay=fromY-2*cpY+toY,bx=2*cpX-2*fromX,by=2*cpY-2*fromY,a=4*(ax*ax+ay*ay),b=4*(ax*bx+ay*by),c=bx*bx+by*by,s=2*Math.sqrt(a+b+c),a2=Math.sqrt(a),a32=2*a*a2,c2=2*Math.sqrt(c),ba=b/a2;return(a32*s+a2*b*(s-c2)+(4*c*a-b*b)*Math.log((2*a2+ba+s)/(ba+c2)))/(4*a32)},QuadraticUtils.curveTo=function(cpX,cpY,toX,toY,points){for(var fromX=points[points.length-2],fromY=points[points.length-1],n=GRAPHICS_CURVES._segmentsCount(QuadraticUtils.curveLength(fromX,fromY,cpX,cpY,toX,toY)),xa=0,ya=0,i=1;i<=n;++i){var j=i/n;xa=fromX+(cpX-fromX)*j,ya=fromY+(cpY-fromY)*j,points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j)}},QuadraticUtils}(),BatchPart=function(){function BatchPart(){this.reset()}return BatchPart.prototype.begin=function(style,startIndex,attribStart){this.reset(),this.style=style,this.start=startIndex,this.attribStart=attribStart},BatchPart.prototype.end=function(endIndex,endAttrib){this.attribSize=endAttrib-this.attribStart,this.size=endIndex-this.start},BatchPart.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},BatchPart}(),FILL_COMMANDS=((graphics_a={})[SHAPES.POLY]=buildPoly,graphics_a[SHAPES.CIRC]=buildCircle,graphics_a[SHAPES.ELIP]=buildCircle,graphics_a[SHAPES.RECT]=buildRectangle,graphics_a[SHAPES.RREC]=buildRoundedRectangle,graphics_a),BATCH_POOL=[],DRAW_CALL_POOL=[];function isPolygonClockwise(polygon){for(var points=polygon.points,sum=0,i=0;i<points.length-2;i+=2)sum+=(points[i+2]-points[i])*(points[i+3]+points[i+1]);return sum>0}var GraphicsData=function(){function GraphicsData(shape,fillStyle,lineStyle,matrix){void 0===fillStyle&&(fillStyle=null),void 0===lineStyle&&(lineStyle=null),void 0===matrix&&(matrix=null),this.points=[],this.holes=[],this.shape=shape,this.lineStyle=lineStyle,this.fillStyle=fillStyle,this.matrix=matrix,this.type=shape.type}return GraphicsData.prototype.clone=function(){return new GraphicsData(this.shape,this.fillStyle,this.lineStyle,this.matrix)},GraphicsData.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},GraphicsData}(),tmpPoint=new Point,tmpBounds=new Bounds,GraphicsGeometry=function(_super){function GraphicsGeometry(){var _this=_super.call(this)||this;return _this.closePointEps=1e-4,_this.boundsPadding=0,_this.uvsFloat32=null,_this.indicesUint16=null,_this.batchable=!1,_this.points=[],_this.colors=[],_this.uvs=[],_this.indices=[],_this.textureIds=[],_this.graphicsData=[],_this.drawCalls=[],_this.batchDirty=-1,_this.batches=[],_this.dirty=0,_this.cacheDirty=-1,_this.clearDirty=0,_this.shapeIndex=0,_this._bounds=new Bounds,_this.boundsDirty=-1,_this}return graphics_extends(GraphicsGeometry,_super),Object.defineProperty(GraphicsGeometry.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),GraphicsGeometry.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[i]);this.drawCalls.length=0;for(i=0;i<this.batches.length;i++){var batchPart=this.batches[i];batchPart.reset(),BATCH_POOL.push(batchPart)}this.batches.length=0},GraphicsGeometry.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},GraphicsGeometry.prototype.drawShape=function(shape,fillStyle,lineStyle,matrix){void 0===fillStyle&&(fillStyle=null),void 0===lineStyle&&(lineStyle=null),void 0===matrix&&(matrix=null);var data=new GraphicsData(shape,fillStyle,lineStyle,matrix);return this.graphicsData.push(data),this.dirty++,this},GraphicsGeometry.prototype.drawHole=function(shape,matrix){if(void 0===matrix&&(matrix=null),!this.graphicsData.length)return null;var data=new GraphicsData(shape,null,null,matrix),lastShape=this.graphicsData[this.graphicsData.length-1];return data.lineStyle=lastShape.lineStyle,lastShape.holes.push(data),this.dirty++,this},GraphicsGeometry.prototype.destroy=function(){_super.prototype.destroy.call(this);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},GraphicsGeometry.prototype.containsPoint=function(point){for(var graphicsData=this.graphicsData,i=0;i<graphicsData.length;++i){var data=graphicsData[i];if(data.fillStyle.visible&&(data.shape&&(data.matrix?data.matrix.applyInverse(point,tmpPoint):tmpPoint.copyFrom(point),data.shape.contains(tmpPoint.x,tmpPoint.y)))){var hitHole=!1;if(data.holes)for(var i_1=0;i_1<data.holes.length;i_1++){if(data.holes[i_1].shape.contains(tmpPoint.x,tmpPoint.y)){hitHole=!0;break}}if(!hitHole)return!0}}return!1},GraphicsGeometry.prototype.updateBatches=function(allow32Indices){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var uvs=this.uvs,graphicsData=this.graphicsData,batchPart=null,currentStyle=null;this.batches.length>0&&(currentStyle=(batchPart=this.batches[this.batches.length-1]).style);for(var i=this.shapeIndex;i<graphicsData.length;i++){this.shapeIndex++;var data=graphicsData[i],fillStyle=data.fillStyle,lineStyle=data.lineStyle;FILL_COMMANDS[data.type].build(data),data.matrix&&this.transformPoints(data.points,data.matrix);for(var j=0;j<2;j++){var style=0===j?fillStyle:lineStyle;if(style.visible){var nextTexture=style.texture.baseTexture,index_1=this.indices.length,attribIndex=this.points.length/2;nextTexture.wrapMode=constants_WRAP_MODES.REPEAT,0===j?this.processFill(data):this.processLine(data);var size=this.points.length/2-attribIndex;0!==size&&(batchPart&&!this._compareStyles(currentStyle,style)&&(batchPart.end(index_1,attribIndex),batchPart=null),batchPart||((batchPart=BATCH_POOL.pop()||new BatchPart).begin(style,index_1,attribIndex),this.batches.push(batchPart),currentStyle=style),this.addUvs(this.points,uvs,style.texture,attribIndex,size,style.matrix))}}}var index=this.indices.length,attrib=this.points.length/2;if(batchPart&&batchPart.end(index,attrib),0!==this.batches.length){if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var need32=attrib>65535&&allow32Indices;this.indicesUint16=need32?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}else this.batchable=!0}}else this.batchable=!0},GraphicsGeometry.prototype._compareStyles=function(styleA,styleB){return!(!styleA||!styleB)&&(styleA.texture.baseTexture===styleB.texture.baseTexture&&(styleA.color+styleA.alpha===styleB.color+styleB.alpha&&!!styleA.native==!!styleB.native))},GraphicsGeometry.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var i=0,l=this.graphicsData.length;i<l;i++){var data=this.graphicsData[i],fill=data.fillStyle,line=data.lineStyle;if(fill&&!fill.texture.baseTexture.valid)return!1;if(line&&!line.texture.baseTexture.valid)return!1}return!0},GraphicsGeometry.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var batches=this.batches,i=0,l=batches.length;i<l;i++)for(var batch=batches[i],j=0;j<batch.size;j++){var index=batch.start+j;this.indicesUint16[index]=this.indicesUint16[index]-batch.attribStart}},GraphicsGeometry.prototype.isBatchable=function(){if(this.points.length>131070)return!1;for(var batches=this.batches,i=0;i<batches.length;i++)if(batches[i].style.native)return!1;return this.points.length<2*GraphicsGeometry.BATCHABLE_SIZE},GraphicsGeometry.prototype.buildDrawCalls=function(){for(var TICK=++BaseTexture._globalBatch,i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[i]);this.drawCalls.length=0;var colors=this.colors,textureIds=this.textureIds,currentGroup=DRAW_CALL_POOL.pop();currentGroup||((currentGroup=new BatchDrawCall).texArray=new BatchTextureArray),currentGroup.texArray.count=0,currentGroup.start=0,currentGroup.size=0,currentGroup.type=constants_DRAW_MODES.TRIANGLES;var textureCount=0,currentTexture=null,textureId=0,native=!1,drawMode=constants_DRAW_MODES.TRIANGLES,index=0;this.drawCalls.push(currentGroup);for(i=0;i<this.batches.length;i++){var data=this.batches[i],style=data.style,nextTexture=style.texture.baseTexture;native!==!!style.native&&(drawMode=(native=!!style.native)?constants_DRAW_MODES.LINES:constants_DRAW_MODES.TRIANGLES,currentTexture=null,textureCount=8,TICK++),currentTexture!==nextTexture&&(currentTexture=nextTexture,nextTexture._batchEnabled!==TICK&&(8===textureCount&&(TICK++,textureCount=0,currentGroup.size>0&&((currentGroup=DRAW_CALL_POOL.pop())||((currentGroup=new BatchDrawCall).texArray=new BatchTextureArray),this.drawCalls.push(currentGroup)),currentGroup.start=index,currentGroup.size=0,currentGroup.texArray.count=0,currentGroup.type=drawMode),nextTexture.touched=1,nextTexture._batchEnabled=TICK,nextTexture._batchLocation=textureCount,nextTexture.wrapMode=constants_WRAP_MODES.REPEAT,currentGroup.texArray.elements[currentGroup.texArray.count++]=nextTexture,textureCount++)),currentGroup.size+=data.size,index+=data.size,textureId=nextTexture._batchLocation,this.addColors(colors,style.color,style.alpha,data.attribSize,data.attribStart),this.addTextureIds(textureIds,textureId,data.attribSize,data.attribStart)}BaseTexture._globalBatch=TICK,this.packAttributes()},GraphicsGeometry.prototype.packAttributes=function(){for(var verts=this.points,uvs=this.uvs,colors=this.colors,textureIds=this.textureIds,glPoints=new ArrayBuffer(3*verts.length*4),f32=new Float32Array(glPoints),u32=new Uint32Array(glPoints),p=0,i=0;i<verts.length/2;i++)f32[p++]=verts[2*i],f32[p++]=verts[2*i+1],f32[p++]=uvs[2*i],f32[p++]=uvs[2*i+1],u32[p++]=colors[i],f32[p++]=textureIds[i];this._buffer.update(glPoints),this._indexBuffer.update(this.indicesUint16)},GraphicsGeometry.prototype.processFill=function(data){data.holes.length?(this.processHoles(data.holes),buildPoly.triangulate(data,this)):FILL_COMMANDS[data.type].triangulate(data,this)},GraphicsGeometry.prototype.processLine=function(data){buildLine(data,this);for(var i=0;i<data.holes.length;i++)buildLine(data.holes[i],this)},GraphicsGeometry.prototype.processHoles=function(holes){for(var i=0;i<holes.length;i++){var hole=holes[i];FILL_COMMANDS[hole.type].build(hole),hole.matrix&&this.transformPoints(hole.points,hole.matrix)}},GraphicsGeometry.prototype.calculateBounds=function(){var bounds=this._bounds,sequenceBounds=tmpBounds,curMatrix=Matrix.IDENTITY;this._bounds.clear(),sequenceBounds.clear();for(var i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i],shape=data.shape,type=data.type,lineStyle=data.lineStyle,nextMatrix=data.matrix||Matrix.IDENTITY,lineWidth=0;if(lineStyle&&lineStyle.visible){var alignment=lineStyle.alignment;lineWidth=lineStyle.width,type===SHAPES.POLY?isPolygonClockwise(shape)?lineWidth*=1-alignment:lineWidth*=alignment:lineWidth*=Math.max(0,alignment)}if(curMatrix!==nextMatrix&&(sequenceBounds.isEmpty()||(bounds.addBoundsMatrix(sequenceBounds,curMatrix),sequenceBounds.clear()),curMatrix=nextMatrix),type===SHAPES.RECT||type===SHAPES.RREC){var rect=shape;sequenceBounds.addFramePad(rect.x,rect.y,rect.x+rect.width,rect.y+rect.height,lineWidth,lineWidth)}else if(type===SHAPES.CIRC){var circle=shape;sequenceBounds.addFramePad(circle.x,circle.y,circle.x,circle.y,circle.radius+lineWidth,circle.radius+lineWidth)}else if(type===SHAPES.ELIP){var ellipse=shape;sequenceBounds.addFramePad(ellipse.x,ellipse.y,ellipse.x,ellipse.y,ellipse.width+lineWidth,ellipse.height+lineWidth)}else{var poly=shape;bounds.addVerticesMatrix(curMatrix,poly.points,0,poly.points.length,lineWidth,lineWidth)}}sequenceBounds.isEmpty()||bounds.addBoundsMatrix(sequenceBounds,curMatrix),bounds.pad(this.boundsPadding,this.boundsPadding)},GraphicsGeometry.prototype.transformPoints=function(points,matrix){for(var i=0;i<points.length/2;i++){var x=points[2*i],y=points[2*i+1];points[2*i]=matrix.a*x+matrix.c*y+matrix.tx,points[2*i+1]=matrix.b*x+matrix.d*y+matrix.ty}},GraphicsGeometry.prototype.addColors=function(colors,color,alpha,size,offset){void 0===offset&&(offset=0);var rgba=premultiplyTint((color>>16)+(65280&color)+((255&color)<<16),alpha);colors.length=Math.max(colors.length,offset+size);for(var i=0;i<size;i++)colors[offset+i]=rgba},GraphicsGeometry.prototype.addTextureIds=function(textureIds,id,size,offset){void 0===offset&&(offset=0),textureIds.length=Math.max(textureIds.length,offset+size);for(var i=0;i<size;i++)textureIds[offset+i]=id},GraphicsGeometry.prototype.addUvs=function(verts,uvs,texture,start,size,matrix){void 0===matrix&&(matrix=null);for(var index=0,uvsStart=uvs.length,frame=texture.frame;index<size;){var x=verts[2*(start+index)],y=verts[2*(start+index)+1];if(matrix){var nx=matrix.a*x+matrix.c*y+matrix.tx;y=matrix.b*x+matrix.d*y+matrix.ty,x=nx}index++,uvs.push(x/frame.width,y/frame.height)}var baseTexture=texture.baseTexture;(frame.width<baseTexture.width||frame.height<baseTexture.height)&&this.adjustUvs(uvs,texture,uvsStart,size)},GraphicsGeometry.prototype.adjustUvs=function(uvs,texture,start,size){for(var baseTexture=texture.baseTexture,eps=1e-6,finish=start+2*size,frame=texture.frame,scaleX=frame.width/baseTexture.width,scaleY=frame.height/baseTexture.height,offsetX=frame.x/frame.width,offsetY=frame.y/frame.height,minX=Math.floor(uvs[start]+eps),minY=Math.floor(uvs[start+1]+eps),i=start+2;i<finish;i+=2)minX=Math.min(minX,Math.floor(uvs[i]+eps)),minY=Math.min(minY,Math.floor(uvs[i+1]+eps));offsetX-=minX,offsetY-=minY;for(i=start;i<finish;i+=2)uvs[i]=(uvs[i]+offsetX)*scaleX,uvs[i+1]=(uvs[i+1]+offsetY)*scaleY},GraphicsGeometry.BATCHABLE_SIZE=100,GraphicsGeometry}(BatchGeometry),LineStyle=function(_super){function LineStyle(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.width=0,_this.alignment=.5,_this.native=!1,_this.cap=LINE_CAP.BUTT,_this.join=LINE_JOIN.MITER,_this.miterLimit=10,_this}return graphics_extends(LineStyle,_super),LineStyle.prototype.clone=function(){var obj=new LineStyle;return obj.color=this.color,obj.alpha=this.alpha,obj.texture=this.texture,obj.matrix=this.matrix,obj.visible=this.visible,obj.width=this.width,obj.alignment=this.alignment,obj.native=this.native,obj.cap=this.cap,obj.join=this.join,obj.miterLimit=this.miterLimit,obj},LineStyle.prototype.reset=function(){_super.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},LineStyle}(FillStyle),temp=new Float32Array(3),DEFAULT_SHADERS={},Graphics=function(_super){function Graphics(geometry){void 0===geometry&&(geometry=null);var _this=_super.call(this)||this;return _this.shader=null,_this.pluginName="batch",_this.currentPath=null,_this.batches=[],_this.batchTint=-1,_this.batchDirty=-1,_this.vertexData=null,_this._fillStyle=new FillStyle,_this._lineStyle=new LineStyle,_this._matrix=null,_this._holeMode=!1,_this.state=State.for2d(),_this._geometry=geometry||new GraphicsGeometry,_this._geometry.refCount++,_this._transformID=-1,_this.tint=16777215,_this.blendMode=constants_BLEND_MODES.NORMAL,_this}return graphics_extends(Graphics,_super),Object.defineProperty(Graphics.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),Graphics.prototype.clone=function(){return this.finishPoly(),new Graphics(this._geometry)},Object.defineProperty(Graphics.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Graphics.prototype,"tint",{get:function(){return this._tint},set:function(value){this._tint=value},enumerable:!1,configurable:!0}),Object.defineProperty(Graphics.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(Graphics.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),Graphics.prototype.lineStyle=function(options,color,alpha,alignment,native){return void 0===options&&(options=null),void 0===color&&(color=0),void 0===alpha&&(alpha=1),void 0===alignment&&(alignment=.5),void 0===native&&(native=!1),"number"==typeof options&&(options={width:options,color,alpha,alignment,native}),this.lineTextureStyle(options)},Graphics.prototype.lineTextureStyle=function(options){options=Object.assign({width:0,texture:Texture.WHITE,color:options&&options.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10},options),this.currentPath&&this.startPoly();var visible=options.width>0&&options.alpha>0;return visible?(options.matrix&&(options.matrix=options.matrix.clone(),options.matrix.invert()),Object.assign(this._lineStyle,{visible},options)):this._lineStyle.reset(),this},Graphics.prototype.startPoly=function(){if(this.currentPath){var points=this.currentPath.points,len=this.currentPath.points.length;len>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(points[len-2],points[len-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1},Graphics.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},Graphics.prototype.moveTo=function(x,y){return this.startPoly(),this.currentPath.points[0]=x,this.currentPath.points[1]=y,this},Graphics.prototype.lineTo=function(x,y){this.currentPath||this.moveTo(0,0);var points=this.currentPath.points,fromX=points[points.length-2],fromY=points[points.length-1];return fromX===x&&fromY===y||points.push(x,y),this},Graphics.prototype._initCurve=function(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[x,y]):this.moveTo(x,y)},Graphics.prototype.quadraticCurveTo=function(cpX,cpY,toX,toY){this._initCurve();var points=this.currentPath.points;return 0===points.length&&this.moveTo(0,0),QuadraticUtils.curveTo(cpX,cpY,toX,toY,points),this},Graphics.prototype.bezierCurveTo=function(cpX,cpY,cpX2,cpY2,toX,toY){return this._initCurve(),BezierUtils.curveTo(cpX,cpY,cpX2,cpY2,toX,toY,this.currentPath.points),this},Graphics.prototype.arcTo=function(x1,y1,x2,y2,radius){this._initCurve(x1,y1);var points=this.currentPath.points,result=ArcUtils.curveTo(x1,y1,x2,y2,radius,points);if(result){var cx=result.cx,cy=result.cy,radius_1=result.radius,startAngle=result.startAngle,endAngle=result.endAngle,anticlockwise=result.anticlockwise;this.arc(cx,cy,radius_1,startAngle,endAngle,anticlockwise)}return this},Graphics.prototype.arc=function(cx,cy,radius,startAngle,endAngle,anticlockwise){if(void 0===anticlockwise&&(anticlockwise=!1),startAngle===endAngle)return this;if(!anticlockwise&&endAngle<=startAngle?endAngle+=PI_2:anticlockwise&&startAngle<=endAngle&&(startAngle+=PI_2),0===endAngle-startAngle)return this;var startX=cx+Math.cos(startAngle)*radius,startY=cy+Math.sin(startAngle)*radius,eps=this._geometry.closePointEps,points=this.currentPath?this.currentPath.points:null;if(points){var xDiff=Math.abs(points[points.length-2]-startX),yDiff=Math.abs(points[points.length-1]-startY);xDiff<eps&&yDiff<eps||points.push(startX,startY)}else this.moveTo(startX,startY),points=this.currentPath.points;return ArcUtils.arc(startX,startY,cx,cy,radius,startAngle,endAngle,anticlockwise,points),this},Graphics.prototype.beginFill=function(color,alpha){return void 0===color&&(color=0),void 0===alpha&&(alpha=1),this.beginTextureFill({texture:Texture.WHITE,color,alpha})},Graphics.prototype.beginTextureFill=function(options){options=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},options),this.currentPath&&this.startPoly();var visible=options.alpha>0;return visible?(options.matrix&&(options.matrix=options.matrix.clone(),options.matrix.invert()),Object.assign(this._fillStyle,{visible},options)):this._fillStyle.reset(),this},Graphics.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},Graphics.prototype.drawRect=function(x,y,width,height){return this.drawShape(new Rectangle(x,y,width,height))},Graphics.prototype.drawRoundedRect=function(x,y,width,height,radius){return this.drawShape(new RoundedRectangle(x,y,width,height,radius))},Graphics.prototype.drawCircle=function(x,y,radius){return this.drawShape(new Circle(x,y,radius))},Graphics.prototype.drawEllipse=function(x,y,width,height){return this.drawShape(new Ellipse(x,y,width,height))},Graphics.prototype.drawPolygon=function(){for(var points,arguments$1=arguments,path=[],_i=0;_i<arguments.length;_i++)path[_i]=arguments$1[_i];var closeStroke=!0,poly=path[0];poly.points?(closeStroke=poly.closeStroke,points=poly.points):points=Array.isArray(path[0])?path[0]:path;var shape=new Polygon(points);return shape.closeStroke=closeStroke,this.drawShape(shape),this},Graphics.prototype.drawShape=function(shape){return this._holeMode?this._geometry.drawHole(shape,this._matrix):this._geometry.drawShape(shape,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},Graphics.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},Graphics.prototype.isFastRect=function(){var data=this._geometry.graphicsData;return!(1!==data.length||data[0].shape.type!==SHAPES.RECT||data[0].holes.length||data[0].lineStyle.visible&&data[0].lineStyle.width)},Graphics.prototype._render=function(renderer){this.finishPoly();var geometry=this._geometry,hasuint32=renderer.context.supports.uint32Indices;geometry.updateBatches(hasuint32),geometry.batchable?(this.batchDirty!==geometry.batchDirty&&this._populateBatches(),this._renderBatched(renderer)):(renderer.batch.flush(),this._renderDirect(renderer))},Graphics.prototype._populateBatches=function(){var geometry=this._geometry,blendMode=this.blendMode,len=geometry.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=geometry.batchDirty,this.batches.length=len,this.vertexData=new Float32Array(geometry.points);for(var i=0;i<len;i++){var gI=geometry.batches[i],color=gI.style.color,vertexData=new Float32Array(this.vertexData.buffer,4*gI.attribStart*2,2*gI.attribSize),uvs=new Float32Array(geometry.uvsFloat32.buffer,4*gI.attribStart*2,2*gI.attribSize),batch={vertexData,blendMode,indices:new Uint16Array(geometry.indicesUint16.buffer,2*gI.start,gI.size),uvs,_batchRGB:hex2rgb(color),_tintRGB:color,_texture:gI.style.texture,alpha:gI.style.alpha,worldAlpha:1};this.batches[i]=batch}},Graphics.prototype._renderBatched=function(renderer){if(this.batches.length){renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var i=0,l=this.batches.length;i<l;i++){var batch=this.batches[i];batch.worldAlpha=this.worldAlpha*batch.alpha,renderer.plugins[this.pluginName].render(batch)}}},Graphics.prototype._renderDirect=function(renderer){var shader=this._resolveDirectShader(renderer),geometry=this._geometry,tint=this.tint,worldAlpha=this.worldAlpha,uniforms=shader.uniforms,drawCalls=geometry.drawCalls;uniforms.translationMatrix=this.transform.worldTransform,uniforms.tint[0]=(tint>>16&255)/255*worldAlpha,uniforms.tint[1]=(tint>>8&255)/255*worldAlpha,uniforms.tint[2]=(255&tint)/255*worldAlpha,uniforms.tint[3]=worldAlpha,renderer.shader.bind(shader),renderer.geometry.bind(geometry,shader),renderer.state.set(this.state);for(var i=0,l=drawCalls.length;i<l;i++)this._renderDrawCallDirect(renderer,geometry.drawCalls[i])},Graphics.prototype._renderDrawCallDirect=function(renderer,drawCall){for(var texArray=drawCall.texArray,type=drawCall.type,size=drawCall.size,start=drawCall.start,groupTextureCount=texArray.count,j=0;j<groupTextureCount;j++)renderer.texture.bind(texArray.elements[j],j);renderer.geometry.draw(type,size,start)},Graphics.prototype._resolveDirectShader=function(renderer){var shader=this.shader,pluginName=this.pluginName;if(!shader){if(!DEFAULT_SHADERS[pluginName]){for(var MAX_TEXTURES=renderer.plugins.batch.MAX_TEXTURES,sampleValues=new Int32Array(MAX_TEXTURES),i=0;i<MAX_TEXTURES;i++)sampleValues[i]=i;var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:sampleValues},!0)},program=renderer.plugins[pluginName]._shader.program;DEFAULT_SHADERS[pluginName]=new Shader(program,uniforms)}shader=DEFAULT_SHADERS[pluginName]}return shader},Graphics.prototype._calculateBounds=function(){this.finishPoly();var geometry=this._geometry;if(geometry.graphicsData.length){var _a=geometry.bounds,minX=_a.minX,minY=_a.minY,maxX=_a.maxX,maxY=_a.maxY;this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)}},Graphics.prototype.containsPoint=function(point){return this.worldTransform.applyInverse(point,Graphics._TEMP_POINT),this._geometry.containsPoint(Graphics._TEMP_POINT)},Graphics.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var tintRGB=hex2rgb(this.tint,temp),i=0;i<this.batches.length;i++){var batch=this.batches[i],batchTint=batch._batchRGB,color=(tintRGB[0]*batchTint[0]*255<<16)+(tintRGB[1]*batchTint[1]*255<<8)+(0|tintRGB[2]*batchTint[2]*255);batch._tintRGB=(color>>16)+(65280&color)+((255&color)<<16)}}},Graphics.prototype.calculateVertices=function(){var wtID=this.transform._worldID;if(this._transformID!==wtID){this._transformID=wtID;for(var wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,data=this._geometry.points,vertexData=this.vertexData,count=0,i=0;i<data.length;i+=2){var x=data[i],y=data[i+1];vertexData[count++]=a*x+c*y+tx,vertexData[count++]=d*y+b*x+ty}}},Graphics.prototype.closePath=function(){var currentPath=this.currentPath;return currentPath&&(currentPath.closeStroke=!0,this.finishPoly()),this},Graphics.prototype.setMatrix=function(matrix){return this._matrix=matrix,this},Graphics.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},Graphics.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},Graphics.prototype.destroy=function(options){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,_super.prototype.destroy.call(this,options)},Graphics._TEMP_POINT=new Point,Graphics}(Container),graphicsUtils={buildPoly,buildCircle,buildRectangle,buildRoundedRectangle,buildLine,ArcUtils,BezierUtils,QuadraticUtils,BatchPart,FILL_COMMANDS,BATCH_POOL,DRAW_CALL_POOL},sprite_extendStatics=function(d,b){return sprite_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},sprite_extendStatics(d,b)};var TEXT_GRADIENT,tempPoint=new Point,indices=new Uint16Array([0,1,2,0,2,3]),Sprite=function(_super){function Sprite(texture){var _this=_super.call(this)||this;return _this._anchor=new ObservablePoint(_this._onAnchorUpdate,_this,texture?texture.defaultAnchor.x:0,texture?texture.defaultAnchor.y:0),_this._texture=null,_this._width=0,_this._height=0,_this._tint=null,_this._tintRGB=null,_this.tint=16777215,_this.blendMode=constants_BLEND_MODES.NORMAL,_this._cachedTint=16777215,_this.uvs=null,_this.texture=texture||Texture.EMPTY,_this.vertexData=new Float32Array(8),_this.vertexTrimmedData=null,_this._transformID=-1,_this._textureID=-1,_this._transformTrimmedID=-1,_this._textureTrimmedID=-1,_this.indices=indices,_this.pluginName="batch",_this.isSprite=!0,_this._roundPixels=settings.ROUND_PIXELS,_this}return function(d,b){function __(){this.constructor=d}sprite_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(Sprite,_super),Sprite.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)},Sprite.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},Sprite.prototype.calculateVertices=function(){var texture=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==texture._updateID){this._textureID!==texture._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=texture._updateID;var wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,vertexData=this.vertexData,trim=texture.trim,orig=texture.orig,anchor=this._anchor,w0=0,w1=0,h0=0,h1=0;if(trim?(w0=(w1=trim.x-anchor._x*orig.width)+trim.width,h0=(h1=trim.y-anchor._y*orig.height)+trim.height):(w0=(w1=-anchor._x*orig.width)+orig.width,h0=(h1=-anchor._y*orig.height)+orig.height),vertexData[0]=a*w1+c*h1+tx,vertexData[1]=d*h1+b*w1+ty,vertexData[2]=a*w0+c*h1+tx,vertexData[3]=d*h1+b*w0+ty,vertexData[4]=a*w0+c*h0+tx,vertexData[5]=d*h0+b*w0+ty,vertexData[6]=a*w1+c*h0+tx,vertexData[7]=d*h0+b*w1+ty,this._roundPixels)for(var resolution=settings.RESOLUTION,i=0;i<vertexData.length;++i)vertexData[i]=Math.round((vertexData[i]*resolution|0)/resolution)}},Sprite.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var texture=this._texture,vertexData=this.vertexTrimmedData,orig=texture.orig,anchor=this._anchor,wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,w1=-anchor._x*orig.width,w0=w1+orig.width,h1=-anchor._y*orig.height,h0=h1+orig.height;vertexData[0]=a*w1+c*h1+tx,vertexData[1]=d*h1+b*w1+ty,vertexData[2]=a*w0+c*h1+tx,vertexData[3]=d*h1+b*w0+ty,vertexData[4]=a*w0+c*h0+tx,vertexData[5]=d*h0+b*w0+ty,vertexData[6]=a*w1+c*h0+tx,vertexData[7]=d*h0+b*w1+ty},Sprite.prototype._render=function(renderer){this.calculateVertices(),renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this)},Sprite.prototype._calculateBounds=function(){var trim=this._texture.trim,orig=this._texture.orig;!trim||trim.width===orig.width&&trim.height===orig.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},Sprite.prototype.getLocalBounds=function(rect){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._bounds.getRectangle(rect)):_super.prototype.getLocalBounds.call(this,rect)},Sprite.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var width=this._texture.orig.width,height=this._texture.orig.height,x1=-width*this.anchor.x,y1=0;return tempPoint.x>=x1&&tempPoint.x<x1+width&&(y1=-height*this.anchor.y,tempPoint.y>=y1&&tempPoint.y<y1+height)},Sprite.prototype.destroy=function(options){if(_super.prototype.destroy.call(this,options),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof options?options:options&&options.texture){var destroyBaseTexture="boolean"==typeof options?options:options&&options.baseTexture;this._texture.destroy(!!destroyBaseTexture)}this._texture=null},Sprite.from=function(source,options){return new Sprite(source instanceof Texture?source:Texture.from(source,options))},Object.defineProperty(Sprite.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(value){this._roundPixels!==value&&(this._transformID=-1),this._roundPixels=value},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(value){var s=sign(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width,this._width=value},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(value){var s=sign(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height,this._height=value},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"anchor",{get:function(){return this._anchor},set:function(value){this._anchor.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"tint",{get:function(){return this._tint},set:function(value){this._tint=value,this._tintRGB=(value>>16)+(65280&value)+((255&value)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"texture",{get:function(){return this._texture},set:function(value){this._texture!==value&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=value||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,value&&(value.baseTexture.valid?this._onTextureUpdate():value.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),Sprite}(Container),text_extendStatics=function(d,b){return text_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},text_extendStatics(d,b)};!function(TEXT_GRADIENT){TEXT_GRADIENT[TEXT_GRADIENT.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",TEXT_GRADIENT[TEXT_GRADIENT.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"}(TEXT_GRADIENT||(TEXT_GRADIENT={}));var defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],TextStyle=function(){function TextStyle(style){this.styleID=0,this.reset(),deepCopyProperties(this,style,style)}return TextStyle.prototype.clone=function(){var clonedProperties={};return deepCopyProperties(clonedProperties,this,defaultStyle),new TextStyle(clonedProperties)},TextStyle.prototype.reset=function(){deepCopyProperties(this,defaultStyle,defaultStyle)},Object.defineProperty(TextStyle.prototype,"align",{get:function(){return this._align},set:function(align){this._align!==align&&(this._align=align,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"breakWords",{get:function(){return this._breakWords},set:function(breakWords){this._breakWords!==breakWords&&(this._breakWords=breakWords,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(dropShadow){this._dropShadow!==dropShadow&&(this._dropShadow=dropShadow,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(dropShadowAlpha){this._dropShadowAlpha!==dropShadowAlpha&&(this._dropShadowAlpha=dropShadowAlpha,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(dropShadowAngle){this._dropShadowAngle!==dropShadowAngle&&(this._dropShadowAngle=dropShadowAngle,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(dropShadowBlur){this._dropShadowBlur!==dropShadowBlur&&(this._dropShadowBlur=dropShadowBlur,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(dropShadowColor){var outputColor=getColor(dropShadowColor);this._dropShadowColor!==outputColor&&(this._dropShadowColor=outputColor,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(dropShadowDistance){this._dropShadowDistance!==dropShadowDistance&&(this._dropShadowDistance=dropShadowDistance,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"fill",{get:function(){return this._fill},set:function(fill){var outputColor=getColor(fill);this._fill!==outputColor&&(this._fill=outputColor,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(fillGradientType){this._fillGradientType!==fillGradientType&&(this._fillGradientType=fillGradientType,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(fillGradientStops){(function(array1,array2){if(!Array.isArray(array1)||!Array.isArray(array2))return!1;if(array1.length!==array2.length)return!1;for(var i=0;i<array1.length;++i)if(array1[i]!==array2[i])return!1;return!0})(this._fillGradientStops,fillGradientStops)||(this._fillGradientStops=fillGradientStops,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(fontFamily){this.fontFamily!==fontFamily&&(this._fontFamily=fontFamily,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"fontSize",{get:function(){return this._fontSize},set:function(fontSize){this._fontSize!==fontSize&&(this._fontSize=fontSize,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(fontStyle){this._fontStyle!==fontStyle&&(this._fontStyle=fontStyle,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(fontVariant){this._fontVariant!==fontVariant&&(this._fontVariant=fontVariant,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(fontWeight){this._fontWeight!==fontWeight&&(this._fontWeight=fontWeight,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(letterSpacing){this._letterSpacing!==letterSpacing&&(this._letterSpacing=letterSpacing,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(lineHeight){this._lineHeight!==lineHeight&&(this._lineHeight=lineHeight,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"leading",{get:function(){return this._leading},set:function(leading){this._leading!==leading&&(this._leading=leading,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(lineJoin){this._lineJoin!==lineJoin&&(this._lineJoin=lineJoin,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(miterLimit){this._miterLimit!==miterLimit&&(this._miterLimit=miterLimit,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"padding",{get:function(){return this._padding},set:function(padding){this._padding!==padding&&(this._padding=padding,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"stroke",{get:function(){return this._stroke},set:function(stroke){var outputColor=getColor(stroke);this._stroke!==outputColor&&(this._stroke=outputColor,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(strokeThickness){this._strokeThickness!==strokeThickness&&(this._strokeThickness=strokeThickness,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(textBaseline){this._textBaseline!==textBaseline&&(this._textBaseline=textBaseline,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"trim",{get:function(){return this._trim},set:function(trim){this._trim!==trim&&(this._trim=trim,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(whiteSpace){this._whiteSpace!==whiteSpace&&(this._whiteSpace=whiteSpace,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(wordWrap){this._wordWrap!==wordWrap&&(this._wordWrap=wordWrap,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(TextStyle.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(wordWrapWidth){this._wordWrapWidth!==wordWrapWidth&&(this._wordWrapWidth=wordWrapWidth,this.styleID++)},enumerable:!1,configurable:!0}),TextStyle.prototype.toFontString=function(){var fontSizeString="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,fontFamilies=this.fontFamily;Array.isArray(this.fontFamily)||(fontFamilies=this.fontFamily.split(","));for(var i=fontFamilies.length-1;i>=0;i--){var fontFamily=fontFamilies[i].trim();!/([\"\'])[^\'\"]+\1/.test(fontFamily)&&genericFontFamilies.indexOf(fontFamily)<0&&(fontFamily='"'+fontFamily+'"'),fontFamilies[i]=fontFamily}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+fontSizeString+" "+fontFamilies.join(",")},TextStyle}();function getSingleColor(color){return"number"==typeof color?hex2string(color):("string"==typeof color&&0===color.indexOf("0x")&&(color=color.replace("0x","#")),color)}function getColor(color){if(Array.isArray(color)){for(var i=0;i<color.length;++i)color[i]=getSingleColor(color[i]);return color}return getSingleColor(color)}function deepCopyProperties(target,source,propertyObj){for(var prop in propertyObj)Array.isArray(source[prop])?target[prop]=source[prop].slice():target[prop]=source[prop]}var TextMetrics=function(){function TextMetrics(text,style,width,height,lines,lineWidths,lineHeight,maxLineWidth,fontProperties){this.text=text,this.style=style,this.width=width,this.height=height,this.lines=lines,this.lineWidths=lineWidths,this.lineHeight=lineHeight,this.maxLineWidth=maxLineWidth,this.fontProperties=fontProperties}return TextMetrics.measureText=function(text,style,wordWrap,canvas){void 0===canvas&&(canvas=TextMetrics._canvas),wordWrap=null==wordWrap?style.wordWrap:wordWrap;var font=style.toFontString(),fontProperties=TextMetrics.measureFont(font);0===fontProperties.fontSize&&(fontProperties.fontSize=style.fontSize,fontProperties.ascent=style.fontSize);var context=canvas.getContext("2d");context.font=font;for(var lines=(wordWrap?TextMetrics.wordWrap(text,style,canvas):text).split(/(?:\r\n|\r|\n)/),lineWidths=new Array(lines.length),maxLineWidth=0,i=0;i<lines.length;i++){var lineWidth=context.measureText(lines[i]).width+(lines[i].length-1)*style.letterSpacing;lineWidths[i]=lineWidth,maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+style.strokeThickness;style.dropShadow&&(width+=style.dropShadowDistance);var lineHeight=style.lineHeight||fontProperties.fontSize+style.strokeThickness,height=Math.max(lineHeight,fontProperties.fontSize+style.strokeThickness)+(lines.length-1)*(lineHeight+style.leading);return style.dropShadow&&(height+=style.dropShadowDistance),new TextMetrics(text,style,width,height,lines,lineWidths,lineHeight+style.leading,maxLineWidth,fontProperties)},TextMetrics.wordWrap=function(text,style,canvas){void 0===canvas&&(canvas=TextMetrics._canvas);for(var context=canvas.getContext("2d"),width=0,line="",lines="",cache=Object.create(null),letterSpacing=style.letterSpacing,whiteSpace=style.whiteSpace,collapseSpaces=TextMetrics.collapseSpaces(whiteSpace),collapseNewlines=TextMetrics.collapseNewlines(whiteSpace),canPrependSpaces=!collapseSpaces,wordWrapWidth=style.wordWrapWidth+letterSpacing,tokens=TextMetrics.tokenize(text),i=0;i<tokens.length;i++){var token=tokens[i];if(TextMetrics.isNewline(token)){if(!collapseNewlines){lines+=TextMetrics.addLine(line),canPrependSpaces=!collapseSpaces,line="",width=0;continue}token=" "}if(collapseSpaces){var currIsBreakingSpace=TextMetrics.isBreakingSpace(token),lastIsBreakingSpace=TextMetrics.isBreakingSpace(line[line.length-1]);if(currIsBreakingSpace&&lastIsBreakingSpace)continue}var tokenWidth=TextMetrics.getFromCache(token,letterSpacing,cache,context);if(tokenWidth>wordWrapWidth)if(""!==line&&(lines+=TextMetrics.addLine(line),line="",width=0),TextMetrics.canBreakWords(token,style.breakWords))for(var characters=TextMetrics.wordWrapSplit(token),j=0;j<characters.length;j++){for(var char=characters[j],k=1;characters[j+k];){var nextChar=characters[j+k],lastChar=char[char.length-1];if(TextMetrics.canBreakChars(lastChar,nextChar,token,j,style.breakWords))break;char+=nextChar,k++}j+=char.length-1;var characterWidth=TextMetrics.getFromCache(char,letterSpacing,cache,context);characterWidth+width>wordWrapWidth&&(lines+=TextMetrics.addLine(line),canPrependSpaces=!1,line="",width=0),line+=char,width+=characterWidth}else{line.length>0&&(lines+=TextMetrics.addLine(line),line="",width=0);var isLastToken=i===tokens.length-1;lines+=TextMetrics.addLine(token,!isLastToken),canPrependSpaces=!1,line="",width=0}else tokenWidth+width>wordWrapWidth&&(canPrependSpaces=!1,lines+=TextMetrics.addLine(line),line="",width=0),(line.length>0||!TextMetrics.isBreakingSpace(token)||canPrependSpaces)&&(line+=token,width+=tokenWidth)}return lines+=TextMetrics.addLine(line,!1)},TextMetrics.addLine=function(line,newLine){return void 0===newLine&&(newLine=!0),line=TextMetrics.trimRight(line),line=newLine?line+"\n":line},TextMetrics.getFromCache=function(key,letterSpacing,cache,context){var width=cache[key];if("number"!=typeof width){var spacing=key.length*letterSpacing;width=context.measureText(key).width+spacing,cache[key]=width}return width},TextMetrics.collapseSpaces=function(whiteSpace){return"normal"===whiteSpace||"pre-line"===whiteSpace},TextMetrics.collapseNewlines=function(whiteSpace){return"normal"===whiteSpace},TextMetrics.trimRight=function(text){if("string"!=typeof text)return"";for(var i=text.length-1;i>=0;i--){var char=text[i];if(!TextMetrics.isBreakingSpace(char))break;text=text.slice(0,-1)}return text},TextMetrics.isNewline=function(char){return"string"==typeof char&&TextMetrics._newlines.indexOf(char.charCodeAt(0))>=0},TextMetrics.isBreakingSpace=function(char,_nextChar){return"string"==typeof char&&TextMetrics._breakingSpaces.indexOf(char.charCodeAt(0))>=0},TextMetrics.tokenize=function(text){var tokens=[],token="";if("string"!=typeof text)return tokens;for(var i=0;i<text.length;i++){var char=text[i],nextChar=text[i+1];TextMetrics.isBreakingSpace(char,nextChar)||TextMetrics.isNewline(char)?(""!==token&&(tokens.push(token),token=""),tokens.push(char)):token+=char}return""!==token&&tokens.push(token),tokens},TextMetrics.canBreakWords=function(_token,breakWords){return breakWords},TextMetrics.canBreakChars=function(_char,_nextChar,_token,_index,_breakWords){return!0},TextMetrics.wordWrapSplit=function(token){return token.split("")},TextMetrics.measureFont=function(font){if(TextMetrics._fonts[font])return TextMetrics._fonts[font];var properties={ascent:0,descent:0,fontSize:0},canvas=TextMetrics._canvas,context=TextMetrics._context;context.font=font;var metricsString=TextMetrics.METRICS_STRING+TextMetrics.BASELINE_SYMBOL,width=Math.ceil(context.measureText(metricsString).width),baseline=Math.ceil(context.measureText(TextMetrics.BASELINE_SYMBOL).width),height=Math.ceil(TextMetrics.HEIGHT_MULTIPLIER*baseline);baseline=baseline*TextMetrics.BASELINE_MULTIPLIER|0,canvas.width=width,canvas.height=height,context.fillStyle="#f00",context.fillRect(0,0,width,height),context.font=font,context.textBaseline="alphabetic",context.fillStyle="#000",context.fillText(metricsString,0,baseline);var imagedata=context.getImageData(0,0,width,height).data,pixels=imagedata.length,line=4*width,i=0,idx=0,stop=!1;for(i=0;i<baseline;++i){for(var j=0;j<line;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx+=line}for(properties.ascent=baseline-i,idx=pixels-line,stop=!1,i=height;i>baseline;--i){for(j=0;j<line;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx-=line}return properties.descent=i-baseline,properties.fontSize=properties.ascent+properties.descent,TextMetrics._fonts[font]=properties,properties},TextMetrics.clearMetrics=function(font){void 0===font&&(font=""),font?delete TextMetrics._fonts[font]:TextMetrics._fonts={}},TextMetrics}(),canvas=function(){try{var c=new OffscreenCanvas(0,0),context=c.getContext("2d");return context&&context.measureText?c:document.createElement("canvas")}catch(ex){return document.createElement("canvas")}}();canvas.width=canvas.height=10,TextMetrics._canvas=canvas,TextMetrics._context=canvas.getContext("2d"),TextMetrics._fonts={},TextMetrics.METRICS_STRING="|ÉqÅ",TextMetrics.BASELINE_SYMBOL="M",TextMetrics.BASELINE_MULTIPLIER=1.4,TextMetrics.HEIGHT_MULTIPLIER=2,TextMetrics._newlines=[10,13],TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Text=function(_super){function Text(text,style,canvas){var _this=this,ownCanvas=!1;canvas||(canvas=document.createElement("canvas"),ownCanvas=!0),canvas.width=3,canvas.height=3;var texture=Texture.from(canvas);return texture.orig=new Rectangle,texture.trim=new Rectangle,(_this=_super.call(this,texture)||this)._ownCanvas=ownCanvas,_this.canvas=canvas,_this.context=_this.canvas.getContext("2d"),_this._resolution=settings.RESOLUTION,_this._autoResolution=!0,_this._text=null,_this._style=null,_this._styleListener=null,_this._font="",_this.text=text,_this.style=style,_this.localStyleID=-1,_this}return function(d,b){function __(){this.constructor=d}text_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(Text,_super),Text.prototype.updateText=function(respectDirty){var style=this._style;if(this.localStyleID!==style.styleID&&(this.dirty=!0,this.localStyleID=style.styleID),this.dirty||!respectDirty){this._font=this._style.toFontString();var linePositionX,linePositionY,context=this.context,measured=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),width=measured.width,height=measured.height,lines=measured.lines,lineHeight=measured.lineHeight,lineWidths=measured.lineWidths,maxLineWidth=measured.maxLineWidth,fontProperties=measured.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,width)+2*style.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,height)+2*style.padding)*this._resolution),context.scale(this._resolution,this._resolution),context.clearRect(0,0,this.canvas.width,this.canvas.height),context.font=this._font,context.lineWidth=style.strokeThickness,context.textBaseline=style.textBaseline,context.lineJoin=style.lineJoin,context.miterLimit=style.miterLimit;for(var passesCount=style.dropShadow?2:1,i=0;i<passesCount;++i){var isShadowPass=style.dropShadow&&0===i,dsOffsetText=isShadowPass?Math.ceil(Math.max(1,height)+2*style.padding):0,dsOffsetShadow=dsOffsetText*this._resolution;if(isShadowPass){context.fillStyle="black",context.strokeStyle="black";var dropShadowColor=style.dropShadowColor,rgb=hex2rgb("number"==typeof dropShadowColor?dropShadowColor:string2hex(dropShadowColor));context.shadowColor="rgba("+255*rgb[0]+","+255*rgb[1]+","+255*rgb[2]+","+style.dropShadowAlpha+")",context.shadowBlur=style.dropShadowBlur,context.shadowOffsetX=Math.cos(style.dropShadowAngle)*style.dropShadowDistance,context.shadowOffsetY=Math.sin(style.dropShadowAngle)*style.dropShadowDistance+dsOffsetShadow}else context.fillStyle=this._generateFillStyle(style,lines,measured),context.strokeStyle=style.stroke,context.shadowColor="black",context.shadowBlur=0,context.shadowOffsetX=0,context.shadowOffsetY=0;var linePositionYShift=(lineHeight-fontProperties.fontSize)/2;(!Text.nextLineHeightBehavior||lineHeight-fontProperties.fontSize<0)&&(linePositionYShift=0);for(var i_1=0;i_1<lines.length;i_1++)linePositionX=style.strokeThickness/2,linePositionY=style.strokeThickness/2+i_1*lineHeight+fontProperties.ascent+linePositionYShift,"right"===style.align?linePositionX+=maxLineWidth-lineWidths[i_1]:"center"===style.align&&(linePositionX+=(maxLineWidth-lineWidths[i_1])/2),style.stroke&&style.strokeThickness&&this.drawLetterSpacing(lines[i_1],linePositionX+style.padding,linePositionY+style.padding-dsOffsetText,!0),style.fill&&this.drawLetterSpacing(lines[i_1],linePositionX+style.padding,linePositionY+style.padding-dsOffsetText)}this.updateTexture()}},Text.prototype.drawLetterSpacing=function(text,x,y,isStroke){void 0===isStroke&&(isStroke=!1);var letterSpacing=this._style.letterSpacing;if(0!==letterSpacing)for(var currentPosition=x,stringArray=Array.from?Array.from(text):text.split(""),previousWidth=this.context.measureText(text).width,currentWidth=0,i=0;i<stringArray.length;++i){var currentChar=stringArray[i];isStroke?this.context.strokeText(currentChar,currentPosition,y):this.context.fillText(currentChar,currentPosition,y),currentPosition+=previousWidth-(currentWidth=this.context.measureText(text.substring(i+1)).width)+letterSpacing,previousWidth=currentWidth}else isStroke?this.context.strokeText(text,x,y):this.context.fillText(text,x,y)},Text.prototype.updateTexture=function(){var canvas=this.canvas;if(this._style.trim){var trimmed=trimCanvas(canvas);trimmed.data&&(canvas.width=trimmed.width,canvas.height=trimmed.height,this.context.putImageData(trimmed.data,0,0))}var texture=this._texture,style=this._style,padding=style.trim?0:style.padding,baseTexture=texture.baseTexture;texture.trim.width=texture._frame.width=canvas.width/this._resolution,texture.trim.height=texture._frame.height=canvas.height/this._resolution,texture.trim.x=-padding,texture.trim.y=-padding,texture.orig.width=texture._frame.width-2*padding,texture.orig.height=texture._frame.height-2*padding,this._onTextureUpdate(),baseTexture.setRealSize(canvas.width,canvas.height,this._resolution),texture.updateUvs(),this._recursivePostUpdateTransform(),this.dirty=!1},Text.prototype._render=function(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),_super.prototype._render.call(this,renderer)},Text.prototype.getLocalBounds=function(rect){return this.updateText(!0),_super.prototype.getLocalBounds.call(this,rect)},Text.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},Text.prototype._generateFillStyle=function(style,lines,metrics){var gradient,fillStyle=style.fill;if(!Array.isArray(fillStyle))return fillStyle;if(1===fillStyle.length)return fillStyle[0];var dropShadowCorrection=style.dropShadow?style.dropShadowDistance:0,padding=style.padding||0,width=this.canvas.width/this._resolution-dropShadowCorrection-2*padding,height=this.canvas.height/this._resolution-dropShadowCorrection-2*padding,fill=fillStyle.slice(),fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length)for(var lengthPlus1=fill.length+1,i=1;i<lengthPlus1;++i)fillGradientStops.push(i/lengthPlus1);if(fill.unshift(fillStyle[0]),fillGradientStops.unshift(0),fill.push(fillStyle[fillStyle.length-1]),fillGradientStops.push(1),style.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=this.context.createLinearGradient(width/2,padding,width/2,height+padding);var textHeight=metrics.fontProperties.fontSize+style.strokeThickness;for(i=0;i<lines.length;i++){var lastLineBottom=metrics.lineHeight*(i-1)+textHeight,thisLineTop=metrics.lineHeight*i,thisLineGradientStart=thisLineTop;i>0&&lastLineBottom>thisLineTop&&(thisLineGradientStart=(thisLineTop+lastLineBottom)/2);var thisLineBottom=thisLineTop+textHeight,nextLineTop=metrics.lineHeight*(i+1),thisLineGradientEnd=thisLineBottom;i+1<lines.length&&nextLineTop<thisLineBottom&&(thisLineGradientEnd=(thisLineBottom+nextLineTop)/2);for(var gradStopLineHeight=(thisLineGradientEnd-thisLineGradientStart)/height,j=0;j<fill.length;j++){var lineStop=0;lineStop="number"==typeof fillGradientStops[j]?fillGradientStops[j]:j/fill.length;var globalStop=Math.min(1,Math.max(0,thisLineGradientStart/height+lineStop*gradStopLineHeight));globalStop=Number(globalStop.toFixed(5)),gradient.addColorStop(globalStop,fill[j])}}}else{gradient=this.context.createLinearGradient(padding,height/2,width+padding,height/2);var totalIterations=fill.length+1,currentIteration=1;for(i=0;i<fill.length;i++){var stop=void 0;stop="number"==typeof fillGradientStops[i]?fillGradientStops[i]:currentIteration/totalIterations,gradient.addColorStop(stop,fill[i]),currentIteration++}}return gradient},Text.prototype.destroy=function(options){"boolean"==typeof options&&(options={children:options}),options=Object.assign({},defaultDestroyOptions,options),_super.prototype.destroy.call(this,options),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(Text.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(value){this.updateText(!0);var s=sign(this.scale.x)||1;this.scale.x=s*value/this._texture.orig.width,this._width=value},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(value){this.updateText(!0);var s=sign(this.scale.y)||1;this.scale.y=s*value/this._texture.orig.height,this._height=value},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"style",{get:function(){return this._style},set:function(style){style=style||{},this._style=style instanceof TextStyle?style:new TextStyle(style),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"text",{get:function(){return this._text},set:function(text){text=String(null==text?"":text),this._text!==text&&(this._text=text,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"resolution",{get:function(){return this._resolution},set:function(value){this._autoResolution=!1,this._resolution!==value&&(this._resolution=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Text.nextLineHeightBehavior=!1,Text}(Sprite);settings.UPLOADS_PER_FRAME=4;var prepare_extendStatics=function(d,b){return prepare_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},prepare_extendStatics(d,b)};var CountLimiter=function(){function CountLimiter(maxItemsPerFrame){this.maxItemsPerFrame=maxItemsPerFrame,this.itemsLeft=0}return CountLimiter.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},CountLimiter.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},CountLimiter}();function findMultipleBaseTextures(item,queue){var result=!1;if(item&&item._textures&&item._textures.length)for(var i=0;i<item._textures.length;i++)if(item._textures[i]instanceof Texture){var baseTexture=item._textures[i].baseTexture;-1===queue.indexOf(baseTexture)&&(queue.push(baseTexture),result=!0)}return result}function findBaseTexture(item,queue){if(item.baseTexture instanceof BaseTexture){var texture=item.baseTexture;return-1===queue.indexOf(texture)&&queue.push(texture),!0}return!1}function findTexture(item,queue){if(item._texture&&item._texture instanceof Texture){var texture=item._texture.baseTexture;return-1===queue.indexOf(texture)&&queue.push(texture),!0}return!1}function drawText(_helper,item){return item instanceof Text&&(item.updateText(!0),!0)}function calculateTextStyle(_helper,item){if(item instanceof TextStyle){var font=item.toFontString();return TextMetrics.measureFont(font),!0}return!1}function findText(item,queue){if(item instanceof Text){-1===queue.indexOf(item.style)&&queue.push(item.style),-1===queue.indexOf(item)&&queue.push(item);var texture=item._texture.baseTexture;return-1===queue.indexOf(texture)&&queue.push(texture),!0}return!1}function findTextStyle(item,queue){return item instanceof TextStyle&&(-1===queue.indexOf(item)&&queue.push(item),!0)}var BasePrepare=function(){function BasePrepare(renderer){var _this=this;this.limiter=new CountLimiter(settings.UPLOADS_PER_FRAME),this.renderer=renderer,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){_this.queue&&_this.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}return BasePrepare.prototype.upload=function(item,done){"function"==typeof item&&(done=item,item=null),item&&this.add(item),this.queue.length?(done&&this.completes.push(done),this.ticking||(this.ticking=!0,Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY))):done&&done()},BasePrepare.prototype.tick=function(){setTimeout(this.delayedTick,0)},BasePrepare.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var item=this.queue[0],uploaded=!1;if(item&&!item._destroyed)for(var i=0,len=this.uploadHooks.length;i<len;i++)if(this.uploadHooks[i](this.uploadHookHelper,item)){this.queue.shift(),uploaded=!0;break}uploaded||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;var completes=this.completes.slice(0);this.completes.length=0;for(i=0,len=completes.length;i<len;i++)completes[i]()}},BasePrepare.prototype.registerFindHook=function(addHook){return addHook&&this.addHooks.push(addHook),this},BasePrepare.prototype.registerUploadHook=function(uploadHook){return uploadHook&&this.uploadHooks.push(uploadHook),this},BasePrepare.prototype.add=function(item){for(var i=0,len=this.addHooks.length;i<len&&!this.addHooks[i](item,this.queue);i++);if(item instanceof Container)for(i=item.children.length-1;i>=0;i--)this.add(item.children[i]);return this},BasePrepare.prototype.destroy=function(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},BasePrepare}();function uploadBaseTextures(renderer,item){return item instanceof BaseTexture&&(item._glTextures[renderer.CONTEXT_UID]||renderer.texture.bind(item),!0)}function uploadGraphics(renderer,item){if(!(item instanceof Graphics))return!1;var geometry=item.geometry;item.finishPoly(),geometry.updateBatches();for(var batches=geometry.batches,i=0;i<batches.length;i++){var texture=batches[i].style.texture;texture&&uploadBaseTextures(renderer,texture.baseTexture)}return geometry.batchable||renderer.geometry.bind(geometry,item._resolveDirectShader(renderer)),!0}function findGraphics(item,queue){return item instanceof Graphics&&(queue.push(item),!0)}var Prepare=function(_super){function Prepare(renderer){var _this=_super.call(this,renderer)||this;return _this.uploadHookHelper=_this.renderer,_this.registerFindHook(findGraphics),_this.registerUploadHook(uploadBaseTextures),_this.registerUploadHook(uploadGraphics),_this}return function(d,b){function __(){this.constructor=d}prepare_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(Prepare,_super),Prepare}(BasePrepare),TimeLimiter=function(){function TimeLimiter(maxMilliseconds){this.maxMilliseconds=maxMilliseconds,this.frameStart=0}return TimeLimiter.prototype.beginFrame=function(){this.frameStart=Date.now()},TimeLimiter.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},TimeLimiter}(),Spritesheet=function(){function Spritesheet(texture,data,resolutionFilename){void 0===resolutionFilename&&(resolutionFilename=null),this._texture=texture instanceof Texture?texture:null,this.baseTexture=texture instanceof BaseTexture?texture:this._texture.baseTexture,this.textures={},this.animations={},this.data=data;var resource=this.baseTexture.resource;this.resolution=this._updateResolution(resolutionFilename||(resource?resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return Spritesheet.prototype._updateResolution=function(resolutionFilename){void 0===resolutionFilename&&(resolutionFilename=null);var scale=this.data.meta.scale,resolution=getResolutionOfUrl(resolutionFilename,null);return null===resolution&&(resolution=void 0!==scale?parseFloat(scale):1),1!==resolution&&this.baseTexture.setResolution(resolution),resolution},Spritesheet.prototype.parse=function(callback){this._batchIndex=0,this._callback=callback,this._frameKeys.length<=Spritesheet.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},Spritesheet.prototype._processFrames=function(initialFrameIndex){for(var frameIndex=initialFrameIndex,maxFrames=Spritesheet.BATCH_SIZE;frameIndex-initialFrameIndex<maxFrames&&frameIndex<this._frameKeys.length;){var i=this._frameKeys[frameIndex],data=this._frames[i],rect=data.frame;if(rect){var frame=null,trim=null,sourceSize=!1!==data.trimmed&&data.sourceSize?data.sourceSize:data.frame,orig=new Rectangle(0,0,Math.floor(sourceSize.w)/this.resolution,Math.floor(sourceSize.h)/this.resolution);frame=data.rotated?new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.h)/this.resolution,Math.floor(rect.w)/this.resolution):new Rectangle(Math.floor(rect.x)/this.resolution,Math.floor(rect.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution),!1!==data.trimmed&&data.spriteSourceSize&&(trim=new Rectangle(Math.floor(data.spriteSourceSize.x)/this.resolution,Math.floor(data.spriteSourceSize.y)/this.resolution,Math.floor(rect.w)/this.resolution,Math.floor(rect.h)/this.resolution)),this.textures[i]=new Texture(this.baseTexture,frame,orig,trim,data.rotated?2:0,data.anchor),Texture.addToCache(this.textures[i],i)}frameIndex++}},Spritesheet.prototype._processAnimations=function(){var animations=this.data.animations||{};for(var animName in animations){this.animations[animName]=[];for(var i=0;i<animations[animName].length;i++){var frameName=animations[animName][i];this.animations[animName].push(this.textures[frameName])}}},Spritesheet.prototype._parseComplete=function(){var callback=this._callback;this._callback=null,this._batchIndex=0,callback.call(this,this.textures)},Spritesheet.prototype._nextBatch=function(){var _this=this;this._processFrames(this._batchIndex*Spritesheet.BATCH_SIZE),this._batchIndex++,setTimeout((function(){_this._batchIndex*Spritesheet.BATCH_SIZE<_this._frameKeys.length?_this._nextBatch():(_this._processAnimations(),_this._parseComplete())}),0)},Spritesheet.prototype.destroy=function(destroyBase){var _a;for(var i in void 0===destroyBase&&(destroyBase=!1),this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,destroyBase&&(null===(_a=this._texture)||void 0===_a||_a.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},Spritesheet.BATCH_SIZE=1e3,Spritesheet}(),SpritesheetLoader=function(){function SpritesheetLoader(){}return SpritesheetLoader.use=function(resource,next){var _a,_b,loader=this,imageResourceName=resource.name+"_image";if(resource.data&&resource.type===LoaderResource.TYPE.JSON&&resource.data.frames&&!loader.resources[imageResourceName]){var multiPacks=null===(_b=null===(_a=resource.data)||void 0===_a?void 0:_a.meta)||void 0===_b?void 0:_b.related_multi_packs;if(Array.isArray(multiPacks))for(var _loop_1=function(item){if("string"!=typeof item)return"continue";var itemName=item.replace(".json",""),itemUrl=utils_url.resolve(resource.url.replace(loader.baseUrl,""),item);if(loader.resources[itemName]||Object.values(loader.resources).some((function(r){return utils_url.format(utils_url.parse(r.url))===itemUrl})))return"continue";var options={crossOrigin:resource.crossOrigin,loadType:LoaderResource.LOAD_TYPE.XHR,xhrType:LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:resource};loader.add(itemName,itemUrl,options)},_i=0,multiPacks_1=multiPacks;_i<multiPacks_1.length;_i++){_loop_1(multiPacks_1[_i])}var loadOptions={crossOrigin:resource.crossOrigin,metadata:resource.metadata.imageMetadata,parentResource:resource},resourcePath=SpritesheetLoader.getResourcePath(resource,loader.baseUrl);loader.add(imageResourceName,resourcePath,loadOptions,(function(res){if(res.error)next(res.error);else{var spritesheet=new Spritesheet(res.texture,resource.data,resource.url);spritesheet.parse((function(){resource.spritesheet=spritesheet,resource.textures=spritesheet.textures,next()}))}}))}else next()},SpritesheetLoader.getResourcePath=function(resource,baseUrl){return resource.isDataUrl?resource.data.meta.image:utils_url.resolve(resource.url.replace(baseUrl,""),resource.data.meta.image)},SpritesheetLoader}(),sprite_tiling_extendStatics=function(d,b){return sprite_tiling_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},sprite_tiling_extendStatics(d,b)};function sprite_tiling_extends(d,b){function __(){this.constructor=d}sprite_tiling_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var sprite_tiling_tempPoint=new Point,TilingSprite=function(_super){function TilingSprite(texture,width,height){void 0===width&&(width=100),void 0===height&&(height=100);var _this=_super.call(this,texture)||this;return _this.tileTransform=new Transform,_this._width=width,_this._height=height,_this.uvMatrix=_this.texture.uvMatrix||new TextureMatrix(texture),_this.pluginName="tilingSprite",_this.uvRespectAnchor=!1,_this}return sprite_tiling_extends(TilingSprite,_super),Object.defineProperty(TilingSprite.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(value){this.uvMatrix.clampMargin=value,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(TilingSprite.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(value){this.tileTransform.scale.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(TilingSprite.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(value){this.tileTransform.position.copyFrom(value)},enumerable:!1,configurable:!0}),TilingSprite.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},TilingSprite.prototype._render=function(renderer){var texture=this._texture;texture&&texture.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),renderer.batch.setObjectRenderer(renderer.plugins[this.pluginName]),renderer.plugins[this.pluginName].render(this))},TilingSprite.prototype._calculateBounds=function(){var minX=this._width*-this._anchor._x,minY=this._height*-this._anchor._y,maxX=this._width*(1-this._anchor._x),maxY=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,minX,minY,maxX,maxY)},TilingSprite.prototype.getLocalBounds=function(rect){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),rect||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),rect=this._localBoundsRect),this._bounds.getRectangle(rect)):_super.prototype.getLocalBounds.call(this,rect)},TilingSprite.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,sprite_tiling_tempPoint);var width=this._width,height=this._height,x1=-width*this.anchor._x;if(sprite_tiling_tempPoint.x>=x1&&sprite_tiling_tempPoint.x<x1+width){var y1=-height*this.anchor._y;if(sprite_tiling_tempPoint.y>=y1&&sprite_tiling_tempPoint.y<y1+height)return!0}return!1},TilingSprite.prototype.destroy=function(options){_super.prototype.destroy.call(this,options),this.tileTransform=null,this.uvMatrix=null},TilingSprite.from=function(source,options){return new TilingSprite(source instanceof Texture?source:Texture.from(source,options),options.width,options.height)},Object.defineProperty(TilingSprite.prototype,"width",{get:function(){return this._width},set:function(value){this._width=value},enumerable:!1,configurable:!0}),Object.defineProperty(TilingSprite.prototype,"height",{get:function(){return this._height},set:function(value){this._height=value},enumerable:!1,configurable:!0}),TilingSprite}(Sprite),sprite_tiling_vertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",sprite_tiling_tempMat=new Matrix,TilingSpriteRenderer=function(_super){function TilingSpriteRenderer(renderer){var _this=_super.call(this,renderer)||this,uniforms={globals:_this.renderer.globalUniforms};return _this.shader=Shader.from(sprite_tiling_vertex,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",uniforms),_this.simpleShader=Shader.from(sprite_tiling_vertex,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",uniforms),_this.quad=new QuadUv,_this.state=State.for2d(),_this}return sprite_tiling_extends(TilingSpriteRenderer,_super),TilingSpriteRenderer.prototype.render=function(ts){var renderer=this.renderer,quad=this.quad,vertices=quad.vertices;vertices[0]=vertices[6]=ts._width*-ts.anchor.x,vertices[1]=vertices[3]=ts._height*-ts.anchor.y,vertices[2]=vertices[4]=ts._width*(1-ts.anchor.x),vertices[5]=vertices[7]=ts._height*(1-ts.anchor.y);var anchorX=ts.uvRespectAnchor?ts.anchor.x:0,anchorY=ts.uvRespectAnchor?ts.anchor.y:0;(vertices=quad.uvs)[0]=vertices[6]=-anchorX,vertices[1]=vertices[3]=-anchorY,vertices[2]=vertices[4]=1-anchorX,vertices[5]=vertices[7]=1-anchorY,quad.invalidate();var tex=ts._texture,baseTex=tex.baseTexture,lt=ts.tileTransform.localTransform,uv=ts.uvMatrix,isSimple=baseTex.isPowerOfTwo&&tex.frame.width===baseTex.width&&tex.frame.height===baseTex.height;isSimple&&(baseTex._glTextures[renderer.CONTEXT_UID]?isSimple=baseTex.wrapMode!==constants_WRAP_MODES.CLAMP:baseTex.wrapMode===constants_WRAP_MODES.CLAMP&&(baseTex.wrapMode=constants_WRAP_MODES.REPEAT));var shader=isSimple?this.simpleShader:this.shader,w=tex.width,h=tex.height,W=ts._width,H=ts._height;sprite_tiling_tempMat.set(lt.a*w/W,lt.b*w/H,lt.c*h/W,lt.d*h/H,lt.tx/W,lt.ty/H),sprite_tiling_tempMat.invert(),isSimple?sprite_tiling_tempMat.prepend(uv.mapCoord):(shader.uniforms.uMapCoord=uv.mapCoord.toArray(!0),shader.uniforms.uClampFrame=uv.uClampFrame,shader.uniforms.uClampOffset=uv.uClampOffset),shader.uniforms.uTransform=sprite_tiling_tempMat.toArray(!0),shader.uniforms.uColor=premultiplyTintToRgba(ts.tint,ts.worldAlpha,shader.uniforms.uColor,baseTex.alphaMode),shader.uniforms.translationMatrix=ts.transform.worldTransform.toArray(!0),shader.uniforms.uSampler=tex,renderer.shader.bind(shader),renderer.geometry.bind(quad),this.state.blendMode=correctBlendMode(ts.blendMode,baseTex.alphaMode),renderer.state.set(this.state),renderer.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},TilingSpriteRenderer}(ObjectRenderer),mesh_extendStatics=function(d,b){return mesh_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},mesh_extendStatics(d,b)};function mesh_extends(d,b){function __(){this.constructor=d}mesh_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var MeshBatchUvs=function(){function MeshBatchUvs(uvBuffer,uvMatrix){this.uvBuffer=uvBuffer,this.uvMatrix=uvMatrix,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return MeshBatchUvs.prototype.update=function(forceUpdate){if(forceUpdate||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var data=this.uvBuffer.data;this.data&&this.data.length===data.length||(this.data=new Float32Array(data.length)),this.uvMatrix.multiplyUvs(data,this.data),this._updateID++}},MeshBatchUvs}(),mesh_tempPoint=new Point,tempPolygon=new Polygon,Mesh=function(_super){function Mesh(geometry,shader,state,drawMode){void 0===drawMode&&(drawMode=constants_DRAW_MODES.TRIANGLES);var _this=_super.call(this)||this;return _this.geometry=geometry,geometry.refCount++,_this.shader=shader,_this.state=state||State.for2d(),_this.drawMode=drawMode,_this.start=0,_this.size=0,_this.uvs=null,_this.indices=null,_this.vertexData=new Float32Array(1),_this.vertexDirty=-1,_this._transformID=-1,_this._roundPixels=settings.ROUND_PIXELS,_this.batchUvs=null,_this}return mesh_extends(Mesh,_super),Object.defineProperty(Mesh.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh.prototype,"material",{get:function(){return this.shader},set:function(value){this.shader=value},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(value){this._roundPixels!==value&&(this._transformID=-1),this._roundPixels=value},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh.prototype,"tint",{get:function(){return"tint"in this.shader?this.shader.tint:null},set:function(value){this.shader.tint=value},enumerable:!1,configurable:!0}),Object.defineProperty(Mesh.prototype,"texture",{get:function(){return"texture"in this.shader?this.shader.texture:null},set:function(value){this.shader.texture=value},enumerable:!1,configurable:!0}),Mesh.prototype._render=function(renderer){var vertices=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===constants_DRAW_MODES.TRIANGLES&&vertices.length<2*Mesh.BATCHABLE_SIZE?this._renderToBatch(renderer):this._renderDefault(renderer)},Mesh.prototype._renderDefault=function(renderer){var shader=this.shader;shader.alpha=this.worldAlpha,shader.update&&shader.update(),renderer.batch.flush(),shader.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),renderer.shader.bind(shader),renderer.state.set(this.state),renderer.geometry.bind(this.geometry,shader),renderer.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},Mesh.prototype._renderToBatch=function(renderer){var geometry=this.geometry,shader=this.shader;shader.uvMatrix&&(shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=geometry.indexBuffer.data,this._tintRGB=shader._tintRGB,this._texture=shader.texture;var pluginName=this.material.pluginName;renderer.batch.setObjectRenderer(renderer.plugins[pluginName]),renderer.plugins[pluginName].render(this)},Mesh.prototype.calculateVertices=function(){var verticesBuffer=this.geometry.buffers[0],vertices=verticesBuffer.data,vertexDirtyId=verticesBuffer._updateID;if(vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==vertices.length&&(this.vertexData=new Float32Array(vertices.length));for(var wt=this.transform.worldTransform,a=wt.a,b=wt.b,c=wt.c,d=wt.d,tx=wt.tx,ty=wt.ty,vertexData=this.vertexData,i=0;i<vertexData.length/2;i++){var x=vertices[2*i],y=vertices[2*i+1];vertexData[2*i]=a*x+c*y+tx,vertexData[2*i+1]=b*x+d*y+ty}if(this._roundPixels){var resolution=settings.RESOLUTION;for(i=0;i<vertexData.length;++i)vertexData[i]=Math.round((vertexData[i]*resolution|0)/resolution)}this.vertexDirty=vertexDirtyId}},Mesh.prototype.calculateUvs=function(){var geomUvs=this.geometry.buffers[1],shader=this.shader;shader.uvMatrix.isSimple?this.uvs=geomUvs.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(geomUvs,shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},Mesh.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},Mesh.prototype.containsPoint=function(point){if(!this.getBounds().contains(point.x,point.y))return!1;this.worldTransform.applyInverse(point,mesh_tempPoint);for(var vertices=this.geometry.getBuffer("aVertexPosition").data,points=tempPolygon.points,indices=this.geometry.getIndex().data,len=indices.length,step=4===this.drawMode?3:1,i=0;i+2<len;i+=step){var ind0=2*indices[i],ind1=2*indices[i+1],ind2=2*indices[i+2];if(points[0]=vertices[ind0],points[1]=vertices[ind0+1],points[2]=vertices[ind1],points[3]=vertices[ind1+1],points[4]=vertices[ind2],points[5]=vertices[ind2+1],tempPolygon.contains(mesh_tempPoint.x,mesh_tempPoint.y))return!0}return!1},Mesh.prototype.destroy=function(options){_super.prototype.destroy.call(this,options),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Mesh.BATCHABLE_SIZE=100,Mesh}(Container),MeshMaterial=function(_super){function MeshMaterial(uSampler,options){var _this=this,uniforms={uSampler,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(options=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},options)).uniforms&&Object.assign(uniforms,options.uniforms),(_this=_super.call(this,options.program||Program.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),uniforms)||this)._colorDirty=!1,_this.uvMatrix=new TextureMatrix(uSampler),_this.batchable=void 0===options.program,_this.pluginName=options.pluginName,_this.tint=options.tint,_this.alpha=options.alpha,_this}return mesh_extends(MeshMaterial,_super),Object.defineProperty(MeshMaterial.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(value){this.uniforms.uSampler!==value&&(this.uniforms.uSampler=value,this.uvMatrix.texture=value)},enumerable:!1,configurable:!0}),Object.defineProperty(MeshMaterial.prototype,"alpha",{get:function(){return this._alpha},set:function(value){value!==this._alpha&&(this._alpha=value,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(MeshMaterial.prototype,"tint",{get:function(){return this._tint},set:function(value){value!==this._tint&&(this._tint=value,this._tintRGB=(value>>16)+(65280&value)+((255&value)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),MeshMaterial.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var baseTexture=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,baseTexture.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},MeshMaterial}(Shader),MeshGeometry=function(_super){function MeshGeometry(vertices,uvs,index){var _this=_super.call(this)||this,verticesBuffer=new Buffer(vertices),uvsBuffer=new Buffer(uvs,!0),indexBuffer=new Buffer(index,!0,!0);return _this.addAttribute("aVertexPosition",verticesBuffer,2,!1,constants_TYPES.FLOAT).addAttribute("aTextureCoord",uvsBuffer,2,!1,constants_TYPES.FLOAT).addIndex(indexBuffer),_this._updateId=-1,_this}return mesh_extends(MeshGeometry,_super),Object.defineProperty(MeshGeometry.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),MeshGeometry}(Geometry),text_bitmap_extendStatics=function(d,b){return text_bitmap_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},text_bitmap_extendStatics(d,b)};var BitmapFontData=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]},TextFormat=function(){function TextFormat(){}return TextFormat.test=function(data){return"string"==typeof data&&0===data.indexOf("info face=")},TextFormat.parse=function(txt){var items=txt.match(/^[a-z]+\s+.+$/gm),rawData={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var i in items){var name=items[i].match(/^[a-z]+/gm)[0],attributeList=items[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),itemData={};for(var i_1 in attributeList){var split=attributeList[i_1].split("="),key=split[0],strValue=split[1].replace(/"/gm,""),floatValue=parseFloat(strValue),value=isNaN(floatValue)?strValue:floatValue;itemData[key]=value}rawData[name].push(itemData)}var font=new BitmapFontData;return rawData.info.forEach((function(info){return font.info.push({face:info.face,size:parseInt(info.size,10)})})),rawData.common.forEach((function(common){return font.common.push({lineHeight:parseInt(common.lineHeight,10)})})),rawData.page.forEach((function(page){return font.page.push({id:parseInt(page.id,10),file:page.file})})),rawData.char.forEach((function(char){return font.char.push({id:parseInt(char.id,10),page:parseInt(char.page,10),x:parseInt(char.x,10),y:parseInt(char.y,10),width:parseInt(char.width,10),height:parseInt(char.height,10),xoffset:parseInt(char.xoffset,10),yoffset:parseInt(char.yoffset,10),xadvance:parseInt(char.xadvance,10)})})),rawData.kerning.forEach((function(kerning){return font.kerning.push({first:parseInt(kerning.first,10),second:parseInt(kerning.second,10),amount:parseInt(kerning.amount,10)})})),font},TextFormat}(),XMLFormat=function(){function XMLFormat(){}return XMLFormat.test=function(data){return data instanceof XMLDocument&&data.getElementsByTagName("page").length&&null!==data.getElementsByTagName("info")[0].getAttribute("face")},XMLFormat.parse=function(xml){for(var data=new BitmapFontData,info=xml.getElementsByTagName("info"),common=xml.getElementsByTagName("common"),page=xml.getElementsByTagName("page"),char=xml.getElementsByTagName("char"),kerning=xml.getElementsByTagName("kerning"),i=0;i<info.length;i++)data.info.push({face:info[i].getAttribute("face"),size:parseInt(info[i].getAttribute("size"),10)});for(i=0;i<common.length;i++)data.common.push({lineHeight:parseInt(common[i].getAttribute("lineHeight"),10)});for(i=0;i<page.length;i++)data.page.push({id:parseInt(page[i].getAttribute("id"),10)||0,file:page[i].getAttribute("file")});for(i=0;i<char.length;i++){var letter=char[i];data.char.push({id:parseInt(letter.getAttribute("id"),10),page:parseInt(letter.getAttribute("page"),10)||0,x:parseInt(letter.getAttribute("x"),10),y:parseInt(letter.getAttribute("y"),10),width:parseInt(letter.getAttribute("width"),10),height:parseInt(letter.getAttribute("height"),10),xoffset:parseInt(letter.getAttribute("xoffset"),10),yoffset:parseInt(letter.getAttribute("yoffset"),10),xadvance:parseInt(letter.getAttribute("xadvance"),10)})}for(i=0;i<kerning.length;i++)data.kerning.push({first:parseInt(kerning[i].getAttribute("first"),10),second:parseInt(kerning[i].getAttribute("second"),10),amount:parseInt(kerning[i].getAttribute("amount"),10)});return data},XMLFormat}(),XMLStringFormat=function(){function XMLStringFormat(){}return XMLStringFormat.test=function(data){if("string"==typeof data&&data.indexOf("<font>")>-1){var xml=(new self.DOMParser).parseFromString(data,"text/xml");return XMLFormat.test(xml)}return!1},XMLStringFormat.parse=function(xmlTxt){var xml=(new self.DOMParser).parseFromString(xmlTxt,"text/xml");return XMLFormat.parse(xml)},XMLStringFormat}(),formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(data){for(var i=0;i<formats.length;i++)if(formats[i].test(data))return formats[i];return null}function drawGlyph(canvas,context,metrics,x,y,resolution,style){var char=metrics.text,fontProperties=metrics.fontProperties;context.translate(x,y),context.scale(resolution,resolution);var tx=style.strokeThickness/2,ty=-style.strokeThickness/2;context.font=style.toFontString(),context.lineWidth=style.strokeThickness,context.textBaseline=style.textBaseline,context.lineJoin=style.lineJoin,context.miterLimit=style.miterLimit,context.fillStyle=function(canvas,context,style,resolution,lines,metrics){var gradient,fillStyle=style.fill;if(!Array.isArray(fillStyle))return fillStyle;if(1===fillStyle.length)return fillStyle[0];var dropShadowCorrection=style.dropShadow?style.dropShadowDistance:0,padding=style.padding||0,width=canvas.width/resolution-dropShadowCorrection-2*padding,height=canvas.height/resolution-dropShadowCorrection-2*padding,fill=fillStyle.slice(),fillGradientStops=style.fillGradientStops.slice();if(!fillGradientStops.length)for(var lengthPlus1=fill.length+1,i=1;i<lengthPlus1;++i)fillGradientStops.push(i/lengthPlus1);if(fill.unshift(fillStyle[0]),fillGradientStops.unshift(0),fill.push(fillStyle[fillStyle.length-1]),fillGradientStops.push(1),style.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){gradient=context.createLinearGradient(width/2,padding,width/2,height+padding);var lastIterationStop=0,gradStopLineHeight=(metrics.fontProperties.fontSize+style.strokeThickness)/height;for(i=0;i<lines.length;i++)for(var thisLineTop=metrics.lineHeight*i,j=0;j<fill.length;j++){var globalStop=thisLineTop/height+("number"==typeof fillGradientStops[j]?fillGradientStops[j]:j/fill.length)*gradStopLineHeight,clampedStop=Math.max(lastIterationStop,globalStop);clampedStop=Math.min(clampedStop,1),gradient.addColorStop(clampedStop,fill[j]),lastIterationStop=clampedStop}}else{gradient=context.createLinearGradient(padding,height/2,width+padding,height/2);var totalIterations=fill.length+1,currentIteration=1;for(i=0;i<fill.length;i++){var stop=void 0;stop="number"==typeof fillGradientStops[i]?fillGradientStops[i]:currentIteration/totalIterations,gradient.addColorStop(stop,fill[i]),currentIteration++}}return gradient}(canvas,context,style,resolution,[char],metrics),context.strokeStyle=style.stroke;var dropShadowColor=style.dropShadowColor,rgb=hex2rgb("number"==typeof dropShadowColor?dropShadowColor:string2hex(dropShadowColor));style.dropShadow?(context.shadowColor="rgba("+255*rgb[0]+","+255*rgb[1]+","+255*rgb[2]+","+style.dropShadowAlpha+")",context.shadowBlur=style.dropShadowBlur,context.shadowOffsetX=Math.cos(style.dropShadowAngle)*style.dropShadowDistance,context.shadowOffsetY=Math.sin(style.dropShadowAngle)*style.dropShadowDistance):(context.shadowColor="black",context.shadowBlur=0,context.shadowOffsetX=0,context.shadowOffsetY=0),style.stroke&&style.strokeThickness&&context.strokeText(char,tx,ty+metrics.lineHeight-fontProperties.descent),style.fill&&context.fillText(char,tx,ty+metrics.lineHeight-fontProperties.descent),context.setTransform(1,0,0,1,0,0),context.fillStyle="rgba(0, 0, 0, 0)"}var BitmapFont=function(){function BitmapFont(data,textures,ownsTextures){var info=data.info[0],common=data.common[0],res=getResolutionOfUrl(data.page[0].file),pageTextures={};this._ownsTextures=ownsTextures,this.font=info.face,this.size=info.size,this.lineHeight=common.lineHeight/res,this.chars={},this.pageTextures=pageTextures;for(var i=0;i<data.page.length;i++){var _a=data.page[i],id=_a.id,file=_a.file;pageTextures[id]=textures instanceof Array?textures[i]:textures[file]}for(i=0;i<data.char.length;i++){var _b=data.char[i],page_1=(id=_b.id,_b.page),_c=data.char[i],x=_c.x,y=_c.y,width=_c.width,height=_c.height,xoffset=_c.xoffset,yoffset=_c.yoffset,xadvance=_c.xadvance;y/=res,width/=res,height/=res,xoffset/=res,yoffset/=res,xadvance/=res;var rect=new Rectangle((x/=res)+pageTextures[page_1].frame.x/res,y+pageTextures[page_1].frame.y/res,width,height);this.chars[id]={xOffset:xoffset,yOffset:yoffset,xAdvance:xadvance,kerning:{},texture:new Texture(pageTextures[page_1].baseTexture,rect),page:page_1}}for(i=0;i<data.kerning.length;i++){var _d=data.kerning[i],first=_d.first,second=_d.second,amount=_d.amount;first/=res,second/=res,amount/=res,this.chars[second]&&(this.chars[second].kerning[first]=amount)}}return BitmapFont.prototype.destroy=function(){for(var id in this.chars)this.chars[id].texture.destroy(),this.chars[id].texture=null;for(var id in this.pageTextures)this._ownsTextures&&this.pageTextures[id].destroy(!0),this.pageTextures[id]=null;this.chars=null,this.pageTextures=null},BitmapFont.install=function(data,textures,ownsTextures){var fontData;if(data instanceof BitmapFontData)fontData=data;else{var format=autoDetectFormat(data);if(!format)throw new Error("Unrecognized data format for font.");fontData=format.parse(data)}textures instanceof Texture&&(textures=[textures]);var font=new BitmapFont(fontData,textures,ownsTextures);return BitmapFont.available[font.font]=font,font},BitmapFont.uninstall=function(name){var font=BitmapFont.available[name];if(!font)throw new Error("No font found named '"+name+"'");font.destroy(),delete BitmapFont.available[name]},BitmapFont.from=function(name,textStyle,options){if(!name)throw new Error("[BitmapFont] Property `name` is required.");var _a=Object.assign({},BitmapFont.defaultOptions,options),chars=_a.chars,padding=_a.padding,resolution=_a.resolution,textureWidth=_a.textureWidth,textureHeight=_a.textureHeight,charsList=function(chars){"string"==typeof chars&&(chars=[chars]);for(var result=[],i=0,j=chars.length;i<j;i++){var item=chars[i];if(Array.isArray(item)){if(2!==item.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+item.length+".");var startCode=item[0].charCodeAt(0),endCode=item[1].charCodeAt(0);if(endCode<startCode)throw new Error("[BitmapFont]: Invalid character range.");for(var i_1=startCode,j_1=endCode;i_1<=j_1;i_1++)result.push(String.fromCharCode(i_1))}else result.push.apply(result,item.split(""))}if(0===result.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return result}(chars),style=textStyle instanceof TextStyle?textStyle:new TextStyle(textStyle),lineWidth=textureWidth,fontData=new BitmapFontData;fontData.info[0]={face:style.fontFamily,size:style.fontSize},fontData.common[0]={lineHeight:style.fontSize};for(var canvas,context,baseTexture,positionX=0,positionY=0,maxCharHeight=0,textures=[],i=0;i<charsList.length;i++){canvas||((canvas=document.createElement("canvas")).width=textureWidth,canvas.height=textureHeight,context=canvas.getContext("2d"),baseTexture=new BaseTexture(canvas,{resolution}),textures.push(new Texture(baseTexture)),fontData.page.push({id:textures.length-1,file:""}));var metrics=TextMetrics.measureText(charsList[i],style,!1,canvas),width=metrics.width,height=Math.ceil(metrics.height),textureGlyphWidth=Math.ceil(("italic"===style.fontStyle?2:1)*width);if(positionY>=textureHeight-height*resolution){if(0===positionY)throw new Error("[BitmapFont] textureHeight "+textureHeight+"px is too small for "+style.fontSize+"px fonts");--i,canvas=null,context=null,baseTexture=null,positionY=0,positionX=0,maxCharHeight=0}else if(maxCharHeight=Math.max(height+metrics.fontProperties.descent,maxCharHeight),textureGlyphWidth*resolution+positionX>=lineWidth)--i,positionY+=maxCharHeight*resolution,positionY=Math.ceil(positionY),positionX=0,maxCharHeight=0;else{drawGlyph(canvas,context,metrics,positionX,positionY,resolution,style);var id=metrics.text.charCodeAt(0);fontData.char.push({id,page:textures.length-1,x:positionX/resolution,y:positionY/resolution,width:textureGlyphWidth,height,xoffset:0,yoffset:0,xadvance:Math.ceil(width-(style.dropShadow?style.dropShadowDistance:0)-(style.stroke?style.strokeThickness:0))}),positionX+=(textureGlyphWidth+2*padding)*resolution,positionX=Math.ceil(positionX)}}i=0;for(var len=charsList.length;i<len;i++)for(var first=charsList[i],j=0;j<len;j++){var second=charsList[j],c1=context.measureText(first).width,c2=context.measureText(second).width,amount=context.measureText(first+second).width-(c1+c2);amount&&fontData.kerning.push({first:first.charCodeAt(0),second:second.charCodeAt(0),amount})}var font=new BitmapFont(fontData,textures,!0);return void 0!==BitmapFont.available[name]&&BitmapFont.uninstall(name),BitmapFont.available[name]=font,font},BitmapFont.ALPHA=[["a","z"],["A","Z"]," "],BitmapFont.NUMERIC=[["0","9"]],BitmapFont.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],BitmapFont.ASCII=[[" ","~"]],BitmapFont.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:BitmapFont.ALPHANUMERIC},BitmapFont.available={},BitmapFont}(),pageMeshDataPool=[],charRenderDataPool=[],BitmapText=function(_super){function BitmapText(text,style){void 0===style&&(style={});var _this=_super.call(this)||this;_this._tint=16777215;var _a=Object.assign({},BitmapText.styleDefaults,style),align=_a.align,tint=_a.tint,maxWidth=_a.maxWidth,letterSpacing=_a.letterSpacing,fontName=_a.fontName,fontSize=_a.fontSize;if(!BitmapFont.available[fontName])throw new Error('Missing BitmapFont "'+fontName+'"');return _this._activePagesMeshData=[],_this._textWidth=0,_this._textHeight=0,_this._align=align,_this._tint=tint,_this._fontName=fontName,_this._fontSize=fontSize||BitmapFont.available[fontName].size,_this._text=text,_this._maxWidth=maxWidth,_this._maxLineHeight=0,_this._letterSpacing=letterSpacing,_this._anchor=new ObservablePoint((function(){_this.dirty=!0}),_this,0,0),_this._roundPixels=settings.ROUND_PIXELS,_this.dirty=!0,_this._textureCache={},_this}return function(d,b){function __(){this.constructor=d}text_bitmap_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(BitmapText,_super),BitmapText.prototype.updateText=function(){for(var _a,data=BitmapFont.available[this._fontName],scale=this._fontSize/data.size,pos=new Point,chars=[],lineWidths=[],lineSpaces=[],text=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",textLength=text.length,maxWidth=this._maxWidth*data.size/this._fontSize,prevCharCode=null,lastLineWidth=0,maxLineWidth=0,line=0,lastBreakPos=-1,lastBreakWidth=0,spacesRemoved=0,maxLineHeight=0,spaceCount=0,i=0;i<textLength;i++){var charCode=text.charCodeAt(i),char=text.charAt(i);if(/(?:\s)/.test(char)&&(lastBreakPos=i,lastBreakWidth=lastLineWidth,spaceCount++),"\r"!==char&&"\n"!==char){var charData=data.chars[charCode];if(charData){prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]);var charRenderData=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point};charRenderData.texture=charData.texture,charRenderData.line=line,charRenderData.charCode=charCode,charRenderData.position.x=pos.x+charData.xOffset+this._letterSpacing/2,charRenderData.position.y=pos.y+charData.yOffset,charRenderData.prevSpaces=spaceCount,chars.push(charRenderData),lastLineWidth=charRenderData.position.x+charData.texture.orig.width,pos.x+=charData.xAdvance+this._letterSpacing,maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height),prevCharCode=charCode,-1!==lastBreakPos&&maxWidth>0&&pos.x>maxWidth&&(removeItems(chars,1+lastBreakPos-++spacesRemoved,1+i-lastBreakPos),i=lastBreakPos,lastBreakPos=-1,lineWidths.push(lastBreakWidth),lineSpaces.push(chars.length>0?chars[chars.length-1].prevSpaces:0),maxLineWidth=Math.max(maxLineWidth,lastBreakWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null,spaceCount=0)}}else lineWidths.push(lastLineWidth),lineSpaces.push(-1),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),++line,++spacesRemoved,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null,spaceCount=0}var lastChar=text.charAt(text.length-1);"\r"!==lastChar&&"\n"!==lastChar&&(/(?:\s)/.test(lastChar)&&(lastLineWidth=lastBreakWidth),lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),lineSpaces.push(-1));var lineAlignOffsets=[];for(i=0;i<=line;i++){var alignOffset=0;"right"===this._align?alignOffset=maxLineWidth-lineWidths[i]:"center"===this._align?alignOffset=(maxLineWidth-lineWidths[i])/2:"justify"===this._align&&(alignOffset=lineSpaces[i]<0?0:(maxLineWidth-lineWidths[i])/lineSpaces[i]),lineAlignOffsets.push(alignOffset)}var lenChars=chars.length,pagesMeshData={},newPagesMeshData=[],activePagesMeshData=this._activePagesMeshData;for(i=0;i<activePagesMeshData.length;i++)pageMeshDataPool.push(activePagesMeshData[i]);for(i=0;i<lenChars;i++){var baseTextureUid=(texture=chars[i].texture).baseTexture.uid;if(!pagesMeshData[baseTextureUid]){if(!(pageMeshData=pageMeshDataPool.pop())){var geometry=new MeshGeometry,material=new MeshMaterial(Texture.EMPTY);pageMeshData={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new Mesh(geometry,material),vertices:null,uvs:null,indices:null}}pageMeshData.index=0,pageMeshData.indexCount=0,pageMeshData.vertexCount=0,pageMeshData.uvsCount=0,pageMeshData.total=0;var _textureCache=this._textureCache;_textureCache[baseTextureUid]=_textureCache[baseTextureUid]||new Texture(texture.baseTexture),pageMeshData.mesh.texture=_textureCache[baseTextureUid],pageMeshData.mesh.tint=this._tint,newPagesMeshData.push(pageMeshData),pagesMeshData[baseTextureUid]=pageMeshData}pagesMeshData[baseTextureUid].total++}for(i=0;i<activePagesMeshData.length;i++)-1===newPagesMeshData.indexOf(activePagesMeshData[i])&&this.removeChild(activePagesMeshData[i].mesh);for(i=0;i<newPagesMeshData.length;i++)newPagesMeshData[i].mesh.parent!==this&&this.addChild(newPagesMeshData[i].mesh);for(var i in this._activePagesMeshData=newPagesMeshData,pagesMeshData){var total=(pageMeshData=pagesMeshData[i]).total;if(!((null===(_a=pageMeshData.indices)||void 0===_a?void 0:_a.length)>6*total)||pageMeshData.vertices.length<2*Mesh.BATCHABLE_SIZE)pageMeshData.vertices=new Float32Array(8*total),pageMeshData.uvs=new Float32Array(8*total),pageMeshData.indices=new Uint16Array(6*total);else for(var total_1=pageMeshData.total,vertices=pageMeshData.vertices,i_1=4*total_1*2;i_1<vertices.length;i_1++)vertices[i_1]=0;pageMeshData.mesh.size=6*total}for(i=0;i<lenChars;i++){var offset=(char=chars[i]).position.x+lineAlignOffsets[char.line]*("justify"===this._align?char.prevSpaces:1);this._roundPixels&&(offset=Math.round(offset));var texture,xPos=offset*scale,yPos=char.position.y*scale,pageMesh=pagesMeshData[(texture=char.texture).baseTexture.uid],textureFrame=texture.frame,textureUvs=texture._uvs,index=pageMesh.index++;pageMesh.indices[6*index+0]=0+4*index,pageMesh.indices[6*index+1]=1+4*index,pageMesh.indices[6*index+2]=2+4*index,pageMesh.indices[6*index+3]=0+4*index,pageMesh.indices[6*index+4]=2+4*index,pageMesh.indices[6*index+5]=3+4*index,pageMesh.vertices[8*index+0]=xPos,pageMesh.vertices[8*index+1]=yPos,pageMesh.vertices[8*index+2]=xPos+textureFrame.width*scale,pageMesh.vertices[8*index+3]=yPos,pageMesh.vertices[8*index+4]=xPos+textureFrame.width*scale,pageMesh.vertices[8*index+5]=yPos+textureFrame.height*scale,pageMesh.vertices[8*index+6]=xPos,pageMesh.vertices[8*index+7]=yPos+textureFrame.height*scale,pageMesh.uvs[8*index+0]=textureUvs.x0,pageMesh.uvs[8*index+1]=textureUvs.y0,pageMesh.uvs[8*index+2]=textureUvs.x1,pageMesh.uvs[8*index+3]=textureUvs.y1,pageMesh.uvs[8*index+4]=textureUvs.x2,pageMesh.uvs[8*index+5]=textureUvs.y2,pageMesh.uvs[8*index+6]=textureUvs.x3,pageMesh.uvs[8*index+7]=textureUvs.y3}for(var i in this._textWidth=maxLineWidth*scale,this._textHeight=(pos.y+data.lineHeight)*scale,pagesMeshData){var pageMeshData=pagesMeshData[i];if(0!==this.anchor.x||0!==this.anchor.y)for(var vertexCount=0,anchorOffsetX=this._textWidth*this.anchor.x,anchorOffsetY=this._textHeight*this.anchor.y,i_2=0;i_2<pageMeshData.total;i_2++)pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY,pageMeshData.vertices[vertexCount++]-=anchorOffsetX,pageMeshData.vertices[vertexCount++]-=anchorOffsetY;this._maxLineHeight=maxLineHeight*scale;var vertexBuffer=pageMeshData.mesh.geometry.getBuffer("aVertexPosition"),textureBuffer=pageMeshData.mesh.geometry.getBuffer("aTextureCoord"),indexBuffer=pageMeshData.mesh.geometry.getIndex();vertexBuffer.data=pageMeshData.vertices,textureBuffer.data=pageMeshData.uvs,indexBuffer.data=pageMeshData.indices,vertexBuffer.update(),textureBuffer.update(),indexBuffer.update()}for(i=0;i<chars.length;i++)charRenderDataPool.push(chars[i])},BitmapText.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},BitmapText.prototype.getLocalBounds=function(){return this.validate(),_super.prototype.getLocalBounds.call(this)},BitmapText.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(value){if(this._tint!==value){this._tint=value;for(var i=0;i<this._activePagesMeshData.length;i++)this._activePagesMeshData[i].mesh.tint=value}},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"align",{get:function(){return this._align},set:function(value){this._align!==value&&(this._align=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"fontName",{get:function(){return this._fontName},set:function(value){if(!BitmapFont.available[value])throw new Error('Missing BitmapFont "'+value+'"');this._fontName!==value&&(this._fontName=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(value){this._fontSize!==value&&(this._fontSize=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"anchor",{get:function(){return this._anchor},set:function(value){"number"==typeof value?this._anchor.set(value):this._anchor.copyFrom(value)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"text",{get:function(){return this._text},set:function(text){text=String(null==text?"":text),this._text!==text&&(this._text=text,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(value){this._maxWidth!==value&&(this._maxWidth=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(value){this._letterSpacing!==value&&(this._letterSpacing=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(value){value!==this._roundPixels&&(this._roundPixels=value,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(BitmapText.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),BitmapText.prototype.destroy=function(options){var _textureCache=this._textureCache;for(var id in _textureCache){_textureCache[id].destroy(),delete _textureCache[id]}this._textureCache=null,_super.prototype.destroy.call(this,options)},BitmapText.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},BitmapText}(Container),BitmapFontLoader=function(){function BitmapFontLoader(){}return BitmapFontLoader.add=function(){LoaderResource.setExtensionXhrType("fnt",LoaderResource.XHR_RESPONSE_TYPE.TEXT)},BitmapFontLoader.use=function(resource,next){var format=autoDetectFormat(resource.data);if(format)for(var baseUrl=BitmapFontLoader.getBaseUrl(this,resource),data=format.parse(resource.data),textures={},completed=function(page){textures[page.metadata.pageFile]=page.texture,Object.keys(textures).length===data.page.length&&(resource.bitmapFont=BitmapFont.install(data,textures,!0),next())},i=0;i<data.page.length;++i){var pageFile=data.page[i].file,url=baseUrl+pageFile,exists=!1;for(var name in this.resources){var bitmapResource=this.resources[name];if(bitmapResource.url===url){bitmapResource.metadata.pageFile=pageFile,bitmapResource.texture?completed(bitmapResource):bitmapResource.onAfterMiddleware.add(completed),exists=!0;break}}if(!exists){var options={crossOrigin:resource.crossOrigin,loadType:LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile},resource.metadata.imageMetadata),parentResource:resource};this.add(url,options,completed)}}else next()},BitmapFontLoader.getBaseUrl=function(loader,resource){var resUrl=resource.isDataUrl?"":BitmapFontLoader.dirname(resource.url);return resource.isDataUrl&&("."===resUrl&&(resUrl=""),loader.baseUrl&&resUrl&&"/"===loader.baseUrl.charAt(loader.baseUrl.length-1)&&(resUrl+="/")),(resUrl=resUrl.replace(loader.baseUrl,""))&&"/"!==resUrl.charAt(resUrl.length-1)&&(resUrl+="/"),resUrl},BitmapFontLoader.dirname=function(url){var dir=url.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return dir===url?".":""===dir?"/":dir},BitmapFontLoader}(),filter_alpha_extendStatics=function(d,b){return filter_alpha_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},filter_alpha_extendStatics(d,b)};var AlphaFilter=function(_super){function AlphaFilter(alpha){void 0===alpha&&(alpha=1);var _this=_super.call(this,defaultVertex$2,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1})||this;return _this.alpha=alpha,_this}return function(d,b){function __(){this.constructor=d}filter_alpha_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(AlphaFilter,_super),Object.defineProperty(AlphaFilter.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(value){this.uniforms.uAlpha=value},enumerable:!1,configurable:!0}),AlphaFilter}(Filter),filter_blur_extendStatics=function(d,b){return filter_blur_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},filter_blur_extendStatics(d,b)};function filter_blur_extends(d,b){function __(){this.constructor=d}filter_blur_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var filter_blur_ENV,filter_blur_RENDERER_TYPE,filter_blur_BUFFER_BITS,filter_blur_BLEND_MODES,filter_blur_DRAW_MODES,filter_blur_FORMATS,filter_blur_TARGETS,filter_blur_TYPES,filter_blur_SAMPLER_TYPES,filter_blur_SCALE_MODES,filter_blur_WRAP_MODES,filter_blur_MIPMAP_MODES,filter_blur_ALPHA_MODES,filter_blur_CLEAR_MODES,filter_blur_GC_MODES,filter_blur_PRECISION,filter_blur_MASK_TYPES,filter_blur_MSAA_QUALITY,filter_blur_BUFFER_TYPE,GAUSSIAN_VALUES={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},filter_blur_fragTemplate=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");!function(ENV){ENV[ENV.WEBGL_LEGACY=0]="WEBGL_LEGACY",ENV[ENV.WEBGL=1]="WEBGL",ENV[ENV.WEBGL2=2]="WEBGL2"}(filter_blur_ENV||(filter_blur_ENV={})),function(RENDERER_TYPE){RENDERER_TYPE[RENDERER_TYPE.UNKNOWN=0]="UNKNOWN",RENDERER_TYPE[RENDERER_TYPE.WEBGL=1]="WEBGL",RENDERER_TYPE[RENDERER_TYPE.CANVAS=2]="CANVAS"}(filter_blur_RENDERER_TYPE||(filter_blur_RENDERER_TYPE={})),function(BUFFER_BITS){BUFFER_BITS[BUFFER_BITS.COLOR=16384]="COLOR",BUFFER_BITS[BUFFER_BITS.DEPTH=256]="DEPTH",BUFFER_BITS[BUFFER_BITS.STENCIL=1024]="STENCIL"}(filter_blur_BUFFER_BITS||(filter_blur_BUFFER_BITS={})),function(BLEND_MODES){BLEND_MODES[BLEND_MODES.NORMAL=0]="NORMAL",BLEND_MODES[BLEND_MODES.ADD=1]="ADD",BLEND_MODES[BLEND_MODES.MULTIPLY=2]="MULTIPLY",BLEND_MODES[BLEND_MODES.SCREEN=3]="SCREEN",BLEND_MODES[BLEND_MODES.OVERLAY=4]="OVERLAY",BLEND_MODES[BLEND_MODES.DARKEN=5]="DARKEN",BLEND_MODES[BLEND_MODES.LIGHTEN=6]="LIGHTEN",BLEND_MODES[BLEND_MODES.COLOR_DODGE=7]="COLOR_DODGE",BLEND_MODES[BLEND_MODES.COLOR_BURN=8]="COLOR_BURN",BLEND_MODES[BLEND_MODES.HARD_LIGHT=9]="HARD_LIGHT",BLEND_MODES[BLEND_MODES.SOFT_LIGHT=10]="SOFT_LIGHT",BLEND_MODES[BLEND_MODES.DIFFERENCE=11]="DIFFERENCE",BLEND_MODES[BLEND_MODES.EXCLUSION=12]="EXCLUSION",BLEND_MODES[BLEND_MODES.HUE=13]="HUE",BLEND_MODES[BLEND_MODES.SATURATION=14]="SATURATION",BLEND_MODES[BLEND_MODES.COLOR=15]="COLOR",BLEND_MODES[BLEND_MODES.LUMINOSITY=16]="LUMINOSITY",BLEND_MODES[BLEND_MODES.NORMAL_NPM=17]="NORMAL_NPM",BLEND_MODES[BLEND_MODES.ADD_NPM=18]="ADD_NPM",BLEND_MODES[BLEND_MODES.SCREEN_NPM=19]="SCREEN_NPM",BLEND_MODES[BLEND_MODES.NONE=20]="NONE",BLEND_MODES[BLEND_MODES.SRC_OVER=0]="SRC_OVER",BLEND_MODES[BLEND_MODES.SRC_IN=21]="SRC_IN",BLEND_MODES[BLEND_MODES.SRC_OUT=22]="SRC_OUT",BLEND_MODES[BLEND_MODES.SRC_ATOP=23]="SRC_ATOP",BLEND_MODES[BLEND_MODES.DST_OVER=24]="DST_OVER",BLEND_MODES[BLEND_MODES.DST_IN=25]="DST_IN",BLEND_MODES[BLEND_MODES.DST_OUT=26]="DST_OUT",BLEND_MODES[BLEND_MODES.DST_ATOP=27]="DST_ATOP",BLEND_MODES[BLEND_MODES.ERASE=26]="ERASE",BLEND_MODES[BLEND_MODES.SUBTRACT=28]="SUBTRACT",BLEND_MODES[BLEND_MODES.XOR=29]="XOR"}(filter_blur_BLEND_MODES||(filter_blur_BLEND_MODES={})),function(DRAW_MODES){DRAW_MODES[DRAW_MODES.POINTS=0]="POINTS",DRAW_MODES[DRAW_MODES.LINES=1]="LINES",DRAW_MODES[DRAW_MODES.LINE_LOOP=2]="LINE_LOOP",DRAW_MODES[DRAW_MODES.LINE_STRIP=3]="LINE_STRIP",DRAW_MODES[DRAW_MODES.TRIANGLES=4]="TRIANGLES",DRAW_MODES[DRAW_MODES.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",DRAW_MODES[DRAW_MODES.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(filter_blur_DRAW_MODES||(filter_blur_DRAW_MODES={})),function(FORMATS){FORMATS[FORMATS.RGBA=6408]="RGBA",FORMATS[FORMATS.RGB=6407]="RGB",FORMATS[FORMATS.RG=33319]="RG",FORMATS[FORMATS.RED=6403]="RED",FORMATS[FORMATS.RGBA_INTEGER=36249]="RGBA_INTEGER",FORMATS[FORMATS.RGB_INTEGER=36248]="RGB_INTEGER",FORMATS[FORMATS.RG_INTEGER=33320]="RG_INTEGER",FORMATS[FORMATS.RED_INTEGER=36244]="RED_INTEGER",FORMATS[FORMATS.ALPHA=6406]="ALPHA",FORMATS[FORMATS.LUMINANCE=6409]="LUMINANCE",FORMATS[FORMATS.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",FORMATS[FORMATS.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",FORMATS[FORMATS.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(filter_blur_FORMATS||(filter_blur_FORMATS={})),function(TARGETS){TARGETS[TARGETS.TEXTURE_2D=3553]="TEXTURE_2D",TARGETS[TARGETS.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",TARGETS[TARGETS.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(filter_blur_TARGETS||(filter_blur_TARGETS={})),function(TYPES){TYPES[TYPES.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",TYPES[TYPES.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",TYPES[TYPES.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",TYPES[TYPES.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",TYPES[TYPES.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",TYPES[TYPES.UNSIGNED_INT=5125]="UNSIGNED_INT",TYPES[TYPES.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",TYPES[TYPES.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",TYPES[TYPES.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",TYPES[TYPES.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",TYPES[TYPES.BYTE=5120]="BYTE",TYPES[TYPES.SHORT=5122]="SHORT",TYPES[TYPES.INT=5124]="INT",TYPES[TYPES.FLOAT=5126]="FLOAT",TYPES[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",TYPES[TYPES.HALF_FLOAT=36193]="HALF_FLOAT"}(filter_blur_TYPES||(filter_blur_TYPES={})),function(SAMPLER_TYPES){SAMPLER_TYPES[SAMPLER_TYPES.FLOAT=0]="FLOAT",SAMPLER_TYPES[SAMPLER_TYPES.INT=1]="INT",SAMPLER_TYPES[SAMPLER_TYPES.UINT=2]="UINT"}(filter_blur_SAMPLER_TYPES||(filter_blur_SAMPLER_TYPES={})),function(SCALE_MODES){SCALE_MODES[SCALE_MODES.NEAREST=0]="NEAREST",SCALE_MODES[SCALE_MODES.LINEAR=1]="LINEAR"}(filter_blur_SCALE_MODES||(filter_blur_SCALE_MODES={})),function(WRAP_MODES){WRAP_MODES[WRAP_MODES.CLAMP=33071]="CLAMP",WRAP_MODES[WRAP_MODES.REPEAT=10497]="REPEAT",WRAP_MODES[WRAP_MODES.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(filter_blur_WRAP_MODES||(filter_blur_WRAP_MODES={})),function(MIPMAP_MODES){MIPMAP_MODES[MIPMAP_MODES.OFF=0]="OFF",MIPMAP_MODES[MIPMAP_MODES.POW2=1]="POW2",MIPMAP_MODES[MIPMAP_MODES.ON=2]="ON",MIPMAP_MODES[MIPMAP_MODES.ON_MANUAL=3]="ON_MANUAL"}(filter_blur_MIPMAP_MODES||(filter_blur_MIPMAP_MODES={})),function(ALPHA_MODES){ALPHA_MODES[ALPHA_MODES.NPM=0]="NPM",ALPHA_MODES[ALPHA_MODES.UNPACK=1]="UNPACK",ALPHA_MODES[ALPHA_MODES.PMA=2]="PMA",ALPHA_MODES[ALPHA_MODES.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ALPHA_MODES[ALPHA_MODES.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ALPHA_MODES[ALPHA_MODES.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(filter_blur_ALPHA_MODES||(filter_blur_ALPHA_MODES={})),function(CLEAR_MODES){CLEAR_MODES[CLEAR_MODES.NO=0]="NO",CLEAR_MODES[CLEAR_MODES.YES=1]="YES",CLEAR_MODES[CLEAR_MODES.AUTO=2]="AUTO",CLEAR_MODES[CLEAR_MODES.BLEND=0]="BLEND",CLEAR_MODES[CLEAR_MODES.CLEAR=1]="CLEAR",CLEAR_MODES[CLEAR_MODES.BLIT=2]="BLIT"}(filter_blur_CLEAR_MODES||(filter_blur_CLEAR_MODES={})),function(GC_MODES){GC_MODES[GC_MODES.AUTO=0]="AUTO",GC_MODES[GC_MODES.MANUAL=1]="MANUAL"}(filter_blur_GC_MODES||(filter_blur_GC_MODES={})),function(PRECISION){PRECISION.LOW="lowp",PRECISION.MEDIUM="mediump",PRECISION.HIGH="highp"}(filter_blur_PRECISION||(filter_blur_PRECISION={})),function(MASK_TYPES){MASK_TYPES[MASK_TYPES.NONE=0]="NONE",MASK_TYPES[MASK_TYPES.SCISSOR=1]="SCISSOR",MASK_TYPES[MASK_TYPES.STENCIL=2]="STENCIL",MASK_TYPES[MASK_TYPES.SPRITE=3]="SPRITE"}(filter_blur_MASK_TYPES||(filter_blur_MASK_TYPES={})),function(MSAA_QUALITY){MSAA_QUALITY[MSAA_QUALITY.NONE=0]="NONE",MSAA_QUALITY[MSAA_QUALITY.LOW=2]="LOW",MSAA_QUALITY[MSAA_QUALITY.MEDIUM=4]="MEDIUM",MSAA_QUALITY[MSAA_QUALITY.HIGH=8]="HIGH"}(filter_blur_MSAA_QUALITY||(filter_blur_MSAA_QUALITY={})),function(BUFFER_TYPE){BUFFER_TYPE[BUFFER_TYPE.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",BUFFER_TYPE[BUFFER_TYPE.ARRAY_BUFFER=34962]="ARRAY_BUFFER",BUFFER_TYPE[BUFFER_TYPE.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(filter_blur_BUFFER_TYPE||(filter_blur_BUFFER_TYPE={}));var BlurFilterPass=function(_super){function BlurFilterPass(horizontal,strength,quality,resolution,kernelSize){void 0===strength&&(strength=8),void 0===quality&&(quality=4),void 0===resolution&&(resolution=settings.FILTER_RESOLUTION),void 0===kernelSize&&(kernelSize=5);var _this=this,vertSrc=function(kernelSize,x){var template,halfLength=Math.ceil(kernelSize/2),vertSource="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",blurLoop="";template=x?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var i=0;i<kernelSize;i++){var blur=template.replace("%index%",i.toString());blurLoop+=blur=blur.replace("%sampleIndex%",i-(halfLength-1)+".0"),blurLoop+="\n"}return(vertSource=vertSource.replace("%blur%",blurLoop)).replace("%size%",kernelSize.toString())}(kernelSize,horizontal),fragSrc=function(kernelSize){for(var value,kernel=GAUSSIAN_VALUES[kernelSize],halfLength=kernel.length,fragSource=filter_blur_fragTemplate,blurLoop="",i=0;i<kernelSize;i++){var blur="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",i.toString());value=i,i>=halfLength&&(value=kernelSize-i-1),blurLoop+=blur=blur.replace("%value%",kernel[value].toString()),blurLoop+="\n"}return(fragSource=fragSource.replace("%blur%",blurLoop)).replace("%size%",kernelSize.toString())}(kernelSize);return(_this=_super.call(this,vertSrc,fragSrc)||this).horizontal=horizontal,_this.resolution=resolution,_this._quality=0,_this.quality=quality,_this.blur=strength,_this}return filter_blur_extends(BlurFilterPass,_super),BlurFilterPass.prototype.apply=function(filterManager,input,output,clearMode){if(output?this.horizontal?this.uniforms.strength=1/output.width*(output.width/input.width):this.uniforms.strength=1/output.height*(output.height/input.height):this.horizontal?this.uniforms.strength=1/filterManager.renderer.width*(filterManager.renderer.width/input.width):this.uniforms.strength=1/filterManager.renderer.height*(filterManager.renderer.height/input.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)filterManager.applyFilter(this,input,output,clearMode);else{var renderTarget=filterManager.getFilterTexture(),renderer=filterManager.renderer,flip=input,flop=renderTarget;this.state.blend=!1,filterManager.applyFilter(this,flip,flop,filter_blur_CLEAR_MODES.CLEAR);for(var i=1;i<this.passes-1;i++){filterManager.bindAndClear(flip,filter_blur_CLEAR_MODES.BLIT),this.uniforms.uSampler=flop;var temp=flop;flop=flip,flip=temp,renderer.shader.bind(this),renderer.geometry.draw(5)}this.state.blend=!0,filterManager.applyFilter(this,flop,output,clearMode),filterManager.returnFilterTexture(renderTarget)}},Object.defineProperty(BlurFilterPass.prototype,"blur",{get:function(){return this.strength},set:function(value){this.padding=1+2*Math.abs(value),this.strength=value},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilterPass.prototype,"quality",{get:function(){return this._quality},set:function(value){this._quality=value,this.passes=value},enumerable:!1,configurable:!0}),BlurFilterPass}(Filter),BlurFilter=function(_super){function BlurFilter(strength,quality,resolution,kernelSize){void 0===strength&&(strength=8),void 0===quality&&(quality=4),void 0===resolution&&(resolution=settings.FILTER_RESOLUTION),void 0===kernelSize&&(kernelSize=5);var _this=_super.call(this)||this;return _this.blurXFilter=new BlurFilterPass(!0,strength,quality,resolution,kernelSize),_this.blurYFilter=new BlurFilterPass(!1,strength,quality,resolution,kernelSize),_this.resolution=resolution,_this.quality=quality,_this.blur=strength,_this.repeatEdgePixels=!1,_this}return filter_blur_extends(BlurFilter,_super),BlurFilter.prototype.apply=function(filterManager,input,output,clearMode){var xStrength=Math.abs(this.blurXFilter.strength),yStrength=Math.abs(this.blurYFilter.strength);if(xStrength&&yStrength){var renderTarget=filterManager.getFilterTexture();this.blurXFilter.apply(filterManager,input,renderTarget,filter_blur_CLEAR_MODES.CLEAR),this.blurYFilter.apply(filterManager,renderTarget,output,clearMode),filterManager.returnFilterTexture(renderTarget)}else yStrength?this.blurYFilter.apply(filterManager,input,output,clearMode):this.blurXFilter.apply(filterManager,input,output,clearMode)},BlurFilter.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=this.blurYFilter.blur=value,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(value){this.blurXFilter.quality=this.blurYFilter.quality=value},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(value){this.blurYFilter.blur=value,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(value){this.blurYFilter.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(BlurFilter.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(value){this._repeatEdgePixels=value,this.updatePadding()},enumerable:!1,configurable:!0}),BlurFilter}(Filter),filter_color_matrix_extendStatics=function(d,b){return filter_color_matrix_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},filter_color_matrix_extendStatics(d,b)};var ColorMatrixFilter=function(_super){function ColorMatrixFilter(){var _this=this,uniforms={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(_this=_super.call(this,defaultFilterVertex,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",uniforms)||this).alpha=1,_this}return function(d,b){function __(){this.constructor=d}filter_color_matrix_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(ColorMatrixFilter,_super),ColorMatrixFilter.prototype._loadMatrix=function(matrix,multiply){void 0===multiply&&(multiply=!1);var newMatrix=matrix;multiply&&(this._multiply(newMatrix,this.uniforms.m,matrix),newMatrix=this._colorMatrix(newMatrix)),this.uniforms.m=newMatrix},ColorMatrixFilter.prototype._multiply=function(out,a,b){return out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15],out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16],out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17],out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18],out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19]+a[4],out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15],out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16],out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17],out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18],out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19]+a[9],out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15],out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16],out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17],out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18],out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19]+a[14],out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15],out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16],out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17],out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18],out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19]+a[19],out},ColorMatrixFilter.prototype._colorMatrix=function(matrix){var m=new Float32Array(matrix);return m[4]/=255,m[9]/=255,m[14]/=255,m[19]/=255,m},ColorMatrixFilter.prototype.brightness=function(b,multiply){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.tint=function(color,multiply){var matrix=[(color>>16&255)/255,0,0,0,0,0,(color>>8&255)/255,0,0,0,0,0,(255&color)/255,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.greyscale=function(scale,multiply){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.blackAndWhite=function(multiply){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.hue=function(rotation,multiply){rotation=(rotation||0)/180*Math.PI;var cosR=Math.cos(rotation),sinR=Math.sin(rotation),w=1/3,sqrW=(0,Math.sqrt)(w),matrix=[cosR+(1-cosR)*w,w*(1-cosR)-sqrW*sinR,w*(1-cosR)+sqrW*sinR,0,0,w*(1-cosR)+sqrW*sinR,cosR+w*(1-cosR),w*(1-cosR)-sqrW*sinR,0,0,w*(1-cosR)-sqrW*sinR,w*(1-cosR)+sqrW*sinR,cosR+w*(1-cosR),0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.contrast=function(amount,multiply){var v=(amount||0)+1,o=-.5*(v-1),matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.saturate=function(amount,multiply){void 0===amount&&(amount=0);var x=2*amount/3+1,y=-.5*(x-1),matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.desaturate=function(){this.saturate(-1)},ColorMatrixFilter.prototype.negative=function(multiply){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.sepia=function(multiply){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.technicolor=function(multiply){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.polaroid=function(multiply){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.toBGR=function(multiply){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.kodachrome=function(multiply){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.browni=function(multiply){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.vintage=function(multiply){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.colorTone=function(desaturation,toned,lightColor,darkColor,multiply){var lR=((lightColor=lightColor||16770432)>>16&255)/255,lG=(lightColor>>8&255)/255,lB=(255&lightColor)/255,dR=((darkColor=darkColor||3375104)>>16&255)/255,dG=(darkColor>>8&255)/255,dB=(255&darkColor)/255,matrix=[.3,.59,.11,0,0,lR,lG,lB,desaturation=desaturation||.2,0,dR,dG,dB,toned=toned||.15,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.night=function(intensity,multiply){var matrix=[-2*(intensity=intensity||.1),-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,2*intensity,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.predator=function(amount,multiply){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.lsd=function(multiply){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],multiply)},ColorMatrixFilter.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(value){this.uniforms.m=value},enumerable:!1,configurable:!0}),Object.defineProperty(ColorMatrixFilter.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(value){this.uniforms.uAlpha=value},enumerable:!1,configurable:!0}),ColorMatrixFilter}(Filter);ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;var filter_displacement_extendStatics=function(d,b){return filter_displacement_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},filter_displacement_extendStatics(d,b)};var DisplacementFilter=function(_super){function DisplacementFilter(sprite,scale){var _this=this,maskMatrix=new Matrix;return sprite.renderable=!1,(_this=_super.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:sprite._texture,filterMatrix:maskMatrix,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=sprite,_this.maskMatrix=maskMatrix,null==scale&&(scale=20),_this.scale=new Point(scale,scale),_this}return function(d,b){function __(){this.constructor=d}filter_displacement_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(DisplacementFilter,_super),DisplacementFilter.prototype.apply=function(filterManager,input,output,clearMode){this.uniforms.filterMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var wt=this.maskSprite.worldTransform,lenX=Math.sqrt(wt.a*wt.a+wt.b*wt.b),lenY=Math.sqrt(wt.c*wt.c+wt.d*wt.d);0!==lenX&&0!==lenY&&(this.uniforms.rotation[0]=wt.a/lenX,this.uniforms.rotation[1]=wt.b/lenX,this.uniforms.rotation[2]=wt.c/lenY,this.uniforms.rotation[3]=wt.d/lenY),filterManager.applyFilter(this,input,output,clearMode)},Object.defineProperty(DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(value){this.uniforms.mapSampler=value},enumerable:!1,configurable:!0}),DisplacementFilter}(Filter),filter_fxaa_extendStatics=function(d,b){return filter_fxaa_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},filter_fxaa_extendStatics(d,b)};var FXAAFilter=function(_super){function FXAAFilter(){return _super.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')||this}return function(d,b){function __(){this.constructor=d}filter_fxaa_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(FXAAFilter,_super),FXAAFilter}(Filter),filter_noise_extendStatics=function(d,b){return filter_noise_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},filter_noise_extendStatics(d,b)};var mixin_cache_as_bitmap_ENV,mixin_cache_as_bitmap_RENDERER_TYPE,mixin_cache_as_bitmap_BUFFER_BITS,mixin_cache_as_bitmap_BLEND_MODES,mixin_cache_as_bitmap_DRAW_MODES,mixin_cache_as_bitmap_FORMATS,mixin_cache_as_bitmap_TARGETS,mixin_cache_as_bitmap_TYPES,mixin_cache_as_bitmap_SAMPLER_TYPES,mixin_cache_as_bitmap_SCALE_MODES,mixin_cache_as_bitmap_WRAP_MODES,mixin_cache_as_bitmap_MIPMAP_MODES,mixin_cache_as_bitmap_ALPHA_MODES,mixin_cache_as_bitmap_CLEAR_MODES,mixin_cache_as_bitmap_GC_MODES,mixin_cache_as_bitmap_PRECISION,mixin_cache_as_bitmap_MASK_TYPES,mixin_cache_as_bitmap_MSAA_QUALITY,mixin_cache_as_bitmap_BUFFER_TYPE,NoiseFilter=function(_super){function NoiseFilter(noise,seed){void 0===noise&&(noise=.5),void 0===seed&&(seed=Math.random());var _this=_super.call(this,defaultFilterVertex,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0})||this;return _this.noise=noise,_this.seed=seed,_this}return function(d,b){function __(){this.constructor=d}filter_noise_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(NoiseFilter,_super),Object.defineProperty(NoiseFilter.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(value){this.uniforms.uNoise=value},enumerable:!1,configurable:!0}),Object.defineProperty(NoiseFilter.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(value){this.uniforms.uSeed=value},enumerable:!1,configurable:!0}),NoiseFilter}(Filter);!function(ENV){ENV[ENV.WEBGL_LEGACY=0]="WEBGL_LEGACY",ENV[ENV.WEBGL=1]="WEBGL",ENV[ENV.WEBGL2=2]="WEBGL2"}(mixin_cache_as_bitmap_ENV||(mixin_cache_as_bitmap_ENV={})),function(RENDERER_TYPE){RENDERER_TYPE[RENDERER_TYPE.UNKNOWN=0]="UNKNOWN",RENDERER_TYPE[RENDERER_TYPE.WEBGL=1]="WEBGL",RENDERER_TYPE[RENDERER_TYPE.CANVAS=2]="CANVAS"}(mixin_cache_as_bitmap_RENDERER_TYPE||(mixin_cache_as_bitmap_RENDERER_TYPE={})),function(BUFFER_BITS){BUFFER_BITS[BUFFER_BITS.COLOR=16384]="COLOR",BUFFER_BITS[BUFFER_BITS.DEPTH=256]="DEPTH",BUFFER_BITS[BUFFER_BITS.STENCIL=1024]="STENCIL"}(mixin_cache_as_bitmap_BUFFER_BITS||(mixin_cache_as_bitmap_BUFFER_BITS={})),function(BLEND_MODES){BLEND_MODES[BLEND_MODES.NORMAL=0]="NORMAL",BLEND_MODES[BLEND_MODES.ADD=1]="ADD",BLEND_MODES[BLEND_MODES.MULTIPLY=2]="MULTIPLY",BLEND_MODES[BLEND_MODES.SCREEN=3]="SCREEN",BLEND_MODES[BLEND_MODES.OVERLAY=4]="OVERLAY",BLEND_MODES[BLEND_MODES.DARKEN=5]="DARKEN",BLEND_MODES[BLEND_MODES.LIGHTEN=6]="LIGHTEN",BLEND_MODES[BLEND_MODES.COLOR_DODGE=7]="COLOR_DODGE",BLEND_MODES[BLEND_MODES.COLOR_BURN=8]="COLOR_BURN",BLEND_MODES[BLEND_MODES.HARD_LIGHT=9]="HARD_LIGHT",BLEND_MODES[BLEND_MODES.SOFT_LIGHT=10]="SOFT_LIGHT",BLEND_MODES[BLEND_MODES.DIFFERENCE=11]="DIFFERENCE",BLEND_MODES[BLEND_MODES.EXCLUSION=12]="EXCLUSION",BLEND_MODES[BLEND_MODES.HUE=13]="HUE",BLEND_MODES[BLEND_MODES.SATURATION=14]="SATURATION",BLEND_MODES[BLEND_MODES.COLOR=15]="COLOR",BLEND_MODES[BLEND_MODES.LUMINOSITY=16]="LUMINOSITY",BLEND_MODES[BLEND_MODES.NORMAL_NPM=17]="NORMAL_NPM",BLEND_MODES[BLEND_MODES.ADD_NPM=18]="ADD_NPM",BLEND_MODES[BLEND_MODES.SCREEN_NPM=19]="SCREEN_NPM",BLEND_MODES[BLEND_MODES.NONE=20]="NONE",BLEND_MODES[BLEND_MODES.SRC_OVER=0]="SRC_OVER",BLEND_MODES[BLEND_MODES.SRC_IN=21]="SRC_IN",BLEND_MODES[BLEND_MODES.SRC_OUT=22]="SRC_OUT",BLEND_MODES[BLEND_MODES.SRC_ATOP=23]="SRC_ATOP",BLEND_MODES[BLEND_MODES.DST_OVER=24]="DST_OVER",BLEND_MODES[BLEND_MODES.DST_IN=25]="DST_IN",BLEND_MODES[BLEND_MODES.DST_OUT=26]="DST_OUT",BLEND_MODES[BLEND_MODES.DST_ATOP=27]="DST_ATOP",BLEND_MODES[BLEND_MODES.ERASE=26]="ERASE",BLEND_MODES[BLEND_MODES.SUBTRACT=28]="SUBTRACT",BLEND_MODES[BLEND_MODES.XOR=29]="XOR"}(mixin_cache_as_bitmap_BLEND_MODES||(mixin_cache_as_bitmap_BLEND_MODES={})),function(DRAW_MODES){DRAW_MODES[DRAW_MODES.POINTS=0]="POINTS",DRAW_MODES[DRAW_MODES.LINES=1]="LINES",DRAW_MODES[DRAW_MODES.LINE_LOOP=2]="LINE_LOOP",DRAW_MODES[DRAW_MODES.LINE_STRIP=3]="LINE_STRIP",DRAW_MODES[DRAW_MODES.TRIANGLES=4]="TRIANGLES",DRAW_MODES[DRAW_MODES.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",DRAW_MODES[DRAW_MODES.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(mixin_cache_as_bitmap_DRAW_MODES||(mixin_cache_as_bitmap_DRAW_MODES={})),function(FORMATS){FORMATS[FORMATS.RGBA=6408]="RGBA",FORMATS[FORMATS.RGB=6407]="RGB",FORMATS[FORMATS.RG=33319]="RG",FORMATS[FORMATS.RED=6403]="RED",FORMATS[FORMATS.RGBA_INTEGER=36249]="RGBA_INTEGER",FORMATS[FORMATS.RGB_INTEGER=36248]="RGB_INTEGER",FORMATS[FORMATS.RG_INTEGER=33320]="RG_INTEGER",FORMATS[FORMATS.RED_INTEGER=36244]="RED_INTEGER",FORMATS[FORMATS.ALPHA=6406]="ALPHA",FORMATS[FORMATS.LUMINANCE=6409]="LUMINANCE",FORMATS[FORMATS.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",FORMATS[FORMATS.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",FORMATS[FORMATS.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(mixin_cache_as_bitmap_FORMATS||(mixin_cache_as_bitmap_FORMATS={})),function(TARGETS){TARGETS[TARGETS.TEXTURE_2D=3553]="TEXTURE_2D",TARGETS[TARGETS.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",TARGETS[TARGETS.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",TARGETS[TARGETS.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",TARGETS[TARGETS.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(mixin_cache_as_bitmap_TARGETS||(mixin_cache_as_bitmap_TARGETS={})),function(TYPES){TYPES[TYPES.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",TYPES[TYPES.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",TYPES[TYPES.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",TYPES[TYPES.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",TYPES[TYPES.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",TYPES[TYPES.UNSIGNED_INT=5125]="UNSIGNED_INT",TYPES[TYPES.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",TYPES[TYPES.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",TYPES[TYPES.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",TYPES[TYPES.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",TYPES[TYPES.BYTE=5120]="BYTE",TYPES[TYPES.SHORT=5122]="SHORT",TYPES[TYPES.INT=5124]="INT",TYPES[TYPES.FLOAT=5126]="FLOAT",TYPES[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",TYPES[TYPES.HALF_FLOAT=36193]="HALF_FLOAT"}(mixin_cache_as_bitmap_TYPES||(mixin_cache_as_bitmap_TYPES={})),function(SAMPLER_TYPES){SAMPLER_TYPES[SAMPLER_TYPES.FLOAT=0]="FLOAT",SAMPLER_TYPES[SAMPLER_TYPES.INT=1]="INT",SAMPLER_TYPES[SAMPLER_TYPES.UINT=2]="UINT"}(mixin_cache_as_bitmap_SAMPLER_TYPES||(mixin_cache_as_bitmap_SAMPLER_TYPES={})),function(SCALE_MODES){SCALE_MODES[SCALE_MODES.NEAREST=0]="NEAREST",SCALE_MODES[SCALE_MODES.LINEAR=1]="LINEAR"}(mixin_cache_as_bitmap_SCALE_MODES||(mixin_cache_as_bitmap_SCALE_MODES={})),function(WRAP_MODES){WRAP_MODES[WRAP_MODES.CLAMP=33071]="CLAMP",WRAP_MODES[WRAP_MODES.REPEAT=10497]="REPEAT",WRAP_MODES[WRAP_MODES.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(mixin_cache_as_bitmap_WRAP_MODES||(mixin_cache_as_bitmap_WRAP_MODES={})),function(MIPMAP_MODES){MIPMAP_MODES[MIPMAP_MODES.OFF=0]="OFF",MIPMAP_MODES[MIPMAP_MODES.POW2=1]="POW2",MIPMAP_MODES[MIPMAP_MODES.ON=2]="ON",MIPMAP_MODES[MIPMAP_MODES.ON_MANUAL=3]="ON_MANUAL"}(mixin_cache_as_bitmap_MIPMAP_MODES||(mixin_cache_as_bitmap_MIPMAP_MODES={})),function(ALPHA_MODES){ALPHA_MODES[ALPHA_MODES.NPM=0]="NPM",ALPHA_MODES[ALPHA_MODES.UNPACK=1]="UNPACK",ALPHA_MODES[ALPHA_MODES.PMA=2]="PMA",ALPHA_MODES[ALPHA_MODES.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ALPHA_MODES[ALPHA_MODES.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ALPHA_MODES[ALPHA_MODES.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}(mixin_cache_as_bitmap_ALPHA_MODES||(mixin_cache_as_bitmap_ALPHA_MODES={})),function(CLEAR_MODES){CLEAR_MODES[CLEAR_MODES.NO=0]="NO",CLEAR_MODES[CLEAR_MODES.YES=1]="YES",CLEAR_MODES[CLEAR_MODES.AUTO=2]="AUTO",CLEAR_MODES[CLEAR_MODES.BLEND=0]="BLEND",CLEAR_MODES[CLEAR_MODES.CLEAR=1]="CLEAR",CLEAR_MODES[CLEAR_MODES.BLIT=2]="BLIT"}(mixin_cache_as_bitmap_CLEAR_MODES||(mixin_cache_as_bitmap_CLEAR_MODES={})),function(GC_MODES){GC_MODES[GC_MODES.AUTO=0]="AUTO",GC_MODES[GC_MODES.MANUAL=1]="MANUAL"}(mixin_cache_as_bitmap_GC_MODES||(mixin_cache_as_bitmap_GC_MODES={})),function(PRECISION){PRECISION.LOW="lowp",PRECISION.MEDIUM="mediump",PRECISION.HIGH="highp"}(mixin_cache_as_bitmap_PRECISION||(mixin_cache_as_bitmap_PRECISION={})),function(MASK_TYPES){MASK_TYPES[MASK_TYPES.NONE=0]="NONE",MASK_TYPES[MASK_TYPES.SCISSOR=1]="SCISSOR",MASK_TYPES[MASK_TYPES.STENCIL=2]="STENCIL",MASK_TYPES[MASK_TYPES.SPRITE=3]="SPRITE"}(mixin_cache_as_bitmap_MASK_TYPES||(mixin_cache_as_bitmap_MASK_TYPES={})),function(MSAA_QUALITY){MSAA_QUALITY[MSAA_QUALITY.NONE=0]="NONE",MSAA_QUALITY[MSAA_QUALITY.LOW=2]="LOW",MSAA_QUALITY[MSAA_QUALITY.MEDIUM=4]="MEDIUM",MSAA_QUALITY[MSAA_QUALITY.HIGH=8]="HIGH"}(mixin_cache_as_bitmap_MSAA_QUALITY||(mixin_cache_as_bitmap_MSAA_QUALITY={})),function(BUFFER_TYPE){BUFFER_TYPE[BUFFER_TYPE.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",BUFFER_TYPE[BUFFER_TYPE.ARRAY_BUFFER=34962]="ARRAY_BUFFER",BUFFER_TYPE[BUFFER_TYPE.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER"}(mixin_cache_as_bitmap_BUFFER_TYPE||(mixin_cache_as_bitmap_BUFFER_TYPE={}));var _tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1,DisplayObject.prototype._cacheData=null,DisplayObject.prototype._cacheAsBitmapResolution=null,DisplayObject.prototype._cacheAsBitmapMultisample=mixin_cache_as_bitmap_MSAA_QUALITY.NONE;var CacheData=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null};Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(resolution){resolution!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=resolution,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get:function(){return this._cacheAsBitmapMultisample},set:function(multisample){multisample!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=multisample,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(value){var data;this._cacheAsBitmap!==value&&(this._cacheAsBitmap=value,value?(this._cacheData||(this._cacheData=new CacheData),(data=this._cacheData).originalRender=this.render,data.originalRenderCanvas=this.renderCanvas,data.originalUpdateTransform=this.updateTransform,data.originalCalculateBounds=this.calculateBounds,data.originalGetLocalBounds=this.getLocalBounds,data.originalDestroy=this.destroy,data.originalContainsPoint=this.containsPoint,data.originalMask=this._mask,data.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((data=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=data.originalRender,this.renderCanvas=data.originalRenderCanvas,this.calculateBounds=data.originalCalculateBounds,this.getLocalBounds=data.originalGetLocalBounds,this.destroy=data.originalDestroy,this.updateTransform=data.originalUpdateTransform,this.containsPoint=data.originalContainsPoint,this._mask=data.originalMask,this.filterArea=data.originalFilterArea))}}}),DisplayObject.prototype._renderCached=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(renderer),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(renderer))},DisplayObject.prototype._initCachedDisplayObject=function(renderer){var _a;if(!this._cacheData||!this._cacheData.sprite){var cacheAlpha=this.alpha;this.alpha=1,renderer.batch.flush();var bounds=this.getLocalBounds(null,!0).clone();if(this.filters){var padding=this.filters[0].padding;bounds.pad(padding)}bounds.ceil(settings.RESOLUTION);var cachedRenderTexture=renderer.renderTexture.current,cachedSourceFrame=renderer.renderTexture.sourceFrame.clone(),cachedDestinationFrame=renderer.renderTexture.destinationFrame.clone(),cachedProjectionTransform=renderer.projection.transform,renderTexture=RenderTexture.create({width:bounds.width,height:bounds.height,resolution:this.cacheAsBitmapResolution||renderer.resolution,multisample:null!==(_a=this.cacheAsBitmapMultisample)&&void 0!==_a?_a:renderer.multisample}),textureCacheId="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=textureCacheId,BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId),Texture.addToCache(renderTexture,textureCacheId);var m=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-bounds.x,-bounds.y);this.render=this._cacheData.originalRender,renderer.render(this,{renderTexture,clear:!0,transform:m,skipUpdateTransform:!1}),renderer.framebuffer.blit(),renderer.projection.transform=cachedProjectionTransform,renderer.renderTexture.bind(cachedRenderTexture,cachedSourceFrame,cachedDestinationFrame),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=cacheAlpha;var cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform,cachedSprite.anchor.x=-bounds.x/bounds.width,cachedSprite.anchor.y=-bounds.y/bounds.height,cachedSprite.alpha=cacheAlpha,cachedSprite._bounds=this._bounds,this._cacheData.sprite=cachedSprite,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)}},DisplayObject.prototype._renderCachedCanvas=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(renderer),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(renderer))},DisplayObject.prototype._initCachedDisplayObjectCanvas=function(renderer){if(!this._cacheData||!this._cacheData.sprite){var bounds=this.getLocalBounds(null,!0),cacheAlpha=this.alpha;this.alpha=1;var cachedRenderTarget=renderer.context,cachedProjectionTransform=renderer._projTransform;bounds.ceil(settings.RESOLUTION);var renderTexture=RenderTexture.create({width:bounds.width,height:bounds.height}),textureCacheId="cacheAsBitmap_"+uid();this._cacheData.textureCacheId=textureCacheId,BaseTexture.addToCache(renderTexture.baseTexture,textureCacheId),Texture.addToCache(renderTexture,textureCacheId);var m=_tempMatrix;this.transform.localTransform.copyTo(m),m.invert(),m.tx-=bounds.x,m.ty-=bounds.y,this.renderCanvas=this._cacheData.originalRenderCanvas,renderer.render(this,{renderTexture,clear:!0,transform:m,skipUpdateTransform:!1}),renderer.context=cachedRenderTarget,renderer._projTransform=cachedProjectionTransform,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=cacheAlpha;var cachedSprite=new Sprite(renderTexture);cachedSprite.transform.worldTransform=this.transform.worldTransform,cachedSprite.anchor.x=-bounds.x/bounds.width,cachedSprite.anchor.y=-bounds.y/bounds.height,cachedSprite.alpha=cacheAlpha,cachedSprite._bounds=this._bounds,this._cacheData.sprite=cachedSprite,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=renderer._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=cachedSprite.containsPoint.bind(cachedSprite)}},DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},DisplayObject.prototype._cacheAsBitmapDestroy=function(options){this.cacheAsBitmap=!1,this.destroy(options)},DisplayObject.prototype.name=null,Container.prototype.getChildByName=function(name,deep){for(var i=0,j=this.children.length;i<j;i++)if(this.children[i].name===name)return this.children[i];if(deep)for(i=0,j=this.children.length;i<j;i++){if(this.children[i].getChildByName){var target=this.children[i].getChildByName(name,!0);if(target)return target}}return null},DisplayObject.prototype.getGlobalPosition=function(point,skipUpdate){return void 0===point&&(point=new Point),void 0===skipUpdate&&(skipUpdate=!1),this.parent?this.parent.toGlobal(this.position,point,skipUpdate):(point.x=this.position.x,point.y=this.position.y),point};var mesh_extras_extendStatics=function(d,b){return mesh_extras_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},mesh_extras_extendStatics(d,b)};function mesh_extras_extends(d,b){function __(){this.constructor=d}mesh_extras_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var PlaneGeometry=function(_super){function PlaneGeometry(width,height,segWidth,segHeight){void 0===width&&(width=100),void 0===height&&(height=100),void 0===segWidth&&(segWidth=10),void 0===segHeight&&(segHeight=10);var _this=_super.call(this)||this;return _this.segWidth=segWidth,_this.segHeight=segHeight,_this.width=width,_this.height=height,_this.build(),_this}return mesh_extras_extends(PlaneGeometry,_super),PlaneGeometry.prototype.build=function(){for(var total=this.segWidth*this.segHeight,verts=[],uvs=[],indices=[],segmentsX=this.segWidth-1,segmentsY=this.segHeight-1,sizeX=this.width/segmentsX,sizeY=this.height/segmentsY,i=0;i<total;i++){var x=i%this.segWidth,y=i/this.segWidth|0;verts.push(x*sizeX,y*sizeY),uvs.push(x/segmentsX,y/segmentsY)}var totalSub=segmentsX*segmentsY;for(i=0;i<totalSub;i++){var xpos=i%segmentsX,ypos=i/segmentsX|0,value=ypos*this.segWidth+xpos,value2=ypos*this.segWidth+xpos+1,value3=(ypos+1)*this.segWidth+xpos,value4=(ypos+1)*this.segWidth+xpos+1;indices.push(value,value2,value3,value2,value4,value3)}this.buffers[0].data=new Float32Array(verts),this.buffers[1].data=new Float32Array(uvs),this.indexBuffer.data=new Uint16Array(indices),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},PlaneGeometry}(MeshGeometry),RopeGeometry=function(_super){function RopeGeometry(width,points,textureScale){void 0===width&&(width=200),void 0===textureScale&&(textureScale=0);var _this=_super.call(this,new Float32Array(4*points.length),new Float32Array(4*points.length),new Uint16Array(6*(points.length-1)))||this;return _this.points=points,_this._width=width,_this.textureScale=textureScale,_this.build(),_this}return mesh_extras_extends(RopeGeometry,_super),Object.defineProperty(RopeGeometry.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),RopeGeometry.prototype.build=function(){var points=this.points;if(points){var vertexBuffer=this.getBuffer("aVertexPosition"),uvBuffer=this.getBuffer("aTextureCoord"),indexBuffer=this.getIndex();if(!(points.length<1)){vertexBuffer.data.length/4!==points.length&&(vertexBuffer.data=new Float32Array(4*points.length),uvBuffer.data=new Float32Array(4*points.length),indexBuffer.data=new Uint16Array(6*(points.length-1)));var uvs=uvBuffer.data,indices=indexBuffer.data;uvs[0]=0,uvs[1]=0,uvs[2]=0,uvs[3]=1;for(var amount=0,prev=points[0],textureWidth=this._width*this.textureScale,total=points.length,i=0;i<total;i++){var index=4*i;if(this.textureScale>0){var dx=prev.x-points[i].x,dy=prev.y-points[i].y,distance=Math.sqrt(dx*dx+dy*dy);prev=points[i],amount+=distance/textureWidth}else amount=i/(total-1);uvs[index]=amount,uvs[index+1]=0,uvs[index+2]=amount,uvs[index+3]=1}var indexCount=0;for(i=0;i<total-1;i++){index=2*i;indices[indexCount++]=index,indices[indexCount++]=index+1,indices[indexCount++]=index+2,indices[indexCount++]=index+2,indices[indexCount++]=index+1,indices[indexCount++]=index+3}uvBuffer.update(),indexBuffer.update(),this.updateVertices()}}},RopeGeometry.prototype.updateVertices=function(){var points=this.points;if(!(points.length<1)){for(var nextPoint,lastPoint=points[0],perpX=0,perpY=0,vertices=this.buffers[0].data,total=points.length,i=0;i<total;i++){var point=points[i],index=4*i;perpY=-((nextPoint=i<points.length-1?points[i+1]:point).x-lastPoint.x),perpX=nextPoint.y-lastPoint.y;var perpLength=Math.sqrt(perpX*perpX+perpY*perpY),num=this.textureScale>0?this.textureScale*this._width/2:this._width/2;perpX/=perpLength,perpY/=perpLength,perpX*=num,perpY*=num,vertices[index]=point.x+perpX,vertices[index+1]=point.y+perpY,vertices[index+2]=point.x-perpX,vertices[index+3]=point.y-perpY,lastPoint=point}this.buffers[0].update()}},RopeGeometry.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},RopeGeometry}(MeshGeometry),SimpleRope=function(_super){function SimpleRope(texture,points,textureScale){void 0===textureScale&&(textureScale=0);var _this=this,ropeGeometry=new RopeGeometry(texture.height,points,textureScale),meshMaterial=new MeshMaterial(texture);return textureScale>0&&(texture.baseTexture.wrapMode=constants_WRAP_MODES.REPEAT),(_this=_super.call(this,ropeGeometry,meshMaterial)||this).autoUpdate=!0,_this}return mesh_extras_extends(SimpleRope,_super),SimpleRope.prototype._render=function(renderer){var geometry=this.geometry;(this.autoUpdate||geometry._width!==this.shader.texture.height)&&(geometry._width=this.shader.texture.height,geometry.update()),_super.prototype._render.call(this,renderer)},SimpleRope}(Mesh),SimplePlane=function(_super){function SimplePlane(texture,verticesX,verticesY){var _this=this,planeGeometry=new PlaneGeometry(texture.width,texture.height,verticesX,verticesY),meshMaterial=new MeshMaterial(Texture.WHITE);return(_this=_super.call(this,planeGeometry,meshMaterial)||this).texture=texture,_this.autoResize=!0,_this}return mesh_extras_extends(SimplePlane,_super),SimplePlane.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var geometry=this.geometry,_a=this.shader.texture,width=_a.width,height=_a.height;!this.autoResize||geometry.width===width&&geometry.height===height||(geometry.width=this.shader.texture.width,geometry.height=this.shader.texture.height,geometry.build())},Object.defineProperty(SimplePlane.prototype,"texture",{get:function(){return this.shader.texture},set:function(value){this.shader.texture!==value&&(this.shader.texture=value,this._textureID=-1,value.baseTexture.valid?this.textureUpdated():value.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),SimplePlane.prototype._render=function(renderer){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),_super.prototype._render.call(this,renderer)},SimplePlane.prototype.destroy=function(options){this.shader.texture.off("update",this.textureUpdated,this),_super.prototype.destroy.call(this,options)},SimplePlane}(Mesh),SimpleMesh=function(_super){function SimpleMesh(texture,vertices,uvs,indices,drawMode){void 0===texture&&(texture=Texture.EMPTY);var _this=this,geometry=new MeshGeometry(vertices,uvs,indices);geometry.getBuffer("aVertexPosition").static=!1;var meshMaterial=new MeshMaterial(texture);return(_this=_super.call(this,geometry,meshMaterial,null,drawMode)||this).autoUpdate=!0,_this}return mesh_extras_extends(SimpleMesh,_super),Object.defineProperty(SimpleMesh.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(value){this.geometry.getBuffer("aVertexPosition").data=value},enumerable:!1,configurable:!0}),SimpleMesh.prototype._render=function(renderer){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),_super.prototype._render.call(this,renderer)},SimpleMesh}(Mesh),NineSlicePlane=function(_super){function NineSlicePlane(texture,leftWidth,topHeight,rightWidth,bottomHeight){void 0===leftWidth&&(leftWidth=10),void 0===topHeight&&(topHeight=10),void 0===rightWidth&&(rightWidth=10),void 0===bottomHeight&&(bottomHeight=10);var _this=_super.call(this,Texture.WHITE,4,4)||this;return _this._origWidth=texture.orig.width,_this._origHeight=texture.orig.height,_this._width=_this._origWidth,_this._height=_this._origHeight,_this._leftWidth=leftWidth,_this._rightWidth=rightWidth,_this._topHeight=topHeight,_this._bottomHeight=bottomHeight,_this.texture=texture,_this}return mesh_extras_extends(NineSlicePlane,_super),NineSlicePlane.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(NineSlicePlane.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(value){this.geometry.getBuffer("aVertexPosition").data=value},enumerable:!1,configurable:!0}),NineSlicePlane.prototype.updateHorizontalVertices=function(){var vertices=this.vertices,scale=this._getMinScale();vertices[9]=vertices[11]=vertices[13]=vertices[15]=this._topHeight*scale,vertices[17]=vertices[19]=vertices[21]=vertices[23]=this._height-this._bottomHeight*scale,vertices[25]=vertices[27]=vertices[29]=vertices[31]=this._height},NineSlicePlane.prototype.updateVerticalVertices=function(){var vertices=this.vertices,scale=this._getMinScale();vertices[2]=vertices[10]=vertices[18]=vertices[26]=this._leftWidth*scale,vertices[4]=vertices[12]=vertices[20]=vertices[28]=this._width-this._rightWidth*scale,vertices[6]=vertices[14]=vertices[22]=vertices[30]=this._width},NineSlicePlane.prototype._getMinScale=function(){var w=this._leftWidth+this._rightWidth,scaleW=this._width>w?1:this._width/w,h=this._topHeight+this._bottomHeight,scaleH=this._height>h?1:this._height/h;return Math.min(scaleW,scaleH)},Object.defineProperty(NineSlicePlane.prototype,"width",{get:function(){return this._width},set:function(value){this._width=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane.prototype,"height",{get:function(){return this._height},set:function(value){this._height=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(value){this._leftWidth=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(value){this._rightWidth=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane.prototype,"topHeight",{get:function(){return this._topHeight},set:function(value){this._topHeight=value,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePlane.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(value){this._bottomHeight=value,this._refresh()},enumerable:!1,configurable:!0}),NineSlicePlane.prototype._refresh=function(){var texture=this.texture,uvs=this.geometry.buffers[1].data;this._origWidth=texture.orig.width,this._origHeight=texture.orig.height;var _uvw=1/this._origWidth,_uvh=1/this._origHeight;uvs[0]=uvs[8]=uvs[16]=uvs[24]=0,uvs[1]=uvs[3]=uvs[5]=uvs[7]=0,uvs[6]=uvs[14]=uvs[22]=uvs[30]=1,uvs[25]=uvs[27]=uvs[29]=uvs[31]=1,uvs[2]=uvs[10]=uvs[18]=uvs[26]=_uvw*this._leftWidth,uvs[4]=uvs[12]=uvs[20]=uvs[28]=1-_uvw*this._rightWidth,uvs[9]=uvs[11]=uvs[13]=uvs[15]=_uvh*this._topHeight,uvs[17]=uvs[19]=uvs[21]=uvs[23]=1-_uvh*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},NineSlicePlane}(SimplePlane),sprite_animated_extendStatics=function(d,b){return sprite_animated_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},sprite_animated_extendStatics(d,b)};var AnimatedSprite=function(_super){function AnimatedSprite(textures,autoUpdate){void 0===autoUpdate&&(autoUpdate=!0);var _this=_super.call(this,textures[0]instanceof Texture?textures[0]:textures[0].texture)||this;return _this._textures=null,_this._durations=null,_this._autoUpdate=autoUpdate,_this._isConnectedToTicker=!1,_this.animationSpeed=1,_this.loop=!0,_this.updateAnchor=!1,_this.onComplete=null,_this.onFrameChange=null,_this.onLoop=null,_this._currentTime=0,_this._playing=!1,_this._previousFrame=null,_this.textures=textures,_this}return function(d,b){function __(){this.constructor=d}sprite_animated_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(AnimatedSprite,_super),AnimatedSprite.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))},AnimatedSprite.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this,UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},AnimatedSprite.prototype.gotoAndStop=function(frameNumber){this.stop();var previousFrame=this.currentFrame;this._currentTime=frameNumber,previousFrame!==this.currentFrame&&this.updateTexture()},AnimatedSprite.prototype.gotoAndPlay=function(frameNumber){var previousFrame=this.currentFrame;this._currentTime=frameNumber,previousFrame!==this.currentFrame&&this.updateTexture(),this.play()},AnimatedSprite.prototype.update=function(deltaTime){if(this._playing){var elapsed=this.animationSpeed*deltaTime,previousFrame=this.currentFrame;if(null!==this._durations){var lag=this._currentTime%1*this._durations[this.currentFrame];for(lag+=elapsed/60*1e3;lag<0;)this._currentTime--,lag+=this._durations[this.currentFrame];var sign=Math.sign(this.animationSpeed*deltaTime);for(this._currentTime=Math.floor(this._currentTime);lag>=this._durations[this.currentFrame];)lag-=this._durations[this.currentFrame]*sign,this._currentTime+=sign;this._currentTime+=lag/this._durations[this.currentFrame]}else this._currentTime+=elapsed;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):previousFrame!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<previousFrame||this.animationSpeed<0&&this.currentFrame>previousFrame)&&this.onLoop(),this.updateTexture())}},AnimatedSprite.prototype.updateTexture=function(){var currentFrame=this.currentFrame;this._previousFrame!==currentFrame&&(this._previousFrame=currentFrame,this._texture=this._textures[currentFrame],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},AnimatedSprite.prototype.destroy=function(options){this.stop(),_super.prototype.destroy.call(this,options),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},AnimatedSprite.fromFrames=function(frames){for(var textures=[],i=0;i<frames.length;++i)textures.push(Texture.from(frames[i]));return new AnimatedSprite(textures)},AnimatedSprite.fromImages=function(images){for(var textures=[],i=0;i<images.length;++i)textures.push(Texture.from(images[i]));return new AnimatedSprite(textures)},Object.defineProperty(AnimatedSprite.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(AnimatedSprite.prototype,"textures",{get:function(){return this._textures},set:function(value){if(value[0]instanceof Texture)this._textures=value,this._durations=null;else{this._textures=[],this._durations=[];for(var i=0;i<value.length;i++)this._textures.push(value[i].texture),this._durations.push(value[i].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(AnimatedSprite.prototype,"currentFrame",{get:function(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;return currentFrame<0&&(currentFrame+=this._textures.length),currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(AnimatedSprite.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(AnimatedSprite.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),AnimatedSprite}(Sprite);Renderer.registerPlugin("accessibility",AccessibilityManager),Renderer.registerPlugin("extract",Extract),Renderer.registerPlugin("interaction",InteractionManager),Renderer.registerPlugin("particle",ParticleRenderer),Renderer.registerPlugin("prepare",Prepare),Renderer.registerPlugin("batch",BatchRenderer),Renderer.registerPlugin("tilingSprite",TilingSpriteRenderer),Loader.registerPlugin(BitmapFontLoader),Loader.registerPlugin(CompressedTextureLoader),Loader.registerPlugin(DDSLoader),Loader.registerPlugin(KTXLoader),Loader.registerPlugin(SpritesheetLoader),Application.registerPlugin(TickerPlugin),Application.registerPlugin(AppLoaderPlugin);var pixi_VERSION="6.1.2",filters={AlphaFilter,BlurFilter,BlurFilterPass,ColorMatrixFilter,DisplacementFilter,FXAAFilter,NoiseFilter},canvas_renderer_extendStatics=function(d,b){return canvas_renderer_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},canvas_renderer_extendStatics(d,b)};var CanvasMaskManager=function(){function CanvasMaskManager(renderer){this._foundShapes=[],this.renderer=renderer}return CanvasMaskManager.prototype.pushMask=function(maskData){var renderer=this.renderer,maskObject=maskData.maskObject||maskData;renderer.context.save();var foundShapes=this._foundShapes;if(this.recursiveFindShapes(maskObject,foundShapes),foundShapes.length>0){var context=renderer.context;context.beginPath();for(var i=0;i<foundShapes.length;i++){var shape=foundShapes[i],transform=shape.transform.worldTransform;this.renderer.setContextTransform(transform),this.renderGraphicsShape(shape)}foundShapes.length=0,context.clip()}},CanvasMaskManager.prototype.recursiveFindShapes=function(container,out){container.geometry&&container.geometry.graphicsData&&out.push(container);var children=container.children;if(children)for(var i=0;i<children.length;i++)this.recursiveFindShapes(children[i],out)},CanvasMaskManager.prototype.renderGraphicsShape=function(graphics){graphics.finishPoly();var context=this.renderer.context,graphicsData=graphics.geometry.graphicsData,len=graphicsData.length;if(0!==len)for(var i=0;i<len;i++){var data=graphicsData[i],shape=data.shape;if(shape.type===SHAPES.POLY){var points=shape.points,holes=data.holes,outerArea=void 0,innerArea=void 0,px=void 0,py=void 0;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++)context.lineTo(points[2*j],points[2*j+1]);if(holes.length>0){outerArea=0,px=points[0],py=points[1];for(j=2;j+2<points.length;j+=2)outerArea+=(points[j]-px)*(points[j+3]-py)-(points[j+2]-px)*(points[j+1]-py);for(var k=0;k<holes.length;k++)if(points=holes[k].shape.points){innerArea=0,px=points[0],py=points[1];for(j=2;j+2<points.length;j+=2)innerArea+=(points[j]-px)*(points[j+3]-py)-(points[j+2]-px)*(points[j+1]-py);if(innerArea*outerArea<0){context.moveTo(points[0],points[1]);for(j=2;j<points.length;j+=2)context.lineTo(points[j],points[j+1])}else{context.moveTo(points[points.length-2],points[points.length-1]);for(j=points.length-4;j>=0;j-=2)context.lineTo(points[j],points[j+1])}holes[k].shape.closeStroke&&context.closePath()}}points[0]===points[points.length-2]&&points[1]===points[points.length-1]&&context.closePath()}else if(shape.type===SHAPES.RECT)context.rect(shape.x,shape.y,shape.width,shape.height),context.closePath();else if(shape.type===SHAPES.CIRC)context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context.closePath();else if(shape.type===SHAPES.ELIP){var w=2*shape.width,h=2*shape.height,x=shape.x-w/2,y=shape.y-h/2,ox=w/2*.5522848,oy=h/2*.5522848,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym),context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context.closePath()}else if(shape.type===SHAPES.RREC){var rx=shape.x,ry=shape.y,width=shape.width,height=shape.height,radius=shape.radius,maxRadius=Math.min(width,height)/2;radius=radius>maxRadius?maxRadius:radius,context.moveTo(rx,ry+radius),context.lineTo(rx,ry+height-radius),context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context.lineTo(rx+width-radius,ry+height),context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context.lineTo(rx+width,ry+radius),context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context.lineTo(rx+radius,ry),context.quadraticCurveTo(rx,ry,rx,ry+radius),context.closePath()}}},CanvasMaskManager.prototype.popMask=function(renderer){renderer.context.restore(),renderer.invalidateBlendMode()},CanvasMaskManager.prototype.destroy=function(){},CanvasMaskManager}();function createColoredCanvas(color){var canvas=document.createElement("canvas");canvas.width=6,canvas.height=1;var context=canvas.getContext("2d");return context.fillStyle=color,context.fillRect(0,0,6,1),canvas}function canUseNewCanvasBlendModes(){if("undefined"==typeof document)return!1;var magenta=createColoredCanvas("#ff00ff"),yellow=createColoredCanvas("#ffff00"),canvas=document.createElement("canvas");canvas.width=6,canvas.height=1;var context=canvas.getContext("2d");context.globalCompositeOperation="multiply",context.drawImage(magenta,0,0),context.drawImage(yellow,2,0);var imageData=context.getImageData(2,0,1,1);if(!imageData)return!1;var data=imageData.data;return 255===data[0]&&0===data[1]&&0===data[2]}var canvas_renderer_tempMatrix=new Matrix,CanvasRenderer=function(_super){function CanvasRenderer(options){var array,_this=_super.call(this,constants_RENDERER_TYPE.CANVAS,options)||this;if(_this.refresh=!0,_this.maskManager=new CanvasMaskManager(_this),_this.smoothProperty="imageSmoothingEnabled",_this.blendModes=(void 0===array&&(array=[]),canUseNewCanvasBlendModes()?(array[constants_BLEND_MODES.NORMAL]="source-over",array[constants_BLEND_MODES.ADD]="lighter",array[constants_BLEND_MODES.MULTIPLY]="multiply",array[constants_BLEND_MODES.SCREEN]="screen",array[constants_BLEND_MODES.OVERLAY]="overlay",array[constants_BLEND_MODES.DARKEN]="darken",array[constants_BLEND_MODES.LIGHTEN]="lighten",array[constants_BLEND_MODES.COLOR_DODGE]="color-dodge",array[constants_BLEND_MODES.COLOR_BURN]="color-burn",array[constants_BLEND_MODES.HARD_LIGHT]="hard-light",array[constants_BLEND_MODES.SOFT_LIGHT]="soft-light",array[constants_BLEND_MODES.DIFFERENCE]="difference",array[constants_BLEND_MODES.EXCLUSION]="exclusion",array[constants_BLEND_MODES.HUE]="hue",array[constants_BLEND_MODES.SATURATION]="saturate",array[constants_BLEND_MODES.COLOR]="color",array[constants_BLEND_MODES.LUMINOSITY]="luminosity"):(array[constants_BLEND_MODES.NORMAL]="source-over",array[constants_BLEND_MODES.ADD]="lighter",array[constants_BLEND_MODES.MULTIPLY]="source-over",array[constants_BLEND_MODES.SCREEN]="source-over",array[constants_BLEND_MODES.OVERLAY]="source-over",array[constants_BLEND_MODES.DARKEN]="source-over",array[constants_BLEND_MODES.LIGHTEN]="source-over",array[constants_BLEND_MODES.COLOR_DODGE]="source-over",array[constants_BLEND_MODES.COLOR_BURN]="source-over",array[constants_BLEND_MODES.HARD_LIGHT]="source-over",array[constants_BLEND_MODES.SOFT_LIGHT]="source-over",array[constants_BLEND_MODES.DIFFERENCE]="source-over",array[constants_BLEND_MODES.EXCLUSION]="source-over",array[constants_BLEND_MODES.HUE]="source-over",array[constants_BLEND_MODES.SATURATION]="source-over",array[constants_BLEND_MODES.COLOR]="source-over",array[constants_BLEND_MODES.LUMINOSITY]="source-over"),array[constants_BLEND_MODES.NORMAL_NPM]=array[constants_BLEND_MODES.NORMAL],array[constants_BLEND_MODES.ADD_NPM]=array[constants_BLEND_MODES.ADD],array[constants_BLEND_MODES.SCREEN_NPM]=array[constants_BLEND_MODES.SCREEN],array[constants_BLEND_MODES.SRC_IN]="source-in",array[constants_BLEND_MODES.SRC_OUT]="source-out",array[constants_BLEND_MODES.SRC_ATOP]="source-atop",array[constants_BLEND_MODES.DST_OVER]="destination-over",array[constants_BLEND_MODES.DST_IN]="destination-in",array[constants_BLEND_MODES.DST_OUT]="destination-out",array[constants_BLEND_MODES.DST_ATOP]="destination-atop",array[constants_BLEND_MODES.XOR]="xor",array[constants_BLEND_MODES.SUBTRACT]="source-over",array),_this.renderingToScreen=!1,_this._activeBlendMode=null,_this._projTransform=null,_this._outerBlend=!1,_this.rootContext=_this.view.getContext("2d",{alpha:_this.useContextAlpha}),_this.context=_this.rootContext,!_this.rootContext.imageSmoothingEnabled){var rc=_this.rootContext;rc.webkitImageSmoothingEnabled?_this.smoothProperty="webkitImageSmoothingEnabled":rc.mozImageSmoothingEnabled?_this.smoothProperty="mozImageSmoothingEnabled":rc.oImageSmoothingEnabled?_this.smoothProperty="oImageSmoothingEnabled":rc.msImageSmoothingEnabled&&(_this.smoothProperty="msImageSmoothingEnabled")}return _this.initPlugins(CanvasRenderer.__plugins),sayHello("Canvas"),_this.resize(_this.options.width,_this.options.height),_this}return function(d,b){function __(){this.constructor=d}canvas_renderer_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(CanvasRenderer,_super),CanvasRenderer.prototype.render=function(displayObject,options){if(this.view){var renderTexture,clear,transform,skipUpdateTransform;options&&(options instanceof RenderTexture||options instanceof BaseRenderTexture?(deprecation("6.0.0","CanvasRenderer#render arguments changed, use options instead."),renderTexture=options,clear=arguments[2],transform=arguments[3],skipUpdateTransform=arguments[4]):(renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform)),this.renderingToScreen=!renderTexture,this.emit("prerender");var rootResolution=this.resolution;renderTexture?((renderTexture=renderTexture.castToBaseTexture())._canvasRenderTarget||(renderTexture._canvasRenderTarget=new CanvasRenderTarget(renderTexture.width,renderTexture.height,renderTexture.resolution),renderTexture.resource=new CanvasResource(renderTexture._canvasRenderTarget.canvas),renderTexture.valid=!0),this.context=renderTexture._canvasRenderTarget.context,this.resolution=renderTexture._canvasRenderTarget.resolution):this.context=this.rootContext;var context=this.context;if(this._projTransform=transform||null,renderTexture||(this._lastObjectRendered=displayObject),!skipUpdateTransform){var cacheParent=displayObject.enableTempParent();displayObject.updateTransform(),displayObject.disableTempParent(cacheParent)}if(context.save(),context.setTransform(1,0,0,1,0,0),context.globalAlpha=1,this._activeBlendMode=constants_BLEND_MODES.NORMAL,this._outerBlend=!1,context.globalCompositeOperation=this.blendModes[constants_BLEND_MODES.NORMAL],void 0!==clear?clear:this.clearBeforeRender)if(this.renderingToScreen)context.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(context.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,context.fillStyle=this._backgroundColorString,context.fillRect(0,0,this.width,this.height),context.globalAlpha=1);else{(renderTexture=renderTexture)._canvasRenderTarget.clear();var clearColor=renderTexture.clearColor;clearColor[3]>0&&(context.globalAlpha=this.useContextAlpha?clearColor[3]:1,context.fillStyle=hex2string(rgb2hex(clearColor)),context.fillRect(0,0,renderTexture.realWidth,renderTexture.realHeight),context.globalAlpha=1)}var tempContext=this.context;this.context=context,displayObject.renderCanvas(this),this.context=tempContext,context.restore(),this.resolution=rootResolution,this._projTransform=null,this.emit("postrender")}},CanvasRenderer.prototype.setContextTransform=function(transform,roundPixels,localResolution){var mat=transform,proj=this._projTransform,resolution=this.resolution;localResolution=localResolution||resolution,proj&&((mat=canvas_renderer_tempMatrix).copyFrom(transform),mat.prepend(proj)),roundPixels?this.context.setTransform(mat.a*localResolution,mat.b*localResolution,mat.c*localResolution,mat.d*localResolution,mat.tx*resolution|0,mat.ty*resolution|0):this.context.setTransform(mat.a*localResolution,mat.b*localResolution,mat.c*localResolution,mat.d*localResolution,mat.tx*resolution,mat.ty*resolution)},CanvasRenderer.prototype.clear=function(clearColor,alpha){void 0===clearColor&&(clearColor=this._backgroundColorString),void 0===alpha&&(alpha=this.backgroundAlpha);var context=this.context;context.clearRect(0,0,this.width,this.height),clearColor&&(context.globalAlpha=this.useContextAlpha?alpha:1,context.fillStyle=clearColor,context.fillRect(0,0,this.width,this.height),context.globalAlpha=1)},CanvasRenderer.prototype.setBlendMode=function(blendMode,readyForOuterBlend){var outerBlend=blendMode===constants_BLEND_MODES.SRC_IN||blendMode===constants_BLEND_MODES.SRC_OUT||blendMode===constants_BLEND_MODES.DST_IN||blendMode===constants_BLEND_MODES.DST_ATOP;!readyForOuterBlend&&outerBlend&&(blendMode=constants_BLEND_MODES.NORMAL),this._activeBlendMode!==blendMode&&(this._activeBlendMode=blendMode,this._outerBlend=outerBlend,this.context.globalCompositeOperation=this.blendModes[blendMode])},CanvasRenderer.prototype.destroy=function(removeView){_super.prototype.destroy.call(this,removeView),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},CanvasRenderer.prototype.resize=function(desiredScreenWidth,desiredScreenHeight){_super.prototype.resize.call(this,desiredScreenWidth,desiredScreenHeight),this.smoothProperty&&(this.rootContext[this.smoothProperty]=settings.SCALE_MODE===constants_SCALE_MODES.LINEAR)},CanvasRenderer.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},CanvasRenderer.registerPlugin=function(pluginName,ctor){CanvasRenderer.__plugins=CanvasRenderer.__plugins||{},CanvasRenderer.__plugins[pluginName]=ctor},CanvasRenderer}(AbstractRenderer),canvasUtils={canvas:null,getTintedCanvas:function(sprite,color){var texture=sprite.texture,stringColor="#"+("00000"+(0|(color=canvasUtils.roundColor(color))).toString(16)).substr(-6);texture.tintCache=texture.tintCache||{};var canvas,cachedCanvas=texture.tintCache[stringColor];if(cachedCanvas){if(cachedCanvas.tintId===texture._updateID)return texture.tintCache[stringColor];canvas=texture.tintCache[stringColor]}else canvas=document.createElement("canvas");if(canvasUtils.tintMethod(texture,color,canvas),canvas.tintId=texture._updateID,canvasUtils.convertTintToImage){var tintImage=new Image;tintImage.src=canvas.toDataURL(),texture.tintCache[stringColor]=tintImage}else texture.tintCache[stringColor]=canvas;return canvas},getTintedPattern:function(texture,color){var stringColor="#"+("00000"+(0|(color=canvasUtils.roundColor(color))).toString(16)).substr(-6);texture.patternCache=texture.patternCache||{};var pattern=texture.patternCache[stringColor];return pattern&&pattern.tintId===texture._updateID||(canvasUtils.canvas||(canvasUtils.canvas=document.createElement("canvas")),canvasUtils.tintMethod(texture,color,canvasUtils.canvas),(pattern=canvasUtils.canvas.getContext("2d").createPattern(canvasUtils.canvas,"repeat")).tintId=texture._updateID,texture.patternCache[stringColor]=pattern),pattern},tintWithMultiply:function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context.save(),context.fillStyle="#"+("00000"+(0|color).toString(16)).substr(-6),context.fillRect(0,0,crop.width,crop.height),context.globalCompositeOperation="multiply";var source=texture.baseTexture.getDrawableSource();context.drawImage(source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.globalCompositeOperation="destination-atop",context.drawImage(source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.restore()},tintWithOverlay:function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context.save(),context.globalCompositeOperation="copy",context.fillStyle="#"+("00000"+(0|color).toString(16)).substr(-6),context.fillRect(0,0,crop.width,crop.height),context.globalCompositeOperation="destination-atop",context.drawImage(texture.baseTexture.getDrawableSource(),crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.restore()},tintWithPerPixel:function(texture,color,canvas){var context=canvas.getContext("2d"),crop=texture._frame.clone(),resolution=texture.baseTexture.resolution;crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=Math.ceil(crop.width),canvas.height=Math.ceil(crop.height),context.save(),context.globalCompositeOperation="copy",context.drawImage(texture.baseTexture.getDrawableSource(),crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.restore();for(var rgbValues=hex2rgb(color),r=rgbValues[0],g=rgbValues[1],b=rgbValues[2],pixelData=context.getImageData(0,0,crop.width,crop.height),pixels=pixelData.data,i=0;i<pixels.length;i+=4)pixels[i+0]*=r,pixels[i+1]*=g,pixels[i+2]*=b;context.putImageData(pixelData,0,0)},roundColor:function(color){var step=canvasUtils.cacheStepsPerColorChannel,rgbValues=hex2rgb(color);return rgbValues[0]=Math.min(255,rgbValues[0]/step*step),rgbValues[1]=Math.min(255,rgbValues[1]/step*step),rgbValues[2]=Math.min(255,rgbValues[2]/step*step),rgb2hex(rgbValues)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:canUseNewCanvasBlendModes(),tintMethod:null};canvasUtils.tintMethod=canvasUtils.canUseMultiply?canvasUtils.tintWithMultiply:canvasUtils.tintWithPerPixel;var parentCreate=Renderer.create;Renderer.create=function(options){if(!(options&&options.forceCanvas))try{return parentCreate(options)}catch(err){}return new CanvasRenderer(options)},BaseTexture.prototype.getDrawableSource=function(){var resource=this.resource;return resource?resource.bitmap||resource.source:null},BaseRenderTexture.prototype._canvasRenderTarget=null,Texture.prototype.patternCache=null,Texture.prototype.tintCache=null;var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{};function createCommonjsModule(fn,basedir,module){return fn(module={path:basedir,exports:{},require:function(path,base){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==base&&module.path)}},module.exports),module.exports}var canvas_mesh_eventemitter3=createCommonjsModule((function(module){var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var arguments$1=arguments,evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments$1[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments$1[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter})),punycode=createCommonjsModule((function(module,exports){!function(root){var freeExports=exports&&!exports.nodeType&&exports,freeModule=module&&!module.nodeType&&module,freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,key,maxInt=2147483647,regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";return parts.length>1&&(result=parts[0]+"@",string=parts[1]),result+map((string=string.replace(regexSeparators,".")).split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,(function(value){var output="";return value>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)})).join("")}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/700):delta>>1,delta+=floor(delta/numPoints);delta>455;k+=36)delta=floor(delta/35);return floor(k+36*delta/(delta+38))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,codePoint,output=[],inputLength=input.length,i=0,n=128,bias=72;for((basic=input.lastIndexOf("-"))<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=36;index>=inputLength&&error("invalid-input"),((digit=(codePoint=input.charCodeAt(index++))-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:36)>=36||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,!(digit<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)w>floor(maxInt/(baseMinusT=36-t))&&error("overflow"),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=128,delta=0,bias=72,j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push("-");handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)(currentValue=input[j])>=n&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=36;!(q<(t=k<=bias?1:k>=bias+26?26:k-bias));k+=36)qMinusT=q-t,baseMinusT=36-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}if(punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode,encode,toASCII:function(input){return mapDomain(input,(function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string}))},toUnicode:function(input){return mapDomain(input,(function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string}))}},freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(commonjsGlobal)})),util_isString=function(arg){return"string"==typeof arg},util_isObject=function(arg){return"object"==typeof arg&&null!==arg},util_isNull=function(arg){return null===arg},util_isNullOrUndefined=function(arg){return null==arg};function canvas_mesh_hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var decode=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),canvas_mesh_hasOwnProperty(obj,k)?Array.isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj},stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}},encode=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?Object.keys(obj).map((function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return Array.isArray(obj[k])?obj[k].map((function(v){return ks+encodeURIComponent(stringifyPrimitive(v))})).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))})).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""},querystring=createCommonjsModule((function(module,exports){exports.decode=exports.parse=decode,exports.encode=exports.stringify=encode})),parse=urlParse,canvas_mesh_resolve=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},format=function(obj){util_isString(obj)&&(obj=urlParse(obj));if(!(obj instanceof canvas_mesh_Url))return canvas_mesh_Url.prototype.format.call(obj);return obj.format()};function canvas_mesh_Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util_isObject(url)&&url instanceof canvas_mesh_Url)return url;var u=new canvas_mesh_Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}canvas_mesh_Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util_isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}return this.href=this.format(),this},canvas_mesh_Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util_isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,(function(match){return encodeURIComponent(match)})))+(search=search.replace("#","%23"))+hash},canvas_mesh_Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},canvas_mesh_Url.prototype.resolveObject=function(relative){if(util_isString(relative)){var rel=new canvas_mesh_Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new canvas_mesh_Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util_isNullOrUndefined(relative.search)){if(psychotic)result.hostname=result.host=srcPath.shift(),(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift());return result.search=relative.search,result.query=relative.query,util_isNull(result.pathname)&&util_isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var authInHost,isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);psychotic&&(result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"",(authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()));return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util_isNull(result.pathname)&&util_isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},canvas_mesh_Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)};var canvas_mesh_url={parse,format,resolve:canvas_mesh_resolve};settings.RETINA_PREFIX=/@([0-9\.]+)x/,settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var canvas_mesh_supported,canvas_mesh_saidHello=!1;var canvas_mesh_premultiplyBlendMode=function(){for(var pm=[],npm=[],i=0;i<32;i++)pm[i]=i,npm[i]=i;pm[constants_BLEND_MODES.NORMAL_NPM]=constants_BLEND_MODES.NORMAL,pm[constants_BLEND_MODES.ADD_NPM]=constants_BLEND_MODES.ADD,pm[constants_BLEND_MODES.SCREEN_NPM]=constants_BLEND_MODES.SCREEN,npm[constants_BLEND_MODES.NORMAL]=constants_BLEND_MODES.NORMAL_NPM,npm[constants_BLEND_MODES.ADD]=constants_BLEND_MODES.ADD_NPM,npm[constants_BLEND_MODES.SCREEN]=constants_BLEND_MODES.SCREEN_NPM;var array=[];return array.push(npm),array.push(pm),array}();function canvas_mesh_getBufferType(array){if(4===array.BYTES_PER_ELEMENT)return array instanceof Float32Array?"Float32Array":array instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===array.BYTES_PER_ELEMENT){if(array instanceof Uint16Array)return"Uint16Array"}else if(1===array.BYTES_PER_ELEMENT&&array instanceof Uint8Array)return"Uint8Array";return null}function canvas_mesh_nextPow2(v){return v+=0===v?1:0,--v,v|=v>>>1,v|=v>>>2,v|=v>>>4,v|=v>>>8,(v|=v>>>16)+1}function canvas_mesh_isPow2(v){return!(v&v-1||!v)}function canvas_mesh_log2(v){var r=(v>65535?1:0)<<4,shift=((v>>>=r)>255?1:0)<<3;return r|=shift,r|=shift=((v>>>=shift)>15?1:0)<<2,(r|=shift=((v>>>=shift)>3?1:0)<<1)|(v>>>=shift)>>1}var canvas_mesh_nextUid=0;function canvas_mesh_uid(){return++canvas_mesh_nextUid}var canvas_mesh_warnings={};function canvas_mesh_deprecation(version,message,ignoreDepth){if(void 0===ignoreDepth&&(ignoreDepth=3),!canvas_mesh_warnings[message]){var stack=(new Error).stack;void 0===stack?console.warn("PixiJS Deprecation Warning: ",message+"\nDeprecated since v"+version):(stack=stack.split("\n").splice(ignoreDepth).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",message+"\nDeprecated since v"+version),console.warn(stack),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",message+"\nDeprecated since v"+version),console.warn(stack))),canvas_mesh_warnings[message]=!0}}var canvas_mesh_tempAnchor,canvas_mesh_ProgramCache={},canvas_mesh_TextureCache=Object.create(null),canvas_mesh_BaseTextureCache=Object.create(null);!function(){function CanvasRenderTarget(width,height,resolution){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=resolution||settings.RESOLUTION,this.resize(width,height)}CanvasRenderTarget.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},CanvasRenderTarget.prototype.resize=function(desiredWidth,desiredHeight){this.canvas.width=Math.round(desiredWidth*this.resolution),this.canvas.height=Math.round(desiredHeight*this.resolution)},CanvasRenderTarget.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(CanvasRenderTarget.prototype,"width",{get:function(){return this.canvas.width},set:function(val){this.canvas.width=Math.round(val)},enumerable:!1,configurable:!0}),Object.defineProperty(CanvasRenderTarget.prototype,"height",{get:function(){return this.canvas.height},set:function(val){this.canvas.height=Math.round(val)},enumerable:!1,configurable:!0})}();function canvas_mesh_getResolutionOfUrl(url,defaultValue){var resolution=settings.RETINA_PREFIX.exec(url);return resolution?parseFloat(resolution[1]):void 0!==defaultValue?defaultValue:1}var canvas_mesh_UPDATE_PRIORITY,canvas_mesh_Runner=function(){function Runner(name){this.items=[],this._name=name,this._aliasCount=0}return Runner.prototype.emit=function(a0,a1,a2,a3,a4,a5,a6,a7){if(arguments.length>8)throw new Error("max arguments reached");var _a=this,name=_a.name,items=_a.items;this._aliasCount++;for(var i=0,len=items.length;i<len;i++)items[i][name](a0,a1,a2,a3,a4,a5,a6,a7);return items===this.items&&this._aliasCount--,this},Runner.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},Runner.prototype.add=function(item){return item[this._name]&&(this.ensureNonAliasedItems(),this.remove(item),this.items.push(item)),this},Runner.prototype.remove=function(item){var index=this.items.indexOf(item);return-1!==index&&(this.ensureNonAliasedItems(),this.items.splice(index,1)),this},Runner.prototype.contains=function(item){return-1!==this.items.indexOf(item)},Runner.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},Runner.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(Runner.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(Runner.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Runner}();Object.defineProperties(canvas_mesh_Runner.prototype,{dispatch:{value:canvas_mesh_Runner.prototype.emit},run:{value:canvas_mesh_Runner.prototype.emit}}),settings.TARGET_FPMS=.06,function(UPDATE_PRIORITY){UPDATE_PRIORITY[UPDATE_PRIORITY.INTERACTION=50]="INTERACTION",UPDATE_PRIORITY[UPDATE_PRIORITY.HIGH=25]="HIGH",UPDATE_PRIORITY[UPDATE_PRIORITY.NORMAL=0]="NORMAL",UPDATE_PRIORITY[UPDATE_PRIORITY.LOW=-25]="LOW",UPDATE_PRIORITY[UPDATE_PRIORITY.UTILITY=-50]="UTILITY"}(canvas_mesh_UPDATE_PRIORITY||(canvas_mesh_UPDATE_PRIORITY={}));var canvas_mesh_SHAPES,canvas_mesh_TickerListener=function(){function TickerListener(fn,context,priority,once){void 0===context&&(context=null),void 0===priority&&(priority=0),void 0===once&&(once=!1),this.next=null,this.previous=null,this._destroyed=!1,this.fn=fn,this.context=context,this.priority=priority,this.once=once}return TickerListener.prototype.match=function(fn,context){return void 0===context&&(context=null),this.fn===fn&&this.context===context},TickerListener.prototype.emit=function(deltaTime){this.fn&&(this.context?this.fn.call(this.context,deltaTime):this.fn(deltaTime));var redirect=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),redirect},TickerListener.prototype.connect=function(previous){this.previous=previous,previous.next&&(previous.next.previous=this),this.next=previous.next,previous.next=this},TickerListener.prototype.destroy=function(hard){void 0===hard&&(hard=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var redirect=this.next;return this.next=hard?null:redirect,this.previous=null,redirect},TickerListener}(),canvas_mesh_Ticker=function(){function Ticker(){var _this=this;this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new canvas_mesh_TickerListener(null,null,1/0),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=function(time){_this._requestId=null,_this.started&&(_this.update(time),_this.started&&null===_this._requestId&&_this._head.next&&(_this._requestId=requestAnimationFrame(_this._tick)))}}return Ticker.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},Ticker.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},Ticker.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},Ticker.prototype.add=function(fn,context,priority){return void 0===priority&&(priority=canvas_mesh_UPDATE_PRIORITY.NORMAL),this._addListener(new canvas_mesh_TickerListener(fn,context,priority))},Ticker.prototype.addOnce=function(fn,context,priority){return void 0===priority&&(priority=canvas_mesh_UPDATE_PRIORITY.NORMAL),this._addListener(new canvas_mesh_TickerListener(fn,context,priority,!0))},Ticker.prototype._addListener=function(listener){var current=this._head.next,previous=this._head;if(current){for(;current;){if(listener.priority>current.priority){listener.connect(previous);break}previous=current,current=current.next}listener.previous||listener.connect(previous)}else listener.connect(previous);return this._startIfPossible(),this},Ticker.prototype.remove=function(fn,context){for(var listener=this._head.next;listener;)listener=listener.match(fn,context)?listener.destroy():listener.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(Ticker.prototype,"count",{get:function(){if(!this._head)return 0;for(var count=0,current=this._head;current=current.next;)count++;return count},enumerable:!1,configurable:!0}),Ticker.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},Ticker.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},Ticker.prototype.destroy=function(){if(!this._protected){this.stop();for(var listener=this._head.next;listener;)listener=listener.destroy(!0);this._head.destroy(),this._head=null}},Ticker.prototype.update=function(currentTime){var elapsedMS;if(void 0===currentTime&&(currentTime=performance.now()),currentTime>this.lastTime){if((elapsedMS=this.elapsedMS=currentTime-this.lastTime)>this._maxElapsedMS&&(elapsedMS=this._maxElapsedMS),elapsedMS*=this.speed,this._minElapsedMS){var delta=currentTime-this._lastFrame|0;if(delta<this._minElapsedMS)return;this._lastFrame=currentTime-delta%this._minElapsedMS}this.deltaMS=elapsedMS,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;for(var head=this._head,listener=head.next;listener;)listener=listener.emit(this.deltaTime);head.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=currentTime},Object.defineProperty(Ticker.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(fps){var minFPS=Math.min(this.maxFPS,fps),minFPMS=Math.min(Math.max(0,minFPS)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/minFPMS},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(fps){if(0===fps)this._minElapsedMS=0;else{var maxFPS=Math.max(this.minFPS,fps);this._minElapsedMS=1/(maxFPS/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker,"shared",{get:function(){if(!Ticker._shared){var shared=Ticker._shared=new Ticker;shared.autoStart=!0,shared._protected=!0}return Ticker._shared},enumerable:!1,configurable:!0}),Object.defineProperty(Ticker,"system",{get:function(){if(!Ticker._system){var system=Ticker._system=new Ticker;system.autoStart=!0,system._protected=!0}return Ticker._system},enumerable:!1,configurable:!0}),Ticker}(),canvas_mesh_PI_2=2*Math.PI;!function(SHAPES){SHAPES[SHAPES.POLY=0]="POLY",SHAPES[SHAPES.RECT=1]="RECT",SHAPES[SHAPES.CIRC=2]="CIRC",SHAPES[SHAPES.ELIP=3]="ELIP",SHAPES[SHAPES.RREC=4]="RREC"}(canvas_mesh_SHAPES||(canvas_mesh_SHAPES={}));var canvas_mesh_Rectangle=function(){function Rectangle(x,y,width,height){void 0===x&&(x=0),void 0===y&&(y=0),void 0===width&&(width=0),void 0===height&&(height=0),this.x=Number(x),this.y=Number(y),this.width=Number(width),this.height=Number(height),this.type=canvas_mesh_SHAPES.RECT}return Object.defineProperty(Rectangle.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(Rectangle,"EMPTY",{get:function(){return new Rectangle(0,0,0,0)},enumerable:!1,configurable:!0}),Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)},Rectangle.prototype.copyFrom=function(rectangle){return this.x=rectangle.x,this.y=rectangle.y,this.width=rectangle.width,this.height=rectangle.height,this},Rectangle.prototype.copyTo=function(rectangle){return rectangle.x=this.x,rectangle.y=this.y,rectangle.width=this.width,rectangle.height=this.height,rectangle},Rectangle.prototype.contains=function(x,y){return!(this.width<=0||this.height<=0)&&(x>=this.x&&x<this.x+this.width&&y>=this.y&&y<this.y+this.height)},Rectangle.prototype.pad=function(paddingX,paddingY){return void 0===paddingX&&(paddingX=0),void 0===paddingY&&(paddingY=paddingX),this.x-=paddingX,this.y-=paddingY,this.width+=2*paddingX,this.height+=2*paddingY,this},Rectangle.prototype.fit=function(rectangle){var x1=Math.max(this.x,rectangle.x),x2=Math.min(this.x+this.width,rectangle.x+rectangle.width),y1=Math.max(this.y,rectangle.y),y2=Math.min(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=Math.max(x2-x1,0),this.y=y1,this.height=Math.max(y2-y1,0),this},Rectangle.prototype.ceil=function(resolution,eps){void 0===resolution&&(resolution=1),void 0===eps&&(eps=.001);var x2=Math.ceil((this.x+this.width-eps)*resolution)/resolution,y2=Math.ceil((this.y+this.height-eps)*resolution)/resolution;return this.x=Math.floor((this.x+eps)*resolution)/resolution,this.y=Math.floor((this.y+eps)*resolution)/resolution,this.width=x2-this.x,this.height=y2-this.y,this},Rectangle.prototype.enlarge=function(rectangle){var x1=Math.min(this.x,rectangle.x),x2=Math.max(this.x+this.width,rectangle.x+rectangle.width),y1=Math.min(this.y,rectangle.y),y2=Math.max(this.y+this.height,rectangle.y+rectangle.height);return this.x=x1,this.width=x2-x1,this.y=y1,this.height=y2-y1,this},Rectangle.prototype.toString=function(){return"[@pixi/math:Rectangle x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+"]"},Rectangle}(),canvas_mesh_Point=function(){function Point(x,y){void 0===x&&(x=0),void 0===y&&(y=0),this.x=0,this.y=0,this.x=x,this.y=y}return Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.copyFrom=function(p){return this.set(p.x,p.y),this},Point.prototype.copyTo=function(p){return p.set(this.x,this.y),p},Point.prototype.equals=function(p){return p.x===this.x&&p.y===this.y},Point.prototype.set=function(x,y){return void 0===x&&(x=0),void 0===y&&(y=x),this.x=x,this.y=y,this},Point.prototype.toString=function(){return"[@pixi/math:Point x="+this.x+" y="+this.y+"]"},Point}(),canvas_mesh_ObservablePoint=function(){function ObservablePoint(cb,scope,x,y){void 0===x&&(x=0),void 0===y&&(y=0),this._x=x,this._y=y,this.cb=cb,this.scope=scope}return ObservablePoint.prototype.clone=function(cb,scope){return void 0===cb&&(cb=this.cb),void 0===scope&&(scope=this.scope),new ObservablePoint(cb,scope,this._x,this._y)},ObservablePoint.prototype.set=function(x,y){return void 0===x&&(x=0),void 0===y&&(y=x),this._x===x&&this._y===y||(this._x=x,this._y=y,this.cb.call(this.scope)),this},ObservablePoint.prototype.copyFrom=function(p){return this._x===p.x&&this._y===p.y||(this._x=p.x,this._y=p.y,this.cb.call(this.scope)),this},ObservablePoint.prototype.copyTo=function(p){return p.set(this._x,this._y),p},ObservablePoint.prototype.equals=function(p){return p.x===this._x&&p.y===this._y},ObservablePoint.prototype.toString=function(){return"[@pixi/math:ObservablePoint x=0 y=0 scope="+this.scope+"]"},Object.defineProperty(ObservablePoint.prototype,"x",{get:function(){return this._x},set:function(value){this._x!==value&&(this._x=value,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(ObservablePoint.prototype,"y",{get:function(){return this._y},set:function(value){this._y!==value&&(this._y=value,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),ObservablePoint}(),canvas_mesh_Matrix=function(){function Matrix(a,b,c,d,tx,ty){void 0===a&&(a=1),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===tx&&(tx=0),void 0===ty&&(ty=0),this.array=null,this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty}return Matrix.prototype.fromArray=function(array){this.a=array[0],this.b=array[1],this.c=array[3],this.d=array[4],this.tx=array[2],this.ty=array[5]},Matrix.prototype.set=function(a,b,c,d,tx,ty){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this},Matrix.prototype.toArray=function(transpose,out){this.array||(this.array=new Float32Array(9));var array=out||this.array;return transpose?(array[0]=this.a,array[1]=this.b,array[2]=0,array[3]=this.c,array[4]=this.d,array[5]=0,array[6]=this.tx,array[7]=this.ty,array[8]=1):(array[0]=this.a,array[1]=this.c,array[2]=this.tx,array[3]=this.b,array[4]=this.d,array[5]=this.ty,array[6]=0,array[7]=0,array[8]=1),array},Matrix.prototype.apply=function(pos,newPos){newPos=newPos||new canvas_mesh_Point;var x=pos.x,y=pos.y;return newPos.x=this.a*x+this.c*y+this.tx,newPos.y=this.b*x+this.d*y+this.ty,newPos},Matrix.prototype.applyInverse=function(pos,newPos){newPos=newPos||new canvas_mesh_Point;var id=1/(this.a*this.d+this.c*-this.b),x=pos.x,y=pos.y;return newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id,newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id,newPos},Matrix.prototype.translate=function(x,y){return this.tx+=x,this.ty+=y,this},Matrix.prototype.scale=function(x,y){return this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this},Matrix.prototype.rotate=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this},Matrix.prototype.append=function(matrix){var a1=this.a,b1=this.b,c1=this.c,d1=this.d;return this.a=matrix.a*a1+matrix.b*c1,this.b=matrix.a*b1+matrix.b*d1,this.c=matrix.c*a1+matrix.d*c1,this.d=matrix.c*b1+matrix.d*d1,this.tx=matrix.tx*a1+matrix.ty*c1+this.tx,this.ty=matrix.tx*b1+matrix.ty*d1+this.ty,this},Matrix.prototype.setTransform=function(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){return this.a=Math.cos(rotation+skewY)*scaleX,this.b=Math.sin(rotation+skewY)*scaleX,this.c=-Math.sin(rotation-skewX)*scaleY,this.d=Math.cos(rotation-skewX)*scaleY,this.tx=x-(pivotX*this.a+pivotY*this.c),this.ty=y-(pivotX*this.b+pivotY*this.d),this},Matrix.prototype.prepend=function(matrix){var tx1=this.tx;if(1!==matrix.a||0!==matrix.b||0!==matrix.c||1!==matrix.d){var a1=this.a,c1=this.c;this.a=a1*matrix.a+this.b*matrix.c,this.b=a1*matrix.b+this.b*matrix.d,this.c=c1*matrix.a+this.d*matrix.c,this.d=c1*matrix.b+this.d*matrix.d}return this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty,this},Matrix.prototype.decompose=function(transform){var a=this.a,b=this.b,c=this.c,d=this.d,pivot=transform.pivot,skewX=-Math.atan2(-c,d),skewY=Math.atan2(b,a),delta=Math.abs(skewX+skewY);return delta<1e-5||Math.abs(canvas_mesh_PI_2-delta)<1e-5?(transform.rotation=skewY,transform.skew.x=transform.skew.y=0):(transform.rotation=0,transform.skew.x=skewX,transform.skew.y=skewY),transform.scale.x=Math.sqrt(a*a+b*b),transform.scale.y=Math.sqrt(c*c+d*d),transform.position.x=this.tx+(pivot.x*a+pivot.y*c),transform.position.y=this.ty+(pivot.x*b+pivot.y*d),transform},Matrix.prototype.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;return this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n,this},Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix.prototype.clone=function(){var matrix=new Matrix;return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix.prototype.copyTo=function(matrix){return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix.prototype.copyFrom=function(matrix){return this.a=matrix.a,this.b=matrix.b,this.c=matrix.c,this.d=matrix.d,this.tx=matrix.tx,this.ty=matrix.ty,this},Matrix.prototype.toString=function(){return"[@pixi/math:Matrix a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+"]"},Object.defineProperty(Matrix,"IDENTITY",{get:function(){return new Matrix},enumerable:!1,configurable:!0}),Object.defineProperty(Matrix,"TEMP_MATRIX",{get:function(){return new Matrix},enumerable:!1,configurable:!0}),Matrix}(),canvas_mesh_ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],canvas_mesh_uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],canvas_mesh_vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],canvas_mesh_vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],canvas_mesh_rotationCayley=[],canvas_mesh_rotationMatrices=[],canvas_mesh_signum=Math.sign;!function(){for(var i=0;i<16;i++){var row=[];canvas_mesh_rotationCayley.push(row);for(var j=0;j<16;j++)for(var _ux=canvas_mesh_signum(canvas_mesh_ux[i]*canvas_mesh_ux[j]+canvas_mesh_vx[i]*canvas_mesh_uy[j]),_uy=canvas_mesh_signum(canvas_mesh_uy[i]*canvas_mesh_ux[j]+canvas_mesh_vy[i]*canvas_mesh_uy[j]),_vx=canvas_mesh_signum(canvas_mesh_ux[i]*canvas_mesh_vx[j]+canvas_mesh_vx[i]*canvas_mesh_vy[j]),_vy=canvas_mesh_signum(canvas_mesh_uy[i]*canvas_mesh_vx[j]+canvas_mesh_vy[i]*canvas_mesh_vy[j]),k=0;k<16;k++)if(canvas_mesh_ux[k]===_ux&&canvas_mesh_uy[k]===_uy&&canvas_mesh_vx[k]===_vx&&canvas_mesh_vy[k]===_vy){row.push(k);break}}for(i=0;i<16;i++){var mat=new canvas_mesh_Matrix;mat.set(canvas_mesh_ux[i],canvas_mesh_uy[i],canvas_mesh_vx[i],canvas_mesh_vy[i],0,0),canvas_mesh_rotationMatrices.push(mat)}}();var canvas_mesh_groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(ind){return canvas_mesh_ux[ind]},uY:function(ind){return canvas_mesh_uy[ind]},vX:function(ind){return canvas_mesh_vx[ind]},vY:function(ind){return canvas_mesh_vy[ind]},inv:function(rotation){return 8&rotation?15&rotation:7&-rotation},add:function(rotationSecond,rotationFirst){return canvas_mesh_rotationCayley[rotationSecond][rotationFirst]},sub:function(rotationSecond,rotationFirst){return canvas_mesh_rotationCayley[rotationSecond][canvas_mesh_groupD8.inv(rotationFirst)]},rotate180:function(rotation){return 4^rotation},isVertical:function(rotation){return 2==(3&rotation)},byDirection:function(dx,dy){return 2*Math.abs(dx)<=Math.abs(dy)?dy>=0?canvas_mesh_groupD8.S:canvas_mesh_groupD8.N:2*Math.abs(dy)<=Math.abs(dx)?dx>0?canvas_mesh_groupD8.E:canvas_mesh_groupD8.W:dy>0?dx>0?canvas_mesh_groupD8.SE:canvas_mesh_groupD8.SW:dx>0?canvas_mesh_groupD8.NE:canvas_mesh_groupD8.NW},matrixAppendRotationInv:function(matrix,rotation,tx,ty){void 0===tx&&(tx=0),void 0===ty&&(ty=0);var mat=canvas_mesh_rotationMatrices[canvas_mesh_groupD8.inv(rotation)];mat.tx=tx,mat.ty=ty,matrix.append(mat)}};!function(){function Transform(){this.worldTransform=new canvas_mesh_Matrix,this.localTransform=new canvas_mesh_Matrix,this.position=new canvas_mesh_ObservablePoint(this.onChange,this,0,0),this.scale=new canvas_mesh_ObservablePoint(this.onChange,this,1,1),this.pivot=new canvas_mesh_ObservablePoint(this.onChange,this,0,0),this.skew=new canvas_mesh_ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}Transform.prototype.onChange=function(){this._localID++},Transform.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},Transform.prototype.toString=function(){return"[@pixi/math:Transform position=("+this.position.x+", "+this.position.y+") rotation="+this.rotation+" scale=("+this.scale.x+", "+this.scale.y+") skew=("+this.skew.x+", "+this.skew.y+") ]"},Transform.prototype.updateLocalTransform=function(){var lt=this.localTransform;this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1)},Transform.prototype.updateTransform=function(parentTransform){var lt=this.localTransform;if(this._localID!==this._currentLocalID&&(lt.a=this._cx*this.scale.x,lt.b=this._sx*this.scale.x,lt.c=this._cy*this.scale.y,lt.d=this._sy*this.scale.y,lt.tx=this.position.x-(this.pivot.x*lt.a+this.pivot.y*lt.c),lt.ty=this.position.y-(this.pivot.x*lt.b+this.pivot.y*lt.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==parentTransform._worldID){var pt=parentTransform.worldTransform,wt=this.worldTransform;wt.a=lt.a*pt.a+lt.b*pt.c,wt.b=lt.a*pt.b+lt.b*pt.d,wt.c=lt.c*pt.a+lt.d*pt.c,wt.d=lt.c*pt.b+lt.d*pt.d,wt.tx=lt.tx*pt.a+lt.ty*pt.c+pt.tx,wt.ty=lt.tx*pt.b+lt.ty*pt.d+pt.ty,this._parentID=parentTransform._worldID,this._worldID++}},Transform.prototype.setFromMatrix=function(matrix){matrix.decompose(this),this._localID++},Object.defineProperty(Transform.prototype,"rotation",{get:function(){return this._rotation},set:function(value){this._rotation!==value&&(this._rotation=value,this.updateSkew())},enumerable:!1,configurable:!0}),Transform.IDENTITY=new Transform}();settings.PREFER_ENV=settings_isMobile.any?constants_ENV.WEBGL:constants_ENV.WEBGL2,settings.STRICT_TEXTURE_CACHE=!1;var canvas_mesh_INSTALLED=[];function canvas_mesh_autoDetectResource(source,options){if(!source)return null;var extension="";if("string"==typeof source){var result=/\.(\w{3,4})(?:$|\?|#)/i.exec(source);result&&(extension=result[1].toLowerCase())}for(var i=canvas_mesh_INSTALLED.length-1;i>=0;--i){var ResourcePlugin=canvas_mesh_INSTALLED[i];if(ResourcePlugin.test&&ResourcePlugin.test(source,extension))return new ResourcePlugin(source,options)}throw new Error("Unrecognized source type to auto-detect Resource")}var canvas_mesh_extendStatics=function(d,b){return canvas_mesh_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},canvas_mesh_extendStatics(d,b)};function canvas_mesh_extends(d,b){function __(){this.constructor=d}canvas_mesh_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var canvas_mesh_assign=function(){return canvas_mesh_assign=Object.assign||function(t){for(var s,arguments$1=arguments,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments$1[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},canvas_mesh_assign.apply(this,arguments)};var canvas_mesh_Resource=function(){function Resource(width,height){void 0===width&&(width=0),void 0===height&&(height=0),this._width=width,this._height=height,this.destroyed=!1,this.internal=!1,this.onResize=new canvas_mesh_Runner("setRealSize"),this.onUpdate=new canvas_mesh_Runner("update"),this.onError=new canvas_mesh_Runner("onError")}return Resource.prototype.bind=function(baseTexture){this.onResize.add(baseTexture),this.onUpdate.add(baseTexture),this.onError.add(baseTexture),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},Resource.prototype.unbind=function(baseTexture){this.onResize.remove(baseTexture),this.onUpdate.remove(baseTexture),this.onError.remove(baseTexture)},Resource.prototype.resize=function(width,height){width===this._width&&height===this._height||(this._width=width,this._height=height,this.onResize.emit(width,height))},Object.defineProperty(Resource.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),Resource.prototype.update=function(){this.destroyed||this.onUpdate.emit()},Resource.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(Resource.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(Resource.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Resource.prototype.style=function(_renderer,_baseTexture,_glTexture){return!1},Resource.prototype.dispose=function(){},Resource.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Resource.test=function(_source,_extension){return!1},Resource}(),canvas_mesh_BufferResource=function(_super){function BufferResource(source,options){var _this=this,_a=options||{},width=_a.width,height=_a.height;if(!width||!height)throw new Error("BufferResource width or height invalid");return(_this=_super.call(this,width,height)||this).data=source,_this}return canvas_mesh_extends(BufferResource,_super),BufferResource.prototype.upload=function(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===constants_ALPHA_MODES.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data)),!0},BufferResource.prototype.dispose=function(){this.data=null},BufferResource.test=function(source){return source instanceof Float32Array||source instanceof Uint8Array||source instanceof Uint32Array},BufferResource}(canvas_mesh_Resource),canvas_mesh_defaultBufferOptions={scaleMode:constants_SCALE_MODES.NEAREST,format:constants_FORMATS.RGBA,alphaMode:constants_ALPHA_MODES.NPM},canvas_mesh_BaseTexture=function(_super){function BaseTexture(resource,options){void 0===resource&&(resource=null),void 0===options&&(options=null);var _this=_super.call(this)||this,alphaMode=(options=options||{}).alphaMode,mipmap=options.mipmap,anisotropicLevel=options.anisotropicLevel,scaleMode=options.scaleMode,width=options.width,height=options.height,wrapMode=options.wrapMode,format=options.format,type=options.type,target=options.target,resolution=options.resolution,resourceOptions=options.resourceOptions;return!resource||resource instanceof canvas_mesh_Resource||((resource=canvas_mesh_autoDetectResource(resource,resourceOptions)).internal=!0),_this.resolution=resolution||settings.RESOLUTION,_this.width=Math.round((width||0)*_this.resolution)/_this.resolution,_this.height=Math.round((height||0)*_this.resolution)/_this.resolution,_this._mipmap=void 0!==mipmap?mipmap:settings.MIPMAP_TEXTURES,_this.anisotropicLevel=void 0!==anisotropicLevel?anisotropicLevel:settings.ANISOTROPIC_LEVEL,_this._wrapMode=wrapMode||settings.WRAP_MODE,_this._scaleMode=void 0!==scaleMode?scaleMode:settings.SCALE_MODE,_this.format=format||constants_FORMATS.RGBA,_this.type=type||constants_TYPES.UNSIGNED_BYTE,_this.target=target||constants_TARGETS.TEXTURE_2D,_this.alphaMode=void 0!==alphaMode?alphaMode:constants_ALPHA_MODES.UNPACK,_this.uid=canvas_mesh_uid(),_this.touched=0,_this.isPowerOfTwo=!1,_this._refreshPOT(),_this._glTextures={},_this.dirtyId=0,_this.dirtyStyleId=0,_this.cacheId=null,_this.valid=width>0&&height>0,_this.textureCacheIds=[],_this.destroyed=!1,_this.resource=null,_this._batchEnabled=0,_this._batchLocation=0,_this.parentTextureArray=null,_this.setResource(resource),_this}return canvas_mesh_extends(BaseTexture,_super),Object.defineProperty(BaseTexture.prototype,"realWidth",{get:function(){return Math.round(this.width*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"mipmap",{get:function(){return this._mipmap},set:function(value){this._mipmap!==value&&(this._mipmap=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(value){this._scaleMode!==value&&(this._scaleMode=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),Object.defineProperty(BaseTexture.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(value){this._wrapMode!==value&&(this._wrapMode=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0}),BaseTexture.prototype.setStyle=function(scaleMode,mipmap){var dirty;return void 0!==scaleMode&&scaleMode!==this.scaleMode&&(this.scaleMode=scaleMode,dirty=!0),void 0!==mipmap&&mipmap!==this.mipmap&&(this.mipmap=mipmap,dirty=!0),dirty&&this.dirtyStyleId++,this},BaseTexture.prototype.setSize=function(desiredWidth,desiredHeight,resolution){return resolution=resolution||this.resolution,this.setRealSize(desiredWidth*resolution,desiredHeight*resolution,resolution)},BaseTexture.prototype.setRealSize=function(realWidth,realHeight,resolution){return this.resolution=resolution||this.resolution,this.width=Math.round(realWidth)/this.resolution,this.height=Math.round(realHeight)/this.resolution,this._refreshPOT(),this.update(),this},BaseTexture.prototype._refreshPOT=function(){this.isPowerOfTwo=canvas_mesh_isPow2(this.realWidth)&&canvas_mesh_isPow2(this.realHeight)},BaseTexture.prototype.setResolution=function(resolution){var oldResolution=this.resolution;return oldResolution===resolution||(this.resolution=resolution,this.valid&&(this.width=Math.round(this.width*oldResolution)/resolution,this.height=Math.round(this.height*oldResolution)/resolution,this.emit("update",this)),this._refreshPOT()),this},BaseTexture.prototype.setResource=function(resource){if(this.resource===resource)return this;if(this.resource)throw new Error("Resource can be set only once");return resource.bind(this),this.resource=resource,this},BaseTexture.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},BaseTexture.prototype.onError=function(event){this.emit("error",this,event)},BaseTexture.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete canvas_mesh_BaseTextureCache[this.cacheId],delete canvas_mesh_TextureCache[this.cacheId],this.cacheId=null),this.dispose(),BaseTexture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},BaseTexture.prototype.dispose=function(){this.emit("dispose",this)},BaseTexture.prototype.castToBaseTexture=function(){return this},BaseTexture.from=function(source,options,strict){void 0===strict&&(strict=settings.STRICT_TEXTURE_CACHE);var isFrame="string"==typeof source,cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){var prefix=options&&options.pixiIdPrefix||"pixiid";source._pixiId=prefix+"_"+canvas_mesh_uid()}cacheId=source._pixiId}var baseTexture=canvas_mesh_BaseTextureCache[cacheId];if(isFrame&&strict&&!baseTexture)throw new Error('The cacheId "'+cacheId+'" does not exist in BaseTextureCache.');return baseTexture||((baseTexture=new BaseTexture(source,options)).cacheId=cacheId,BaseTexture.addToCache(baseTexture,cacheId)),baseTexture},BaseTexture.fromBuffer=function(buffer,width,height,options){buffer=buffer||new Float32Array(width*height*4);var resource=new canvas_mesh_BufferResource(buffer,{width,height}),type=buffer instanceof Float32Array?constants_TYPES.FLOAT:constants_TYPES.UNSIGNED_BYTE;return new BaseTexture(resource,Object.assign(canvas_mesh_defaultBufferOptions,options||{width,height,type}))},BaseTexture.addToCache=function(baseTexture,id){id&&(-1===baseTexture.textureCacheIds.indexOf(id)&&baseTexture.textureCacheIds.push(id),canvas_mesh_BaseTextureCache[id]&&console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry"),canvas_mesh_BaseTextureCache[id]=baseTexture)},BaseTexture.removeFromCache=function(baseTexture){if("string"==typeof baseTexture){var baseTextureFromCache=canvas_mesh_BaseTextureCache[baseTexture];if(baseTextureFromCache){var index=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);return index>-1&&baseTextureFromCache.textureCacheIds.splice(index,1),delete canvas_mesh_BaseTextureCache[baseTexture],baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(var i=0;i<baseTexture.textureCacheIds.length;++i)delete canvas_mesh_BaseTextureCache[baseTexture.textureCacheIds[i]];return baseTexture.textureCacheIds.length=0,baseTexture}return null},BaseTexture._globalBatch=0,BaseTexture}(canvas_mesh_eventemitter3),canvas_mesh_AbstractMultiResource=function(_super){function AbstractMultiResource(length,options){var _this=this,_a=options||{},width=_a.width,height=_a.height;(_this=_super.call(this,width,height)||this).items=[],_this.itemDirtyIds=[];for(var i=0;i<length;i++){var partTexture=new canvas_mesh_BaseTexture;_this.items.push(partTexture),_this.itemDirtyIds.push(-2)}return _this.length=length,_this._load=null,_this.baseTexture=null,_this}return canvas_mesh_extends(AbstractMultiResource,_super),AbstractMultiResource.prototype.initFromArray=function(resources,options){for(var i=0;i<this.length;i++)resources[i]&&(resources[i].castToBaseTexture?this.addBaseTextureAt(resources[i].castToBaseTexture(),i):resources[i]instanceof canvas_mesh_Resource?this.addResourceAt(resources[i],i):this.addResourceAt(canvas_mesh_autoDetectResource(resources[i],options),i))},AbstractMultiResource.prototype.dispose=function(){for(var i=0,len=this.length;i<len;i++)this.items[i].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},AbstractMultiResource.prototype.addResourceAt=function(resource,index){if(!this.items[index])throw new Error("Index "+index+" is out of bounds");return resource.valid&&!this.valid&&this.resize(resource.width,resource.height),this.items[index].setResource(resource),this},AbstractMultiResource.prototype.bind=function(baseTexture){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");_super.prototype.bind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=baseTexture,this.items[i].on("update",baseTexture.update,baseTexture)},AbstractMultiResource.prototype.unbind=function(baseTexture){_super.prototype.unbind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",baseTexture.update,baseTexture)},AbstractMultiResource.prototype.load=function(){var _this=this;if(this._load)return this._load;var promises=this.items.map((function(item){return item.resource})).filter((function(item){return item})).map((function(item){return item.load()}));return this._load=Promise.all(promises).then((function(){var _a=_this.items[0],realWidth=_a.realWidth,realHeight=_a.realHeight;return _this.resize(realWidth,realHeight),Promise.resolve(_this)})),this._load},AbstractMultiResource}(canvas_mesh_Resource),canvas_mesh_ArrayResource=function(_super){function ArrayResource(source,options){var urls,length,_this=this,_a=options||{},width=_a.width,height=_a.height;return Array.isArray(source)?(urls=source,length=source.length):length=source,_this=_super.call(this,length,{width,height})||this,urls&&_this.initFromArray(urls,options),_this}return canvas_mesh_extends(ArrayResource,_super),ArrayResource.prototype.addBaseTextureAt=function(baseTexture,index){if(!baseTexture.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(baseTexture.resource,index),this},ArrayResource.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture),baseTexture.target=constants_TARGETS.TEXTURE_2D_ARRAY},ArrayResource.prototype.upload=function(renderer,texture,glTexture){var length=this.length,itemDirtyIds=this.itemDirtyIds,items=this.items,gl=renderer.gl;glTexture.dirtyId<0&&gl.texImage3D(gl.TEXTURE_2D_ARRAY,0,glTexture.internalFormat,this._width,this._height,length,0,texture.format,glTexture.type,null);for(var i=0;i<length;i++){var item=items[i];itemDirtyIds[i]<item.dirtyId&&(itemDirtyIds[i]=item.dirtyId,item.valid&&gl.texSubImage3D(gl.TEXTURE_2D_ARRAY,0,0,0,i,item.resource.width,item.resource.height,1,texture.format,glTexture.type,item.resource.source))}return!0},ArrayResource}(canvas_mesh_AbstractMultiResource),canvas_mesh_BaseImageResource=function(_super){function BaseImageResource(source){var _this=this,sourceAny=source,width=sourceAny.naturalWidth||sourceAny.videoWidth||sourceAny.width,height=sourceAny.naturalHeight||sourceAny.videoHeight||sourceAny.height;return(_this=_super.call(this,width,height)||this).source=source,_this.noSubImage=!1,_this}return canvas_mesh_extends(BaseImageResource,_super),BaseImageResource.crossOrigin=function(element,url,crossorigin){void 0===crossorigin&&0!==url.indexOf("data:")?element.crossOrigin=function(url$1,loc){if(void 0===loc&&(loc=self.location),0===url$1.indexOf("data:"))return"";loc=loc||self.location,canvas_mesh_tempAnchor||(canvas_mesh_tempAnchor=document.createElement("a")),canvas_mesh_tempAnchor.href=url$1;var parsedUrl=canvas_mesh_url.parse(canvas_mesh_tempAnchor.href),samePort=!parsedUrl.port&&""===loc.port||parsedUrl.port===loc.port;return parsedUrl.hostname===loc.hostname&&samePort&&parsedUrl.protocol===loc.protocol?"":"anonymous"}(url):!1!==crossorigin&&(element.crossOrigin="string"==typeof crossorigin?crossorigin:"anonymous")},BaseImageResource.prototype.upload=function(renderer,baseTexture,glTexture,source){var gl=renderer.gl,width=baseTexture.realWidth,height=baseTexture.realHeight;return source=source||this.source,gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===constants_ALPHA_MODES.UNPACK),this.noSubImage||baseTexture.target!==gl.TEXTURE_2D||glTexture.width!==width||glTexture.height!==height?(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,baseTexture.format,glTexture.type,source)):gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,baseTexture.format,glTexture.type,source),!0},BaseImageResource.prototype.update=function(){if(!this.destroyed){var source=this.source,width=source.naturalWidth||source.videoWidth||source.width,height=source.naturalHeight||source.videoHeight||source.height;this.resize(width,height),_super.prototype.update.call(this)}},BaseImageResource.prototype.dispose=function(){this.source=null},BaseImageResource}(canvas_mesh_Resource),canvas_mesh_CanvasResource=function(_super){function CanvasResource(source){return _super.call(this,source)||this}return canvas_mesh_extends(CanvasResource,_super),CanvasResource.test=function(source){var OffscreenCanvas=self.OffscreenCanvas;return!!(OffscreenCanvas&&source instanceof OffscreenCanvas)||self.HTMLCanvasElement&&source instanceof HTMLCanvasElement},CanvasResource}(canvas_mesh_BaseImageResource),canvas_mesh_CubeResource=function(_super){function CubeResource(source,options){var _this=this,_a=options||{},width=_a.width,height=_a.height,autoLoad=_a.autoLoad,linkBaseTexture=_a.linkBaseTexture;if(source&&source.length!==CubeResource.SIDES)throw new Error("Invalid length. Got "+source.length+", expected 6");_this=_super.call(this,6,{width,height})||this;for(var i=0;i<CubeResource.SIDES;i++)_this.items[i].target=constants_TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+i;return _this.linkBaseTexture=!1!==linkBaseTexture,source&&_this.initFromArray(source,options),!1!==autoLoad&&_this.load(),_this}return canvas_mesh_extends(CubeResource,_super),CubeResource.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture),baseTexture.target=constants_TARGETS.TEXTURE_CUBE_MAP},CubeResource.prototype.addBaseTextureAt=function(baseTexture,index,linkBaseTexture){if(void 0===linkBaseTexture&&(linkBaseTexture=this.linkBaseTexture),!this.items[index])throw new Error("Index "+index+" is out of bounds");if(!this.linkBaseTexture||baseTexture.parentTextureArray||Object.keys(baseTexture._glTextures).length>0){if(!baseTexture.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(baseTexture.resource,index)}else baseTexture.target=constants_TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+index,baseTexture.parentTextureArray=this.baseTexture,this.items[index]=baseTexture;return baseTexture.valid&&!this.valid&&this.resize(baseTexture.realWidth,baseTexture.realHeight),this.items[index]=baseTexture,this},CubeResource.prototype.upload=function(renderer,_baseTexture,glTexture){for(var dirty=this.itemDirtyIds,i=0;i<CubeResource.SIDES;i++){var side=this.items[i];dirty[i]<side.dirtyId&&(side.valid&&side.resource?(side.resource.upload(renderer,side,glTexture),dirty[i]=side.dirtyId):dirty[i]<-1&&(renderer.gl.texImage2D(side.target,0,glTexture.internalFormat,_baseTexture.realWidth,_baseTexture.realHeight,0,_baseTexture.format,glTexture.type,null),dirty[i]=-1))}return!0},CubeResource.test=function(source){return Array.isArray(source)&&source.length===CubeResource.SIDES},CubeResource.SIDES=6,CubeResource}(canvas_mesh_AbstractMultiResource),canvas_mesh_ImageResource=function(_super){function ImageResource(source,options){var _this=this;if(options=options||{},!(source instanceof HTMLImageElement)){var imageElement=new Image;canvas_mesh_BaseImageResource.crossOrigin(imageElement,source,options.crossorigin),imageElement.src=source,source=imageElement}return _this=_super.call(this,source)||this,!source.complete&&_this._width&&_this._height&&(_this._width=0,_this._height=0),_this.url=source.src,_this._process=null,_this.preserveBitmap=!1,_this.createBitmap=(void 0!==options.createBitmap?options.createBitmap:settings.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap,_this.alphaMode="number"==typeof options.alphaMode?options.alphaMode:null,_this.bitmap=null,_this._load=null,!1!==options.autoLoad&&_this.load(),_this}return canvas_mesh_extends(ImageResource,_super),ImageResource.prototype.load=function(createBitmap){var _this=this;return this._load||(void 0!==createBitmap&&(this.createBitmap=createBitmap),this._load=new Promise((function(resolve,reject){var source=_this.source;_this.url=source.src;var completed=function(){_this.destroyed||(source.onload=null,source.onerror=null,_this.resize(source.width,source.height),_this._load=null,_this.createBitmap?resolve(_this.process()):resolve(_this))};source.complete&&source.src?completed():(source.onload=completed,source.onerror=function(event){reject(event),_this.onError.emit(event)})}))),this._load},ImageResource.prototype.process=function(){var _this=this,source=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var createImageBitmap=self.createImageBitmap,cors=!source.crossOrigin||"anonymous"===source.crossOrigin;return this._process=fetch(source.src,{mode:cors?"cors":"no-cors"}).then((function(r){return r.blob()})).then((function(blob){return createImageBitmap(blob,0,0,source.width,source.height,{premultiplyAlpha:_this.alphaMode===constants_ALPHA_MODES.UNPACK?"premultiply":"none"})})).then((function(bitmap){return _this.destroyed?Promise.reject():(_this.bitmap=bitmap,_this.update(),_this._process=null,Promise.resolve(_this))})),this._process},ImageResource.prototype.upload=function(renderer,baseTexture,glTexture){if("number"==typeof this.alphaMode&&(baseTexture.alphaMode=this.alphaMode),!this.createBitmap)return _super.prototype.upload.call(this,renderer,baseTexture,glTexture);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(_super.prototype.upload.call(this,renderer,baseTexture,glTexture,this.bitmap),!this.preserveBitmap){var flag=!0,glTextures=baseTexture._glTextures;for(var key in glTextures){var otherTex=glTextures[key];if(otherTex!==glTexture&&otherTex.dirtyId!==baseTexture.dirtyId){flag=!1;break}}flag&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},ImageResource.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,_super.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},ImageResource.test=function(source){return"string"==typeof source||source instanceof HTMLImageElement},ImageResource}(canvas_mesh_BaseImageResource),canvas_mesh_SVGResource=function(_super){function SVGResource(sourceBase64,options){var _this=this;return options=options||{},(_this=_super.call(this,document.createElement("canvas"))||this)._width=0,_this._height=0,_this.svg=sourceBase64,_this.scale=options.scale||1,_this._overrideWidth=options.width,_this._overrideHeight=options.height,_this._resolve=null,_this._crossorigin=options.crossorigin,_this._load=null,!1!==options.autoLoad&&_this.load(),_this}return canvas_mesh_extends(SVGResource,_super),SVGResource.prototype.load=function(){var _this=this;return this._load||(this._load=new Promise((function(resolve){if(_this._resolve=function(){_this.resize(_this.source.width,_this.source.height),resolve(_this)},/^\<svg/.test(_this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");_this.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(_this.svg)))}_this._loadSvg()}))),this._load},SVGResource.prototype._loadSvg=function(){var _this=this,tempImage=new Image;canvas_mesh_BaseImageResource.crossOrigin(tempImage,this.svg,this._crossorigin),tempImage.src=this.svg,tempImage.onerror=function(event){_this._resolve&&(tempImage.onerror=null,_this.onError.emit(event))},tempImage.onload=function(){if(_this._resolve){var svgWidth=tempImage.width,svgHeight=tempImage.height;if(!svgWidth||!svgHeight)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var width=svgWidth*_this.scale,height=svgHeight*_this.scale;(_this._overrideWidth||_this._overrideHeight)&&(width=_this._overrideWidth||_this._overrideHeight/svgHeight*svgWidth,height=_this._overrideHeight||_this._overrideWidth/svgWidth*svgHeight),width=Math.round(width),height=Math.round(height);var canvas=_this.source;canvas.width=width,canvas.height=height,canvas._pixiId="canvas_"+canvas_mesh_uid(),canvas.getContext("2d").drawImage(tempImage,0,0,svgWidth,svgHeight,0,0,width,height),_this._resolve(),_this._resolve=null}}},SVGResource.getSize=function(svgString){var sizeMatch=SVGResource.SVG_SIZE.exec(svgString),size={};return sizeMatch&&(size[sizeMatch[1]]=Math.round(parseFloat(sizeMatch[3])),size[sizeMatch[5]]=Math.round(parseFloat(sizeMatch[7]))),size},SVGResource.prototype.dispose=function(){_super.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},SVGResource.test=function(source,extension){return"svg"===extension||"string"==typeof source&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(source)||"string"==typeof source&&SVGResource.SVG_XML.test(source)},SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,SVGResource}(canvas_mesh_BaseImageResource),canvas_mesh_VideoResource=function(_super){function VideoResource(source,options){var _this=this;if(options=options||{},!(source instanceof HTMLVideoElement)){var videoElement=document.createElement("video");videoElement.setAttribute("preload","auto"),videoElement.setAttribute("webkit-playsinline",""),videoElement.setAttribute("playsinline",""),"string"==typeof source&&(source=[source]);var firstSrc=source[0].src||source[0];canvas_mesh_BaseImageResource.crossOrigin(videoElement,firstSrc,options.crossorigin);for(var i=0;i<source.length;++i){var sourceElement=document.createElement("source"),_a=source[i],src=_a.src,mime=_a.mime,baseSrc=(src=src||source[i]).split("?").shift().toLowerCase(),ext=baseSrc.substr(baseSrc.lastIndexOf(".")+1);mime=mime||VideoResource.MIME_TYPES[ext]||"video/"+ext,sourceElement.src=src,sourceElement.type=mime,videoElement.appendChild(sourceElement)}source=videoElement}return(_this=_super.call(this,source)||this).noSubImage=!0,_this._autoUpdate=!0,_this._isConnectedToTicker=!1,_this._updateFPS=options.updateFPS||0,_this._msToNextUpdate=0,_this.autoPlay=!1!==options.autoPlay,_this._load=null,_this._resolve=null,_this._onCanPlay=_this._onCanPlay.bind(_this),_this._onError=_this._onError.bind(_this),!1!==options.autoLoad&&_this.load(),_this}return canvas_mesh_extends(VideoResource,_super),VideoResource.prototype.update=function(_deltaTime){if(!this.destroyed){var elapsedMS=canvas_mesh_Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-elapsedMS),(!this._updateFPS||this._msToNextUpdate<=0)&&(_super.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},VideoResource.prototype.load=function(){var _this=this;if(this._load)return this._load;var source=this.source;return(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0),source.addEventListener("play",this._onPlayStart.bind(this)),source.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(source.addEventListener("canplay",this._onCanPlay),source.addEventListener("canplaythrough",this._onCanPlay),source.addEventListener("error",this._onError,!0)),this._load=new Promise((function(resolve){_this.valid?resolve(_this):(_this._resolve=resolve,source.load())})),this._load},VideoResource.prototype._onError=function(event){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(event)},VideoResource.prototype._isSourcePlaying=function(){var source=this.source;return source.currentTime>0&&!1===source.paused&&!1===source.ended&&source.readyState>2},VideoResource.prototype._isSourceReady=function(){var source=this.source;return 3===source.readyState||4===source.readyState},VideoResource.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(canvas_mesh_Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)},VideoResource.prototype._onPlayStop=function(){this._isConnectedToTicker&&(canvas_mesh_Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)},VideoResource.prototype._onCanPlay=function(){var source=this.source;source.removeEventListener("canplay",this._onCanPlay),source.removeEventListener("canplaythrough",this._onCanPlay);var valid=this.valid;this.resize(source.videoWidth,source.videoHeight),!valid&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&source.play()},VideoResource.prototype.dispose=function(){this._isConnectedToTicker&&(canvas_mesh_Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1);var source=this.source;source&&(source.removeEventListener("error",this._onError,!0),source.pause(),source.src="",source.load()),_super.prototype.dispose.call(this)},Object.defineProperty(VideoResource.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isConnectedToTicker?(canvas_mesh_Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(canvas_mesh_Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(VideoResource.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(value){value!==this._updateFPS&&(this._updateFPS=value)},enumerable:!1,configurable:!0}),VideoResource.test=function(source,extension){return self.HTMLVideoElement&&source instanceof HTMLVideoElement||VideoResource.TYPES.indexOf(extension)>-1},VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},VideoResource}(canvas_mesh_BaseImageResource),canvas_mesh_ImageBitmapResource=function(_super){function ImageBitmapResource(source){return _super.call(this,source)||this}return canvas_mesh_extends(ImageBitmapResource,_super),ImageBitmapResource.test=function(source){return!!self.createImageBitmap&&source instanceof ImageBitmap},ImageBitmapResource}(canvas_mesh_BaseImageResource);canvas_mesh_INSTALLED.push(canvas_mesh_ImageResource,canvas_mesh_ImageBitmapResource,canvas_mesh_CanvasResource,canvas_mesh_VideoResource,canvas_mesh_SVGResource,canvas_mesh_BufferResource,canvas_mesh_CubeResource,canvas_mesh_ArrayResource);var canvas_mesh_resources={__proto__:null,Resource:canvas_mesh_Resource,BaseImageResource:canvas_mesh_BaseImageResource,INSTALLED:canvas_mesh_INSTALLED,autoDetectResource:canvas_mesh_autoDetectResource,AbstractMultiResource:canvas_mesh_AbstractMultiResource,ArrayResource:canvas_mesh_ArrayResource,BufferResource:canvas_mesh_BufferResource,CanvasResource:canvas_mesh_CanvasResource,CubeResource:canvas_mesh_CubeResource,ImageResource:canvas_mesh_ImageResource,SVGResource:canvas_mesh_SVGResource,VideoResource:canvas_mesh_VideoResource,ImageBitmapResource:canvas_mesh_ImageBitmapResource},canvas_mesh_DepthResource=function(_super){function DepthResource(){return null!==_super&&_super.apply(this,arguments)||this}return canvas_mesh_extends(DepthResource,_super),DepthResource.prototype.upload=function(renderer,baseTexture,glTexture){var gl=renderer.gl;gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===constants_ALPHA_MODES.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;return glTexture.width===width&&glTexture.height===height?gl.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data):(glTexture.width=width,glTexture.height=height,gl.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data)),!0},DepthResource}(canvas_mesh_BufferResource),canvas_mesh_Framebuffer=function(){function Framebuffer(width,height){this.width=Math.round(width||100),this.height=Math.round(height||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new canvas_mesh_Runner("disposeFramebuffer"),this.multisample=constants_MSAA_QUALITY.NONE}return Object.defineProperty(Framebuffer.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),Framebuffer.prototype.addColorTexture=function(index,texture){return void 0===index&&(index=0),this.colorTextures[index]=texture||new canvas_mesh_BaseTexture(null,{scaleMode:constants_SCALE_MODES.NEAREST,resolution:1,mipmap:constants_MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Framebuffer.prototype.addDepthTexture=function(texture){return this.depthTexture=texture||new canvas_mesh_BaseTexture(new canvas_mesh_DepthResource(null,{width:this.width,height:this.height}),{scaleMode:constants_SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:constants_MIPMAP_MODES.OFF,format:constants_FORMATS.DEPTH_COMPONENT,type:constants_TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Framebuffer.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Framebuffer.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Framebuffer.prototype.resize=function(width,height){if(width=Math.round(width),height=Math.round(height),width!==this.width||height!==this.height){this.width=width,this.height=height,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var texture=this.colorTextures[i],resolution=texture.resolution;texture.setSize(width/resolution,height/resolution)}if(this.depthTexture){resolution=this.depthTexture.resolution;this.depthTexture.setSize(width/resolution,height/resolution)}}},Framebuffer.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Framebuffer.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},Framebuffer}(),canvas_mesh_BaseRenderTexture=function(_super){function BaseRenderTexture(options){var _this=this;if("number"==typeof options){var width=arguments[0],height=arguments[1],scaleMode=arguments[2],resolution=arguments[3];options={width,height,scaleMode,resolution}}return options.width=options.width||100,options.height=options.height||100,options.multisample=void 0!==options.multisample?options.multisample:constants_MSAA_QUALITY.NONE,(_this=_super.call(this,null,options)||this).mipmap=constants_MIPMAP_MODES.OFF,_this.valid=!0,_this.clearColor=[0,0,0,0],_this.framebuffer=new canvas_mesh_Framebuffer(_this.realWidth,_this.realHeight).addColorTexture(0,_this),_this.framebuffer.multisample=options.multisample,_this.maskStack=[],_this.filterStack=[{}],_this}return canvas_mesh_extends(BaseRenderTexture,_super),BaseRenderTexture.prototype.resize=function(desiredWidth,desiredHeight){this.framebuffer.resize(desiredWidth*this.resolution,desiredHeight*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)},BaseRenderTexture.prototype.dispose=function(){this.framebuffer.dispose(),_super.prototype.dispose.call(this)},BaseRenderTexture.prototype.destroy=function(){_super.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},BaseRenderTexture}(canvas_mesh_BaseTexture),canvas_mesh_TextureUvs=function(){function TextureUvs(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return TextureUvs.prototype.set=function(frame,baseFrame,rotate){var tw=baseFrame.width,th=baseFrame.height;if(rotate){var w2=frame.width/2/tw,h2=frame.height/2/th,cX=frame.x/tw+w2,cY=frame.y/th+h2;rotate=canvas_mesh_groupD8.add(rotate,canvas_mesh_groupD8.NW),this.x0=cX+w2*canvas_mesh_groupD8.uX(rotate),this.y0=cY+h2*canvas_mesh_groupD8.uY(rotate),rotate=canvas_mesh_groupD8.add(rotate,2),this.x1=cX+w2*canvas_mesh_groupD8.uX(rotate),this.y1=cY+h2*canvas_mesh_groupD8.uY(rotate),rotate=canvas_mesh_groupD8.add(rotate,2),this.x2=cX+w2*canvas_mesh_groupD8.uX(rotate),this.y2=cY+h2*canvas_mesh_groupD8.uY(rotate),rotate=canvas_mesh_groupD8.add(rotate,2),this.x3=cX+w2*canvas_mesh_groupD8.uX(rotate),this.y3=cY+h2*canvas_mesh_groupD8.uY(rotate)}else this.x0=frame.x/tw,this.y0=frame.y/th,this.x1=(frame.x+frame.width)/tw,this.y1=frame.y/th,this.x2=(frame.x+frame.width)/tw,this.y2=(frame.y+frame.height)/th,this.x3=frame.x/tw,this.y3=(frame.y+frame.height)/th;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},TextureUvs.prototype.toString=function(){return"[@pixi/core:TextureUvs x0="+this.x0+" y0="+this.y0+" x1="+this.x1+" y1="+this.y1+" x2="+this.x2+" y2="+this.y2+" x3="+this.x3+" y3="+this.y3+"]"},TextureUvs}(),canvas_mesh_DEFAULT_UVS=new canvas_mesh_TextureUvs,canvas_mesh_Texture=function(_super){function Texture(baseTexture,frame,orig,trim,rotate,anchor){var _this=_super.call(this)||this;if(_this.noFrame=!1,frame||(_this.noFrame=!0,frame=new canvas_mesh_Rectangle(0,0,1,1)),baseTexture instanceof Texture&&(baseTexture=baseTexture.baseTexture),_this.baseTexture=baseTexture,_this._frame=frame,_this.trim=trim,_this.valid=!1,_this._uvs=canvas_mesh_DEFAULT_UVS,_this.uvMatrix=null,_this.orig=orig||frame,_this._rotate=Number(rotate||0),!0===rotate)_this._rotate=2;else if(_this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return _this.defaultAnchor=anchor?new canvas_mesh_Point(anchor.x,anchor.y):new canvas_mesh_Point(0,0),_this._updateID=0,_this.textureCacheIds=[],baseTexture.valid?_this.noFrame?baseTexture.valid&&_this.onBaseTextureUpdated(baseTexture):_this.frame=frame:baseTexture.once("loaded",_this.onBaseTextureUpdated,_this),_this.noFrame&&baseTexture.on("update",_this.onBaseTextureUpdated,_this),_this}return canvas_mesh_extends(Texture,_super),Texture.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},Texture.prototype.onBaseTextureUpdated=function(baseTexture){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=baseTexture.width,this._frame.height=baseTexture.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},Texture.prototype.destroy=function(destroyBase){if(this.baseTexture){if(destroyBase){var resource=this.baseTexture.resource;resource&&resource.url&&canvas_mesh_TextureCache[resource.url]&&Texture.removeFromCache(resource.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null},Texture.prototype.clone=function(){var clonedFrame=this._frame.clone(),clonedOrig=this._frame===this.orig?clonedFrame:this.orig.clone(),clonedTexture=new Texture(this.baseTexture,!this.noFrame&&clonedFrame,clonedOrig,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(clonedTexture._frame=clonedFrame),clonedTexture},Texture.prototype.updateUvs=function(){this._uvs===canvas_mesh_DEFAULT_UVS&&(this._uvs=new canvas_mesh_TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},Texture.from=function(source,options,strict){void 0===options&&(options={}),void 0===strict&&(strict=settings.STRICT_TEXTURE_CACHE);var isFrame="string"==typeof source,cacheId=null;if(isFrame)cacheId=source;else{if(!source._pixiId){var prefix=options&&options.pixiIdPrefix||"pixiid";source._pixiId=prefix+"_"+canvas_mesh_uid()}cacheId=source._pixiId}var texture=canvas_mesh_TextureCache[cacheId];if(isFrame&&strict&&!texture)throw new Error('The cacheId "'+cacheId+'" does not exist in TextureCache.');return texture||(options.resolution||(options.resolution=canvas_mesh_getResolutionOfUrl(source)),(texture=new Texture(new canvas_mesh_BaseTexture(source,options))).baseTexture.cacheId=cacheId,canvas_mesh_BaseTexture.addToCache(texture.baseTexture,cacheId),Texture.addToCache(texture,cacheId)),texture},Texture.fromURL=function(url,options){var resourceOptions=Object.assign({autoLoad:!1},null==options?void 0:options.resourceOptions),texture=Texture.from(url,Object.assign({resourceOptions},options),!1),resource=texture.baseTexture.resource;return texture.baseTexture.valid?Promise.resolve(texture):resource.load().then((function(){return Promise.resolve(texture)}))},Texture.fromBuffer=function(buffer,width,height,options){return new Texture(canvas_mesh_BaseTexture.fromBuffer(buffer,width,height,options))},Texture.fromLoader=function(source,imageUrl,name,options){var baseTexture=new canvas_mesh_BaseTexture(source,Object.assign({scaleMode:settings.SCALE_MODE,resolution:canvas_mesh_getResolutionOfUrl(imageUrl)},options)),resource=baseTexture.resource;resource instanceof canvas_mesh_ImageResource&&(resource.url=imageUrl);var texture=new Texture(baseTexture);return name||(name=imageUrl),canvas_mesh_BaseTexture.addToCache(texture.baseTexture,name),Texture.addToCache(texture,name),name!==imageUrl&&(canvas_mesh_BaseTexture.addToCache(texture.baseTexture,imageUrl),Texture.addToCache(texture,imageUrl)),texture.baseTexture.valid?Promise.resolve(texture):new Promise((function(resolve){texture.baseTexture.once("loaded",(function(){return resolve(texture)}))}))},Texture.addToCache=function(texture,id){id&&(-1===texture.textureCacheIds.indexOf(id)&&texture.textureCacheIds.push(id),canvas_mesh_TextureCache[id]&&console.warn("Texture added to the cache with an id ["+id+"] that already had an entry"),canvas_mesh_TextureCache[id]=texture)},Texture.removeFromCache=function(texture){if("string"==typeof texture){var textureFromCache=canvas_mesh_TextureCache[texture];if(textureFromCache){var index=textureFromCache.textureCacheIds.indexOf(texture);return index>-1&&textureFromCache.textureCacheIds.splice(index,1),delete canvas_mesh_TextureCache[texture],textureFromCache}}else if(texture&&texture.textureCacheIds){for(var i=0;i<texture.textureCacheIds.length;++i)canvas_mesh_TextureCache[texture.textureCacheIds[i]]===texture&&delete canvas_mesh_TextureCache[texture.textureCacheIds[i]];return texture.textureCacheIds.length=0,texture}return null},Object.defineProperty(Texture.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(Texture.prototype,"frame",{get:function(){return this._frame},set:function(frame){this._frame=frame,this.noFrame=!1;var x=frame.x,y=frame.y,width=frame.width,height=frame.height,xNotFit=x+width>this.baseTexture.width,yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit){var relationship=xNotFit&&yNotFit?"and":"or",errorX="X: "+x+" + "+width+" = "+(x+width)+" > "+this.baseTexture.width,errorY="Y: "+y+" + "+height+" = "+(y+height)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+errorX+" "+relationship+" "+errorY)}this.valid=width&&height&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=frame),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Texture.prototype,"rotate",{get:function(){return this._rotate},set:function(rotate){this._rotate=rotate,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(Texture.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(Texture.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),Texture.prototype.castToBaseTexture=function(){return this.baseTexture},Texture}(canvas_mesh_eventemitter3);function canvas_mesh_removeAllHandlers(tex){tex.destroy=function(){},tex.on=function(){},tex.once=function(){},tex.emit=function(){}}canvas_mesh_Texture.EMPTY=new canvas_mesh_Texture(new canvas_mesh_BaseTexture),canvas_mesh_removeAllHandlers(canvas_mesh_Texture.EMPTY),canvas_mesh_removeAllHandlers(canvas_mesh_Texture.EMPTY.baseTexture),canvas_mesh_Texture.WHITE=function(){var canvas=document.createElement("canvas");canvas.width=16,canvas.height=16;var context=canvas.getContext("2d");return context.fillStyle="white",context.fillRect(0,0,16,16),new canvas_mesh_Texture(new canvas_mesh_BaseTexture(new canvas_mesh_CanvasResource(canvas)))}(),canvas_mesh_removeAllHandlers(canvas_mesh_Texture.WHITE),canvas_mesh_removeAllHandlers(canvas_mesh_Texture.WHITE.baseTexture);var canvas_mesh_RenderTexture=function(_super){function RenderTexture(baseRenderTexture,frame){var _this=_super.call(this,baseRenderTexture,frame)||this;return _this.valid=!0,_this.filterFrame=null,_this.filterPoolKey=null,_this.updateUvs(),_this}return canvas_mesh_extends(RenderTexture,_super),Object.defineProperty(RenderTexture.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(RenderTexture.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(value){this.framebuffer.multisample=value},enumerable:!1,configurable:!0}),RenderTexture.prototype.resize=function(desiredWidth,desiredHeight,resizeBaseTexture){void 0===resizeBaseTexture&&(resizeBaseTexture=!0);var resolution=this.baseTexture.resolution,width=Math.round(desiredWidth*resolution)/resolution,height=Math.round(desiredHeight*resolution)/resolution;this.valid=width>0&&height>0,this._frame.width=this.orig.width=width,this._frame.height=this.orig.height=height,resizeBaseTexture&&this.baseTexture.resize(width,height),this.updateUvs()},RenderTexture.prototype.setResolution=function(resolution){var baseTexture=this.baseTexture;baseTexture.resolution!==resolution&&(baseTexture.setResolution(resolution),this.resize(baseTexture.width,baseTexture.height,!1))},RenderTexture.create=function(options){for(var arguments$1=arguments,rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments$1[_i];return"number"==typeof options&&(canvas_mesh_deprecation("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),options={width:options,height:rest[0],scaleMode:rest[1],resolution:rest[2]}),new RenderTexture(new canvas_mesh_BaseRenderTexture(options))},RenderTexture}(canvas_mesh_Texture),canvas_mesh_RenderTexturePool=function(){function RenderTexturePool(textureOptions){this.texturePool={},this.textureOptions=textureOptions||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return RenderTexturePool.prototype.createTexture=function(realWidth,realHeight,multisample){void 0===multisample&&(multisample=constants_MSAA_QUALITY.NONE);var baseRenderTexture=new canvas_mesh_BaseRenderTexture(Object.assign({width:realWidth,height:realHeight,resolution:1,multisample},this.textureOptions));return new canvas_mesh_RenderTexture(baseRenderTexture)},RenderTexturePool.prototype.getOptimalTexture=function(minWidth,minHeight,resolution,multisample){var key;void 0===resolution&&(resolution=1),void 0===multisample&&(multisample=constants_MSAA_QUALITY.NONE),minWidth=Math.ceil(minWidth*resolution),minHeight=Math.ceil(minHeight*resolution),this.enableFullScreen&&minWidth===this._pixelsWidth&&minHeight===this._pixelsHeight?key=multisample>1?-multisample:-1:(key=((65535&(minWidth=canvas_mesh_nextPow2(minWidth)))<<16|65535&(minHeight=canvas_mesh_nextPow2(minHeight)))>>>0,multisample>1&&(key+=4294967296*multisample)),this.texturePool[key]||(this.texturePool[key]=[]);var renderTexture=this.texturePool[key].pop();return renderTexture||(renderTexture=this.createTexture(minWidth,minHeight,multisample)),renderTexture.filterPoolKey=key,renderTexture.setResolution(resolution),renderTexture},RenderTexturePool.prototype.getFilterTexture=function(input,resolution,multisample){var filterTexture=this.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||constants_MSAA_QUALITY.NONE);return filterTexture.filterFrame=input.filterFrame,filterTexture},RenderTexturePool.prototype.returnTexture=function(renderTexture){var key=renderTexture.filterPoolKey;renderTexture.filterFrame=null,this.texturePool[key].push(renderTexture)},RenderTexturePool.prototype.returnFilterTexture=function(renderTexture){this.returnTexture(renderTexture)},RenderTexturePool.prototype.clear=function(destroyTextures){if(destroyTextures=!1!==destroyTextures)for(var i in this.texturePool){var textures=this.texturePool[i];if(textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0)}this.texturePool={}},RenderTexturePool.prototype.setScreenSize=function(size){if(size.width!==this._pixelsWidth||size.height!==this._pixelsHeight){for(var i in this.enableFullScreen=size.width>0&&size.height>0,this.texturePool)if(Number(i)<0){var textures=this.texturePool[i];if(textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=size.width,this._pixelsHeight=size.height}},RenderTexturePool.SCREEN_KEY=-1,RenderTexturePool}(),canvas_mesh_Attribute=function(){function Attribute(buffer,size,normalized,type,stride,start,instance){void 0===size&&(size=0),void 0===normalized&&(normalized=!1),void 0===type&&(type=constants_TYPES.FLOAT),this.buffer=buffer,this.size=size,this.normalized=normalized,this.type=type,this.stride=stride,this.start=start,this.instance=instance}return Attribute.prototype.destroy=function(){this.buffer=null},Attribute.from=function(buffer,size,normalized,type,stride){return new Attribute(buffer,size,normalized,type,stride)},Attribute}(),canvas_mesh_UID=0,canvas_mesh_Buffer=function(){function Buffer(data,_static,index){void 0===_static&&(_static=!0),void 0===index&&(index=!1),this.data=data||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=index,this.static=_static,this.id=canvas_mesh_UID++,this.disposeRunner=new canvas_mesh_Runner("disposeBuffer")}return Buffer.prototype.update=function(data){data instanceof Array&&(data=new Float32Array(data)),this.data=data||this.data,this._updateID++},Buffer.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Buffer.prototype.destroy=function(){this.dispose(),this.data=null},Object.defineProperty(Buffer.prototype,"index",{get:function(){return this.type===constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER},set:function(value){this.type=value?constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:constants_BUFFER_TYPE.ARRAY_BUFFER},enumerable:!1,configurable:!0}),Buffer.from=function(data){return data instanceof Array&&(data=new Float32Array(data)),new Buffer(data)},Buffer}(),canvas_mesh_map={Float32Array,Uint32Array,Int32Array,Uint8Array};var canvas_mesh_byteSizeMap={5126:4,5123:2,5121:1},canvas_mesh_UID$1=0,canvas_mesh_map$1={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},canvas_mesh_Geometry=function(){function Geometry(buffers,attributes){void 0===buffers&&(buffers=[]),void 0===attributes&&(attributes={}),this.buffers=buffers,this.indexBuffer=null,this.attributes=attributes,this.glVertexArrayObjects={},this.id=canvas_mesh_UID$1++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new canvas_mesh_Runner("disposeGeometry"),this.refCount=0}return Geometry.prototype.addAttribute=function(id,buffer,size,normalized,type,stride,start,instance){if(void 0===size&&(size=0),void 0===normalized&&(normalized=!1),void 0===instance&&(instance=!1),!buffer)throw new Error("You must pass a buffer when creating an attribute");buffer instanceof canvas_mesh_Buffer||(buffer instanceof Array&&(buffer=new Float32Array(buffer)),buffer=new canvas_mesh_Buffer(buffer));var ids=id.split("|");if(ids.length>1){for(var i=0;i<ids.length;i++)this.addAttribute(ids[i],buffer,size,normalized,type);return this}var bufferIndex=this.buffers.indexOf(buffer);return-1===bufferIndex&&(this.buffers.push(buffer),bufferIndex=this.buffers.length-1),this.attributes[id]=new canvas_mesh_Attribute(bufferIndex,size,normalized,type,stride,start,instance),this.instanced=this.instanced||instance,this},Geometry.prototype.getAttribute=function(id){return this.attributes[id]},Geometry.prototype.getBuffer=function(id){return this.buffers[this.getAttribute(id).buffer]},Geometry.prototype.addIndex=function(buffer){return buffer instanceof canvas_mesh_Buffer||(buffer instanceof Array&&(buffer=new Uint16Array(buffer)),buffer=new canvas_mesh_Buffer(buffer)),buffer.type=constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=buffer,-1===this.buffers.indexOf(buffer)&&this.buffers.push(buffer),this},Geometry.prototype.getIndex=function(){return this.indexBuffer},Geometry.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var i,arrays=[],sizes=[],interleavedBuffer=new canvas_mesh_Buffer;for(i in this.attributes){var attribute=this.attributes[i],buffer=this.buffers[attribute.buffer];arrays.push(buffer.data),sizes.push(attribute.size*canvas_mesh_byteSizeMap[attribute.type]/4),attribute.buffer=0}for(interleavedBuffer.data=function(arrays,sizes){for(var outSize=0,stride=0,views={},i=0;i<arrays.length;i++)stride+=sizes[i],outSize+=arrays[i].length;var buffer=new ArrayBuffer(4*outSize),out=null,littleOffset=0;for(i=0;i<arrays.length;i++){var size=sizes[i],array=arrays[i],type=canvas_mesh_getBufferType(array);views[type]||(views[type]=new canvas_mesh_map[type](buffer)),out=views[type];for(var j=0;j<array.length;j++)out[(j/size|0)*stride+littleOffset+j%size]=array[j];littleOffset+=size}return new Float32Array(buffer)}(arrays,sizes),i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();return this.buffers=[interleavedBuffer],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},Geometry.prototype.getSize=function(){for(var i in this.attributes){var attribute=this.attributes[i];return this.buffers[attribute.buffer].data.length/(attribute.stride/4||attribute.size)}return 0},Geometry.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Geometry.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},Geometry.prototype.clone=function(){for(var geometry=new Geometry,i=0;i<this.buffers.length;i++)geometry.buffers[i]=new canvas_mesh_Buffer(this.buffers[i].data.slice(0));for(var i in this.attributes){var attrib=this.attributes[i];geometry.attributes[i]=new canvas_mesh_Attribute(attrib.buffer,attrib.size,attrib.normalized,attrib.type,attrib.stride,attrib.start,attrib.instance)}return this.indexBuffer&&(geometry.indexBuffer=geometry.buffers[this.buffers.indexOf(this.indexBuffer)],geometry.indexBuffer.type=constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),geometry},Geometry.merge=function(geometries){for(var geometry,geometryOut=new Geometry,arrays=[],sizes=[],offsets=[],i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++)sizes[j]=sizes[j]||0,sizes[j]+=geometry.buffers[j].data.length,offsets[j]=0}for(i=0;i<geometry.buffers.length;i++)arrays[i]=new(canvas_mesh_map$1[canvas_mesh_getBufferType(geometry.buffers[i].data)])(sizes[i]),geometryOut.buffers[i]=new canvas_mesh_Buffer(arrays[i]);for(i=0;i<geometries.length;i++){geometry=geometries[i];for(j=0;j<geometry.buffers.length;j++)arrays[j].set(geometry.buffers[j].data,offsets[j]),offsets[j]+=geometry.buffers[j].data.length}if(geometryOut.attributes=geometry.attributes,geometry.indexBuffer){geometryOut.indexBuffer=geometryOut.buffers[geometry.buffers.indexOf(geometry.indexBuffer)],geometryOut.indexBuffer.type=constants_BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;var offset=0,stride=0,offset2=0,bufferIndexToCount=0;for(i=0;i<geometry.buffers.length;i++)if(geometry.buffers[i]!==geometry.indexBuffer){bufferIndexToCount=i;break}for(var i in geometry.attributes){var attribute=geometry.attributes[i];(0|attribute.buffer)===bufferIndexToCount&&(stride+=attribute.size*canvas_mesh_byteSizeMap[attribute.type]/4)}for(i=0;i<geometries.length;i++){var indexBufferData=geometries[i].indexBuffer.data;for(j=0;j<indexBufferData.length;j++)geometryOut.indexBuffer.data[j+offset2]+=offset;offset+=geometries[i].buffers[bufferIndexToCount].data.length/stride,offset2+=indexBufferData.length}}return geometryOut},Geometry}(),canvas_mesh_Quad=function(_super){function Quad(){var _this=_super.call(this)||this;return _this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),_this}return canvas_mesh_extends(Quad,_super),Quad}(canvas_mesh_Geometry),canvas_mesh_QuadUv=function(_super){function QuadUv(){var _this=_super.call(this)||this;return _this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),_this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),_this.vertexBuffer=new canvas_mesh_Buffer(_this.vertices),_this.uvBuffer=new canvas_mesh_Buffer(_this.uvs),_this.addAttribute("aVertexPosition",_this.vertexBuffer).addAttribute("aTextureCoord",_this.uvBuffer).addIndex([0,1,2,0,2,3]),_this}return canvas_mesh_extends(QuadUv,_super),QuadUv.prototype.map=function(targetTextureFrame,destinationFrame){var x=0,y=0;return this.uvs[0]=x,this.uvs[1]=y,this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[3]=y,this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width,this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height,this.uvs[6]=x,this.uvs[7]=y+destinationFrame.height/targetTextureFrame.height,x=destinationFrame.x,y=destinationFrame.y,this.vertices[0]=x,this.vertices[1]=y,this.vertices[2]=x+destinationFrame.width,this.vertices[3]=y,this.vertices[4]=x+destinationFrame.width,this.vertices[5]=y+destinationFrame.height,this.vertices[6]=x,this.vertices[7]=y+destinationFrame.height,this.invalidate(),this},QuadUv.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},QuadUv}(canvas_mesh_Geometry),canvas_mesh_UID$2=0,canvas_mesh_UniformGroup=function(){function UniformGroup(uniforms,isStatic,isUbo){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=canvas_mesh_UID$2++,this.static=!!isStatic,this.ubo=!!isUbo,uniforms instanceof canvas_mesh_Buffer?(this.buffer=uniforms,this.buffer.type=constants_BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=uniforms,this.ubo&&(this.buffer=new canvas_mesh_Buffer(new Float32Array(1)),this.buffer.type=constants_BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}return UniformGroup.prototype.update=function(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()},UniformGroup.prototype.add=function(name,uniforms,_static){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[name]=new UniformGroup(uniforms,_static)},UniformGroup.from=function(uniforms,_static,_ubo){return new UniformGroup(uniforms,_static,_ubo)},UniformGroup.uboFrom=function(uniforms,_static){return new UniformGroup(uniforms,null==_static||_static,!0)},UniformGroup}(),canvas_mesh_FilterState=function(){function FilterState(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=constants_MSAA_QUALITY.NONE,this.sourceFrame=new canvas_mesh_Rectangle,this.destinationFrame=new canvas_mesh_Rectangle,this.bindingSourceFrame=new canvas_mesh_Rectangle,this.bindingDestinationFrame=new canvas_mesh_Rectangle,this.filters=[],this.transform=null}return FilterState.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},FilterState}(),canvas_mesh_tempPoints=[new canvas_mesh_Point,new canvas_mesh_Point,new canvas_mesh_Point,new canvas_mesh_Point],canvas_mesh_tempMatrix=new canvas_mesh_Matrix,canvas_mesh_FilterSystem=function(){function FilterSystem(renderer){this.renderer=renderer,this.defaultFilterStack=[{}],this.texturePool=new canvas_mesh_RenderTexturePool,this.texturePool.setScreenSize(renderer.view),this.statePool=[],this.quad=new canvas_mesh_Quad,this.quadUv=new canvas_mesh_QuadUv,this.tempRect=new canvas_mesh_Rectangle,this.activeState={},this.globalUniforms=new canvas_mesh_UniformGroup({outputFrame:new canvas_mesh_Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}return FilterSystem.prototype.push=function(target,filters){for(var renderer=this.renderer,filterStack=this.defaultFilterStack,state=this.statePool.pop()||new canvas_mesh_FilterState,renderTextureSystem=this.renderer.renderTexture,resolution=filters[0].resolution,multisample=filters[0].multisample,padding=filters[0].padding,autoFit=filters[0].autoFit,legacy=filters[0].legacy,i=1;i<filters.length;i++){var filter=filters[i];resolution=Math.min(resolution,filter.resolution),multisample=Math.min(multisample,filter.multisample),padding=this.useMaxPadding?Math.max(padding,filter.padding):padding+filter.padding,autoFit=autoFit&&filter.autoFit,legacy=legacy||filter.legacy}if(1===filterStack.length&&(this.defaultFilterStack[0].renderTexture=renderTextureSystem.current),filterStack.push(state),state.resolution=resolution,state.multisample=multisample,state.legacy=legacy,state.target=target,state.sourceFrame.copyFrom(target.filterArea||target.getBounds(!0)),state.sourceFrame.pad(padding),autoFit){var sourceFrameProjected=this.tempRect.copyFrom(renderTextureSystem.sourceFrame);renderer.projection.transform&&this.transformAABB(canvas_mesh_tempMatrix.copyFrom(renderer.projection.transform).invert(),sourceFrameProjected),state.sourceFrame.fit(sourceFrameProjected)}this.roundFrame(state.sourceFrame,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform),state.renderTexture=this.getOptimalFilterTexture(state.sourceFrame.width,state.sourceFrame.height,resolution,multisample),state.filters=filters,state.destinationFrame.width=state.renderTexture.width,state.destinationFrame.height=state.renderTexture.height;var destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=state.sourceFrame.width,destinationFrame.height=state.sourceFrame.height,state.renderTexture.filterFrame=state.sourceFrame,state.bindingSourceFrame.copyFrom(renderTextureSystem.sourceFrame),state.bindingDestinationFrame.copyFrom(renderTextureSystem.destinationFrame),state.transform=renderer.projection.transform,renderer.projection.transform=null,renderTextureSystem.bind(state.renderTexture,state.sourceFrame,destinationFrame),renderer.framebuffer.clear(0,0,0,0)},FilterSystem.prototype.pop=function(){var filterStack=this.defaultFilterStack,state=filterStack.pop(),filters=state.filters;this.activeState=state;var globalUniforms=this.globalUniforms.uniforms;globalUniforms.outputFrame=state.sourceFrame,globalUniforms.resolution=state.resolution;var inputSize=globalUniforms.inputSize,inputPixel=globalUniforms.inputPixel,inputClamp=globalUniforms.inputClamp;if(inputSize[0]=state.destinationFrame.width,inputSize[1]=state.destinationFrame.height,inputSize[2]=1/inputSize[0],inputSize[3]=1/inputSize[1],inputPixel[0]=Math.round(inputSize[0]*state.resolution),inputPixel[1]=Math.round(inputSize[1]*state.resolution),inputPixel[2]=1/inputPixel[0],inputPixel[3]=1/inputPixel[1],inputClamp[0]=.5*inputPixel[2],inputClamp[1]=.5*inputPixel[3],inputClamp[2]=state.sourceFrame.width*inputSize[2]-.5*inputPixel[2],inputClamp[3]=state.sourceFrame.height*inputSize[3]-.5*inputPixel[3],state.legacy){var filterArea=globalUniforms.filterArea;filterArea[0]=state.destinationFrame.width,filterArea[1]=state.destinationFrame.height,filterArea[2]=state.sourceFrame.x,filterArea[3]=state.sourceFrame.y,globalUniforms.filterClamp=globalUniforms.inputClamp}this.globalUniforms.update();var lastState=filterStack[filterStack.length-1];if(this.renderer.framebuffer.blit(),1===filters.length)filters[0].apply(this,state.renderTexture,lastState.renderTexture,constants_CLEAR_MODES.BLEND,state),this.returnFilterTexture(state.renderTexture);else{var flip=state.renderTexture,flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution);flop.filterFrame=flip.filterFrame;var i=0;for(i=0;i<filters.length-1;++i){1===i&&state.multisample>1&&((flop=this.getOptimalFilterTexture(flip.width,flip.height,state.resolution)).filterFrame=flip.filterFrame),filters[i].apply(this,flip,flop,constants_CLEAR_MODES.CLEAR,state);var t=flip;flip=flop,flop=t}filters[i].apply(this,flip,lastState.renderTexture,constants_CLEAR_MODES.BLEND,state),i>1&&state.multisample>1&&this.returnFilterTexture(state.renderTexture),this.returnFilterTexture(flip),this.returnFilterTexture(flop)}state.clear(),this.statePool.push(state)},FilterSystem.prototype.bindAndClear=function(filterTexture,clearMode){void 0===clearMode&&(clearMode=constants_CLEAR_MODES.CLEAR);var _a=this.renderer,renderTextureSystem=_a.renderTexture,stateSystem=_a.state;if(filterTexture===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,filterTexture&&filterTexture.filterFrame){var destinationFrame=this.tempRect;destinationFrame.x=0,destinationFrame.y=0,destinationFrame.width=filterTexture.filterFrame.width,destinationFrame.height=filterTexture.filterFrame.height,renderTextureSystem.bind(filterTexture,filterTexture.filterFrame,destinationFrame)}else filterTexture!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?renderTextureSystem.bind(filterTexture):this.renderer.renderTexture.bind(filterTexture,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);var autoClear=1&stateSystem.stateId||this.forceClear;(clearMode===constants_CLEAR_MODES.CLEAR||clearMode===constants_CLEAR_MODES.BLIT&&autoClear)&&this.renderer.framebuffer.clear(0,0,0,0)},FilterSystem.prototype.applyFilter=function(filter,input,output,clearMode){var renderer=this.renderer;renderer.state.set(filter.state),this.bindAndClear(output,clearMode),filter.uniforms.uSampler=input,filter.uniforms.filterGlobals=this.globalUniforms,renderer.shader.bind(filter),filter.legacy=!!filter.program.attributeData.aTextureCoord,filter.legacy?(this.quadUv.map(input._frame,input.filterFrame),renderer.geometry.bind(this.quadUv),renderer.geometry.draw(constants_DRAW_MODES.TRIANGLES)):(renderer.geometry.bind(this.quad),renderer.geometry.draw(constants_DRAW_MODES.TRIANGLE_STRIP))},FilterSystem.prototype.calculateSpriteMatrix=function(outputMatrix,sprite){var _a=this.activeState,sourceFrame=_a.sourceFrame,destinationFrame=_a.destinationFrame,orig=sprite._texture.orig,mappedMatrix=outputMatrix.set(destinationFrame.width,0,0,destinationFrame.height,sourceFrame.x,sourceFrame.y),worldTransform=sprite.worldTransform.copyTo(canvas_mesh_Matrix.TEMP_MATRIX);return worldTransform.invert(),mappedMatrix.prepend(worldTransform),mappedMatrix.scale(1/orig.width,1/orig.height),mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y),mappedMatrix},FilterSystem.prototype.destroy=function(){this.renderer=null,this.texturePool.clear(!1)},FilterSystem.prototype.getOptimalFilterTexture=function(minWidth,minHeight,resolution,multisample){return void 0===resolution&&(resolution=1),void 0===multisample&&(multisample=constants_MSAA_QUALITY.NONE),this.texturePool.getOptimalTexture(minWidth,minHeight,resolution,multisample)},FilterSystem.prototype.getFilterTexture=function(input,resolution,multisample){if("number"==typeof input){var swap=input;input=resolution,resolution=swap}input=input||this.activeState.renderTexture;var filterTexture=this.texturePool.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||constants_MSAA_QUALITY.NONE);return filterTexture.filterFrame=input.filterFrame,filterTexture},FilterSystem.prototype.returnFilterTexture=function(renderTexture){this.texturePool.returnTexture(renderTexture)},FilterSystem.prototype.emptyPool=function(){this.texturePool.clear(!0)},FilterSystem.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},FilterSystem.prototype.transformAABB=function(matrix,rect){var lt=canvas_mesh_tempPoints[0],lb=canvas_mesh_tempPoints[1],rt=canvas_mesh_tempPoints[2],rb=canvas_mesh_tempPoints[3];lt.set(rect.left,rect.top),lb.set(rect.left,rect.bottom),rt.set(rect.right,rect.top),rb.set(rect.right,rect.bottom),matrix.apply(lt,lt),matrix.apply(lb,lb),matrix.apply(rt,rt),matrix.apply(rb,rb);var x0=Math.min(lt.x,lb.x,rt.x,rb.x),y0=Math.min(lt.y,lb.y,rt.y,rb.y),x1=Math.max(lt.x,lb.x,rt.x,rb.x),y1=Math.max(lt.y,lb.y,rt.y,rb.y);rect.x=x0,rect.y=y0,rect.width=x1-x0,rect.height=y1-y0},FilterSystem.prototype.roundFrame=function(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){if(transform){var a=transform.a,b=transform.b,c=transform.c,d=transform.d;if((Math.abs(b)>1e-4||Math.abs(c)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(d)>1e-4))return}(transform=transform?canvas_mesh_tempMatrix.copyFrom(transform):canvas_mesh_tempMatrix.identity()).translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y),this.transformAABB(transform,frame),frame.ceil(resolution),this.transformAABB(transform.invert(),frame)},FilterSystem}(),canvas_mesh_ObjectRenderer=function(){function ObjectRenderer(renderer){this.renderer=renderer}return ObjectRenderer.prototype.flush=function(){},ObjectRenderer.prototype.destroy=function(){this.renderer=null},ObjectRenderer.prototype.start=function(){},ObjectRenderer.prototype.stop=function(){this.flush()},ObjectRenderer.prototype.render=function(_object){},ObjectRenderer}(),canvas_mesh_BatchSystem=function(){function BatchSystem(renderer){this.renderer=renderer,this.emptyRenderer=new canvas_mesh_ObjectRenderer(renderer),this.currentRenderer=this.emptyRenderer}return BatchSystem.prototype.setObjectRenderer=function(objectRenderer){this.currentRenderer!==objectRenderer&&(this.currentRenderer.stop(),this.currentRenderer=objectRenderer,this.currentRenderer.start())},BatchSystem.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},BatchSystem.prototype.copyBoundTextures=function(arr,maxTextures){for(var boundTextures=this.renderer.texture.boundTextures,i=maxTextures-1;i>=0;--i)arr[i]=boundTextures[i]||null,arr[i]&&(arr[i]._batchLocation=i)},BatchSystem.prototype.boundArray=function(texArray,boundTextures,batchId,maxTextures){for(var elements=texArray.elements,ids=texArray.ids,count=texArray.count,j=0,i=0;i<count;i++){var tex=elements[i],loc=tex._batchLocation;if(loc>=0&&loc<maxTextures&&boundTextures[loc]===tex)ids[i]=loc;else for(;j<maxTextures;){var bound=boundTextures[j];if(!bound||bound._batchEnabled!==batchId||bound._batchLocation!==j){ids[i]=j,tex._batchLocation=j,boundTextures[j]=tex;break}j++}}},BatchSystem.prototype.destroy=function(){this.renderer=null},BatchSystem}(),canvas_mesh_CONTEXT_UID_COUNTER=0,canvas_mesh_ContextSystem=function(){function ContextSystem(renderer){this.renderer=renderer,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),renderer.view.addEventListener("webglcontextlost",this.handleContextLost,!1),renderer.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}return Object.defineProperty(ContextSystem.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),ContextSystem.prototype.contextChange=function(gl){this.gl=gl,this.renderer.gl=gl,this.renderer.CONTEXT_UID=canvas_mesh_CONTEXT_UID_COUNTER++,gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")&&gl.getExtension("WEBGL_lose_context").restoreContext()},ContextSystem.prototype.initFromContext=function(gl){this.gl=gl,this.validateContext(gl),this.renderer.gl=gl,this.renderer.CONTEXT_UID=canvas_mesh_CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(gl)},ContextSystem.prototype.initFromOptions=function(options){var gl=this.createContext(this.renderer.view,options);this.initFromContext(gl)},ContextSystem.prototype.createContext=function(canvas,options){var gl;if(settings.PREFER_ENV>=constants_ENV.WEBGL2&&(gl=canvas.getContext("webgl2",options)),gl)this.webGLVersion=2;else if(this.webGLVersion=1,!(gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=gl,this.getExtensions(),this.gl},ContextSystem.prototype.getExtensions=function(){var gl=this.gl,common={anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,common,{drawBuffers:gl.getExtension("WEBGL_draw_buffers"),depthTexture:gl.getExtension("WEBGL_depth_texture"),loseContext:gl.getExtension("WEBGL_lose_context"),vertexArrayObject:gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:gl.getExtension("OES_element_index_uint"),floatTexture:gl.getExtension("OES_texture_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),textureHalfFloat:gl.getExtension("OES_texture_half_float"),textureHalfFloatLinear:gl.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,common,{colorBufferFloat:gl.getExtension("EXT_color_buffer_float")})},ContextSystem.prototype.handleContextLost=function(event){event.preventDefault()},ContextSystem.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},ContextSystem.prototype.destroy=function(){var view=this.renderer.view;this.renderer=null,view.removeEventListener("webglcontextlost",this.handleContextLost),view.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},ContextSystem.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},ContextSystem.prototype.validateContext=function(gl){var attributes=gl.getContextAttributes(),isWebGl2="WebGL2RenderingContext"in self&&gl instanceof self.WebGL2RenderingContext;isWebGl2&&(this.webGLVersion=2),attributes.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var hasuint32=isWebGl2||!!gl.getExtension("OES_element_index_uint");this.supports.uint32Indices=hasuint32,hasuint32||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},ContextSystem}(),canvas_mesh_GLFramebuffer=function(framebuffer){this.framebuffer=framebuffer,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=constants_MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0},canvas_mesh_tempRectangle=new canvas_mesh_Rectangle,canvas_mesh_FramebufferSystem=function(){function FramebufferSystem(renderer){this.renderer=renderer,this.managedFramebuffers=[],this.unknownFramebuffer=new canvas_mesh_Framebuffer(10,10),this.msaaSamples=null}return FramebufferSystem.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new canvas_mesh_Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var nativeDrawBuffersExtension_1=this.renderer.context.extensions.drawBuffers,nativeDepthTextureExtension=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===constants_ENV.WEBGL_LEGACY&&(nativeDrawBuffersExtension_1=null,nativeDepthTextureExtension=null),nativeDrawBuffersExtension_1?gl.drawBuffers=function(activeTextures){return nativeDrawBuffersExtension_1.drawBuffersWEBGL(activeTextures)}:(this.hasMRT=!1,gl.drawBuffers=function(){}),nativeDepthTextureExtension||(this.writeDepthTexture=!1)}else this.msaaSamples=gl.getInternalformatParameter(gl.RENDERBUFFER,gl.RGBA8,gl.SAMPLES)},FramebufferSystem.prototype.bind=function(framebuffer,frame,mipLevel){void 0===mipLevel&&(mipLevel=0);var gl=this.gl;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(framebuffer);this.current!==framebuffer&&(this.current=framebuffer,gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.framebuffer)),fbo.mipLevel!==mipLevel&&(framebuffer.dirtyId++,framebuffer.dirtyFormat++,fbo.mipLevel=mipLevel),fbo.dirtyId!==framebuffer.dirtyId&&(fbo.dirtyId=framebuffer.dirtyId,fbo.dirtyFormat!==framebuffer.dirtyFormat?(fbo.dirtyFormat=framebuffer.dirtyFormat,fbo.dirtySize=framebuffer.dirtySize,this.updateFramebuffer(framebuffer,mipLevel)):fbo.dirtySize!==framebuffer.dirtySize&&(fbo.dirtySize=framebuffer.dirtySize,this.resizeFramebuffer(framebuffer)));for(var i=0;i<framebuffer.colorTextures.length;i++){var tex=framebuffer.colorTextures[i];this.renderer.texture.unbind(tex.parentTextureArray||tex)}if(framebuffer.depthTexture&&this.renderer.texture.unbind(framebuffer.depthTexture),frame){var mipWidth=frame.width>>mipLevel,mipHeight=frame.height>>mipLevel,scale=mipWidth/frame.width;this.setViewport(frame.x*scale,frame.y*scale,mipWidth,mipHeight)}else{mipWidth=framebuffer.width>>mipLevel,mipHeight=framebuffer.height>>mipLevel;this.setViewport(0,0,mipWidth,mipHeight)}}else this.current&&(this.current=null,gl.bindFramebuffer(gl.FRAMEBUFFER,null)),frame?this.setViewport(frame.x,frame.y,frame.width,frame.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},FramebufferSystem.prototype.setViewport=function(x,y,width,height){var v=this.viewport;x=Math.round(x),y=Math.round(y),width=Math.round(width),height=Math.round(height),v.width===width&&v.height===height&&v.x===x&&v.y===y||(v.x=x,v.y=y,v.width=width,v.height=height,this.gl.viewport(x,y,width,height))},Object.defineProperty(FramebufferSystem.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),FramebufferSystem.prototype.clear=function(r,g,b,a,mask){void 0===mask&&(mask=constants_BUFFER_BITS.COLOR|constants_BUFFER_BITS.DEPTH);var gl=this.gl;gl.clearColor(r,g,b,a),gl.clear(mask)},FramebufferSystem.prototype.initFramebuffer=function(framebuffer){var gl=this.gl,fbo=new canvas_mesh_GLFramebuffer(gl.createFramebuffer());return fbo.multisample=this.detectSamples(framebuffer.multisample),framebuffer.glFramebuffers[this.CONTEXT_UID]=fbo,this.managedFramebuffers.push(framebuffer),framebuffer.disposeRunner.add(this),fbo},FramebufferSystem.prototype.resizeFramebuffer=function(framebuffer){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];fbo.msaaBuffer&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.RGBA8,framebuffer.width,framebuffer.height)),fbo.stencil&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,framebuffer.width,framebuffer.height):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height));var colorTextures=framebuffer.colorTextures,count=colorTextures.length;gl.drawBuffers||(count=Math.min(count,1));for(var i=0;i<count;i++){var texture=colorTextures[i],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0)}framebuffer.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(framebuffer.depthTexture,0)},FramebufferSystem.prototype.updateFramebuffer=function(framebuffer,mipLevel){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],colorTextures=framebuffer.colorTextures,count=colorTextures.length;gl.drawBuffers||(count=Math.min(count,1)),fbo.multisample>1&&this.canMultisampleFramebuffer(framebuffer)?(fbo.msaaBuffer=fbo.msaaBuffer||gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.RGBA8,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,fbo.msaaBuffer)):fbo.msaaBuffer&&(gl.deleteRenderbuffer(fbo.msaaBuffer),fbo.msaaBuffer=null);for(var activeTextures=[],i=0;i<count;i++){var texture=colorTextures[i],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0),0===i&&fbo.msaaBuffer||(gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i,texture.target,parentTexture._glTextures[this.CONTEXT_UID].texture,mipLevel),activeTextures.push(gl.COLOR_ATTACHMENT0+i))}if((activeTextures.length>1&&gl.drawBuffers(activeTextures),framebuffer.depthTexture)&&this.writeDepthTexture){var depthTexture=framebuffer.depthTexture;this.renderer.texture.bind(depthTexture,0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,depthTexture._glTextures[this.CONTEXT_UID].texture,mipLevel)}!framebuffer.stencil&&!framebuffer.depth||framebuffer.depthTexture&&this.writeDepthTexture?fbo.stencil&&(gl.deleteRenderbuffer(fbo.stencil),fbo.stencil=null):(fbo.stencil=fbo.stencil||gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,framebuffer.width,framebuffer.height):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,fbo.stencil))},FramebufferSystem.prototype.canMultisampleFramebuffer=function(framebuffer){return 1!==this.renderer.context.webGLVersion&&framebuffer.colorTextures.length<=1&&!framebuffer.depthTexture},FramebufferSystem.prototype.detectSamples=function(samples){var msaaSamples=this.msaaSamples,res=constants_MSAA_QUALITY.NONE;if(samples<=1||null===msaaSamples)return res;for(var i=0;i<msaaSamples.length;i++)if(msaaSamples[i]<=samples){res=msaaSamples[i];break}return 1===res&&(res=constants_MSAA_QUALITY.NONE),res},FramebufferSystem.prototype.blit=function(framebuffer,sourcePixels,destPixels){var current=this.current,renderer=this.renderer,gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;if(2===renderer.context.webGLVersion&&current){var fbo=current.glFramebuffers[CONTEXT_UID];if(fbo){if(!framebuffer){if(!fbo.msaaBuffer)return;fbo.blitFramebuffer||(fbo.blitFramebuffer=new canvas_mesh_Framebuffer(current.width,current.height),fbo.blitFramebuffer.addColorTexture(0,current.colorTextures[0])),(framebuffer=fbo.blitFramebuffer).width=current.width,framebuffer.height=current.height}sourcePixels||((sourcePixels=canvas_mesh_tempRectangle).width=current.width,sourcePixels.height=current.height),destPixels||(destPixels=sourcePixels);var sameSize=sourcePixels.width===destPixels.width&&sourcePixels.height===destPixels.height;this.bind(framebuffer),gl.bindFramebuffer(gl.READ_FRAMEBUFFER,fbo.framebuffer),gl.blitFramebuffer(sourcePixels.x,sourcePixels.y,sourcePixels.width,sourcePixels.height,destPixels.x,destPixels.y,destPixels.width,destPixels.height,gl.COLOR_BUFFER_BIT,sameSize?gl.NEAREST:gl.LINEAR)}}},FramebufferSystem.prototype.disposeFramebuffer=function(framebuffer,contextLost){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],gl=this.gl;if(fbo){delete framebuffer.glFramebuffers[this.CONTEXT_UID];var index=this.managedFramebuffers.indexOf(framebuffer);index>=0&&this.managedFramebuffers.splice(index,1),framebuffer.disposeRunner.remove(this),contextLost||(gl.deleteFramebuffer(fbo.framebuffer),fbo.msaaBuffer&&gl.deleteRenderbuffer(fbo.msaaBuffer),fbo.stencil&&gl.deleteRenderbuffer(fbo.stencil))}},FramebufferSystem.prototype.disposeAll=function(contextLost){var list=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<list.length;i++)this.disposeFramebuffer(list[i],contextLost)},FramebufferSystem.prototype.forceStencil=function(){var framebuffer=this.current;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(fbo&&!fbo.stencil){framebuffer.stencil=!0;var w=framebuffer.width,h=framebuffer.height,gl=this.gl,stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,w,h):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,w,h),fbo.stencil=stencil,gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,stencil)}}},FramebufferSystem.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new canvas_mesh_Rectangle},FramebufferSystem.prototype.destroy=function(){this.renderer=null},FramebufferSystem}(),canvas_mesh_byteSizeMap$1={5126:4,5123:2,5121:1},canvas_mesh_GeometrySystem=function(){function GeometrySystem(renderer){this.renderer=renderer,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}return GeometrySystem.prototype.contextChange=function(){this.disposeAll(!0);var gl=this.gl=this.renderer.gl,context=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==context.webGLVersion){var nativeVaoExtension_1=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===constants_ENV.WEBGL_LEGACY&&(nativeVaoExtension_1=null),nativeVaoExtension_1?(gl.createVertexArray=function(){return nativeVaoExtension_1.createVertexArrayOES()},gl.bindVertexArray=function(vao){return nativeVaoExtension_1.bindVertexArrayOES(vao)},gl.deleteVertexArray=function(vao){return nativeVaoExtension_1.deleteVertexArrayOES(vao)}):(this.hasVao=!1,gl.createVertexArray=function(){return null},gl.bindVertexArray=function(){return null},gl.deleteVertexArray=function(){return null})}if(2!==context.webGLVersion){var instanceExt_1=gl.getExtension("ANGLE_instanced_arrays");instanceExt_1?(gl.vertexAttribDivisor=function(a,b){return instanceExt_1.vertexAttribDivisorANGLE(a,b)},gl.drawElementsInstanced=function(a,b,c,d,e){return instanceExt_1.drawElementsInstancedANGLE(a,b,c,d,e)},gl.drawArraysInstanced=function(a,b,c,d){return instanceExt_1.drawArraysInstancedANGLE(a,b,c,d)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===context.webGLVersion||!!context.extensions.uint32ElementIndex},GeometrySystem.prototype.bind=function(geometry,shader){shader=shader||this.renderer.shader.shader;var gl=this.gl,vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],incRefCount=!1;vaos||(this.managedGeometries[geometry.id]=geometry,geometry.disposeRunner.add(this),geometry.glVertexArrayObjects[this.CONTEXT_UID]=vaos={},incRefCount=!0);var vao=vaos[shader.program.id]||this.initGeometryVao(geometry,shader,incRefCount);this._activeGeometry=geometry,this._activeVao!==vao&&(this._activeVao=vao,this.hasVao?gl.bindVertexArray(vao):this.activateVao(geometry,shader.program)),this.updateBuffers()},GeometrySystem.prototype.reset=function(){this.unbind()},GeometrySystem.prototype.updateBuffers=function(){for(var geometry=this._activeGeometry,bufferSystem=this.renderer.buffer,i=0;i<geometry.buffers.length;i++){var buffer=geometry.buffers[i];bufferSystem.update(buffer)}},GeometrySystem.prototype.checkCompatibility=function(geometry,program){var geometryAttributes=geometry.attributes,shaderAttributes=program.attributeData;for(var j in shaderAttributes)if(!geometryAttributes[j])throw new Error('shader and geometry incompatible, geometry missing the "'+j+'" attribute')},GeometrySystem.prototype.getSignature=function(geometry,program){var attribs=geometry.attributes,shaderAttributes=program.attributeData,strings=["g",geometry.id];for(var i in attribs)shaderAttributes[i]&&strings.push(i);return strings.join("-")},GeometrySystem.prototype.initGeometryVao=function(geometry,shader,incRefCount){void 0===incRefCount&&(incRefCount=!0);var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,bufferSystem=this.renderer.buffer,program=shader.program;program.glPrograms[CONTEXT_UID]||this.renderer.shader.generateProgram(shader),this.checkCompatibility(geometry,program);var signature=this.getSignature(geometry,program),vaoObjectHash=geometry.glVertexArrayObjects[this.CONTEXT_UID],vao=vaoObjectHash[signature];if(vao)return vaoObjectHash[program.id]=vao,vao;var buffers=geometry.buffers,attributes=geometry.attributes,tempStride={},tempStart={};for(var j in buffers)tempStride[j]=0,tempStart[j]=0;for(var j in attributes)!attributes[j].size&&program.attributeData[j]?attributes[j].size=program.attributeData[j].size:attributes[j].size||console.warn("PIXI Geometry attribute '"+j+"' size cannot be determined (likely the bound shader does not have the attribute)"),tempStride[attributes[j].buffer]+=attributes[j].size*canvas_mesh_byteSizeMap$1[attributes[j].type];for(var j in attributes){var attribute=attributes[j],attribSize=attribute.size;void 0===attribute.stride&&(tempStride[attribute.buffer]===attribSize*canvas_mesh_byteSizeMap$1[attribute.type]?attribute.stride=0:attribute.stride=tempStride[attribute.buffer]),void 0===attribute.start&&(attribute.start=tempStart[attribute.buffer],tempStart[attribute.buffer]+=attribSize*canvas_mesh_byteSizeMap$1[attribute.type])}vao=gl.createVertexArray(),gl.bindVertexArray(vao);for(var i=0;i<buffers.length;i++){var buffer=buffers[i];bufferSystem.bind(buffer),incRefCount&&buffer._glBuffers[CONTEXT_UID].refCount++}return this.activateVao(geometry,program),this._activeVao=vao,vaoObjectHash[program.id]=vao,vaoObjectHash[signature]=vao,vao},GeometrySystem.prototype.disposeGeometry=function(geometry,contextLost){var _a;if(this.managedGeometries[geometry.id]){delete this.managedGeometries[geometry.id];var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],gl=this.gl,buffers=geometry.buffers,bufferSystem=null===(_a=this.renderer)||void 0===_a?void 0:_a.buffer;if(geometry.disposeRunner.remove(this),vaos){if(bufferSystem)for(var i=0;i<buffers.length;i++){var buf=buffers[i]._glBuffers[this.CONTEXT_UID];buf&&(buf.refCount--,0!==buf.refCount||contextLost||bufferSystem.dispose(buffers[i],contextLost))}if(!contextLost)for(var vaoId in vaos)if("g"===vaoId[0]){var vao=vaos[vaoId];this._activeVao===vao&&this.unbind(),gl.deleteVertexArray(vao)}delete geometry.glVertexArrayObjects[this.CONTEXT_UID]}}},GeometrySystem.prototype.disposeAll=function(contextLost){for(var all=Object.keys(this.managedGeometries),i=0;i<all.length;i++)this.disposeGeometry(this.managedGeometries[all[i]],contextLost)},GeometrySystem.prototype.activateVao=function(geometry,program){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,bufferSystem=this.renderer.buffer,buffers=geometry.buffers,attributes=geometry.attributes;geometry.indexBuffer&&bufferSystem.bind(geometry.indexBuffer);var lastBuffer=null;for(var j in attributes){var attribute=attributes[j],buffer=buffers[attribute.buffer],glBuffer=buffer._glBuffers[CONTEXT_UID];if(program.attributeData[j]){lastBuffer!==glBuffer&&(bufferSystem.bind(buffer),lastBuffer=glBuffer);var location=program.attributeData[j].location;if(gl.enableVertexAttribArray(location),gl.vertexAttribPointer(location,attribute.size,attribute.type||gl.FLOAT,attribute.normalized,attribute.stride,attribute.start),attribute.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");gl.vertexAttribDivisor(location,1)}}}},GeometrySystem.prototype.draw=function(type,size,start,instanceCount){var gl=this.gl,geometry=this._activeGeometry;if(geometry.indexBuffer){var byteSize=geometry.indexBuffer.data.BYTES_PER_ELEMENT,glType=2===byteSize?gl.UNSIGNED_SHORT:gl.UNSIGNED_INT;2===byteSize||4===byteSize&&this.canUseUInt32ElementIndex?geometry.instanced?gl.drawElementsInstanced(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize,instanceCount||1):gl.drawElements(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize):console.warn("unsupported index buffer type: uint32")}else geometry.instanced?gl.drawArraysInstanced(type,start,size||geometry.getSize(),instanceCount||1):gl.drawArrays(type,start,size||geometry.getSize());return this},GeometrySystem.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},GeometrySystem.prototype.destroy=function(){this.renderer=null},GeometrySystem}(),canvas_mesh_MaskData=function(){function MaskData(maskObject){void 0===maskObject&&(maskObject=null),this.type=constants_MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=maskObject||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=settings.FILTER_MULTISAMPLE,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return MaskData.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=constants_MASK_TYPES.NONE,this.autoDetect=!0),this._target=null},MaskData.prototype.copyCountersOrReset=function(maskAbove){maskAbove?(this._stencilCounter=maskAbove._stencilCounter,this._scissorCounter=maskAbove._scissorCounter,this._scissorRect=maskAbove._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},MaskData}();function canvas_mesh_compileShader(gl,type,src){var shader=gl.createShader(type);return gl.shaderSource(shader,src),gl.compileShader(shader),shader}function canvas_mesh_logPrettyShaderError(gl,shader){var shaderSrc=gl.getShaderSource(shader).split("\n").map((function(line,index){return index+": "+line})),shaderLog=gl.getShaderInfoLog(shader),splitShader=shaderLog.split("\n"),dedupe={},lineNumbers=splitShader.map((function(line){return parseFloat(line.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))})).filter((function(n){return!(!n||dedupe[n])&&(dedupe[n]=!0,!0)})),logArgs=[""];lineNumbers.forEach((function(number){shaderSrc[number-1]="%c"+shaderSrc[number-1]+"%c",logArgs.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));var fragmentSourceToLog=shaderSrc.join("\n");logArgs[0]=fragmentSourceToLog,console.error(shaderLog),console.groupCollapsed("click to view full shader code"),console.warn.apply(console,logArgs),console.groupEnd()}function canvas_mesh_booleanArray(size){for(var array=new Array(size),i=0;i<array.length;i++)array[i]=!1;return array}function canvas_mesh_defaultValue(type,size){switch(type){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*size);case"vec3":return new Float32Array(3*size);case"vec4":return new Float32Array(4*size);case"ivec2":return new Int32Array(2*size);case"ivec3":return new Int32Array(3*size);case"ivec4":return new Int32Array(4*size);case"uvec2":return new Uint32Array(2*size);case"uvec3":return new Uint32Array(3*size);case"uvec4":return new Uint32Array(4*size);case"bool":return!1;case"bvec2":return canvas_mesh_booleanArray(2*size);case"bvec3":return canvas_mesh_booleanArray(3*size);case"bvec4":return canvas_mesh_booleanArray(4*size);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var canvas_mesh_maxFragmentPrecision,canvas_mesh_unknownContext={},canvas_mesh_context=canvas_mesh_unknownContext;function canvas_mesh_getMaxFragmentPrecision(){if(!canvas_mesh_maxFragmentPrecision){canvas_mesh_maxFragmentPrecision=constants_PRECISION.MEDIUM;var gl=function(){if(canvas_mesh_context===canvas_mesh_unknownContext||canvas_mesh_context&&canvas_mesh_context.isContextLost()){var canvas=document.createElement("canvas"),gl=void 0;settings.PREFER_ENV>=constants_ENV.WEBGL2&&(gl=canvas.getContext("webgl2",{})),gl||((gl=canvas.getContext("webgl",{})||canvas.getContext("experimental-webgl",{}))?gl.getExtension("WEBGL_draw_buffers"):gl=null),canvas_mesh_context=gl}return canvas_mesh_context}();if(gl&&gl.getShaderPrecisionFormat){var shaderFragment=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);canvas_mesh_maxFragmentPrecision=shaderFragment.precision?constants_PRECISION.HIGH:constants_PRECISION.MEDIUM}}return canvas_mesh_maxFragmentPrecision}function canvas_mesh_setPrecision(src,requestedPrecision,maxSupportedPrecision){if("precision"!==src.substring(0,9)){var precision=requestedPrecision;return requestedPrecision===constants_PRECISION.HIGH&&maxSupportedPrecision!==constants_PRECISION.HIGH&&(precision=constants_PRECISION.MEDIUM),"precision "+precision+" float;\n"+src}return maxSupportedPrecision!==constants_PRECISION.HIGH&&"precision highp"===src.substring(0,15)?src.replace("precision highp","precision mediump"):src}var canvas_mesh_GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function canvas_mesh_mapSize(type){return canvas_mesh_GLSL_TO_SIZE[type]}var canvas_mesh_GL_TABLE=null,canvas_mesh_GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function canvas_mesh_mapType(gl,type){if(!canvas_mesh_GL_TABLE){var typeNames=Object.keys(canvas_mesh_GL_TO_GLSL_TYPES);canvas_mesh_GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];canvas_mesh_GL_TABLE[gl[tn]]=canvas_mesh_GL_TO_GLSL_TYPES[tn]}}return canvas_mesh_GL_TABLE[type]}var canvas_mesh_uniformParsers=[{test:function(data){return"float"===data.type&&1===data.size},code:function(name){return'\n            if(uv["'+name+'"] !== ud["'+name+'"].value)\n            {\n                ud["'+name+'"].value = uv["'+name+'"]\n                gl.uniform1f(ud["'+name+'"].location, uv["'+name+'"])\n            }\n            '}},{test:function(data){return("sampler2D"===data.type||"samplerCube"===data.type||"sampler2DArray"===data.type)&&1===data.size&&!data.isArray},code:function(name){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+name+'"], t);\n\n            if(ud["'+name+'"].value !== t)\n            {\n                ud["'+name+'"].value = t;\n                gl.uniform1i(ud["'+name+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(data,uniform){return"mat3"===data.type&&1===data.size&&void 0!==uniform.a},code:function(name){return'\n            gl.uniformMatrix3fv(ud["'+name+'"].location, false, uv["'+name+'"].toArray(true));\n            '},codeUbo:function(name){return"\n                var "+name+"_matrix = uv."+name+".toArray(true);\n\n                data[offset] = "+name+"_matrix[0];\n                data[offset+1] = "+name+"_matrix[1];\n                data[offset+2] = "+name+"_matrix[2];\n        \n                data[offset + 4] = "+name+"_matrix[3];\n                data[offset + 5] = "+name+"_matrix[4];\n                data[offset + 6] = "+name+"_matrix[5];\n        \n                data[offset + 8] = "+name+"_matrix[6];\n                data[offset + 9] = "+name+"_matrix[7];\n                data[offset + 10] = "+name+"_matrix[8];\n            "}},{test:function(data,uniform){return"vec2"===data.type&&1===data.size&&void 0!==uniform.x},code:function(name){return'\n                cv = ud["'+name+'"].value;\n                v = uv["'+name+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+name+'"].location, v.x, v.y);\n                }'},codeUbo:function(name){return"\n                v = uv."+name+";\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            "}},{test:function(data){return"vec2"===data.type&&1===data.size},code:function(name){return'\n                cv = ud["'+name+'"].value;\n                v = uv["'+name+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+name+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(data,uniform){return"vec4"===data.type&&1===data.size&&void 0!==uniform.width},code:function(name){return'\n                cv = ud["'+name+'"].value;\n                v = uv["'+name+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+name+'"].location, v.x, v.y, v.width, v.height)\n                }'},codeUbo:function(name){return"\n                    v = uv."+name+";\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                "}},{test:function(data){return"vec4"===data.type&&1===data.size},code:function(name){return'\n                cv = ud["'+name+'"].value;\n                v = uv["'+name+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+name+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],canvas_mesh_GLSL_TO_SINGLE_SETTERS_CACHED={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",uint:"gl.uniform1ui(location, v)",uvec2:"gl.uniform2ui(location, v[0], v[1])",uvec3:"gl.uniform3ui(location, v[0], v[1], v[2])",uvec4:"gl.uniform4ui(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},canvas_mesh_GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};var canvas_mesh_unsafeEval,canvas_mesh_fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function canvas_mesh_generateIfTestSrc(maxIfs){for(var src="",i=0;i<maxIfs;++i)i>0&&(src+="\nelse "),i<maxIfs-1&&(src+="if(test == "+i+".0){}");return src}var canvas_mesh_UID$3=0,canvas_mesh_nameCache={},canvas_mesh_Program=function(){function Program(vertexSrc,fragmentSrc,name){void 0===name&&(name="pixi-shader"),this.id=canvas_mesh_UID$3++,this.vertexSrc=vertexSrc||Program.defaultVertexSrc,this.fragmentSrc=fragmentSrc||Program.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(name=name.replace(/\s+/g,"-"),canvas_mesh_nameCache[name]?(canvas_mesh_nameCache[name]++,name+="-"+canvas_mesh_nameCache[name]):canvas_mesh_nameCache[name]=1,this.vertexSrc="#define SHADER_NAME "+name+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+name+"\n"+this.fragmentSrc,this.vertexSrc=canvas_mesh_setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,constants_PRECISION.HIGH),this.fragmentSrc=canvas_mesh_setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,canvas_mesh_getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}return Object.defineProperty(Program,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(Program,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),Program.from=function(vertexSrc,fragmentSrc,name){var key=vertexSrc+fragmentSrc,program=canvas_mesh_ProgramCache[key];return program||(canvas_mesh_ProgramCache[key]=program=new Program(vertexSrc,fragmentSrc,name)),program},Program}(),canvas_mesh_Shader=function(){function Shader(program,uniforms){this.uniformBindCount=0,this.program=program,this.uniformGroup=uniforms?uniforms instanceof canvas_mesh_UniformGroup?uniforms:new canvas_mesh_UniformGroup(uniforms):new canvas_mesh_UniformGroup({})}return Shader.prototype.checkUniformExists=function(name,group){if(group.uniforms[name])return!0;for(var i in group.uniforms){var uniform=group.uniforms[i];if(uniform.group&&this.checkUniformExists(name,uniform))return!0}return!1},Shader.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(Shader.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),Shader.from=function(vertexSrc,fragmentSrc,uniforms){return new Shader(canvas_mesh_Program.from(vertexSrc,fragmentSrc),uniforms)},Shader}(),canvas_mesh_State=function(){function State(){this.data=0,this.blendMode=constants_BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}return Object.defineProperty(State.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(value){!!(1&this.data)!==value&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(value){!!(2&this.data)!==value&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(value){!!(4&this.data)!==value&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(value){!!(8&this.data)!==value&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"depthMask",{get:function(){return!!(32&this.data)},set:function(value){!!(32&this.data)!==value&&(this.data^=32)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(value){!!(16&this.data)!==value&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"blendMode",{get:function(){return this._blendMode},set:function(value){this.blend=value!==constants_BLEND_MODES.NONE,this._blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(value){this.offsets=!!value,this._polygonOffset=value},enumerable:!1,configurable:!0}),State.prototype.toString=function(){return"[@pixi/core:State blendMode="+this.blendMode+" clockwiseFrontFace="+this.clockwiseFrontFace+" culling="+this.culling+" depthMask="+this.depthMask+" polygonOffset="+this.polygonOffset+"]"},State.for2d=function(){var state=new State;return state.depthTest=!1,state.blend=!0,state},State}(),canvas_mesh_Filter=function(_super){function Filter(vertexSrc,fragmentSrc,uniforms){var _this=this,program=canvas_mesh_Program.from(vertexSrc||Filter.defaultVertexSrc,fragmentSrc||Filter.defaultFragmentSrc);return(_this=_super.call(this,program,uniforms)||this).padding=0,_this.resolution=settings.FILTER_RESOLUTION,_this.multisample=settings.FILTER_MULTISAMPLE,_this.enabled=!0,_this.autoFit=!0,_this.state=new canvas_mesh_State,_this}return canvas_mesh_extends(Filter,_super),Filter.prototype.apply=function(filterManager,input,output,clearMode,_currentState){filterManager.applyFilter(this,input,output,clearMode)},Object.defineProperty(Filter.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0}),Object.defineProperty(Filter,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(Filter,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),Filter}(canvas_mesh_Shader),canvas_mesh_tempMat=new canvas_mesh_Matrix,canvas_mesh_TextureMatrix=function(){function TextureMatrix(texture,clampMargin){this._texture=texture,this.mapCoord=new canvas_mesh_Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===clampMargin?.5:clampMargin,this.isSimple=!1}return Object.defineProperty(TextureMatrix.prototype,"texture",{get:function(){return this._texture},set:function(value){this._texture=value,this._textureID=-1},enumerable:!1,configurable:!0}),TextureMatrix.prototype.multiplyUvs=function(uvs,out){void 0===out&&(out=uvs);for(var mat=this.mapCoord,i=0;i<uvs.length;i+=2){var x=uvs[i],y=uvs[i+1];out[i]=x*mat.a+y*mat.c+mat.tx,out[i+1]=x*mat.b+y*mat.d+mat.ty}return out},TextureMatrix.prototype.update=function(forceUpdate){var tex=this._texture;if(!tex||!tex.valid)return!1;if(!forceUpdate&&this._textureID===tex._updateID)return!1;this._textureID=tex._updateID,this._updateID++;var uvs=tex._uvs;this.mapCoord.set(uvs.x1-uvs.x0,uvs.y1-uvs.y0,uvs.x3-uvs.x0,uvs.y3-uvs.y0,uvs.x0,uvs.y0);var orig=tex.orig,trim=tex.trim;trim&&(canvas_mesh_tempMat.set(orig.width/trim.width,0,0,orig.height/trim.height,-trim.x/trim.width,-trim.y/trim.height),this.mapCoord.append(canvas_mesh_tempMat));var texBase=tex.baseTexture,frame=this.uClampFrame,margin=this.clampMargin/texBase.resolution,offset=this.clampOffset;return frame[0]=(tex._frame.x+margin+offset)/texBase.width,frame[1]=(tex._frame.y+margin+offset)/texBase.height,frame[2]=(tex._frame.x+tex._frame.width-margin+offset)/texBase.width,frame[3]=(tex._frame.y+tex._frame.height-margin+offset)/texBase.height,this.uClampOffset[0]=offset/texBase.realWidth,this.uClampOffset[1]=offset/texBase.realHeight,this.isSimple=tex._frame.width===texBase.width&&tex._frame.height===texBase.height&&0===tex.rotate,!0},TextureMatrix}(),canvas_mesh_SpriteMaskFilter=function(_super){function SpriteMaskFilter(sprite){var _this=this,maskMatrix=new canvas_mesh_Matrix;return _this=_super.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n")||this,sprite.renderable=!1,_this.maskSprite=sprite,_this.maskMatrix=maskMatrix,_this}return canvas_mesh_extends(SpriteMaskFilter,_super),SpriteMaskFilter.prototype.apply=function(filterManager,input,output,clearMode){var maskSprite=this.maskSprite,tex=maskSprite._texture;tex.valid&&(tex.uvMatrix||(tex.uvMatrix=new canvas_mesh_TextureMatrix(tex,0)),tex.uvMatrix.update(),this.uniforms.npmAlpha=tex.baseTexture.alphaMode?0:1,this.uniforms.mask=tex,this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.uvMatrix.mapCoord),this.uniforms.alpha=maskSprite.worldAlpha,this.uniforms.maskClamp=tex.uvMatrix.uClampFrame,filterManager.applyFilter(this,input,output,clearMode))},SpriteMaskFilter}(canvas_mesh_Filter),canvas_mesh_MaskSystem=function(){function MaskSystem(renderer){this.renderer=renderer,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return MaskSystem.prototype.setMaskStack=function(maskStack){this.maskStack=maskStack,this.renderer.scissor.setMaskStack(maskStack),this.renderer.stencil.setMaskStack(maskStack)},MaskSystem.prototype.push=function(target,maskDataOrTarget){var maskData=maskDataOrTarget;if(!maskData.isMaskData){var d=this.maskDataPool.pop()||new canvas_mesh_MaskData;d.pooled=!0,d.maskObject=maskDataOrTarget,maskData=d}switch(maskData.autoDetect&&this.detect(maskData),maskData.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),maskData._target=target,maskData.type){case constants_MASK_TYPES.SCISSOR:this.maskStack.push(maskData),this.renderer.scissor.push(maskData);break;case constants_MASK_TYPES.STENCIL:this.maskStack.push(maskData),this.renderer.stencil.push(maskData);break;case constants_MASK_TYPES.SPRITE:maskData.copyCountersOrReset(null),this.pushSpriteMask(maskData),this.maskStack.push(maskData)}},MaskSystem.prototype.pop=function(target){var maskData=this.maskStack.pop();if(maskData&&maskData._target===target){switch(maskData.type){case constants_MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case constants_MASK_TYPES.STENCIL:this.renderer.stencil.pop(maskData.maskObject);break;case constants_MASK_TYPES.SPRITE:this.popSpriteMask()}maskData.reset(),maskData.pooled&&this.maskDataPool.push(maskData)}},MaskSystem.prototype.detect=function(maskData){var maskObject=maskData.maskObject;if(maskObject.isSprite)maskData.type=constants_MASK_TYPES.SPRITE;else if(maskData.type=constants_MASK_TYPES.STENCIL,this.enableScissor&&maskObject.isFastRect&&maskObject.isFastRect()){var matrix=maskObject.worldTransform,rotX=Math.atan2(matrix.b,matrix.a),rotXY=Math.atan2(matrix.d,matrix.c);rotX=Math.round(rotX*(180/Math.PI)*100),rotXY=((rotXY=Math.round(rotXY*(180/Math.PI)*100)-rotX)%18e3+18e3)%18e3,0===(rotX=(rotX%9e3+9e3)%9e3)&&9e3===rotXY&&(maskData.type=constants_MASK_TYPES.SCISSOR)}},MaskSystem.prototype.pushSpriteMask=function(maskData){var _a,_b,maskObject=maskData.maskObject,target=maskData._target,alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex];alphaMaskFilter||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new canvas_mesh_SpriteMaskFilter(maskObject)]);var resolution,multisample,renderer=this.renderer,renderTextureSystem=renderer.renderTexture;if(renderTextureSystem.current){var renderTexture=renderTextureSystem.current;resolution=maskData.resolution||renderTexture.resolution,multisample=null!==(_a=maskData.multisample)&&void 0!==_a?_a:renderTexture.multisample}else resolution=maskData.resolution||renderer.resolution,multisample=null!==(_b=maskData.multisample)&&void 0!==_b?_b:renderer.multisample;alphaMaskFilter[0].resolution=resolution,alphaMaskFilter[0].multisample=multisample,alphaMaskFilter[0].maskSprite=maskObject;var stashFilterArea=target.filterArea;target.filterArea=maskObject.getBounds(!0),renderer.filter.push(target,alphaMaskFilter),target.filterArea=stashFilterArea,this.alphaMaskIndex++},MaskSystem.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},MaskSystem.prototype.destroy=function(){this.renderer=null},MaskSystem}(),canvas_mesh_AbstractMaskSystem=function(){function AbstractMaskSystem(renderer){this.renderer=renderer,this.maskStack=[],this.glConst=0}return AbstractMaskSystem.prototype.getStackLength=function(){return this.maskStack.length},AbstractMaskSystem.prototype.setMaskStack=function(maskStack){var gl=this.renderer.gl,curStackLen=this.getStackLength();this.maskStack=maskStack;var newStackLen=this.getStackLength();newStackLen!==curStackLen&&(0===newStackLen?gl.disable(this.glConst):(gl.enable(this.glConst),this._useCurrent()))},AbstractMaskSystem.prototype._useCurrent=function(){},AbstractMaskSystem.prototype.destroy=function(){this.renderer=null,this.maskStack=null},AbstractMaskSystem}(),canvas_mesh_ScissorSystem=function(_super){function ScissorSystem(renderer){var _this=_super.call(this,renderer)||this;return _this.glConst=WebGLRenderingContext.SCISSOR_TEST,_this}return canvas_mesh_extends(ScissorSystem,_super),ScissorSystem.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._scissorCounter:0},ScissorSystem.prototype.push=function(maskData){var maskObject=maskData.maskObject;maskObject.renderable=!0;var prevData=maskData._scissorRect,bounds=maskObject.getBounds(!0),gl=this.renderer.gl;maskObject.renderable=!1,prevData?bounds.fit(prevData):gl.enable(gl.SCISSOR_TEST),maskData._scissorCounter++,maskData._scissorRect=bounds,this._useCurrent()},ScissorSystem.prototype.pop=function(){var gl=this.renderer.gl;this.getStackLength()>0?this._useCurrent():gl.disable(gl.SCISSOR_TEST)},ScissorSystem.prototype._useCurrent=function(){var rect=this.maskStack[this.maskStack.length-1]._scissorRect,rt=this.renderer.renderTexture.current,_a=this.renderer.projection,transform=_a.transform,sourceFrame=_a.sourceFrame,destinationFrame=_a.destinationFrame,resolution=rt?rt.resolution:this.renderer.resolution,sx=destinationFrame.width/sourceFrame.width,sy=destinationFrame.height/sourceFrame.height,x=((rect.x-sourceFrame.x)*sx+destinationFrame.x)*resolution,y=((rect.y-sourceFrame.y)*sy+destinationFrame.y)*resolution,width=rect.width*sx*resolution,height=rect.height*sy*resolution;transform&&(x+=transform.tx*resolution,y+=transform.ty*resolution),rt||(y=this.renderer.height-height-y),x=Math.round(x),y=Math.round(y),width=Math.round(width),height=Math.round(height),this.renderer.gl.scissor(x,y,width,height)},ScissorSystem}(canvas_mesh_AbstractMaskSystem),canvas_mesh_StencilSystem=function(_super){function StencilSystem(renderer){var _this=_super.call(this,renderer)||this;return _this.glConst=WebGLRenderingContext.STENCIL_TEST,_this}return canvas_mesh_extends(StencilSystem,_super),StencilSystem.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._stencilCounter:0},StencilSystem.prototype.push=function(maskData){var maskObject=maskData.maskObject,gl=this.renderer.gl,prevMaskCount=maskData._stencilCounter;0===prevMaskCount&&(this.renderer.framebuffer.forceStencil(),gl.enable(gl.STENCIL_TEST)),maskData._stencilCounter++,gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.EQUAL,prevMaskCount,this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),maskObject.renderable=!1,this._useCurrent()},StencilSystem.prototype.pop=function(maskObject){var gl=this.renderer.gl;0===this.getStackLength()?(gl.disable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),gl.clearStencil(0)):(gl.colorMask(!1,!1,!1,!1),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),maskObject.renderable=!1,this._useCurrent())},StencilSystem.prototype._useCurrent=function(){var gl=this.renderer.gl;gl.colorMask(!0,!0,!0,!0),gl.stencilFunc(gl.EQUAL,this.getStackLength(),this._getBitwiseMask()),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)},StencilSystem.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},StencilSystem}(canvas_mesh_AbstractMaskSystem),canvas_mesh_ProjectionSystem=function(){function ProjectionSystem(renderer){this.renderer=renderer,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new canvas_mesh_Matrix,this.transform=null}return ProjectionSystem.prototype.update=function(destinationFrame,sourceFrame,resolution,root){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame,this.sourceFrame=sourceFrame||this.sourceFrame||destinationFrame,this.calculateProjection(this.destinationFrame,this.sourceFrame,resolution,root),this.transform&&this.projectionMatrix.append(this.transform);var renderer=this.renderer;renderer.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,renderer.globalUniforms.update(),renderer.shader.shader&&renderer.shader.syncUniformGroup(renderer.shader.shader.uniforms.globals)},ProjectionSystem.prototype.calculateProjection=function(_destinationFrame,sourceFrame,_resolution,root){var pm=this.projectionMatrix,sign=root?-1:1;pm.identity(),pm.a=1/sourceFrame.width*2,pm.d=sign*(1/sourceFrame.height*2),pm.tx=-1-sourceFrame.x*pm.a,pm.ty=-sign-sourceFrame.y*pm.d},ProjectionSystem.prototype.setTransform=function(_matrix){},ProjectionSystem.prototype.destroy=function(){this.renderer=null},ProjectionSystem}(),canvas_mesh_tempRect=new canvas_mesh_Rectangle,canvas_mesh_tempRect2=new canvas_mesh_Rectangle,canvas_mesh_RenderTextureSystem=function(){function RenderTextureSystem(renderer){this.renderer=renderer,this.clearColor=renderer._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new canvas_mesh_Rectangle,this.destinationFrame=new canvas_mesh_Rectangle,this.viewportFrame=new canvas_mesh_Rectangle}return RenderTextureSystem.prototype.bind=function(renderTexture,sourceFrame,destinationFrame){void 0===renderTexture&&(renderTexture=null);var baseTexture,framebuffer,resolution,renderer=this.renderer;this.current=renderTexture,renderTexture?(resolution=(baseTexture=renderTexture.baseTexture).resolution,sourceFrame||(canvas_mesh_tempRect.width=renderTexture.frame.width,canvas_mesh_tempRect.height=renderTexture.frame.height,sourceFrame=canvas_mesh_tempRect),destinationFrame||(canvas_mesh_tempRect2.x=renderTexture.frame.x,canvas_mesh_tempRect2.y=renderTexture.frame.y,canvas_mesh_tempRect2.width=sourceFrame.width,canvas_mesh_tempRect2.height=sourceFrame.height,destinationFrame=canvas_mesh_tempRect2),framebuffer=baseTexture.framebuffer):(resolution=renderer.resolution,sourceFrame||(canvas_mesh_tempRect.width=renderer.screen.width,canvas_mesh_tempRect.height=renderer.screen.height,sourceFrame=canvas_mesh_tempRect),destinationFrame||((destinationFrame=canvas_mesh_tempRect).width=sourceFrame.width,destinationFrame.height=sourceFrame.height));var viewportFrame=this.viewportFrame;viewportFrame.x=destinationFrame.x*resolution,viewportFrame.y=destinationFrame.y*resolution,viewportFrame.width=destinationFrame.width*resolution,viewportFrame.height=destinationFrame.height*resolution,renderTexture||(viewportFrame.y=renderer.view.height-(viewportFrame.y+viewportFrame.height)),viewportFrame.ceil(),this.renderer.framebuffer.bind(framebuffer,viewportFrame),this.renderer.projection.update(destinationFrame,sourceFrame,resolution,!framebuffer),renderTexture?this.renderer.mask.setMaskStack(baseTexture.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(sourceFrame),this.destinationFrame.copyFrom(destinationFrame)},RenderTextureSystem.prototype.clear=function(clearColor,mask){clearColor=this.current?clearColor||this.current.baseTexture.clearColor:clearColor||this.clearColor;var destinationFrame=this.destinationFrame,baseFrame=this.current?this.current.baseTexture:this.renderer.screen,clearMask=destinationFrame.width!==baseFrame.width||destinationFrame.height!==baseFrame.height;if(clearMask){var _a=this.viewportFrame,x=_a.x,y=_a.y,width=_a.width,height=_a.height;x=Math.round(x),y=Math.round(y),width=Math.round(width),height=Math.round(height),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(x,y,width,height)}this.renderer.framebuffer.clear(clearColor[0],clearColor[1],clearColor[2],clearColor[3],mask),clearMask&&this.renderer.scissor.pop()},RenderTextureSystem.prototype.resize=function(){this.bind(null)},RenderTextureSystem.prototype.reset=function(){this.bind(null)},RenderTextureSystem.prototype.destroy=function(){this.renderer=null},RenderTextureSystem}();function canvas_mesh_uboUpdate(_ud,_uv,_renderer,_syncData,buffer){_renderer.buffer.update(buffer)}var canvas_mesh_UBO_TO_SINGLE_SETTERS={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},canvas_mesh_GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function canvas_mesh_generateUniformBufferSync(group,uniformData){if(!group.autoManage)return{size:0,syncFunc:canvas_mesh_uboUpdate};for(var usedUniformDatas=function(uniforms,uniformData){var usedUniformDatas=[];for(var i in uniforms)uniformData[i]&&usedUniformDatas.push(uniformData[i]);return usedUniformDatas.sort((function(a,b){return a.index-b.index})),usedUniformDatas}(group.uniforms,uniformData),_a=function(uniformData){for(var uboElements=uniformData.map((function(data){return{data,offset:0,dataLen:0,dirty:0}})),size=0,chunkSize=0,offset=0,i=0;i<uboElements.length;i++){var uboElement=uboElements[i];if(size=canvas_mesh_GLSL_TO_STD40_SIZE[uboElement.data.type],uboElement.data.size>1&&(size=Math.max(size,16)*uboElement.data.size),uboElement.dataLen=size,chunkSize%size!=0&&chunkSize<16){var lineUpValue=chunkSize%size%16;chunkSize+=lineUpValue,offset+=lineUpValue}chunkSize+size>16?(offset=16*Math.ceil(offset/16),uboElement.offset=offset,offset+=size,chunkSize=size):(uboElement.offset=offset,chunkSize+=size,offset+=size)}return{uboElements,size:offset=16*Math.ceil(offset/16)}}(usedUniformDatas),uboElements=_a.uboElements,size=_a.size,funcFragments=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "],i=0;i<uboElements.length;i++){for(var uboElement=uboElements[i],uniform=group.uniforms[uboElement.data.name],name=uboElement.data.name,parsed=!1,j=0;j<canvas_mesh_uniformParsers.length;j++){var uniformParser=canvas_mesh_uniformParsers[j];if(uniformParser.codeUbo&&uniformParser.test(uboElement.data,uniform)){funcFragments.push("offset = "+uboElement.offset/4+";",canvas_mesh_uniformParsers[j].codeUbo(uboElement.data.name,uniform)),parsed=!0;break}}if(!parsed)if(uboElement.data.size>1){var size_1=canvas_mesh_mapSize(uboElement.data.type),rowSize=Math.max(canvas_mesh_GLSL_TO_STD40_SIZE[uboElement.data.type]/16,1),elementSize=size_1/rowSize,remainder=(4-elementSize%4)%4;funcFragments.push("\n                cv = ud."+name+".value;\n                v = uv."+name+";\n                offset = "+uboElement.offset/4+";\n\n                t = 0;\n\n                for(var i=0; i < "+uboElement.data.size*rowSize+"; i++)\n                {\n                    for(var j = 0; j < "+elementSize+"; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += "+remainder+";\n                }\n\n                ")}else{var template=canvas_mesh_UBO_TO_SINGLE_SETTERS[uboElement.data.type];funcFragments.push("\n                cv = ud."+name+".value;\n                v = uv."+name+";\n                offset = "+uboElement.offset/4+";\n                "+template+";\n                ")}}return funcFragments.push("\n       renderer.buffer.update(buffer);\n    "),{size,syncFunc:new Function("ud","uv","renderer","syncData","buffer",funcFragments.join("\n"))}}var canvas_mesh_GLProgram=function(){function GLProgram(program,uniformData){this.program=program,this.uniformData=uniformData,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}return GLProgram.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null},GLProgram}();function canvas_mesh_generateProgram(gl,program){var glVertShader=canvas_mesh_compileShader(gl,gl.VERTEX_SHADER,program.vertexSrc),glFragShader=canvas_mesh_compileShader(gl,gl.FRAGMENT_SHADER,program.fragmentSrc),webGLProgram=gl.createProgram();gl.attachShader(webGLProgram,glVertShader),gl.attachShader(webGLProgram,glFragShader),gl.linkProgram(webGLProgram),gl.getProgramParameter(webGLProgram,gl.LINK_STATUS)||function(gl,program,vertexShader,fragmentShader){gl.getProgramParameter(program,gl.LINK_STATUS)||(gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)||canvas_mesh_logPrettyShaderError(gl,vertexShader),gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)||canvas_mesh_logPrettyShaderError(gl,fragmentShader),console.error("PixiJS Error: Could not initialize shader."),""!==gl.getProgramInfoLog(program)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program)))}(gl,webGLProgram,glVertShader,glFragShader),program.attributeData=function(program,gl){for(var attributes={},totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i);if(!attribData.name.startsWith("gl_")){var type=canvas_mesh_mapType(gl,attribData.type),data={type,name:attribData.name,size:canvas_mesh_mapSize(type),location:i};attributes[attribData.name]=data}}return attributes}(webGLProgram,gl),program.uniformData=function(program,gl){for(var uniforms={},totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i),name=uniformData.name.replace(/\[.*?\]$/,""),isArray=!!uniformData.name.match(/\[.*?\]$/),type=canvas_mesh_mapType(gl,uniformData.type);uniforms[name]={name,index:i,type,size:uniformData.size,isArray,value:canvas_mesh_defaultValue(type,uniformData.size)}}return uniforms}(webGLProgram,gl);var keys=Object.keys(program.attributeData);keys.sort((function(a,b){return a>b?1:-1}));for(var i=0;i<keys.length;i++)program.attributeData[keys[i]].location=i,gl.bindAttribLocation(webGLProgram,i,keys[i]);gl.linkProgram(webGLProgram),gl.deleteShader(glVertShader),gl.deleteShader(glFragShader);var uniformData={};for(var i in program.uniformData){var data=program.uniformData[i];uniformData[i]={location:gl.getUniformLocation(webGLProgram,i),value:canvas_mesh_defaultValue(data.type,data.size)}}return new canvas_mesh_GLProgram(webGLProgram,uniformData)}var canvas_mesh_UID$4=0,canvas_mesh_defaultSyncData={textureCount:0,uboCount:0},canvas_mesh_ShaderSystem=function(){function ShaderSystem(renderer){this.destroyed=!1,this.renderer=renderer,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=canvas_mesh_UID$4++}return ShaderSystem.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof canvas_mesh_unsafeEval)return canvas_mesh_unsafeEval;try{var func=new Function("param1","param2","param3","return param1[param2] === param3;");canvas_mesh_unsafeEval=!0===func({a:"b"},"a","b")}catch(e){canvas_mesh_unsafeEval=!1}return canvas_mesh_unsafeEval}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},ShaderSystem.prototype.contextChange=function(gl){this.gl=gl,this.reset()},ShaderSystem.prototype.bind=function(shader,dontSync){shader.uniforms.globals=this.renderer.globalUniforms;var program=shader.program,glProgram=program.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(shader);return this.shader=shader,this.program!==program&&(this.program=program,this.gl.useProgram(glProgram.program)),dontSync||(canvas_mesh_defaultSyncData.textureCount=0,canvas_mesh_defaultSyncData.uboCount=0,this.syncUniformGroup(shader.uniformGroup,canvas_mesh_defaultSyncData)),glProgram},ShaderSystem.prototype.setUniforms=function(uniforms){var shader=this.shader.program,glProgram=shader.glPrograms[this.renderer.CONTEXT_UID];shader.syncUniforms(glProgram.uniformData,uniforms,this.renderer)},ShaderSystem.prototype.syncUniformGroup=function(group,syncData){var glProgram=this.getGlProgram();group.static&&group.dirtyId===glProgram.uniformDirtyGroups[group.id]||(glProgram.uniformDirtyGroups[group.id]=group.dirtyId,this.syncUniforms(group,glProgram,syncData))},ShaderSystem.prototype.syncUniforms=function(group,glProgram,syncData){(group.syncUniforms[this.shader.program.id]||this.createSyncGroups(group))(glProgram.uniformData,group.uniforms,this.renderer,syncData)},ShaderSystem.prototype.createSyncGroups=function(group){var id=this.getSignature(group,this.shader.program.uniformData,"u");return this.cache[id]||(this.cache[id]=function(group,uniformData){var funcFragments=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(var i in group.uniforms){var data=uniformData[i];if(data){for(var uniform=group.uniforms[i],parsed=!1,j=0;j<canvas_mesh_uniformParsers.length;j++)if(canvas_mesh_uniformParsers[j].test(data,uniform)){funcFragments.push(canvas_mesh_uniformParsers[j].code(i,uniform)),parsed=!0;break}if(!parsed){var template=(1===data.size?canvas_mesh_GLSL_TO_SINGLE_SETTERS_CACHED:canvas_mesh_GLSL_TO_ARRAY_SETTERS)[data.type].replace("location",'ud["'+i+'"].location');funcFragments.push('\n            cv = ud["'+i+'"].value;\n            v = uv["'+i+'"];\n            '+template+";")}}else group.uniforms[i].group&&(group.uniforms[i].ubo?funcFragments.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+i+", '"+i+"');\n                    "):funcFragments.push("\n                        renderer.shader.syncUniformGroup(uv."+i+", syncData);\n                    "))}return new Function("ud","uv","renderer","syncData",funcFragments.join("\n"))}(group,this.shader.program.uniformData)),group.syncUniforms[this.shader.program.id]=this.cache[id],group.syncUniforms[this.shader.program.id]},ShaderSystem.prototype.syncUniformBufferGroup=function(group,name){var glProgram=this.getGlProgram();if(!group.static||0!==group.dirtyId||!glProgram.uniformGroups[group.id]){group.dirtyId=0;var syncFunc=glProgram.uniformGroups[group.id]||this.createSyncBufferGroup(group,glProgram,name);group.buffer.update(),syncFunc(glProgram.uniformData,group.uniforms,this.renderer,canvas_mesh_defaultSyncData,group.buffer)}this.renderer.buffer.bindBufferBase(group.buffer,glProgram.uniformBufferBindings[name])},ShaderSystem.prototype.createSyncBufferGroup=function(group,glProgram,name){var gl=this.renderer.gl;this.renderer.buffer.bind(group.buffer);var uniformBlockIndex=this.gl.getUniformBlockIndex(glProgram.program,name);glProgram.uniformBufferBindings[name]=this.shader.uniformBindCount,gl.uniformBlockBinding(glProgram.program,uniformBlockIndex,this.shader.uniformBindCount),this.shader.uniformBindCount++;var id=this.getSignature(group,this.shader.program.uniformData,"ubo"),uboData=this._uboCache[id];if(uboData||(uboData=this._uboCache[id]=canvas_mesh_generateUniformBufferSync(group,this.shader.program.uniformData)),group.autoManage){var data=new Float32Array(uboData.size/4);group.buffer.update(data)}return glProgram.uniformGroups[group.id]=uboData.syncFunc,glProgram.uniformGroups[group.id]},ShaderSystem.prototype.getSignature=function(group,uniformData,preFix){var uniforms=group.uniforms,strings=[preFix+"-"];for(var i in uniforms)strings.push(i),uniformData[i]&&strings.push(uniformData[i].type);return strings.join("-")},ShaderSystem.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},ShaderSystem.prototype.generateProgram=function(shader){var gl=this.gl,program=shader.program,glProgram=canvas_mesh_generateProgram(gl,program);return program.glPrograms[this.renderer.CONTEXT_UID]=glProgram,glProgram},ShaderSystem.prototype.reset=function(){this.program=null,this.shader=null},ShaderSystem.prototype.destroy=function(){this.renderer=null,this.destroyed=!0},ShaderSystem}();var canvas_mesh_StateSystem=function(){function StateSystem(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=constants_BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new canvas_mesh_State,this.defaultState.blend=!0}return StateSystem.prototype.contextChange=function(gl){this.gl=gl,this.blendModes=function(gl,array){return void 0===array&&(array=[]),array[constants_BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.ADD]=[gl.ONE,gl.ONE],array[constants_BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.NONE]=[0,0],array[constants_BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE],array[constants_BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SRC_IN]=[gl.DST_ALPHA,gl.ZERO],array[constants_BLEND_MODES.SRC_OUT]=[gl.ONE_MINUS_DST_ALPHA,gl.ZERO],array[constants_BLEND_MODES.SRC_ATOP]=[gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.DST_OVER]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE],array[constants_BLEND_MODES.DST_IN]=[gl.ZERO,gl.SRC_ALPHA],array[constants_BLEND_MODES.DST_OUT]=[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.DST_ATOP]=[gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA],array[constants_BLEND_MODES.XOR]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],array[constants_BLEND_MODES.SUBTRACT]=[gl.ONE,gl.ONE,gl.ONE,gl.ONE,gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD],array}(gl),this.set(this.defaultState),this.reset()},StateSystem.prototype.set=function(state){if(state=state||this.defaultState,this.stateId!==state.data){for(var diff=this.stateId^state.data,i=0;diff;)1&diff&&this.map[i].call(this,!!(state.data&1<<i)),diff>>=1,i++;this.stateId=state.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,state)},StateSystem.prototype.forceState=function(state){state=state||this.defaultState;for(var i=0;i<this.map.length;i++)this.map[i].call(this,!!(state.data&1<<i));for(i=0;i<this.checks.length;i++)this.checks[i](this,state);this.stateId=state.data},StateSystem.prototype.setBlend=function(value){this.updateCheck(StateSystem.checkBlendMode,value),this.gl[value?"enable":"disable"](this.gl.BLEND)},StateSystem.prototype.setOffset=function(value){this.updateCheck(StateSystem.checkPolygonOffset,value),this.gl[value?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},StateSystem.prototype.setDepthTest=function(value){this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)},StateSystem.prototype.setDepthMask=function(value){this.gl.depthMask(value)},StateSystem.prototype.setCullFace=function(value){this.gl[value?"enable":"disable"](this.gl.CULL_FACE)},StateSystem.prototype.setFrontFace=function(value){this.gl.frontFace(this.gl[value?"CW":"CCW"])},StateSystem.prototype.setBlendMode=function(value){if(value!==this.blendMode){this.blendMode=value;var mode=this.blendModes[value],gl=this.gl;2===mode.length?gl.blendFunc(mode[0],mode[1]):gl.blendFuncSeparate(mode[0],mode[1],mode[2],mode[3]),6===mode.length?(this._blendEq=!0,gl.blendEquationSeparate(mode[4],mode[5])):this._blendEq&&(this._blendEq=!1,gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD))}},StateSystem.prototype.setPolygonOffset=function(value,scale){this.gl.polygonOffset(value,scale)},StateSystem.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},StateSystem.prototype.updateCheck=function(func,value){var index=this.checks.indexOf(func);value&&-1===index?this.checks.push(func):value||-1===index||this.checks.splice(index,1)},StateSystem.checkBlendMode=function(system,state){system.setBlendMode(state.blendMode)},StateSystem.checkPolygonOffset=function(system,state){system.setPolygonOffset(1,state.polygonOffset)},StateSystem.prototype.destroy=function(){this.gl=null},StateSystem}(),canvas_mesh_TextureGCSystem=function(){function TextureGCSystem(renderer){this.renderer=renderer,this.count=0,this.checkCount=0,this.maxIdle=settings.GC_MAX_IDLE,this.checkCountMax=settings.GC_MAX_CHECK_COUNT,this.mode=settings.GC_MODE}return TextureGCSystem.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==constants_GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},TextureGCSystem.prototype.run=function(){for(var tm=this.renderer.texture,managedTextures=tm.managedTextures,wasRemoved=!1,i=0;i<managedTextures.length;i++){var texture=managedTextures[i];!texture.framebuffer&&this.count-texture.touched>this.maxIdle&&(tm.destroyTexture(texture,!0),managedTextures[i]=null,wasRemoved=!0)}if(wasRemoved){var j=0;for(i=0;i<managedTextures.length;i++)null!==managedTextures[i]&&(managedTextures[j++]=managedTextures[i]);managedTextures.length=j}},TextureGCSystem.prototype.unload=function(displayObject){var tm=this.renderer.texture,texture=displayObject._texture;texture&&!texture.framebuffer&&tm.destroyTexture(texture);for(var i=displayObject.children.length-1;i>=0;i--)this.unload(displayObject.children[i])},TextureGCSystem.prototype.destroy=function(){this.renderer=null},TextureGCSystem}();var canvas_mesh_GLTexture=function(texture){this.texture=texture,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=constants_TYPES.UNSIGNED_BYTE,this.internalFormat=constants_FORMATS.RGBA,this.samplerType=0},canvas_mesh_TextureSystem=function(){function TextureSystem(renderer){this.renderer=renderer,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new canvas_mesh_BaseTexture,this.hasIntegerTextures=!1}return TextureSystem.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(gl){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,table;return"WebGL2RenderingContext"in self&&gl instanceof self.WebGL2RenderingContext?((_a={})[constants_TYPES.UNSIGNED_BYTE]=((_b={})[constants_FORMATS.RGBA]=gl.RGBA8,_b[constants_FORMATS.RGB]=gl.RGB8,_b[constants_FORMATS.RG]=gl.RG8,_b[constants_FORMATS.RED]=gl.R8,_b[constants_FORMATS.RGBA_INTEGER]=gl.RGBA8UI,_b[constants_FORMATS.RGB_INTEGER]=gl.RGB8UI,_b[constants_FORMATS.RG_INTEGER]=gl.RG8UI,_b[constants_FORMATS.RED_INTEGER]=gl.R8UI,_b[constants_FORMATS.ALPHA]=gl.ALPHA,_b[constants_FORMATS.LUMINANCE]=gl.LUMINANCE,_b[constants_FORMATS.LUMINANCE_ALPHA]=gl.LUMINANCE_ALPHA,_b),_a[constants_TYPES.BYTE]=((_c={})[constants_FORMATS.RGBA]=gl.RGBA8_SNORM,_c[constants_FORMATS.RGB]=gl.RGB8_SNORM,_c[constants_FORMATS.RG]=gl.RG8_SNORM,_c[constants_FORMATS.RED]=gl.R8_SNORM,_c[constants_FORMATS.RGBA_INTEGER]=gl.RGBA8I,_c[constants_FORMATS.RGB_INTEGER]=gl.RGB8I,_c[constants_FORMATS.RG_INTEGER]=gl.RG8I,_c[constants_FORMATS.RED_INTEGER]=gl.R8I,_c),_a[constants_TYPES.UNSIGNED_SHORT]=((_d={})[constants_FORMATS.RGBA_INTEGER]=gl.RGBA16UI,_d[constants_FORMATS.RGB_INTEGER]=gl.RGB16UI,_d[constants_FORMATS.RG_INTEGER]=gl.RG16UI,_d[constants_FORMATS.RED_INTEGER]=gl.R16UI,_d[constants_FORMATS.DEPTH_COMPONENT]=gl.DEPTH_COMPONENT16,_d),_a[constants_TYPES.SHORT]=((_e={})[constants_FORMATS.RGBA_INTEGER]=gl.RGBA16I,_e[constants_FORMATS.RGB_INTEGER]=gl.RGB16I,_e[constants_FORMATS.RG_INTEGER]=gl.RG16I,_e[constants_FORMATS.RED_INTEGER]=gl.R16I,_e),_a[constants_TYPES.UNSIGNED_INT]=((_f={})[constants_FORMATS.RGBA_INTEGER]=gl.RGBA32UI,_f[constants_FORMATS.RGB_INTEGER]=gl.RGB32UI,_f[constants_FORMATS.RG_INTEGER]=gl.RG32UI,_f[constants_FORMATS.RED_INTEGER]=gl.R32UI,_f[constants_FORMATS.DEPTH_COMPONENT]=gl.DEPTH_COMPONENT24,_f),_a[constants_TYPES.INT]=((_g={})[constants_FORMATS.RGBA_INTEGER]=gl.RGBA32I,_g[constants_FORMATS.RGB_INTEGER]=gl.RGB32I,_g[constants_FORMATS.RG_INTEGER]=gl.RG32I,_g[constants_FORMATS.RED_INTEGER]=gl.R32I,_g),_a[constants_TYPES.FLOAT]=((_h={})[constants_FORMATS.RGBA]=gl.RGBA32F,_h[constants_FORMATS.RGB]=gl.RGB32F,_h[constants_FORMATS.RG]=gl.RG32F,_h[constants_FORMATS.RED]=gl.R32F,_h[constants_FORMATS.DEPTH_COMPONENT]=gl.DEPTH_COMPONENT32F,_h),_a[constants_TYPES.HALF_FLOAT]=((_j={})[constants_FORMATS.RGBA]=gl.RGBA16F,_j[constants_FORMATS.RGB]=gl.RGB16F,_j[constants_FORMATS.RG]=gl.RG16F,_j[constants_FORMATS.RED]=gl.R16F,_j),_a[constants_TYPES.UNSIGNED_SHORT_5_6_5]=((_k={})[constants_FORMATS.RGB]=gl.RGB565,_k),_a[constants_TYPES.UNSIGNED_SHORT_4_4_4_4]=((_l={})[constants_FORMATS.RGBA]=gl.RGBA4,_l),_a[constants_TYPES.UNSIGNED_SHORT_5_5_5_1]=((_m={})[constants_FORMATS.RGBA]=gl.RGB5_A1,_m),_a[constants_TYPES.UNSIGNED_INT_2_10_10_10_REV]=((_o={})[constants_FORMATS.RGBA]=gl.RGB10_A2,_o[constants_FORMATS.RGBA_INTEGER]=gl.RGB10_A2UI,_o),_a[constants_TYPES.UNSIGNED_INT_10F_11F_11F_REV]=((_p={})[constants_FORMATS.RGB]=gl.R11F_G11F_B10F,_p),_a[constants_TYPES.UNSIGNED_INT_5_9_9_9_REV]=((_q={})[constants_FORMATS.RGB]=gl.RGB9_E5,_q),_a[constants_TYPES.UNSIGNED_INT_24_8]=((_r={})[constants_FORMATS.DEPTH_STENCIL]=gl.DEPTH24_STENCIL8,_r),_a[constants_TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]=((_s={})[constants_FORMATS.DEPTH_STENCIL]=gl.DEPTH32F_STENCIL8,_s),table=_a):((_t={})[constants_TYPES.UNSIGNED_BYTE]=((_u={})[constants_FORMATS.RGBA]=gl.RGBA,_u[constants_FORMATS.RGB]=gl.RGB,_u[constants_FORMATS.ALPHA]=gl.ALPHA,_u[constants_FORMATS.LUMINANCE]=gl.LUMINANCE,_u[constants_FORMATS.LUMINANCE_ALPHA]=gl.LUMINANCE_ALPHA,_u),_t[constants_TYPES.UNSIGNED_SHORT_5_6_5]=((_v={})[constants_FORMATS.RGB]=gl.RGB,_v),_t[constants_TYPES.UNSIGNED_SHORT_4_4_4_4]=((_w={})[constants_FORMATS.RGBA]=gl.RGBA,_w),_t[constants_TYPES.UNSIGNED_SHORT_5_5_5_1]=((_x={})[constants_FORMATS.RGBA]=gl.RGBA,_x),table=_t),table}(gl);var maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=maxTextures;for(var i=0;i<maxTextures;i++)this.boundTextures[i]=null;this.emptyTextures={};var emptyTexture2D=new canvas_mesh_GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_2D,emptyTexture2D.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[gl.TEXTURE_2D]=emptyTexture2D,this.emptyTextures[gl.TEXTURE_CUBE_MAP]=new canvas_mesh_GLTexture(gl.createTexture()),gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.emptyTextures[gl.TEXTURE_CUBE_MAP].texture);for(i=0;i<6;i++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR);for(i=0;i<this.boundTextures.length;i++)this.bind(null,i)},TextureSystem.prototype.bind=function(texture,location){void 0===location&&(location=0);var gl=this.gl;if((texture=null==texture?void 0:texture.castToBaseTexture())&&texture.valid&&!texture.parentTextureArray){texture.touched=this.renderer.textureGC.count;var glTexture=texture._glTextures[this.CONTEXT_UID]||this.initTexture(texture);this.boundTextures[location]!==texture&&(this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),gl.bindTexture(texture.target,glTexture.texture)),glTexture.dirtyId!==texture.dirtyId&&(this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),this.updateTexture(texture)),this.boundTextures[location]=texture}else this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[gl.TEXTURE_2D].texture),this.boundTextures[location]=null},TextureSystem.prototype.reset=function(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(var i=0;i<this.boundTextures.length;i++)this.boundTextures[i]=this.unknownTexture},TextureSystem.prototype.unbind=function(texture){var gl=this.gl,boundTextures=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var i=0;i<boundTextures.length;i++)boundTextures[i]===this.unknownTexture&&this.bind(null,i)}for(i=0;i<boundTextures.length;i++)boundTextures[i]===texture&&(this.currentLocation!==i&&(gl.activeTexture(gl.TEXTURE0+i),this.currentLocation=i),gl.bindTexture(texture.target,this.emptyTextures[texture.target].texture),boundTextures[i]=null)},TextureSystem.prototype.ensureSamplerType=function(maxTextures){var boundTextures=this.boundTextures,hasIntegerTextures=this.hasIntegerTextures,CONTEXT_UID=this.CONTEXT_UID;if(hasIntegerTextures)for(var i=maxTextures-1;i>=0;--i){var tex=boundTextures[i];if(tex)tex._glTextures[CONTEXT_UID].samplerType!==constants_SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(tex)}},TextureSystem.prototype.initTexture=function(texture){var glTexture=new canvas_mesh_GLTexture(this.gl.createTexture());return glTexture.dirtyId=-1,texture._glTextures[this.CONTEXT_UID]=glTexture,this.managedTextures.push(texture),texture.on("dispose",this.destroyTexture,this),glTexture},TextureSystem.prototype.initTextureType=function(texture,glTexture){var _a,_b;glTexture.internalFormat=null!==(_b=null===(_a=this.internalFormats[texture.type])||void 0===_a?void 0:_a[texture.format])&&void 0!==_b?_b:texture.format,2===this.webGLVersion&&texture.type===constants_TYPES.HALF_FLOAT?glTexture.type=this.gl.HALF_FLOAT:glTexture.type=texture.type},TextureSystem.prototype.updateTexture=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];if(glTexture){var renderer=this.renderer;if(this.initTextureType(texture,glTexture),texture.resource&&texture.resource.upload(renderer,texture,glTexture))glTexture.samplerType!==constants_SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var width=texture.realWidth,height=texture.realHeight,gl=renderer.gl;(glTexture.width!==width||glTexture.height!==height||glTexture.dirtyId<0)&&(glTexture.width=width,glTexture.height=height,gl.texImage2D(texture.target,0,glTexture.internalFormat,width,height,0,texture.format,glTexture.type,null))}texture.dirtyStyleId!==glTexture.dirtyStyleId&&this.updateTextureStyle(texture),glTexture.dirtyId=texture.dirtyId}},TextureSystem.prototype.destroyTexture=function(texture,skipRemove){var gl=this.gl;if((texture=texture.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(texture),gl.deleteTexture(texture._glTextures[this.CONTEXT_UID].texture),texture.off("dispose",this.destroyTexture,this),delete texture._glTextures[this.CONTEXT_UID],!skipRemove)){var i=this.managedTextures.indexOf(texture);-1!==i&&function(arr,startIdx,removeCount){var i,length=arr.length;if(!(startIdx>=length||0===removeCount)){var len=length-(removeCount=startIdx+removeCount>length?length-startIdx:removeCount);for(i=startIdx;i<len;++i)arr[i]=arr[i+removeCount];arr.length=len}}(this.managedTextures,i,1)}},TextureSystem.prototype.updateTextureStyle=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];glTexture&&(texture.mipmap!==constants_MIPMAP_MODES.POW2&&2===this.webGLVersion||texture.isPowerOfTwo?glTexture.mipmap=texture.mipmap>=1:glTexture.mipmap=!1,2===this.webGLVersion||texture.isPowerOfTwo?glTexture.wrapMode=texture.wrapMode:glTexture.wrapMode=constants_WRAP_MODES.CLAMP,texture.resource&&texture.resource.style(this.renderer,texture,glTexture)||this.setStyle(texture,glTexture),glTexture.dirtyStyleId=texture.dirtyStyleId)},TextureSystem.prototype.setStyle=function(texture,glTexture){var gl=this.gl;if(glTexture.mipmap&&texture.mipmap!==constants_MIPMAP_MODES.ON_MANUAL&&gl.generateMipmap(texture.target),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_S,glTexture.wrapMode),gl.texParameteri(texture.target,gl.TEXTURE_WRAP_T,glTexture.wrapMode),glTexture.mipmap){gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===constants_SCALE_MODES.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST);var anisotropicExt=this.renderer.context.extensions.anisotropicFiltering;if(anisotropicExt&&texture.anisotropicLevel>0&&texture.scaleMode===constants_SCALE_MODES.LINEAR){var level=Math.min(texture.anisotropicLevel,gl.getParameter(anisotropicExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT));gl.texParameterf(texture.target,anisotropicExt.TEXTURE_MAX_ANISOTROPY_EXT,level)}}else gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===constants_SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);gl.texParameteri(texture.target,gl.TEXTURE_MAG_FILTER,texture.scaleMode===constants_SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST)},TextureSystem.prototype.destroy=function(){this.renderer=null},TextureSystem}(),canvas_mesh_systems={__proto__:null,FilterSystem:canvas_mesh_FilterSystem,BatchSystem:canvas_mesh_BatchSystem,ContextSystem:canvas_mesh_ContextSystem,FramebufferSystem:canvas_mesh_FramebufferSystem,GeometrySystem:canvas_mesh_GeometrySystem,MaskSystem:canvas_mesh_MaskSystem,ScissorSystem:canvas_mesh_ScissorSystem,StencilSystem:canvas_mesh_StencilSystem,ProjectionSystem:canvas_mesh_ProjectionSystem,RenderTextureSystem:canvas_mesh_RenderTextureSystem,ShaderSystem:canvas_mesh_ShaderSystem,StateSystem:canvas_mesh_StateSystem,TextureGCSystem:canvas_mesh_TextureGCSystem,TextureSystem:canvas_mesh_TextureSystem},canvas_mesh_tempMatrix$1=new canvas_mesh_Matrix,canvas_mesh_AbstractRenderer=function(_super){function AbstractRenderer(type,options){void 0===type&&(type=constants_RENDERER_TYPE.UNKNOWN);var _this=_super.call(this)||this;return options=Object.assign({},settings.RENDER_OPTIONS,options),_this.options=options,_this.type=type,_this.screen=new canvas_mesh_Rectangle(0,0,options.width,options.height),_this.view=options.view||document.createElement("canvas"),_this.resolution=options.resolution||settings.RESOLUTION,_this.useContextAlpha=options.useContextAlpha,_this.autoDensity=!!options.autoDensity,_this.preserveDrawingBuffer=options.preserveDrawingBuffer,_this.clearBeforeRender=options.clearBeforeRender,_this._backgroundColor=0,_this._backgroundColorRgba=[0,0,0,1],_this._backgroundColorString="#000000",_this.backgroundColor=options.backgroundColor||_this._backgroundColor,_this.backgroundAlpha=options.backgroundAlpha,void 0!==options.transparent&&(canvas_mesh_deprecation("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),_this.useContextAlpha=options.transparent,_this.backgroundAlpha=options.transparent?0:1),_this._lastObjectRendered=null,_this.plugins={},_this}return canvas_mesh_extends(AbstractRenderer,_super),AbstractRenderer.prototype.initPlugins=function(staticMap){for(var o in staticMap)this.plugins[o]=new staticMap[o](this)},Object.defineProperty(AbstractRenderer.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(AbstractRenderer.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),AbstractRenderer.prototype.resize=function(desiredScreenWidth,desiredScreenHeight){this.view.width=Math.round(desiredScreenWidth*this.resolution),this.view.height=Math.round(desiredScreenHeight*this.resolution);var screenWidth=this.view.width/this.resolution,screenHeight=this.view.height/this.resolution;this.screen.width=screenWidth,this.screen.height=screenHeight,this.autoDensity&&(this.view.style.width=screenWidth+"px",this.view.style.height=screenHeight+"px"),this.emit("resize",screenWidth,screenHeight)},AbstractRenderer.prototype.generateTexture=function(displayObject,options,resolution,region){void 0===options&&(options={}),"number"==typeof options&&(canvas_mesh_deprecation("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),options={scaleMode:options,resolution,region});var manualRegion=options.region,textureOptions=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&(t[p[i]]=s[p[i]])}return t}(options,["region"]);0===(region=manualRegion||displayObject.getLocalBounds(null,!0)).width&&(region.width=1),0===region.height&&(region.height=1);var renderTexture=canvas_mesh_RenderTexture.create(canvas_mesh_assign({width:region.width,height:region.height},textureOptions));return canvas_mesh_tempMatrix$1.tx=-region.x,canvas_mesh_tempMatrix$1.ty=-region.y,this.render(displayObject,{renderTexture,clear:!1,transform:canvas_mesh_tempMatrix$1,skipUpdateTransform:!!displayObject.parent}),renderTexture},AbstractRenderer.prototype.destroy=function(removeView){for(var o in this.plugins)this.plugins[o].destroy(),this.plugins[o]=null;removeView&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);this.plugins=null,this.type=constants_RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this._tempDisplayObjectParent=null,this.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(AbstractRenderer.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(value){var hexString;this._backgroundColor=value,this._backgroundColorString=(hexString=value.toString(16),"#"+("000000".substr(0,6-hexString.length)+hexString)),function(hex,out){void 0===out&&(out=[]),out[0]=(hex>>16&255)/255,out[1]=(hex>>8&255)/255,out[2]=(255&hex)/255}(value,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Object.defineProperty(AbstractRenderer.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(value){this._backgroundColorRgba[3]=value},enumerable:!1,configurable:!0}),AbstractRenderer}(canvas_mesh_eventemitter3),canvas_mesh_GLBuffer=function(buffer){this.buffer=buffer||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},canvas_mesh_BufferSystem=function(){function BufferSystem(renderer){this.renderer=renderer,this.managedBuffers={},this.boundBufferBases={}}return BufferSystem.prototype.destroy=function(){this.renderer=null},BufferSystem.prototype.contextChange=function(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID},BufferSystem.prototype.bind=function(buffer){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);gl.bindBuffer(buffer.type,glBuffer.buffer)},BufferSystem.prototype.bindBufferBase=function(buffer,index){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;if(this.boundBufferBases[index]!==buffer){var glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);this.boundBufferBases[index]=buffer,gl.bindBufferBase(gl.UNIFORM_BUFFER,index,glBuffer.buffer)}},BufferSystem.prototype.bindBufferRange=function(buffer,index,offset){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;offset=offset||0;var glBuffer=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer);gl.bindBufferRange(gl.UNIFORM_BUFFER,index||0,glBuffer.buffer,256*offset,256)},BufferSystem.prototype.update=function(buffer){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,glBuffer=buffer._glBuffers[CONTEXT_UID];if(buffer._updateID!==glBuffer.updateID)if(glBuffer.updateID=buffer._updateID,gl.bindBuffer(buffer.type,glBuffer.buffer),glBuffer.byteLength>=buffer.data.byteLength)gl.bufferSubData(buffer.type,0,buffer.data);else{var drawType=buffer.static?gl.STATIC_DRAW:gl.DYNAMIC_DRAW;glBuffer.byteLength=buffer.data.byteLength,gl.bufferData(buffer.type,buffer.data,drawType)}},BufferSystem.prototype.dispose=function(buffer,contextLost){if(this.managedBuffers[buffer.id]){delete this.managedBuffers[buffer.id];var glBuffer=buffer._glBuffers[this.CONTEXT_UID],gl=this.gl;buffer.disposeRunner.remove(this),glBuffer&&(contextLost||gl.deleteBuffer(glBuffer.buffer),delete buffer._glBuffers[this.CONTEXT_UID])}},BufferSystem.prototype.disposeAll=function(contextLost){for(var all=Object.keys(this.managedBuffers),i=0;i<all.length;i++)this.dispose(this.managedBuffers[all[i]],contextLost)},BufferSystem.prototype.createGLBuffer=function(buffer){var CONTEXT_UID=this.CONTEXT_UID,gl=this.gl;return buffer._glBuffers[CONTEXT_UID]=new canvas_mesh_GLBuffer(gl.createBuffer()),this.managedBuffers[buffer.id]=buffer,buffer.disposeRunner.add(this),buffer._glBuffers[CONTEXT_UID]},BufferSystem}(),canvas_mesh_BatchDrawCall=(function(_super){function Renderer(options){var _this=_super.call(this,constants_RENDERER_TYPE.WEBGL,options)||this;return options=_this.options,_this.gl=null,_this.CONTEXT_UID=0,_this.runners={destroy:new canvas_mesh_Runner("destroy"),contextChange:new canvas_mesh_Runner("contextChange"),reset:new canvas_mesh_Runner("reset"),update:new canvas_mesh_Runner("update"),postrender:new canvas_mesh_Runner("postrender"),prerender:new canvas_mesh_Runner("prerender"),resize:new canvas_mesh_Runner("resize")},_this.runners.contextChange.add(_this),_this.globalUniforms=new canvas_mesh_UniformGroup({projectionMatrix:new canvas_mesh_Matrix},!0),_this.addSystem(canvas_mesh_MaskSystem,"mask").addSystem(canvas_mesh_ContextSystem,"context").addSystem(canvas_mesh_StateSystem,"state").addSystem(canvas_mesh_ShaderSystem,"shader").addSystem(canvas_mesh_TextureSystem,"texture").addSystem(canvas_mesh_BufferSystem,"buffer").addSystem(canvas_mesh_GeometrySystem,"geometry").addSystem(canvas_mesh_FramebufferSystem,"framebuffer").addSystem(canvas_mesh_ScissorSystem,"scissor").addSystem(canvas_mesh_StencilSystem,"stencil").addSystem(canvas_mesh_ProjectionSystem,"projection").addSystem(canvas_mesh_TextureGCSystem,"textureGC").addSystem(canvas_mesh_FilterSystem,"filter").addSystem(canvas_mesh_RenderTextureSystem,"renderTexture").addSystem(canvas_mesh_BatchSystem,"batch"),_this.initPlugins(Renderer.__plugins),_this.multisample=void 0,options.context?_this.context.initFromContext(options.context):_this.context.initFromOptions({alpha:!!_this.useContextAlpha,antialias:options.antialias,premultipliedAlpha:_this.useContextAlpha&&"notMultiplied"!==_this.useContextAlpha,stencil:!0,preserveDrawingBuffer:options.preserveDrawingBuffer,powerPreference:_this.options.powerPreference}),_this.renderingToScreen=!0,function(type){var _a;if(!canvas_mesh_saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["\n %c %c %c PixiJS 6.1.2 - ✰ "+type+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(_a=self.console).log.apply(_a,args)}else self.console&&self.console.log("PixiJS 6.1.2 - "+type+" - http://www.pixijs.com/");canvas_mesh_saidHello=!0}}(2===_this.context.webGLVersion?"WebGL 2":"WebGL 1"),_this.resize(_this.options.width,_this.options.height),_this}canvas_mesh_extends(Renderer,_super),Renderer.create=function(options){if(void 0===canvas_mesh_supported&&(canvas_mesh_supported=function(){var contextOptions={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!self.WebGLRenderingContext)return!1;var canvas=document.createElement("canvas"),gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions),success=!(!gl||!gl.getContextAttributes().stencil);if(gl){var loseContext=gl.getExtension("WEBGL_lose_context");loseContext&&loseContext.loseContext()}return gl=null,success}catch(e){return!1}}()),canvas_mesh_supported)return new Renderer(options);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},Renderer.prototype.contextChange=function(){var samples,gl=this.gl;if(1===this.context.webGLVersion){var framebuffer=gl.getParameter(gl.FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.FRAMEBUFFER,null),samples=gl.getParameter(gl.SAMPLES),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)}else{framebuffer=gl.getParameter(gl.DRAW_FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null),samples=gl.getParameter(gl.SAMPLES),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,framebuffer)}samples>=constants_MSAA_QUALITY.HIGH?this.multisample=constants_MSAA_QUALITY.HIGH:samples>=constants_MSAA_QUALITY.MEDIUM?this.multisample=constants_MSAA_QUALITY.MEDIUM:samples>=constants_MSAA_QUALITY.LOW?this.multisample=constants_MSAA_QUALITY.LOW:this.multisample=constants_MSAA_QUALITY.NONE},Renderer.prototype.addSystem=function(ClassRef,name){var system=new ClassRef(this);if(this[name])throw new Error('Whoops! The name "'+name+'" is already in use');for(var i in this[name]=system,this.runners)this.runners[i].add(system);return this},Renderer.prototype.render=function(displayObject,options){var renderTexture,clear,transform,skipUpdateTransform;if(options&&(options instanceof canvas_mesh_RenderTexture?(canvas_mesh_deprecation("6.0.0","Renderer#render arguments changed, use options instead."),renderTexture=options,clear=arguments[2],transform=arguments[3],skipUpdateTransform=arguments[4]):(renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform)),this.renderingToScreen=!renderTexture,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=transform,!this.context.isLost){if(renderTexture||(this._lastObjectRendered=displayObject),!skipUpdateTransform){var cacheParent=displayObject.enableTempParent();displayObject.updateTransform(),displayObject.disableTempParent(cacheParent)}this.renderTexture.bind(renderTexture),this.batch.currentRenderer.start(),(void 0!==clear?clear:this.clearBeforeRender)&&this.renderTexture.clear(),displayObject.render(this),this.batch.currentRenderer.flush(),renderTexture&&renderTexture.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},Renderer.prototype.generateTexture=function(displayObject,options,resolution,region){void 0===options&&(options={});var renderTexture=_super.prototype.generateTexture.call(this,displayObject,options,resolution,region);return this.framebuffer.blit(),renderTexture},Renderer.prototype.resize=function(desiredScreenWidth,desiredScreenHeight){_super.prototype.resize.call(this,desiredScreenWidth,desiredScreenHeight),this.runners.resize.emit(this.screen.height,this.screen.width)},Renderer.prototype.reset=function(){return this.runners.reset.emit(),this},Renderer.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},Renderer.prototype.destroy=function(removeView){for(var r in this.runners.destroy.emit(),this.runners)this.runners[r].destroy();_super.prototype.destroy.call(this,removeView),this.gl=null},Object.defineProperty(Renderer.prototype,"extract",{get:function(){return canvas_mesh_deprecation("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead."),this.plugins.extract},enumerable:!1,configurable:!0}),Renderer.registerPlugin=function(pluginName,ctor){Renderer.__plugins=Renderer.__plugins||{},Renderer.__plugins[pluginName]=ctor}}(canvas_mesh_AbstractRenderer),function(){this.texArray=null,this.blend=0,this.type=constants_DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}),canvas_mesh_BatchTextureArray=function(){function BatchTextureArray(){this.elements=[],this.ids=[],this.count=0}return BatchTextureArray.prototype.clear=function(){for(var i=0;i<this.count;i++)this.elements[i]=null;this.count=0},BatchTextureArray}(),canvas_mesh_ViewableBuffer=function(){function ViewableBuffer(sizeOrBuffer){"number"==typeof sizeOrBuffer?this.rawBinaryData=new ArrayBuffer(sizeOrBuffer):sizeOrBuffer instanceof Uint8Array?this.rawBinaryData=sizeOrBuffer.buffer:this.rawBinaryData=sizeOrBuffer,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(ViewableBuffer.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(ViewableBuffer.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),ViewableBuffer.prototype.view=function(type){return this[type+"View"]},ViewableBuffer.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},ViewableBuffer.sizeOf=function(type){switch(type){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(type+" isn't a valid view type")}},ViewableBuffer}(),canvas_mesh_AbstractBatchRenderer=function(_super){function AbstractBatchRenderer(renderer){var _this=_super.call(this,renderer)||this;return _this.shaderGenerator=null,_this.geometryClass=null,_this.vertexSize=null,_this.state=canvas_mesh_State.for2d(),_this.size=4*settings.SPRITE_BATCH_SIZE,_this._vertexCount=0,_this._indexCount=0,_this._bufferedElements=[],_this._bufferedTextures=[],_this._bufferSize=0,_this._shader=null,_this._packedGeometries=[],_this._packedGeometryPoolSize=2,_this._flushId=0,_this._aBuffers={},_this._iBuffers={},_this.MAX_TEXTURES=1,_this.renderer.on("prerender",_this.onPrerender,_this),renderer.runners.contextChange.add(_this),_this._dcIndex=0,_this._aIndex=0,_this._iIndex=0,_this._attributeBuffer=null,_this._indexBuffer=null,_this._tempBoundTextures=[],_this}return canvas_mesh_extends(AbstractBatchRenderer,_super),AbstractBatchRenderer.prototype.contextChange=function(){var gl=this.renderer.gl;settings.PREFER_ENV===constants_ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=function(maxIfs,gl){if(0===maxIfs)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var shader=gl.createShader(gl.FRAGMENT_SHADER);;){var fragmentSrc=canvas_mesh_fragTemplate.replace(/%forloop%/gi,canvas_mesh_generateIfTestSrc(maxIfs));if(gl.shaderSource(shader,fragmentSrc),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS))break;maxIfs=maxIfs/2|0}return maxIfs}(this.MAX_TEXTURES,gl)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]=new this.geometryClass;this.initFlushBuffers()},AbstractBatchRenderer.prototype.initFlushBuffers=function(){for(var _drawCallPool=AbstractBatchRenderer._drawCallPool,_textureArrayPool=AbstractBatchRenderer._textureArrayPool,MAX_SPRITES=this.size/4,MAX_TA=Math.floor(MAX_SPRITES/this.MAX_TEXTURES)+1;_drawCallPool.length<MAX_SPRITES;)_drawCallPool.push(new canvas_mesh_BatchDrawCall);for(;_textureArrayPool.length<MAX_TA;)_textureArrayPool.push(new canvas_mesh_BatchTextureArray);for(var i=0;i<this.MAX_TEXTURES;i++)this._tempBoundTextures[i]=null},AbstractBatchRenderer.prototype.onPrerender=function(){this._flushId=0},AbstractBatchRenderer.prototype.render=function(element){element._texture.valid&&(this._vertexCount+element.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=element.vertexData.length/2,this._indexCount+=element.indices.length,this._bufferedTextures[this._bufferSize]=element._texture.baseTexture,this._bufferedElements[this._bufferSize++]=element)},AbstractBatchRenderer.prototype.buildTexturesAndDrawCalls=function(){var textures=this._bufferedTextures,MAX_TEXTURES=this.MAX_TEXTURES,textureArrays=AbstractBatchRenderer._textureArrayPool,batch=this.renderer.batch,boundTextures=this._tempBoundTextures,touch=this.renderer.textureGC.count,TICK=++canvas_mesh_BaseTexture._globalBatch,countTexArrays=0,texArray=textureArrays[0],start=0;batch.copyBoundTextures(boundTextures,MAX_TEXTURES);for(var i=0;i<this._bufferSize;++i){var tex=textures[i];textures[i]=null,tex._batchEnabled!==TICK&&(texArray.count>=MAX_TEXTURES&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start,i),start=i,texArray=textureArrays[++countTexArrays],++TICK),tex._batchEnabled=TICK,tex.touched=touch,texArray.elements[texArray.count++]=tex)}texArray.count>0&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start,this._bufferSize),++countTexArrays,++TICK);for(i=0;i<boundTextures.length;i++)boundTextures[i]=null;canvas_mesh_BaseTexture._globalBatch=TICK},AbstractBatchRenderer.prototype.buildDrawCalls=function(texArray,start,finish){var elements=this._bufferedElements,_attributeBuffer=this._attributeBuffer,_indexBuffer=this._indexBuffer,vertexSize=this.vertexSize,drawCalls=AbstractBatchRenderer._drawCallPool,dcIndex=this._dcIndex,aIndex=this._aIndex,iIndex=this._iIndex,drawCall=drawCalls[dcIndex];drawCall.start=this._iIndex,drawCall.texArray=texArray;for(var i=start;i<finish;++i){var sprite=elements[i],tex=sprite._texture.baseTexture,spriteBlendMode=canvas_mesh_premultiplyBlendMode[tex.alphaMode?1:0][sprite.blendMode];elements[i]=null,start<i&&drawCall.blend!==spriteBlendMode&&(drawCall.size=iIndex-drawCall.start,start=i,(drawCall=drawCalls[++dcIndex]).texArray=texArray,drawCall.start=iIndex),this.packInterleavedGeometry(sprite,_attributeBuffer,_indexBuffer,aIndex,iIndex),aIndex+=sprite.vertexData.length/2*vertexSize,iIndex+=sprite.indices.length,drawCall.blend=spriteBlendMode}start<finish&&(drawCall.size=iIndex-drawCall.start,++dcIndex),this._dcIndex=dcIndex,this._aIndex=aIndex,this._iIndex=iIndex},AbstractBatchRenderer.prototype.bindAndClearTexArray=function(texArray){for(var textureSystem=this.renderer.texture,j=0;j<texArray.count;j++)textureSystem.bind(texArray.elements[j],texArray.ids[j]),texArray.elements[j]=null;texArray.count=0},AbstractBatchRenderer.prototype.updateGeometry=function(){var packedGeometries=this._packedGeometries,attributeBuffer=this._attributeBuffer,indexBuffer=this._indexBuffer;settings.CAN_UPLOAD_SAME_BUFFER?(packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,packedGeometries[this._flushId]=new this.geometryClass),packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.bind(packedGeometries[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},AbstractBatchRenderer.prototype.drawBatches=function(){for(var dcCount=this._dcIndex,_a=this.renderer,gl=_a.gl,stateSystem=_a.state,drawCalls=AbstractBatchRenderer._drawCallPool,curTexArray=null,i=0;i<dcCount;i++){var _b=drawCalls[i],texArray=_b.texArray,type=_b.type,size=_b.size,start=_b.start,blend=_b.blend;curTexArray!==texArray&&(curTexArray=texArray,this.bindAndClearTexArray(texArray)),this.state.blendMode=blend,stateSystem.set(this.state),gl.drawElements(type,size,gl.UNSIGNED_SHORT,2*start)}},AbstractBatchRenderer.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},AbstractBatchRenderer.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},AbstractBatchRenderer.prototype.stop=function(){this.flush()},AbstractBatchRenderer.prototype.destroy=function(){for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),_super.prototype.destroy.call(this)},AbstractBatchRenderer.prototype.getAttributeBuffer=function(size){var roundedP2=canvas_mesh_nextPow2(Math.ceil(size/8)),roundedSizeIndex=canvas_mesh_log2(roundedP2),roundedSize=8*roundedP2;this._aBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._aBuffers[roundedSize];return buffer||(this._aBuffers[roundedSize]=buffer=new canvas_mesh_ViewableBuffer(roundedSize*this.vertexSize*4)),buffer},AbstractBatchRenderer.prototype.getIndexBuffer=function(size){var roundedP2=canvas_mesh_nextPow2(Math.ceil(size/12)),roundedSizeIndex=canvas_mesh_log2(roundedP2),roundedSize=12*roundedP2;this._iBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._iBuffers[roundedSizeIndex];return buffer||(this._iBuffers[roundedSizeIndex]=buffer=new Uint16Array(roundedSize)),buffer},AbstractBatchRenderer.prototype.packInterleavedGeometry=function(element,attributeBuffer,indexBuffer,aIndex,iIndex){for(var uint32View=attributeBuffer.uint32View,float32View=attributeBuffer.float32View,packedVertices=aIndex/this.vertexSize,uvs=element.uvs,indicies=element.indices,vertexData=element.vertexData,textureId=element._texture.baseTexture._batchLocation,alpha=Math.min(element.worldAlpha,1),argb=alpha<1&&element._texture.baseTexture.alphaMode?function(tint,alpha){if(1===alpha)return(255*alpha<<24)+tint;if(0===alpha)return 0;var R=tint>>16&255,G=tint>>8&255,B=255&tint;return(255*alpha<<24)+((R=R*alpha+.5|0)<<16)+((G=G*alpha+.5|0)<<8)+(B*alpha+.5|0)}(element._tintRGB,alpha):element._tintRGB+(255*alpha<<24),i=0;i<vertexData.length;i+=2)float32View[aIndex++]=vertexData[i],float32View[aIndex++]=vertexData[i+1],float32View[aIndex++]=uvs[i],float32View[aIndex++]=uvs[i+1],uint32View[aIndex++]=argb,float32View[aIndex++]=textureId;for(i=0;i<indicies.length;i++)indexBuffer[iIndex++]=packedVertices+indicies[i]},AbstractBatchRenderer._drawCallPool=[],AbstractBatchRenderer._textureArrayPool=[],AbstractBatchRenderer}(canvas_mesh_ObjectRenderer),canvas_mesh_BatchShaderGenerator=function(){function BatchShaderGenerator(vertexSrc,fragTemplate){if(this.vertexSrc=vertexSrc,this.fragTemplate=fragTemplate,this.programCache={},this.defaultGroupCache={},fragTemplate.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(fragTemplate.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return BatchShaderGenerator.prototype.generateShader=function(maxTextures){if(!this.programCache[maxTextures]){for(var sampleValues=new Int32Array(maxTextures),i=0;i<maxTextures;i++)sampleValues[i]=i;this.defaultGroupCache[maxTextures]=canvas_mesh_UniformGroup.from({uSamplers:sampleValues},!0);var fragmentSrc=this.fragTemplate;fragmentSrc=(fragmentSrc=fragmentSrc.replace(/%count%/gi,""+maxTextures)).replace(/%forloop%/gi,this.generateSampleSrc(maxTextures)),this.programCache[maxTextures]=new canvas_mesh_Program(this.vertexSrc,fragmentSrc)}var uniforms={tint:new Float32Array([1,1,1,1]),translationMatrix:new canvas_mesh_Matrix,default:this.defaultGroupCache[maxTextures]};return new canvas_mesh_Shader(this.programCache[maxTextures],uniforms)},BatchShaderGenerator.prototype.generateSampleSrc=function(maxTextures){var src="";src+="\n",src+="\n";for(var i=0;i<maxTextures;i++)i>0&&(src+="\nelse "),i<maxTextures-1&&(src+="if(vTextureId < "+i+".5)"),src+="\n{",src+="\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);",src+="\n}";return src+="\n",src+="\n"},BatchShaderGenerator}(),canvas_mesh_BatchGeometry=function(_super){function BatchGeometry(_static){void 0===_static&&(_static=!1);var _this=_super.call(this)||this;return _this._buffer=new canvas_mesh_Buffer(null,_static,!1),_this._indexBuffer=new canvas_mesh_Buffer(null,_static,!0),_this.addAttribute("aVertexPosition",_this._buffer,2,!1,constants_TYPES.FLOAT).addAttribute("aTextureCoord",_this._buffer,2,!1,constants_TYPES.FLOAT).addAttribute("aColor",_this._buffer,4,!0,constants_TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",_this._buffer,1,!0,constants_TYPES.FLOAT).addIndex(_this._indexBuffer),_this}return canvas_mesh_extends(BatchGeometry,_super),BatchGeometry}(canvas_mesh_Geometry),canvas_mesh_defaultVertex$3="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",canvas_mesh_defaultFragment$2="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",canvas_mesh_BatchPluginFactory=function(){function BatchPluginFactory(){}return BatchPluginFactory.create=function(options){var _a=Object.assign({vertex:canvas_mesh_defaultVertex$3,fragment:canvas_mesh_defaultFragment$2,geometryClass:canvas_mesh_BatchGeometry,vertexSize:6},options),vertex=_a.vertex,fragment=_a.fragment,vertexSize=_a.vertexSize,geometryClass=_a.geometryClass;return function(_super){function BatchPlugin(renderer){var _this=_super.call(this,renderer)||this;return _this.shaderGenerator=new canvas_mesh_BatchShaderGenerator(vertex,fragment),_this.geometryClass=geometryClass,_this.vertexSize=vertexSize,_this}return canvas_mesh_extends(BatchPlugin,_super),BatchPlugin}(canvas_mesh_AbstractBatchRenderer)},Object.defineProperty(BatchPluginFactory,"defaultVertexSrc",{get:function(){return canvas_mesh_defaultVertex$3},enumerable:!1,configurable:!0}),Object.defineProperty(BatchPluginFactory,"defaultFragmentTemplate",{get:function(){return canvas_mesh_defaultFragment$2},enumerable:!1,configurable:!0}),BatchPluginFactory}(),esm_canvas_mesh_resources=(canvas_mesh_BatchPluginFactory.create(),{}),canvas_mesh_loop_1=function(name){Object.defineProperty(esm_canvas_mesh_resources,name,{get:function(){return canvas_mesh_deprecation("6.0.0","PIXI.systems."+name+" has moved to PIXI."+name),canvas_mesh_resources[name]}})};for(var canvas_mesh_name in canvas_mesh_resources)canvas_mesh_loop_1(canvas_mesh_name);var esm_canvas_mesh_systems={},canvas_mesh_loop_2=function(name){Object.defineProperty(esm_canvas_mesh_systems,name,{get:function(){return canvas_mesh_deprecation("6.0.0","PIXI.resources."+name+" has moved to PIXI."+name),canvas_mesh_systems[name]}})};for(var canvas_mesh_name in canvas_mesh_systems)canvas_mesh_loop_2(canvas_mesh_name);var CanvasMeshRenderer=function(){function CanvasMeshRenderer(renderer){this.renderer=renderer}return CanvasMeshRenderer.prototype.render=function(mesh){var renderer=this.renderer,transform=mesh.worldTransform;renderer.context.globalAlpha=mesh.worldAlpha,renderer.setBlendMode(mesh.blendMode),renderer.setContextTransform(transform,mesh.roundPixels),mesh.drawMode!==constants_DRAW_MODES.TRIANGLES?this._renderTriangleMesh(mesh):this._renderTriangles(mesh)},CanvasMeshRenderer.prototype._renderTriangleMesh=function(mesh){for(var length=mesh.geometry.buffers[0].data.length,i=0;i<length-2;i++){var index=2*i;this._renderDrawTriangle(mesh,index,index+2,index+4)}},CanvasMeshRenderer.prototype._renderTriangles=function(mesh){for(var indices=mesh.geometry.getIndex().data,length=indices.length,i=0;i<length;i+=3){var index0=2*indices[i],index1=2*indices[i+1],index2=2*indices[i+2];this._renderDrawTriangle(mesh,index0,index1,index2)}},CanvasMeshRenderer.prototype._renderDrawTriangle=function(mesh,index0,index1,index2){var context=this.renderer.context,vertices=mesh.geometry.buffers[0].data,uvs=mesh.uvs,texture=mesh.texture;if(texture.valid){var isTinted=16777215!==mesh.tint,base=texture.baseTexture,textureWidth=base.width,textureHeight=base.height;isTinted&&mesh._cachedTint!==mesh.tint&&(mesh._cachedTint=mesh.tint,mesh._cachedTexture=mesh._cachedTexture||new canvas_mesh_Texture(base),mesh._tintedCanvas=canvasUtils.getTintedCanvas({texture:mesh._cachedTexture},mesh.tint));var textureSource=isTinted?mesh._tintedCanvas:base.getDrawableSource(),u0=uvs[index0]*base.width,u1=uvs[index1]*base.width,u2=uvs[index2]*base.width,v0=uvs[index0+1]*base.height,v1=uvs[index1+1]*base.height,v2=uvs[index2+1]*base.height,x0=vertices[index0],x1=vertices[index1],x2=vertices[index2],y0=vertices[index0+1],y1=vertices[index1+1],y2=vertices[index2+1],screenPadding=mesh.canvasPadding/this.renderer.resolution;if(screenPadding>0){var _a=mesh.worldTransform,a=_a.a,b=_a.b,c=_a.c,d=_a.d,centerX=(x0+x1+x2)/3,centerY=(y0+y1+y2)/3,normX=x0-centerX,normY=y0-centerY,screenX=a*normX+c*normY,screenY=b*normX+d*normY,screenDist=Math.sqrt(screenX*screenX+screenY*screenY),paddingFactor=1+screenPadding/screenDist;x0=centerX+normX*paddingFactor,y0=centerY+normY*paddingFactor,screenX=a*(normX=x1-centerX)+c*(normY=y1-centerY),screenY=b*normX+d*normY,x1=centerX+normX*(paddingFactor=1+screenPadding/(screenDist=Math.sqrt(screenX*screenX+screenY*screenY))),y1=centerY+normY*paddingFactor,screenX=a*(normX=x2-centerX)+c*(normY=y2-centerY),screenY=b*normX+d*normY,x2=centerX+normX*(paddingFactor=1+screenPadding/(screenDist=Math.sqrt(screenX*screenX+screenY*screenY))),y2=centerY+normY*paddingFactor}context.save(),context.beginPath(),context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2),context.closePath(),context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2,deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2,deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2,deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2,deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2,deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2,deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta),context.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight),context.restore(),this.renderer.invalidateBlendMode()}},CanvasMeshRenderer.prototype.renderMeshFlat=function(mesh){var context=this.renderer.context,vertices=mesh.geometry.getBuffer("aVertexPosition").data,length=vertices.length/2;context.beginPath();for(var i=1;i<length-2;++i){var index=2*i,x0=vertices[index],y0=vertices[index+1],x1=vertices[index+2],y1=vertices[index+3],x2=vertices[index+4],y2=vertices[index+5];context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2)}context.fillStyle="#FF0000",context.fill(),context.closePath()},CanvasMeshRenderer.prototype.destroy=function(){this.renderer=null},CanvasMeshRenderer}();settings.MESH_CANVAS_PADDING=0,MeshMaterial.prototype._renderCanvas=function(renderer,mesh){renderer.plugins.mesh.render(mesh)},NineSlicePlane.prototype._cachedTint=16777215,NineSlicePlane.prototype._tintedCanvas=null,NineSlicePlane.prototype._canvasUvs=null,NineSlicePlane.prototype._renderCanvas=function(renderer){var context=renderer.context,transform=this.worldTransform,isTinted=16777215!==this.tint,texture=this.texture;if(texture.valid){isTinted&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=canvasUtils.getTintedCanvas(this,this.tint));var textureSource=isTinted?this._tintedCanvas:texture.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var vertices=this.vertices,uvs=this._canvasUvs,u0=isTinted?0:texture.frame.x,v0=isTinted?0:texture.frame.y,u1=u0+texture.frame.width,v1=v0+texture.frame.height;uvs[0]=u0,uvs[1]=u0+this._leftWidth,uvs[2]=u1-this._rightWidth,uvs[3]=u1,uvs[4]=v0,uvs[5]=v0+this._topHeight,uvs[6]=v1-this._bottomHeight,uvs[7]=v1;for(var i=0;i<8;i++)uvs[i]*=texture.baseTexture.resolution;context.globalAlpha=this.worldAlpha,renderer.setBlendMode(this.blendMode),renderer.setContextTransform(transform,this.roundPixels);for(var row=0;row<3;row++)for(var col=0;col<3;col++){var ind=2*col+8*row,sw=Math.max(1,uvs[col+1]-uvs[col]),sh=Math.max(1,uvs[row+5]-uvs[row+4]),dw=Math.max(1,vertices[ind+10]-vertices[ind]),dh=Math.max(1,vertices[ind+11]-vertices[ind+1]);context.drawImage(textureSource,uvs[col],uvs[row+4],sw,sh,vertices[ind],vertices[ind+1],dw,dh)}}};var warned=!1;Mesh.prototype._cachedTint=16777215,Mesh.prototype._tintedCanvas=null,Mesh.prototype._cachedTexture=null,Mesh.prototype._renderCanvas=function(renderer){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(renderer,this):warned||(warned=!0,self.console&&console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))},Mesh.prototype._canvasPadding=null,Object.defineProperty(Mesh.prototype,"canvasPadding",{get:function(){return null!==this._canvasPadding?this._canvasPadding:settings.MESH_CANVAS_PADDING},set:function(value){this._canvasPadding=value}}),SimpleMesh.prototype._renderCanvas=function(renderer){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(renderer,this)},SimpleRope.prototype._renderCanvas=function(renderer){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(renderer,this)};var canvasRenderer,PolygonUtils=function(){function PolygonUtils(){}return PolygonUtils.offsetPolygon=function(points,offset){var offsetPoints=[],length=points.length;offset=PolygonUtils.isPolygonClockwise(points)?offset:-1*offset;for(var j=0;j<length;j+=2){var i=j-2;i<0&&(i+=length);var k=(j+2)%length,v1x=points[j]-points[i],v1y=points[j+1]-points[i+1],len=Math.sqrt(v1x*v1x+v1y*v1y);v1x/=len,v1y/=len;var norm1x=-(v1y*=offset),norm1y=v1x*=offset,pij1=[points[i]+norm1x,points[i+1]+norm1y],pij2=[points[j]+norm1x,points[j+1]+norm1y],v2x=points[k]-points[j],v2y=points[k+1]-points[j+1];v2x/=len=Math.sqrt(v2x*v2x+v2y*v2y),v2y/=len;var norm2x=-(v2y*=offset),norm2y=v2x*=offset,pjk1=[points[j]+norm2x,points[j+1]+norm2y],pjk2=[points[k]+norm2x,points[k+1]+norm2y],intersectPoint=PolygonUtils.findIntersection(pij1[0],pij1[1],pij2[0],pij2[1],pjk1[0],pjk1[1],pjk2[0],pjk2[1]);intersectPoint&&offsetPoints.push.apply(offsetPoints,intersectPoint)}return offsetPoints},PolygonUtils.findIntersection=function(x1,y1,x2,y2,x3,y3,x4,y4){var denominator=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1),numeratorA=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3);if(0===denominator)return 0===numeratorA&&0===(x2-x1)*(y1-y3)-(y2-y1)*(x1-x3)?[(x1+x2)/2,(y1+y2)/2]:null;var uA=numeratorA/denominator;return[x1+uA*(x2-x1),y1+uA*(y2-y1)]},PolygonUtils.isPolygonClockwise=function(polygon){for(var sum=0,i=0;i<polygon.length-2;i+=2)sum+=(polygon[i+2]-polygon[i])*(polygon[i+3]+polygon[i+1]);return sum>0},PolygonUtils}(),CanvasGraphicsRenderer=function(){function CanvasGraphicsRenderer(renderer){this._svgMatrix=null,this._tempMatrix=new Matrix,this.renderer=renderer}return CanvasGraphicsRenderer.prototype._calcCanvasStyle=function(style,tint){var res;return style.texture&&style.texture.baseTexture!==Texture.WHITE.baseTexture?style.texture.valid?(res=canvasUtils.getTintedPattern(style.texture,tint),this.setPatternTransform(res,style.matrix||Matrix.IDENTITY)):res="#808080":res="#"+("00000"+(0|tint).toString(16)).substr(-6),res},CanvasGraphicsRenderer.prototype.render=function(graphics){var renderer=this.renderer,context=renderer.context,worldAlpha=graphics.worldAlpha,transform=graphics.transform.worldTransform;renderer.setContextTransform(transform),renderer.setBlendMode(graphics.blendMode);for(var contextFillStyle,contextStrokeStyle,graphicsData=graphics.geometry.graphicsData,tintR=(graphics.tint>>16&255)/255,tintG=(graphics.tint>>8&255)/255,tintB=(255&graphics.tint)/255,i=0;i<graphicsData.length;i++){var data=graphicsData[i],shape=data.shape,fillStyle=data.fillStyle,lineStyle=data.lineStyle,fillColor=0|data.fillStyle.color,lineColor=0|data.lineStyle.color;if(data.matrix&&renderer.setContextTransform(transform.copyTo(this._tempMatrix).append(data.matrix)),fillStyle.visible){var fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(255&fillColor)/255*tintB*255;contextFillStyle=this._calcCanvasStyle(fillStyle,fillTint)}if(lineStyle.visible){var lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(255&lineColor)/255*tintB*255;contextStrokeStyle=this._calcCanvasStyle(lineStyle,lineTint)}if(context.lineWidth=lineStyle.width,context.lineCap=lineStyle.cap,context.lineJoin=lineStyle.join,context.miterLimit=lineStyle.miterLimit,data.type===SHAPES.POLY){context.beginPath();var points=(tempShape=shape).points,holes=data.holes,outerArea=void 0,innerArea=void 0,px=void 0,py=void 0,holesDirection=void 0;context.moveTo(points[0],points[1]);for(var j=2;j<points.length;j+=2)context.lineTo(points[j],points[j+1]);if(tempShape.closeStroke&&context.closePath(),holes.length>0){holesDirection=[],outerArea=0,px=points[0],py=points[1];for(j=2;j+2<points.length;j+=2)outerArea+=(points[j]-px)*(points[j+3]-py)-(points[j+2]-px)*(points[j+1]-py);for(var k=0;k<holes.length;k++)if(points=holes[k].shape.points){innerArea=0,px=points[0],py=points[1];for(j=2;j+2<points.length;j+=2)innerArea+=(points[j]-px)*(points[j+3]-py)-(points[j+2]-px)*(points[j+1]-py);if(innerArea*outerArea<0){context.moveTo(points[0],points[1]);for(j=2;j<points.length;j+=2)context.lineTo(points[j],points[j+1])}else{context.moveTo(points[points.length-2],points[points.length-1]);for(j=points.length-4;j>=0;j-=2)context.lineTo(points[j],points[j+1])}holes[k].shape.closeStroke&&context.closePath(),holesDirection[k]=innerArea*outerArea<0}}fillStyle.visible&&(context.globalAlpha=fillStyle.alpha*worldAlpha,context.fillStyle=contextFillStyle,context.fill()),lineStyle.visible&&this.paintPolygonStroke(tempShape,lineStyle,contextStrokeStyle,holes,holesDirection,worldAlpha,context)}else if(data.type===SHAPES.RECT){var tempShape=shape;if(fillStyle.visible&&(context.globalAlpha=fillStyle.alpha*worldAlpha,context.fillStyle=contextFillStyle,context.fillRect(tempShape.x,tempShape.y,tempShape.width,tempShape.height)),lineStyle.visible){var alignmentOffset=lineStyle.width*(.5-(1-lineStyle.alignment)),width=tempShape.width+2*alignmentOffset,height=tempShape.height+2*alignmentOffset;context.globalAlpha=lineStyle.alpha*worldAlpha,context.strokeStyle=contextStrokeStyle,context.strokeRect(tempShape.x-alignmentOffset,tempShape.y-alignmentOffset,width,height)}}else if(data.type===SHAPES.CIRC){tempShape=shape;if(context.beginPath(),context.arc(tempShape.x,tempShape.y,tempShape.radius,0,2*Math.PI),context.closePath(),fillStyle.visible&&(context.globalAlpha=fillStyle.alpha*worldAlpha,context.fillStyle=contextFillStyle,context.fill()),lineStyle.visible){if(.5!==lineStyle.alignment){alignmentOffset=lineStyle.width*(.5-(1-lineStyle.alignment));context.beginPath(),context.arc(tempShape.x,tempShape.y,tempShape.radius+alignmentOffset,0,2*Math.PI),context.closePath()}context.globalAlpha=lineStyle.alpha*worldAlpha,context.strokeStyle=contextStrokeStyle,context.stroke()}}else if(data.type===SHAPES.ELIP){tempShape=shape;if((drawShapeOverStroke=1===lineStyle.alignment)||this.paintEllipse(tempShape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context),lineStyle.visible){if(.5!==lineStyle.alignment){alignmentOffset=lineStyle.width*(.5-(1-lineStyle.alignment));var sW=2*(tempShape.width+alignmentOffset),sH=2*(tempShape.height+alignmentOffset),sX=tempShape.x-sW/2,sY=tempShape.y-sH/2,sOx=sW/2*.5522848,sOy=sH/2*.5522848,sXe=sX+sW,sYe=sY+sH,sXm=sX+sW/2,sYm=sY+sH/2;context.beginPath(),context.moveTo(sX,sYm),context.bezierCurveTo(sX,sYm-sOy,sXm-sOx,sY,sXm,sY),context.bezierCurveTo(sXm+sOx,sY,sXe,sYm-sOy,sXe,sYm),context.bezierCurveTo(sXe,sYm+sOy,sXm+sOx,sYe,sXm,sYe),context.bezierCurveTo(sXm-sOx,sYe,sX,sYm+sOy,sX,sYm),context.closePath()}context.globalAlpha=lineStyle.alpha*worldAlpha,context.strokeStyle=contextStrokeStyle,context.stroke()}drawShapeOverStroke&&this.paintEllipse(tempShape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context)}else if(data.type===SHAPES.RREC){var drawShapeOverStroke;tempShape=shape;if((drawShapeOverStroke=1===lineStyle.alignment)||this.paintRoundedRectangle(tempShape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context),lineStyle.visible){if(.5!==lineStyle.alignment){width=tempShape.width,height=tempShape.height,alignmentOffset=lineStyle.width*(.5-(1-lineStyle.alignment));var sRx=tempShape.x-alignmentOffset,sRy=tempShape.y-alignmentOffset,sWidth=tempShape.width+2*alignmentOffset,sHeight=tempShape.height+2*alignmentOffset,radiusOffset=alignmentOffset*(lineStyle.alignment>=1?Math.min(sWidth/width,sHeight/height):Math.min(width/sWidth,height/sHeight)),sRadius=tempShape.radius+radiusOffset,sMaxRadius=Math.min(sWidth,sHeight)/2;sRadius=sRadius>sMaxRadius?sMaxRadius:sRadius,context.beginPath(),context.moveTo(sRx,sRy+sRadius),context.lineTo(sRx,sRy+sHeight-sRadius),context.quadraticCurveTo(sRx,sRy+sHeight,sRx+sRadius,sRy+sHeight),context.lineTo(sRx+sWidth-sRadius,sRy+sHeight),context.quadraticCurveTo(sRx+sWidth,sRy+sHeight,sRx+sWidth,sRy+sHeight-sRadius),context.lineTo(sRx+sWidth,sRy+sRadius),context.quadraticCurveTo(sRx+sWidth,sRy,sRx+sWidth-sRadius,sRy),context.lineTo(sRx+sRadius,sRy),context.quadraticCurveTo(sRx,sRy,sRx,sRy+sRadius),context.closePath()}context.globalAlpha=lineStyle.alpha*worldAlpha,context.strokeStyle=contextStrokeStyle,context.stroke()}drawShapeOverStroke&&this.paintRoundedRectangle(tempShape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context)}}},CanvasGraphicsRenderer.prototype.paintPolygonStroke=function(shape,lineStyle,contextStrokeStyle,holes,holesDirection,worldAlpha,context){if(.5!==lineStyle.alignment){var alignmentOffset=lineStyle.width*(.5-(1-lineStyle.alignment)),offsetPoints=PolygonUtils.offsetPolygon(shape.points,alignmentOffset),points=void 0;context.beginPath(),context.moveTo(offsetPoints[0],offsetPoints[1]);for(var j=2;j<offsetPoints.length;j+=2)context.lineTo(offsetPoints[j],offsetPoints[j+1]);shape.closeStroke&&context.closePath();for(var k=0;k<holes.length;k++){if(points=holes[k].shape.points,offsetPoints=PolygonUtils.offsetPolygon(points,alignmentOffset),holesDirection[k]){context.moveTo(offsetPoints[0],offsetPoints[1]);for(j=2;j<offsetPoints.length;j+=2)context.lineTo(offsetPoints[j],offsetPoints[j+1])}else{context.moveTo(offsetPoints[offsetPoints.length-2],offsetPoints[offsetPoints.length-1]);for(j=offsetPoints.length-4;j>=0;j-=2)context.lineTo(offsetPoints[j],offsetPoints[j+1])}holes[k].shape.closeStroke&&context.closePath()}}context.globalAlpha=lineStyle.alpha*worldAlpha,context.strokeStyle=contextStrokeStyle,context.stroke()},CanvasGraphicsRenderer.prototype.paintEllipse=function(shape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context){var w=2*shape.width,h=2*shape.height,x=shape.x-w/2,y=shape.y-h/2,ox=w/2*.5522848,oy=h/2*.5522848,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.beginPath(),context.moveTo(x,ym),context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context.closePath(),0===lineStyle.alignment&&context.clip(),fillStyle.visible&&(context.globalAlpha=fillStyle.alpha*worldAlpha,context.fillStyle=contextFillStyle,context.fill())},CanvasGraphicsRenderer.prototype.paintRoundedRectangle=function(shape,fillStyle,lineStyle,contextFillStyle,worldAlpha,context){var rx=shape.x,ry=shape.y,width=shape.width,height=shape.height,radius=shape.radius,maxRadius=Math.min(width,height)/2;radius=radius>maxRadius?maxRadius:radius,context.beginPath(),context.moveTo(rx,ry+radius),context.lineTo(rx,ry+height-radius),context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context.lineTo(rx+width-radius,ry+height),context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context.lineTo(rx+width,ry+radius),context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context.lineTo(rx+radius,ry),context.quadraticCurveTo(rx,ry,rx,ry+radius),context.closePath(),0===lineStyle.alignment&&context.clip(),fillStyle.visible&&(context.globalAlpha=fillStyle.alpha*worldAlpha,context.fillStyle=contextFillStyle,context.fill())},CanvasGraphicsRenderer.prototype.setPatternTransform=function(pattern,matrix){if(!1!==this._svgMatrix){if(!this._svgMatrix){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");if(svg&&svg.createSVGMatrix&&(this._svgMatrix=svg.createSVGMatrix()),!this._svgMatrix||!pattern.setTransform)return void(this._svgMatrix=!1)}this._svgMatrix.a=matrix.a,this._svgMatrix.b=matrix.b,this._svgMatrix.c=matrix.c,this._svgMatrix.d=matrix.d,this._svgMatrix.e=matrix.tx,this._svgMatrix.f=matrix.ty,pattern.setTransform(this._svgMatrix.inverse())}},CanvasGraphicsRenderer.prototype.destroy=function(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null},CanvasGraphicsRenderer}(),canvas_graphics_tempMatrix=new Matrix;Graphics.prototype.generateCanvasTexture=function(scaleMode,resolution){void 0===resolution&&(resolution=1);var bounds=this.getLocalBounds(),canvasBuffer=RenderTexture.create({width:bounds.width,height:bounds.height,scaleMode,resolution});canvasRenderer||(canvasRenderer=new CanvasRenderer),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(canvas_graphics_tempMatrix),canvas_graphics_tempMatrix.invert(),canvas_graphics_tempMatrix.tx-=bounds.x,canvas_graphics_tempMatrix.ty-=bounds.y,canvasRenderer.render(this,{renderTexture:canvasBuffer,clear:!0,transform:canvas_graphics_tempMatrix});var texture=Texture.from(canvasBuffer.baseTexture._canvasRenderTarget.canvas,{scaleMode});return texture.baseTexture.setResolution(resolution),texture},Graphics.prototype.cachedGraphicsData=[],Graphics.prototype._renderCanvas=function(renderer){!0!==this.isMask&&(this.finishPoly(),renderer.plugins.graphics.render(this))};var canvasRenderWorldTransform=new Matrix,CanvasSpriteRenderer=function(){function CanvasSpriteRenderer(renderer){this.renderer=renderer}return CanvasSpriteRenderer.prototype.render=function(sprite){var texture=sprite._texture,renderer=this.renderer,context=renderer.context,width=texture._frame.width,height=texture._frame.height,wt=sprite.transform.worldTransform,dx=0,dy=0,source=texture.baseTexture.getDrawableSource();if(!(texture.orig.width<=0||texture.orig.height<=0)&&texture.valid&&source&&texture.valid){renderer.setBlendMode(sprite.blendMode,!0),renderer.context.globalAlpha=sprite.worldAlpha;var smoothingEnabled=texture.baseTexture.scaleMode===constants_SCALE_MODES.LINEAR;renderer.smoothProperty&&renderer.context[renderer.smoothProperty]!==smoothingEnabled&&(context[renderer.smoothProperty]=smoothingEnabled),texture.trim?(dx=texture.trim.width/2+texture.trim.x-sprite.anchor.x*texture.orig.width,dy=texture.trim.height/2+texture.trim.y-sprite.anchor.y*texture.orig.height):(dx=(.5-sprite.anchor.x)*texture.orig.width,dy=(.5-sprite.anchor.y)*texture.orig.height),texture.rotate&&(wt.copyTo(canvasRenderWorldTransform),wt=canvasRenderWorldTransform,groupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy),dx=0,dy=0),dx-=width/2,dy-=height/2,renderer.setContextTransform(wt,sprite.roundPixels,1),sprite.roundPixels&&(dx|=0,dy|=0);var resolution=texture.baseTexture.resolution,outerBlend=renderer._outerBlend;outerBlend&&(context.save(),context.beginPath(),context.rect(dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution),context.clip()),16777215!==sprite.tint?(sprite._cachedTint===sprite.tint&&sprite._tintedCanvas.tintId===sprite._texture._updateID||(sprite._cachedTint=sprite.tint,sprite._tintedCanvas=canvasUtils.getTintedCanvas(sprite,sprite.tint)),context.drawImage(sprite._tintedCanvas,0,0,Math.floor(width*resolution),Math.floor(height*resolution),Math.floor(dx*renderer.resolution),Math.floor(dy*renderer.resolution),Math.floor(width*renderer.resolution),Math.floor(height*renderer.resolution))):context.drawImage(source,texture._frame.x*resolution,texture._frame.y*resolution,Math.floor(width*resolution),Math.floor(height*resolution),Math.floor(dx*renderer.resolution),Math.floor(dy*renderer.resolution),Math.floor(width*renderer.resolution),Math.floor(height*renderer.resolution)),outerBlend&&context.restore(),renderer.setBlendMode(constants_BLEND_MODES.NORMAL)}},CanvasSpriteRenderer.prototype.destroy=function(){this.renderer=null},CanvasSpriteRenderer}();Sprite.prototype._tintedCanvas=null,Sprite.prototype._renderCanvas=function(renderer){renderer.plugins.sprite.render(this)};var canvas_extract_TEMP_RECT=new Rectangle,CanvasExtract=function(){function CanvasExtract(renderer){this.renderer=renderer}return CanvasExtract.prototype.image=function(target,format,quality){var image=new Image;return image.src=this.base64(target,format,quality),image},CanvasExtract.prototype.base64=function(target,format,quality){return this.canvas(target).toDataURL(format,quality)},CanvasExtract.prototype.canvas=function(target){var context,resolution,frame,renderTexture,renderer=this.renderer;target&&(renderTexture=target instanceof RenderTexture?target:renderer.generateTexture(target)),renderTexture?(context=renderTexture.baseTexture._canvasRenderTarget.context,resolution=renderTexture.baseTexture._canvasRenderTarget.resolution,frame=renderTexture.frame):(context=renderer.rootContext,resolution=renderer.resolution,(frame=canvas_extract_TEMP_RECT).width=this.renderer.width,frame.height=this.renderer.height);var width=Math.floor(frame.width*resolution+1e-4),height=Math.floor(frame.height*resolution+1e-4),canvasBuffer=new CanvasRenderTarget(width,height,1),canvasData=context.getImageData(frame.x*resolution,frame.y*resolution,width,height);return canvasBuffer.context.putImageData(canvasData,0,0),canvasBuffer.canvas},CanvasExtract.prototype.pixels=function(target){var context,resolution,frame,renderTexture,renderer=this.renderer;target&&(renderTexture=target instanceof RenderTexture?target:renderer.generateTexture(target)),renderTexture?(context=renderTexture.baseTexture._canvasRenderTarget.context,resolution=renderTexture.baseTexture._canvasRenderTarget.resolution,frame=renderTexture.frame):(context=renderer.rootContext,resolution=renderer.resolution,(frame=canvas_extract_TEMP_RECT).width=renderer.width,frame.height=renderer.height);var x=frame.x*resolution,y=frame.y*resolution,width=frame.width*resolution,height=frame.height*resolution;return context.getImageData(x,y,width,height).data},CanvasExtract.prototype.destroy=function(){this.renderer=null},CanvasExtract}(),canvas_prepare_extendStatics=function(d,b){return canvas_prepare_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},canvas_prepare_extendStatics(d,b)};function canvas_prepare_uploadBaseTextures(prepare,item){var tempPrepare=prepare;if(item instanceof BaseTexture){var image=item.source,imageWidth=0===image.width?tempPrepare.canvas.width:Math.min(tempPrepare.canvas.width,image.width),imageHeight=0===image.height?tempPrepare.canvas.height:Math.min(tempPrepare.canvas.height,image.height);return tempPrepare.ctx.drawImage(image,0,0,imageWidth,imageHeight,0,0,tempPrepare.canvas.width,tempPrepare.canvas.height),!0}return!1}var CanvasPrepare=function(_super){function CanvasPrepare(renderer){var _this=_super.call(this,renderer)||this;return _this.uploadHookHelper=_this,_this.canvas=document.createElement("canvas"),_this.canvas.width=16,_this.canvas.height=16,_this.ctx=_this.canvas.getContext("2d"),_this.registerUploadHook(canvas_prepare_uploadBaseTextures),_this}return function(d,b){function __(){this.constructor=d}canvas_prepare_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}(CanvasPrepare,_super),CanvasPrepare.prototype.destroy=function(){_super.prototype.destroy.call(this),this.ctx=null,this.canvas=null},CanvasPrepare}(BasePrepare),worldMatrix=new Matrix,patternMatrix=new Matrix,patternRect=[new Point,new Point,new Point,new Point];function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}TilingSprite.prototype._renderCanvas=function(renderer){var texture=this._texture;if(texture.baseTexture.valid){var context=renderer.context,transform=this.worldTransform,baseTexture=texture.baseTexture,source=baseTexture.getDrawableSource(),baseTextureResolution=baseTexture.resolution;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tint){this._textureID=this._texture._updateID;var tempCanvas=new CanvasRenderTarget(texture._frame.width,texture._frame.height,baseTextureResolution);16777215!==this.tint?(this._tintedCanvas=canvasUtils.getTintedCanvas(this,this.tint),tempCanvas.context.drawImage(this._tintedCanvas,0,0)):tempCanvas.context.drawImage(source,-texture._frame.x*baseTextureResolution,-texture._frame.y*baseTextureResolution),this._cachedTint=this.tint,this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context.globalAlpha=this.worldAlpha,renderer.setBlendMode(this.blendMode),this.tileTransform.updateLocalTransform();var lt=this.tileTransform.localTransform,W=this._width,H=this._height;worldMatrix.identity(),patternMatrix.copyFrom(lt),this.uvRespectAnchor||patternMatrix.translate(-this.anchor.x*W,-this.anchor.y*H),worldMatrix.prepend(patternMatrix),worldMatrix.prepend(transform),renderer.setContextTransform(worldMatrix),context.fillStyle=this._canvasPattern;var lx=this.anchor.x*-W,ly=this.anchor.y*-H;patternRect[0].set(lx,ly),patternRect[1].set(lx+W,ly),patternRect[2].set(lx+W,ly+H),patternRect[3].set(lx,ly+H);for(var i=0;i<4;i++)patternMatrix.applyInverse(patternRect[i],patternRect[i]);context.beginPath(),context.moveTo(patternRect[0].x,patternRect[0].y);for(i=1;i<4;i++)context.lineTo(patternRect[i].x,patternRect[i].y);context.closePath(),context.fill()}},ParticleContainer.prototype.renderCanvas=function(renderer){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var context=renderer.context,transform=this.worldTransform,isRotated=!0,positionX=0,positionY=0,finalWidth=0,finalHeight=0;renderer.setBlendMode(this.blendMode),context.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=0;i<this.children.length;++i){var child=this.children[i];if(child.visible&&child._texture.valid){var frame=child._texture.frame;if(context.globalAlpha=this.worldAlpha*child.alpha,child.rotation%(2*Math.PI)==0)isRotated&&(renderer.setContextTransform(transform,!1,1),isRotated=!1),positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+.5,positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+.5,finalWidth=frame.width*child.scale.x,finalHeight=frame.height*child.scale.y;else{isRotated||(isRotated=!0),child.displayObjectUpdateTransform();var childTransform=child.worldTransform;renderer.setContextTransform(childTransform,this.roundPixels,1),positionX=child.anchor.x*-frame.width+.5,positionY=child.anchor.y*-frame.height+.5,finalWidth=frame.width,finalHeight=frame.height}var resolution=child._texture.baseTexture.resolution;context.drawImage(child._texture.baseTexture.getDrawableSource(),frame.x*resolution,frame.y*resolution,frame.width*resolution,frame.height*resolution,positionX*renderer.resolution,positionY*renderer.resolution,finalWidth*renderer.resolution,finalHeight*renderer.resolution)}}}},Container.prototype._renderCanvas=function(_renderer){},Container.prototype.renderCanvas=function(renderer){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&renderer.maskManager.pushMask(this._mask),this._renderCanvas(renderer);for(var i=0,j=this.children.length;i<j;++i)this.children[i].renderCanvas(renderer);this._mask&&renderer.maskManager.popMask(renderer)}},DisplayObject.prototype.renderCanvas=function(_renderer){},Text.prototype._renderCanvas=function(renderer){this._autoResolution&&this._resolution!==renderer.resolution&&(this._resolution=renderer.resolution,this.dirty=!0),this.updateText(!0),Sprite.prototype._renderCanvas.call(this,renderer)},CanvasRenderer.registerPlugin("accessibility",AccessibilityManager),CanvasRenderer.registerPlugin("extract",CanvasExtract),CanvasRenderer.registerPlugin("graphics",CanvasGraphicsRenderer),CanvasRenderer.registerPlugin("interaction",InteractionManager),CanvasRenderer.registerPlugin("mesh",CanvasMeshRenderer),CanvasRenderer.registerPlugin("prepare",CanvasPrepare),CanvasRenderer.registerPlugin("sprite",CanvasSpriteRenderer);var grid_grid={width:100,height:44,legend:{name:"legend",width:12,height:41,x:0,y:0,halfWidth:!0},interactions:{name:"interactions",width:12,height:41,x:88,y:0,halfWidth:!0},build:{name:"build",width:12,height:1,x:0,y:43,halfWidth:!0},mapOverlay:{name:"mapOverlay",width:74,height:39,x:13,y:3,halfWidth:!1},map:{name:"map",width:74,height:39,x:13,y:3,halfWidth:!1},fps:{name:"fps",width:12,height:1,x:0,y:42,halfWidth:!0},adventureLog:{name:"adventureLog",width:84,height:3,x:13,y:0,halfWidth:!0},ambiance:{name:"ambiance",width:74,height:1,x:13,y:42,halfWidth:!0},contextMenu:{name:"contextMenu",width:74,height:1,x:13,y:43,halfWidth:!0},float:{name:"float",width:40,height:39,x:13,y:3,halfWidth:!0},menu:{name:"menu",width:74,height:38,x:13,y:3,halfWidth:!0,bgColor:1}},CARDINAL=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}],DIAGONAL=[{x:1,y:-1},{x:1,y:1},{x:-1,y:1},{x:-1,y:-1}],toCell=([].concat(CARDINAL,DIAGONAL),function(cellOrId){var cell=cellOrId;return"string"==typeof cell&&(cell=idToCell(cell)),cell}),insideCircle=function(center,tile,radius){var dx=center.x-tile.x,dy=center.y-tile.y;return dx*dx+dy*dy<=radius*radius},lerp=function(start,end,t){return start+t*(end-start)},lerpPoint=function(p0,p1,t){return{x:lerp(p0.x,p1.x,t),y:lerp(p0.y,p1.y,t)}},roundPoint=function(p){return{x:Math.round(p.x),y:Math.round(p.y)}},line=function(cellOrId1,cellOrId2){for(var p0=toCell(cellOrId1),p1=toCell(cellOrId2),points=[],N=function(p0,p1){var dx=p1.x-p0.x,dy=p1.y-p0.y;return Math.max(Math.abs(dx),Math.abs(dy))}(p0,p1),step=0;step<=N;step++){var t=0===N?0:step/N;points.push(roundPoint(lerpPoint(p0,p1,t)))}return points},rectangle=function(_ref,tileProps){var x=_ref.x,y=_ref.y,width=_ref.width,height=_ref.height,hasWalls=_ref.hasWalls,tiles={},x1=x,x2=x+width,y1=y,y2=y+height;if(hasWalls)for(var yi=y1+1;yi<y2-1;yi++)for(var xi=x1+1;xi<x2-1;xi++)tiles["".concat(xi,",").concat(yi)]=_objectSpread({x:xi,y:yi},tileProps);else for(var _yi=y1;_yi<y2;_yi++)for(var _xi=x1;_xi<x2;_xi++)tiles["".concat(_xi,",").concat(_yi)]=_objectSpread({x:_xi,y:_yi},tileProps);return{x1,x2,y1,y2,center:{x:Math.round((x1+x2)/2),y:Math.round((y1+y2)/2)},hasWalls,tiles}},distance=function(cell1,cell2){var x=Math.pow(cell2.x-cell1.x,2),y=Math.pow(cell2.y-cell1.y,2);return Math.floor(Math.sqrt(x+y))},idToCell=function(id){var coords=id.split(",");return{x:parseInt(coords[0],10),y:parseInt(coords[1],10),z:parseInt(coords[2],10)}},cellToId=function(_ref2){var x=_ref2.x,y=_ref2.y,z=_ref2.z;return"".concat(x,",").concat(y,",").concat(z)},getNeighbors=function(_ref3){var _step,x=_ref3.x,y=_ref3.y,z=_ref3.z,direction=arguments.length>1&&void 0!==arguments[1]?arguments[1]:CARDINAL,points=[],_iterator=_createForOfIteratorHelper(direction);try{for(_iterator.s();!(_step=_iterator.n()).done;){var dir=_step.value,candidate={x:x+dir.x,y:y+dir.y,z};candidate.x>=0&&candidate.x<grid_grid.width&&candidate.y>=0&&candidate.y<grid_grid.height&&points.push(candidate)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return points},getNeighborIds=function(cellOrId){var direction=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CARDINAL",cell=toCell(cellOrId);return"CARDINAL"===direction?getNeighbors(cell,CARDINAL).map(cellToId):"DIAGONAL"===direction?getNeighbors(cell,DIAGONAL).map(cellToId):"ALL"===direction?[].concat(_toConsumableArray(getNeighbors(cell,CARDINAL).map(cellToId)),_toConsumableArray(getNeighbors(cell,DIAGONAL).map(cellToId))):void 0},isAtSamePosition=function(cell1,cell2){return cell1.x===cell2.x&&cell1.y===cell2.y&&cell1.z===cell2.z},isNeighbor=function(cell1,cell2){var c1=toCell(cell1),c2=toCell(cell2);if(c1.z!==c2.z)return!1;var ax=c1.x,ay=c1.y,bx=c2.x,by=c2.y;return ax-bx==1&&ay-by==0||ax-bx==0&&ay-by==-1||ax-bx==-1&&ay-by==0||ax-bx==0&&ay-by==1},menloBoldAlphaMap={A:"menlo-bold-0.png",B:"menlo-bold-1.png",C:"menlo-bold-2.png",D:"menlo-bold-3.png",E:"menlo-bold-4.png",F:"menlo-bold-5.png",G:"menlo-bold-6.png",H:"menlo-bold-7.png",I:"menlo-bold-8.png",J:"menlo-bold-9.png",K:"menlo-bold-10.png",L:"menlo-bold-11.png",M:"menlo-bold-12.png",N:"menlo-bold-13.png",O:"menlo-bold-14.png",P:"menlo-bold-15.png",Q:"menlo-bold-16.png",R:"menlo-bold-17.png",S:"menlo-bold-18.png",T:"menlo-bold-19.png",U:"menlo-bold-20.png",V:"menlo-bold-21.png",W:"menlo-bold-22.png",X:"menlo-bold-23.png",Y:"menlo-bold-24.png",Z:"menlo-bold-25.png",a:"menlo-bold-26.png",b:"menlo-bold-27.png",c:"menlo-bold-28.png",d:"menlo-bold-29.png",e:"menlo-bold-30.png",f:"menlo-bold-31.png",g:"menlo-bold-32.png",h:"menlo-bold-33.png",i:"menlo-bold-34.png",j:"menlo-bold-35.png",k:"menlo-bold-36.png",l:"menlo-bold-37.png",m:"menlo-bold-38.png",n:"menlo-bold-39.png",o:"menlo-bold-40.png",p:"menlo-bold-41.png",q:"menlo-bold-42.png",r:"menlo-bold-43.png",s:"menlo-bold-44.png",t:"menlo-bold-45.png",u:"menlo-bold-46.png",v:"menlo-bold-47.png",w:"menlo-bold-48.png",x:"menlo-bold-49.png",y:"menlo-bold-50.png",z:"menlo-bold-51.png",0:"menlo-bold-52.png",1:"menlo-bold-53.png",2:"menlo-bold-54.png",3:"menlo-bold-55.png",4:"menlo-bold-56.png",5:"menlo-bold-57.png",6:"menlo-bold-58.png",7:"menlo-bold-59.png",8:"menlo-bold-60.png",9:"menlo-bold-61.png","!":"menlo-bold-62.png","@":"menlo-bold-63.png","#":"menlo-bold-64.png",$:"menlo-bold-65.png","%":"menlo-bold-66.png","^":"menlo-bold-67.png","&":"menlo-bold-68.png","*":"menlo-bold-69.png","(":"menlo-bold-70.png",")":"menlo-bold-71.png","-":"menlo-bold-72.png",_:"menlo-bold-73.png","=":"menlo-bold-74.png","+":"menlo-bold-75.png",",":"menlo-bold-76.png",".":"menlo-bold-77.png","<":"menlo-bold-78.png",">":"menlo-bold-79.png","/":"menlo-bold-80.png","?":"menlo-bold-81.png",";":"menlo-bold-82.png",":":"menlo-bold-83.png",'"':"menlo-bold-84.png","'":"menlo-bold-85.png","[":"menlo-bold-86.png","]":"menlo-bold-87.png","{":"menlo-bold-88.png","}":"menlo-bold-89.png","\\":"menlo-bold-90.png","|":"menlo-bold-91.png","`":"menlo-bold-92.png","~":"menlo-bold-93.png","•":"menlo-bold-94.png"},menloBoldHalfAlphaMap={A:"menlo-bold-half-0.png",B:"menlo-bold-half-1.png",C:"menlo-bold-half-2.png",D:"menlo-bold-half-3.png",E:"menlo-bold-half-4.png",F:"menlo-bold-half-5.png",G:"menlo-bold-half-6.png",H:"menlo-bold-half-7.png",I:"menlo-bold-half-8.png",J:"menlo-bold-half-9.png",K:"menlo-bold-half-10.png",L:"menlo-bold-half-11.png",M:"menlo-bold-half-12.png",N:"menlo-bold-half-13.png",O:"menlo-bold-half-14.png",P:"menlo-bold-half-15.png",Q:"menlo-bold-half-16.png",R:"menlo-bold-half-17.png",S:"menlo-bold-half-18.png",T:"menlo-bold-half-19.png",U:"menlo-bold-half-20.png",V:"menlo-bold-half-21.png",W:"menlo-bold-half-22.png",X:"menlo-bold-half-23.png",Y:"menlo-bold-half-24.png",Z:"menlo-bold-half-25.png",a:"menlo-bold-half-26.png",b:"menlo-bold-half-27.png",c:"menlo-bold-half-28.png",d:"menlo-bold-half-29.png",e:"menlo-bold-half-30.png",f:"menlo-bold-half-31.png",g:"menlo-bold-half-32.png",h:"menlo-bold-half-33.png",i:"menlo-bold-half-34.png",j:"menlo-bold-half-35.png",k:"menlo-bold-half-36.png",l:"menlo-bold-half-37.png",m:"menlo-bold-half-38.png",n:"menlo-bold-half-39.png",o:"menlo-bold-half-40.png",p:"menlo-bold-half-41.png",q:"menlo-bold-half-42.png",r:"menlo-bold-half-43.png",s:"menlo-bold-half-44.png",t:"menlo-bold-half-45.png",u:"menlo-bold-half-46.png",v:"menlo-bold-half-47.png",w:"menlo-bold-half-48.png",x:"menlo-bold-half-49.png",y:"menlo-bold-half-50.png",z:"menlo-bold-half-51.png",0:"menlo-bold-half-52.png",1:"menlo-bold-half-53.png",2:"menlo-bold-half-54.png",3:"menlo-bold-half-55.png",4:"menlo-bold-half-56.png",5:"menlo-bold-half-57.png",6:"menlo-bold-half-58.png",7:"menlo-bold-half-59.png",8:"menlo-bold-half-60.png",9:"menlo-bold-half-61.png","!":"menlo-bold-half-62.png","@":"menlo-bold-half-63.png","#":"menlo-bold-half-64.png",$:"menlo-bold-half-65.png","%":"menlo-bold-half-66.png","^":"menlo-bold-half-67.png","&":"menlo-bold-half-68.png","*":"menlo-bold-half-69.png","(":"menlo-bold-half-70.png",")":"menlo-bold-half-71.png","-":"menlo-bold-half-72.png",_:"menlo-bold-half-73.png","=":"menlo-bold-half-74.png","+":"menlo-bold-half-75.png",",":"menlo-bold-half-76.png",".":"menlo-bold-half-77.png","<":"menlo-bold-half-78.png",">":"menlo-bold-half-79.png","/":"menlo-bold-half-80.png","?":"menlo-bold-half-81.png",";":"menlo-bold-half-82.png",":":"menlo-bold-half-83.png",'"':"menlo-bold-half-84.png","'":"menlo-bold-half-85.png","[":"menlo-bold-half-86.png","]":"menlo-bold-half-87.png","{":"menlo-bold-half-88.png","}":"menlo-bold-half-89.png","\\":"menlo-bold-half-90.png","|":"menlo-bold-half-91.png","`":"menlo-bold-half-92.png","~":"menlo-bold-half-93.png","•":"menlo-bold-half-94.png"},_excluded=["id"];function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||build_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=function(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],excluded.indexOf(key)>=0||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function build_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=build_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e3){didErr=!0,err=_e3},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function build_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return build_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?build_arrayLikeToArray(o,minLen):void 0}}function build_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function build_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function build_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?build_ownKeys(Object(source),!0).forEach((function(key){_defineProperty2(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):build_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty2(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function build_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var camelCase=function(input,options){if("string"!=typeof input&&!Array.isArray(input))throw new TypeError("Expected the input to be `string | string[]`");options=build_objectSpread(build_objectSpread({},{pascalCase:!1}),options);return input=Array.isArray(input)?input.map((function(x){return x.trim()})).filter((function(x){return x.length})).join("-"):input.trim(),0===input.length?"":1===input.length?options.pascalCase?input.toLocaleUpperCase():input.toLocaleLowerCase():(input!==input.toLocaleLowerCase()&&(input=function(string){for(var isLastCharLower=!1,isLastCharUpper=!1,isLastLastCharUpper=!1,i=0;i<string.length;i++){var character=string[i];isLastCharLower&&/(?:[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2F\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C0\uA7C2\uA7C4-\uA7C7\uA7C9\uA7D0\uA7D6\uA7D8\uA7F5\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27\uDCB0-\uDCD3\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95]|\uD803[\uDC80-\uDCB2]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])/.test(character)?(string=string.slice(0,i)+"-"+string.slice(i),isLastCharLower=!1,isLastLastCharUpper=isLastCharUpper,isLastCharUpper=!0,i++):isLastCharUpper&&isLastLastCharUpper&&/(?:[a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5F\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C1\uA7C3\uA7C8\uA7CA\uA7D1\uA7D3\uA7D5\uA7D7\uA7D9\uA7F6\uA7FA\uAB30-\uAB5A\uAB60-\uAB68\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC]|\uD803[\uDCC0-\uDCF2]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD837[\uDF00-\uDF09\uDF0B-\uDF1E]|\uD83A[\uDD22-\uDD43])/.test(character)?(string=string.slice(0,i-1)+"-"+string.slice(i-1),isLastLastCharUpper=isLastCharUpper,isLastCharUpper=!1,isLastCharLower=!0):(isLastCharLower=character.toLocaleLowerCase()===character&&character.toLocaleUpperCase()!==character,isLastLastCharUpper=isLastCharUpper,isLastCharUpper=character.toLocaleUpperCase()===character&&character.toLocaleLowerCase()!==character)}return string}(input)),function(x){return options.pascalCase?x.charAt(0).toLocaleUpperCase()+x.slice(1):x}(input=input.replace(/^[_.\- ]+/,"").toLocaleLowerCase().replace(/[ \x2D\._]+((?:[0-9A-Z_a-z\xAA\xB2\xB3\xB5\xB9\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0345\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05B0-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0657\u0659-\u0669\u066E-\u06D3\u06D5-\u06DC\u06E1-\u06E8\u06ED-\u06FC\u06FF\u0710-\u073F\u074D-\u07B1\u07C0-\u07EA\u07F4\u07F5\u07FA\u0800-\u0817\u081A-\u082C\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u08D4-\u08DF\u08E3-\u08E9\u08F0-\u093B\u093D-\u094C\u094E-\u0950\u0955-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD-\u09C4\u09C7\u09C8\u09CB\u09CC\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A42\u0A47\u0A48\u0A4B\u0A4C\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD-\u0AC5\u0AC7-\u0AC9\u0ACB\u0ACC\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFC\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D-\u0B44\u0B47\u0B48\u0B4B\u0B4C\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71-\u0B77\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0BD0\u0BD7\u0BE6-\u0BF2\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4C\u0C55\u0C56\u0C58-\u0C5A\u0C5D\u0C60-\u0C63\u0C66-\u0C6F\u0C78-\u0C7E\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCC\u0CD5\u0CD6\u0CDD\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4C\u0D4E\u0D54-\u0D63\u0D66-\u0D78\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E46\u0E4D\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F20-\u0F33\u0F40-\u0F47\u0F49-\u0F6C\u0F71-\u0F81\u0F88-\u0F97\u0F99-\u0FBC\u1000-\u1036\u1038\u103B-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1713\u171F-\u1733\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17B3\u17B6-\u17C8\u17D7\u17DC\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u1938\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A61-\u1A74\u1A80-\u1A89\u1A90-\u1A99\u1AA7\u1ABF\u1AC0\u1ACC-\u1ACE\u1B00-\u1B33\u1B35-\u1B43\u1B45-\u1B4C\u1B50-\u1B59\u1B80-\u1BA9\u1BAC-\u1BE5\u1BE7-\u1BF1\u1C00-\u1C36\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1DE7-\u1DF4\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2189\u2150-\u2182\u2460-\u249B\u24B6-\u24FF\u2776-\u2793\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66E\uA674-\uA67B\uA67F-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA805\uA807-\uA827\uA830-\uA835\uA840-\uA873\uA880-\uA8C3\uA8C5\uA8D0-\uA8D9\uA8F2-\uA8F7\uA8FB\uA8FD-\uA92A\uA930-\uA952\uA960-\uA97C\uA980-\uA9B2\uA9B4-\uA9BF\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAABE\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF5\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE1-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE4\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF45\uDF51-\uDF54\uDF70-\uDF81\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC45\uDC52-\uDC6F\uDC71-\uDC75\uDC82-\uDCB8\uDCC2\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD32\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD72\uDD76\uDD80-\uDDBF\uDDC1-\uDDC4\uDDCE-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE34\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEE8\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D-\uDF44\uDF47\uDF48\uDF4B\uDF4C\uDF50\uDF57\uDF5D-\uDF63]|\uD805[\uDC00-\uDC41\uDC43-\uDC45\uDC47-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCC1\uDCC4\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDBE\uDDD8-\uDDDD\uDE00-\uDE3E\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB5\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2A\uDF30-\uDF3B\uDF40-\uDF46]|\uD806[\uDC00-\uDC38\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B\uDD3C\uDD3F-\uDD42\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDDF\uDDE1\uDDE3\uDDE4\uDE00-\uDE32\uDE35-\uDE3E\uDE50-\uDE97\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC3E\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD41\uDD43\uDD46\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD96\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE70-\uDEBE\uDEC0-\uDEC9\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9E]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD837[\uDF00-\uDF1E]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD37-\uDD3D\uDD40-\uDD49\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB\uDEF0-\uDEF9]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCCF\uDD00-\uDD43\uDD47\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C\uDD30-\uDD49\uDD50-\uDD69\uDD70-\uDD89]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])|$)/g,(function(_,p1){return p1.toLocaleUpperCase()})).replace(/[0-9]+((?:[0-9A-Z_a-z\xAA\xB2\xB3\xB5\xB9\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0345\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05B0-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0657\u0659-\u0669\u066E-\u06D3\u06D5-\u06DC\u06E1-\u06E8\u06ED-\u06FC\u06FF\u0710-\u073F\u074D-\u07B1\u07C0-\u07EA\u07F4\u07F5\u07FA\u0800-\u0817\u081A-\u082C\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u08D4-\u08DF\u08E3-\u08E9\u08F0-\u093B\u093D-\u094C\u094E-\u0950\u0955-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD-\u09C4\u09C7\u09C8\u09CB\u09CC\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A42\u0A47\u0A48\u0A4B\u0A4C\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD-\u0AC5\u0AC7-\u0AC9\u0ACB\u0ACC\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFC\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D-\u0B44\u0B47\u0B48\u0B4B\u0B4C\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71-\u0B77\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0BD0\u0BD7\u0BE6-\u0BF2\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4C\u0C55\u0C56\u0C58-\u0C5A\u0C5D\u0C60-\u0C63\u0C66-\u0C6F\u0C78-\u0C7E\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCC\u0CD5\u0CD6\u0CDD\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4C\u0D4E\u0D54-\u0D63\u0D66-\u0D78\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E46\u0E4D\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F20-\u0F33\u0F40-\u0F47\u0F49-\u0F6C\u0F71-\u0F81\u0F88-\u0F97\u0F99-\u0FBC\u1000-\u1036\u1038\u103B-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u1713\u171F-\u1733\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17B3\u17B6-\u17C8\u17D7\u17DC\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u1938\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A61-\u1A74\u1A80-\u1A89\u1A90-\u1A99\u1AA7\u1ABF\u1AC0\u1ACC-\u1ACE\u1B00-\u1B33\u1B35-\u1B43\u1B45-\u1B4C\u1B50-\u1B59\u1B80-\u1BA9\u1BAC-\u1BE5\u1BE7-\u1BF1\u1C00-\u1C36\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1DE7-\u1DF4\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2189\u2150-\u2182\u2460-\u249B\u24B6-\u24FF\u2776-\u2793\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66E\uA674-\uA67B\uA67F-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA805\uA807-\uA827\uA830-\uA835\uA840-\uA873\uA880-\uA8C3\uA8C5\uA8D0-\uA8D9\uA8F2-\uA8F7\uA8FB\uA8FD-\uA92A\uA930-\uA952\uA960-\uA97C\uA980-\uA9B2\uA9B4-\uA9BF\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAABE\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF5\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE1-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE4\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF45\uDF51-\uDF54\uDF70-\uDF81\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC45\uDC52-\uDC6F\uDC71-\uDC75\uDC82-\uDCB8\uDCC2\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD32\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD72\uDD76\uDD80-\uDDBF\uDDC1-\uDDC4\uDDCE-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE34\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEE8\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D-\uDF44\uDF47\uDF48\uDF4B\uDF4C\uDF50\uDF57\uDF5D-\uDF63]|\uD805[\uDC00-\uDC41\uDC43-\uDC45\uDC47-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCC1\uDCC4\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDBE\uDDD8-\uDDDD\uDE00-\uDE3E\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB5\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2A\uDF30-\uDF3B\uDF40-\uDF46]|\uD806[\uDC00-\uDC38\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B\uDD3C\uDD3F-\uDD42\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDDF\uDDE1\uDDE3\uDDE4\uDE00-\uDE32\uDE35-\uDE3E\uDE50-\uDE97\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC3E\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD41\uDD43\uDD46\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD96\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDE70-\uDEBE\uDEC0-\uDEC9\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9E]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD837[\uDF00-\uDF1E]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD37-\uDD3D\uDD40-\uDD49\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB\uDEF0-\uDEF9]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCCF\uDD00-\uDD43\uDD47\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C\uDD30-\uDD49\uDD50-\uDD69\uDD70-\uDD89]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])|$)/g,(function(m){return m.toLocaleUpperCase()}))))},camelcase=camelCase,_default=camelCase;camelcase.default=_default;var camelCache={},camelString=function(value){var result=camelCache[value];return result||(camelCache[value]=camelcase(value),camelCache[value])},ComponentRegistry=function(){function ComponentRegistry(){_classCallCheck(this,ComponentRegistry),build_defineProperty(this,"_cbit",0),build_defineProperty(this,"_map",{})}return _createClass(ComponentRegistry,[{key:"register",value:function(clazz){var key=camelString(clazz.name);clazz.prototype._ckey=key,clazz.prototype._cbit=BigInt(++this._cbit),this._map[key]=clazz}},{key:"get",value:function(key){return this._map[key]}}]),ComponentRegistry}(),isMergeableObject=function(value){return function(value){return!!value&&"object"===_typeof(value)}(value)&&!function(value){var stringValue=Object.prototype.toString.call(value);return"[object RegExp]"===stringValue||"[object Date]"===stringValue||function(value){return value.$$typeof===REACT_ELEMENT_TYPE}(value)}(value)};var REACT_ELEMENT_TYPE="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(value,options){return!1!==options.clone&&options.isMergeableObject(value)?deepmerge((val=value,Array.isArray(val)?[]:{}),value,options):value;var val}function defaultArrayMerge(target,source,options){return target.concat(source).map((function(element){return cloneUnlessOtherwiseSpecified(element,options)}))}function getKeys(target){return Object.keys(target).concat(function(target){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(target).filter((function(symbol){return target.propertyIsEnumerable(symbol)})):[]}(target))}function propertyIsOnObject(object,property){try{return property in object}catch(_){return!1}}function mergeObject(target,source,options){var destination={};return options.isMergeableObject(target)&&getKeys(target).forEach((function(key){destination[key]=cloneUnlessOtherwiseSpecified(target[key],options)})),getKeys(source).forEach((function(key){(function(target,key){return propertyIsOnObject(target,key)&&!(Object.hasOwnProperty.call(target,key)&&Object.propertyIsEnumerable.call(target,key))})(target,key)||(propertyIsOnObject(target,key)&&options.isMergeableObject(source[key])?destination[key]=function(key,options){if(!options.customMerge)return deepmerge;var customMerge=options.customMerge(key);return"function"==typeof customMerge?customMerge:deepmerge}(key,options)(target[key],source[key],options):destination[key]=cloneUnlessOtherwiseSpecified(source[key],options))})),destination}function deepmerge(target,source,options){(options=options||{}).arrayMerge=options.arrayMerge||defaultArrayMerge,options.isMergeableObject=options.isMergeableObject||isMergeableObject,options.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var sourceIsArray=Array.isArray(source);return sourceIsArray===Array.isArray(target)?sourceIsArray?options.arrayMerge(target,source,options):mergeObject(target,source,options):cloneUnlessOtherwiseSpecified(source,options)}deepmerge.all=function(array,options){if(!Array.isArray(array))throw new Error("first argument should be an array");return array.reduce((function(prev,next){return deepmerge(prev,next,options)}),{})};var cjs=deepmerge,PrefabComponent=function(){function PrefabComponent(clazz){var properties=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},overwrite=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];_classCallCheck(this,PrefabComponent),this.clazz=clazz,this.properties=properties,this.overwrite=overwrite}return _createClass(PrefabComponent,[{key:"applyToEntity",value:function(entity){var initialProps=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.clazz.allowMultiple&&entity.has(this.clazz)){if(!this.overwrite)return;var comp=entity[this.clazz.prototype._ckey];entity.remove(comp)}var props=cjs(this.properties,initialProps);entity.add(this.clazz,props)}}]),PrefabComponent}(),Prefab=function(){function Prefab(name){_classCallCheck(this,Prefab),build_defineProperty(this,"name",""),build_defineProperty(this,"inherit",[]),build_defineProperty(this,"components",[]),this.name=name}return _createClass(Prefab,[{key:"addComponent",value:function(prefabComponent){this.components.push(prefabComponent)}},{key:"applyToEntity",value:function(entity){var prefabProps=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.inherit.forEach((function(parent){parent.applyToEntity(entity,prefabProps)}));var arrComps={};return this.components.forEach((function(component){var clazz=component.clazz,ckey=clazz.prototype._ckey,initialCompProps={};if(clazz.allowMultiple)if(clazz.keyProperty){var key=component.properties[clazz.keyProperty];prefabProps[ckey]&&prefabProps[ckey][key]&&(initialCompProps=prefabProps[ckey][key])}else arrComps[ckey]||(arrComps[ckey]=0),prefabProps[ckey]&&prefabProps[ckey][arrComps[ckey]]&&(initialCompProps=prefabProps[ckey][arrComps[ckey]]),arrComps[ckey]++;else initialCompProps=prefabProps[ckey];component.applyToEntity(entity,initialCompProps)})),entity}}]),Prefab}(),PrefabRegistry=function(){function PrefabRegistry(engine){_classCallCheck(this,PrefabRegistry),build_defineProperty(this,"_prefabs",{}),build_defineProperty(this,"_engine",null),this._engine=engine}return _createClass(PrefabRegistry,[{key:"deserialize",value:function(data){var _this=this,registered=this.get(data.name);if(registered)return registered;var inherit,prefab=new Prefab(data.name);return inherit=Array.isArray(data.inherit)?data.inherit:"string"==typeof data.inherit?[data.inherit]:[],prefab.inherit=inherit.map((function(parent){var ref=_this.get(parent);return ref||(console.warn('Prefab "'.concat(data.name,'" cannot inherit from Prefab "').concat(parent,'" because is not registered yet! Prefabs must be registered in the right order.')),parent)})),(data.components||[]).forEach((function(componentData){if("string"==typeof componentData){var ckey=camelString(componentData),clazz=_this._engine._components.get(ckey);if(clazz)return void prefab.addComponent(new PrefabComponent(clazz))}if("object"===_typeof(componentData)){var _ckey=camelString(componentData.type),_clazz=_this._engine._components.get(_ckey);if(_clazz)return void prefab.addComponent(new PrefabComponent(_clazz,componentData.properties,componentData.overwrite))}console.warn('Unrecognized component reference "'.concat(componentData,'" in prefab "').concat(data.name,'". Ensure the component is registered before the prefab.'))})),prefab}},{key:"register",value:function(data){var prefab=this.deserialize(data);this._prefabs[prefab.name]=prefab}},{key:"get",value:function(name){return this._prefabs[name]}},{key:"create",value:function(world,name){var properties=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},prefab=this.get(name);if(prefab){var entity=world.createEntity();return entity._qeligible=!1,prefab.applyToEntity(entity,properties),entity._qeligible=!0,entity._candidacy(),entity}console.warn('Could not instantiate prefab "'.concat(name,'" since it is not registered'))}}]),PrefabRegistry}(),Component=function(){function Component(){var properties=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,Component),Object.assign(this,this.constructor.properties,properties)}return _createClass(Component,[{key:"world",get:function(){return this.entity.world}},{key:"allowMultiple",get:function(){return this.constructor.allowMultiple}},{key:"keyProperty",get:function(){return this.constructor.keyProperty}},{key:"destroy",value:function(){this.entity.remove(this)}},{key:"_onDestroyed",value:function(){this.onDestroyed(),delete this.entity}},{key:"_onEvent",value:function(evt){this.onEvent(evt),"function"==typeof this[evt.handlerName]&&this[evt.handlerName](evt)}},{key:"_onAttached",value:function(entity){this.entity=entity,this.onAttached(entity)}},{key:"serialize",value:function(){var ob={};for(var key in this.constructor.properties)ob[key]=this[key];return ob}},{key:"onAttached",value:function(entity){}},{key:"onDestroyed",value:function(){}},{key:"onEvent",value:function(evt){}}]),Component}();build_defineProperty(Component,"allowMultiple",!1),build_defineProperty(Component,"keyProperty",null),build_defineProperty(Component,"properties",{});var EntityEvent=function(){function EntityEvent(name){var data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,EntityEvent),build_defineProperty(this,"data",{}),build_defineProperty(this,"prevented",!1),build_defineProperty(this,"handled",!1),this.name=name,this.data=data,this.handlerName=camelString("on ".concat(this.name))}return _createClass(EntityEvent,[{key:"is",value:function(name){return this.name===name}},{key:"handle",value:function(){this.handled=!0,this.prevented=!0}},{key:"prevent",value:function(){this.prevented=!0}}]),EntityEvent}(),ONE=1n,subtractBit=function(num,bit){return num&~(1n<<bit)},addBit=function(num,bit){return num|ONE<<bit},bitIntersection=function(n1,n2){return n1&n2},serializeComponent=function(component){return component.serialize()},serializeComponentKeyed=function(ob){var ser={};for(var k in ob)ser[k]=serializeComponent(ob[k]);return ser},Entity=function(){function Entity(world,id){_classCallCheck(this,Entity),build_defineProperty(this,"_cbits",0n),build_defineProperty(this,"_qeligible",!0),this.world=world,this.id=id,this.components={},this.isDestroyed=!1}return _createClass(Entity,[{key:"_candidacy",value:function(){this._qeligible&&this.world._candidate(this)}},{key:"add",value:function(clazz,properties){var component=new clazz(properties);component.keyProperty?function(entity,component){var key=component._ckey;entity.components[key]||(entity[key]={},entity.components[key]={}),entity[key][component[component.keyProperty]]=component,entity.components[key][component[component.keyProperty]]=component}(this,component):component.allowMultiple?function(entity,component){var key=component._ckey;entity.components[key]||(entity[key]=[],entity.components[key]=[]),entity[key].push(component),entity.components[key].push(component)}(this,component):function(entity,component){var key=component._ckey;entity[key]=component,entity.components[key]=component}(this,component),this._cbits=addBit(this._cbits,component._cbit),component._onAttached(this),this._candidacy()}},{key:"has",value:function(clazz){return num=this._cbits,bit=clazz.prototype._cbit,(num>>bit)%2n!==0n;var num,bit}},{key:"remove",value:function(component){component.keyProperty?function(entity,component){var key=component._ckey,keyProp=component[component.keyProperty];delete entity[key][keyProp],delete entity.components[key][keyProp],Object.keys(entity[key]).length<=0&&(delete entity[key],delete entity.components[key],entity._cbits=subtractBit(entity._cbits,component._cbit),entity._candidacy())}(this,component):component.allowMultiple?function(entity,component){var key=component._ckey,idx=entity[key].indexOf(component);entity[key].splice(idx,1),entity.components[key].splice(idx,1),entity[key].length<=0&&(delete entity[key],delete entity.components[key],entity._cbits=subtractBit(entity._cbits,component._cbit),entity._candidacy())}(this,component):function(entity,component){var key=component._ckey;delete entity[key],delete entity.components[key],entity._cbits=subtractBit(entity._cbits,component._cbit),entity._candidacy()}(this,component),component._onDestroyed()}},{key:"destroy",value:function(){for(var k in this.components){var v=this.components[k];if(v instanceof Component)this._cbits=subtractBit(this._cbits,v._cbit),v._onDestroyed();else if(v instanceof Array){var _step,_iterator=build_createForOfIteratorHelper(v);try{for(_iterator.s();!(_step=_iterator.n()).done;){var component=_step.value;this._cbits=subtractBit(this._cbits,component._cbit),component._onDestroyed()}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else for(var _i=0,_Object$values=Object.values(v);_i<_Object$values.length;_i++){var _component=_Object$values[_i];this._cbits=subtractBit(this._cbits,_component._cbit),_component._onDestroyed()}delete this[k],delete this.components[k]}this._candidacy(),this.world._destroyed(this.id),this.components={},this.isDestroyed=!0}},{key:"serialize",value:function(){var components={};for(var k in this.components){var v=this.components[k];components[k]=v instanceof Component?serializeComponent(v):v instanceof Array?v.map(serializeComponent):serializeComponentKeyed(v)}return build_objectSpread({id:this.id},components)}},{key:"fireEvent",value:function(name,data){var evt=new EntityEvent(name,data);for(var key in this.components){var v=this.components[key];if(v instanceof Component){if(v._onEvent(evt),evt.prevented)return evt}else if(v instanceof Array){for(var i=0;i<v.length;i++)if(v[i]._onEvent(evt),evt.prevented)return evt}else for(var _i2=0,_Object$values2=Object.values(v);_i2<_Object$values2.length;_i2++){if(_Object$values2[_i2]._onEvent(evt),evt.prevented)return evt}}return evt}}]),Entity}(),Query=function(){function Query(world,filters){_classCallCheck(this,Query),build_defineProperty(this,"_cache",[]),build_defineProperty(this,"_onAddListeners",[]),build_defineProperty(this,"_onRemoveListeners",[]),this._world=world;var any=filters.any||[],all=filters.all||[],none=filters.none||[];this._any=any.reduce((function(s,c){return addBit(s,c.prototype._cbit)}),0n),this._all=all.reduce((function(s,c){return addBit(s,c.prototype._cbit)}),0n),this._none=none.reduce((function(s,c){return addBit(s,c.prototype._cbit)}),0n),this.refresh()}return _createClass(Query,[{key:"onEntityAdded",value:function(fn){this._onAddListeners.push(fn)}},{key:"onEntityRemoved",value:function(fn){this._onRemoveListeners.push(fn)}},{key:"has",value:function(entity){return this.idx(entity)>=0}},{key:"idx",value:function(entity){return this._cache.indexOf(entity)}},{key:"matches",value:function(entity){var bits=entity._cbits,any=0n===this._any||bitIntersection(bits,this._any)>0,all=bitIntersection(bits,this._all)===this._all,none=0n===bitIntersection(bits,this._none);return any&&all&&none}},{key:"candidate",value:function(entity){var idx=this.idx(entity),isTracking=idx>=0;return!entity.isDestroyed&&this.matches(entity)?(isTracking||(this._cache.push(entity),this._onAddListeners.forEach((function(cb){return cb(entity)}))),!0):(isTracking&&(this._cache.splice(idx,1),this._onRemoveListeners.forEach((function(cb){return cb(entity)}))),!1)}},{key:"refresh",value:function(){var _this2=this;this._cache=[],this._world._entities.forEach((function(entity){_this2.candidate(entity)}))}},{key:"get",value:function(){return this._cache}}]),Query}(),World=function(){function World(engine){_classCallCheck(this,World),build_defineProperty(this,"_id",0),build_defineProperty(this,"_queries",[]),build_defineProperty(this,"_entities",new Map),this.engine=engine}return _createClass(World,[{key:"createId",value:function(){return++this._id+Math.random().toString(36).substr(2,9)}},{key:"getEntity",value:function(id){return this._entities.get(id)}},{key:"getEntities",value:function(){return this._entities.values()}},{key:"createEntity",value:function(){var id=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.createId(),entity=new Entity(this,id);return this._entities.set(id,entity),entity}},{key:"destroyEntity",value:function(id){var entity=this.getEntity(id);entity&&entity.destroy()}},{key:"destroyEntities",value:function(){this._entities.forEach((function(entity){entity.destroy()}))}},{key:"destroy",value:function(){this.destroyEntities(),this._id=0,this._queries=[],this._entities=new Map}},{key:"createQuery",value:function(filters){var query=new Query(this,filters);return this._queries.push(query),query}},{key:"createPrefab",value:function(name){var properties=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.engine._prefabs.create(this,name,properties)}},{key:"serialize",value:function(entities){var json=[];return(entities||this._entities).forEach((function(e){json.push(e.serialize())})),{entities:json}}},{key:"deserialize",value:function(data){var _step2,_iterator2=build_createForOfIteratorHelper(data.entities);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var entityData=_step2.value;this._createOrGetEntityById(entityData.id)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var _step3,_iterator3=build_createForOfIteratorHelper(data.entities);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _entityData=_step3.value;this._deserializeEntity(_entityData)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}},{key:"_createOrGetEntityById",value:function(id){return this.getEntity(id)||this.createEntity(id)}},{key:"_deserializeEntity",value:function(data){var _this3=this,id=data.id,components=_objectWithoutProperties(data,_excluded),entity=this._createOrGetEntityById(id);entity._qeligible=!1,Object.entries(components).forEach((function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1],type=camelString(key),def=_this3.engine._components.get(type);def.allowMultiple?Object.values(value).forEach((function(d){entity.add(def,d)})):entity.add(def,value)})),entity._qeligible=!0,entity._candidacy()}},{key:"_candidate",value:function(entity){this._queries.forEach((function(q){return q.candidate(entity)}))}},{key:"_destroyed",value:function(id){return this._entities.delete(id)}}]),World}(),Engine=function(){function Engine(){_classCallCheck(this,Engine),build_defineProperty(this,"_components",new ComponentRegistry),build_defineProperty(this,"_prefabs",new PrefabRegistry(this))}return _createClass(Engine,[{key:"registerComponent",value:function(clazz){this._components.register(clazz)}},{key:"registerPrefab",value:function(data){this._prefabs.register(data)}},{key:"createWorld",value:function(){return new World(this)}},{key:"destroyWorld",value:function(world){world.destroy()}}]),Engine}(),colors_default=16711799,colors_door=7418654,colors_fire=16764942,colors_floor=5592405,colors_goblin=8497218,colors_player=16777215,colors_revealed=56575,colors_tool=14329120,colors_uiInteraction=803918,colors_uiLooking=4390949,colors_wall=11184810,colors_metal=7372944,chars_corpse="%",chars_default="?",chars_doorClosed="+",chars_floor="•",chars_goblin="g",chars_player="@",chars_tool="~",chars_wall="#",chars_brazier="^";function Appearance_component_typeof(obj){return Appearance_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Appearance_component_typeof(obj)}function Appearance_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Appearance_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===Appearance_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}var obj,key,value,Appearance=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(Appearance,_Component);var Constructor,protoProps,staticProps,_super=_createSuper(Appearance);function Appearance(){return Appearance_component_classCallCheck(this,Appearance),_super.apply(this,arguments)}return Constructor=Appearance,protoProps=[{key:"onChangeChar",value:function(evt){var _this=this;this.char=evt.data.value,this.entity.position&&setState((function(state){state.rerender.add(_this.entity.position)}))}}],protoProps&&Appearance_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Appearance_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Appearance}(Component);function Astar_component_typeof(obj){return Astar_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Astar_component_typeof(obj)}function Astar_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Astar_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Astar_component_setPrototypeOf(o,p){return Astar_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Astar_component_setPrototypeOf(o,p)}function Astar_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Astar_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Astar_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Astar_component_possibleConstructorReturn(this,result)}}function Astar_component_possibleConstructorReturn(self,call){if(call&&("object"===Astar_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Astar_component_getPrototypeOf(o){return Astar_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Astar_component_getPrototypeOf(o)}value={char:chars_default,color:colors_default,baseColor:colors_default,alpha:0},(key="properties")in(obj=Appearance)?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;var Astar=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Astar_component_setPrototypeOf(subClass,superClass)}(Astar,_Component);var Constructor,protoProps,staticProps,_super=Astar_component_createSuper(Astar);function Astar(){return Astar_component_classCallCheck(this,Astar),_super.apply(this,arguments)}return Constructor=Astar,protoProps&&Astar_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Astar_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function Impassable_component_typeof(obj){return Impassable_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Impassable_component_typeof(obj)}function Impassable_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Impassable_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Impassable_component_setPrototypeOf(o,p){return Impassable_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Impassable_component_setPrototypeOf(o,p)}function Impassable_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Impassable_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Impassable_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Impassable_component_possibleConstructorReturn(this,result)}}function Impassable_component_possibleConstructorReturn(self,call){if(call&&("object"===Impassable_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Impassable_component_getPrototypeOf(o){return Impassable_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Impassable_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Astar,"properties",{wt:1});var Impassable=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Impassable_component_setPrototypeOf(subClass,superClass)}(Impassable,_Component);var Constructor,protoProps,staticProps,_super=Impassable_component_createSuper(Impassable);function Impassable(){return Impassable_component_classCallCheck(this,Impassable),_super.apply(this,arguments)}return Constructor=Impassable,protoProps&&Impassable_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Impassable_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component),pathfinding=__webpack_require__(657),pathfinding_default=__webpack_require__.n(pathfinding);function logger_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function logger_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var addLog=function(template){var _getState=getState(),tick=_getState.tick;_getState.adventureLog.unshift({log:template,tick})},log=function(data){var _getState2=getState(),tick=_getState2.tick;_getState2.logsToProcess.push(function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?logger_ownKeys(Object(source),!0).forEach((function(key){logger_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):logger_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({tick},data))};function Motor_component_typeof(obj){return Motor_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Motor_component_typeof(obj)}function Motor_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Motor_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Motor_component_setPrototypeOf(o,p){return Motor_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Motor_component_setPrototypeOf(o,p)}function Motor_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Motor_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Motor_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Motor_component_possibleConstructorReturn(this,result)}}function Motor_component_possibleConstructorReturn(self,call){if(call&&("object"===Motor_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Motor_component_getPrototypeOf(o){return Motor_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Motor_component_getPrototypeOf(o)}var Motor=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Motor_component_setPrototypeOf(subClass,superClass)}(Motor,_Component);var Constructor,protoProps,staticProps,_super=Motor_component_createSuper(Motor);function Motor(){return Motor_component_classCallCheck(this,Motor),_super.apply(this,arguments)}return Constructor=Motor,protoProps=[{key:"onTryMove",value:function(evt){var _this=this,canMove=!1,position=evt.data.position,entsAtPos=getEntitiesAt(position),x=position.x,y=position.y,z=position.z;x>=0&&x<grid_grid.map.width&&y>=0&&y<grid_grid.map.height&&(canMove=!0);var bumpableEnt=null;return entsAtPos.find((function(ent){return ent.bumpable&&(bumpableEnt=ent),ent.bumpable})),bumpableEnt&&(bumpableEnt.fireEvent("get-bump-interactions",{interactor:this.entity,interactions:[]}).data.interactions.forEach((function(e){bumpableEnt.fireEvent(e.evt,{interactor:_this.entity})})),canMove=!1),canMove?(setState((function(state){var _this$entity$position=_this.entity.position,ox=_this$entity$position.x,oy=_this$entity$position.y,oz=_this$entity$position.z;state.rerender.add({x:ox,y:oy,z:oz}),state.rerender.add({x,y,z})})),this.entity.fireEvent("update-position",{x,y,z}),evt.handle(),!0):(evt.handle(),!1)}},{key:"onTryWander",value:function(evt){var position=this.entity.position,neighborPosition=_.sample(getNeighbors(position));this.onTryMove({data:{position:neighborPosition}})}},{key:"onGetBoredGoals",value:function(evt){evt.data.goals.push({name:"Wander",evt:"try-wander",source:this.entity})}}],protoProps&&Motor_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Motor_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Motor}(Component),isInvalid=function(goal){var parent=goal.parent,data=goal.data;if(goal.originalIntent!==goal.id){var ogIntentGoal=getEntity(goal.originalIntent);if(ogIntentGoal.goal.isInvalid(ogIntentGoal))return!0}return!isNeighbor(parent.position,data)},isFinished=function(goal){var parent=goal.parent,data=goal.data;return parent.position.x===data.x&&parent.position.y===data.y},takeAction=function(goal){var parent=goal.parent,data=goal.data;if(parent.has(Motor)){parent.fireEvent("tryMove",{position:data});return!0}},approachTarget_goal_isInvalid=function(goal){var data=goal.data,parent=goal.parent;return!isAtSamePosition(data.target.position,data)||!!isAtSamePosition(parent.position,data.target.position)},approachTarget_goal_isFinished=function(goal){var parent=goal.parent,target=goal.data.target;if(isNeighbor(parent.position,target.position))return!0},approachTarget_goal_takeAction=function(goal){var parent=goal.parent,target=goal.data.target;return function(start,end){var grid=getState().astarGrids[getState().currentMapId],pfGrid=new(pathfinding_default().Grid)(grid),path=new(pathfinding_default().AStarFinder)({allowDiagonal:!1,dontCrossCorners:!0}).findPath(start.x,start.y,end.x,end.y,pfGrid);return(0,lodash.tail)(path)}(parent.position,target.position).reverse().forEach((function(step){var moveToGoal=createGoal({goal:moveTo_goal_namespaceObject,name:"Move To Goal",data:{x:step[0],y:step[1],z:getState().z},originalIntent:goal.id});parent.brain.pushGoal(moveToGoal)})),parent.fireEvent("take-action"),!0};function killSomething_goal_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function killSomething_goal_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?killSomething_goal_ownKeys(Object(source),!0).forEach((function(key){killSomething_goal_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):killSomething_goal_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function killSomething_goal_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var killSomething_goal_isInvalid=function(goal){goal.parent;var data=goal.data;if(data.target.health&&data.target.health.current<=0)return!0},killSomething_goal_isFinished=function(goal){goal.parent;var data=goal.data;if(data.target.health&&data.target.health.current<=0)return!0},killSomething_goal_takeAction=function(goal){var parent=goal.parent,target=goal.data.target;if(!isAtSamePosition(parent.position,target.position)&&!isNeighbor(parent.position,target.position)){var approachTargetGoal=createGoal({goal:approachTarget_goal_namespaceObject,name:"Approach Target Goal",ogIntent:goal.originalIntent,data:killSomething_goal_objectSpread({target},target.position)});return parent.brain.pushGoal(approachTargetGoal),parent.fireEvent("take-action"),!0}if(isNeighbor(parent.position,target.position)){var interactions=[];parent.fireEvent("get-melee-interactions",{interactions,interactee:target,interactor:parent}),parent.inventory&&parent.inventory.contentIds.forEach((function(eId){getEntity(eId).fireEvent("get-melee-interactions",{interactions,interactee:target,interactor:parent})}));var interaction=(0,lodash.sample)(interactions),interactant=interaction.interactant,interactee=interaction.interactee,interactor=interaction.interactor;return interactant.fireEvent(interaction.evt,{interactant,interactee,interactor}),!0}},isBored=!0,bored_goal_isInvalid=function(){return!1},bored_goal_isFinished=function(){return!1},bored_goal_takeAction=function(goal){var parent=goal.parent,player=parent.fireEvent("tryPerception",{entities:[]}).data.entities.find((function(x){return x.pc}));if(player&&player.health.current>=0){var killSomethingGoal=createGoal({goal:killSomething_goal_namespaceObject,name:"Kill Something Goal",data:{target:player}});return parent.brain.pushGoal(killSomethingGoal),parent.fireEvent("take-action"),killSomethingGoal}parent.appearance.color="0x"+(16777215*Math.random()<<0).toString(16)};function Brain_component_typeof(obj){return Brain_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Brain_component_typeof(obj)}function Brain_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Brain_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Brain_component_setPrototypeOf(o,p){return Brain_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Brain_component_setPrototypeOf(o,p)}function Brain_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Brain_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Brain_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Brain_component_possibleConstructorReturn(this,result)}}function Brain_component_possibleConstructorReturn(self,call){if(call&&("object"===Brain_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Brain_component_getPrototypeOf(o){return Brain_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Brain_component_getPrototypeOf(o)}var Brain=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Brain_component_setPrototypeOf(subClass,superClass)}(Brain,_Component);var Constructor,protoProps,staticProps,_super=Brain_component_createSuper(Brain);function Brain(){return Brain_component_classCallCheck(this,Brain),_super.apply(this,arguments)}return Constructor=Brain,(protoProps=[{key:"onAttached",value:function(){if(this.goalIds=[],!this.goalIds.length){var goal=createGoal({goal:bored_goal_namespaceObject,name:"Bored Goal"});this.pushGoal(goal)}}},{key:"onDestroyed",value:function(){this.goalIds.forEach((function(eid){getEntity(eid).destroy()}))}},{key:"popAndDestroyGoal",value:function(){this.popGoal().destroy()}},{key:"removeFinishedGoals",value:function(){for(;this.peekGoal()&&this.peekGoal().goal.isFinished(this.peekGoal());)this.popAndDestroyGoal()}},{key:"fallBackToOriginalIntent",value:function(eId){for(;this.peekGoal()&&this.peekGoal().goal.id!==eId&&!this.peekGoal().goal.isBored;)this.popAndDestroyGoal();return this.peekGoal()}},{key:"onTakeAction",value:function(evt){this.removeFinishedGoals();var currentGoal=this.peekGoal();if(currentGoal){var currentValidGoal=currentGoal;currentValidGoal.goal.isInvalid(currentValidGoal)&&(currentValidGoal=this.fallBackToOriginalIntent(currentValidGoal.goal.originalIntent)),currentValidGoal.goal.takeAction(currentValidGoal),currentValidGoal.goal.isBored||this.popAndDestroyGoal()}evt.handle()}},{key:"removeGoal",value:function(goal){var goalsToDestroy=[];this.goalIds=this.goalIds.filter((function(gid){var gEnt=getEntity(gid),isSelf=Boolean(gEnt.id===goal.id),isSiblingGoal=Boolean(gEnt.goal.originalIntent&&gEnt.goal.originalIntent.id===goal.goal.originalIntent.id);return!isSelf&&!isSiblingGoal||(goalsToDestroy.push(gEnt.goal),!1)})),goalsToDestroy.forEach((function(gEnt){return gEnt.destroy()}))}},{key:"pushGoal",value:function(goal){return goal.parent=this.entity,this.goalIds.push(goal.id)}},{key:"popGoal",value:function(){var eid=this.goalIds.pop();return getEntity(eid)}},{key:"peekGoal",value:function(){var eid=this.goalIds[this.goalIds.length-1];if(eid)return getEntity(eid)}}])&&Brain_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Brain_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Brain}(Component);function Bumpable_component_typeof(obj){return Bumpable_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Bumpable_component_typeof(obj)}function Bumpable_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Bumpable_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Bumpable_component_setPrototypeOf(o,p){return Bumpable_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Bumpable_component_setPrototypeOf(o,p)}function Bumpable_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Bumpable_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Bumpable_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Bumpable_component_possibleConstructorReturn(this,result)}}function Bumpable_component_possibleConstructorReturn(self,call){if(call&&("object"===Bumpable_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Bumpable_component_getPrototypeOf(o){return Bumpable_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Bumpable_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Brain,"properties",{goalIds:[]});var Bumpable=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Bumpable_component_setPrototypeOf(subClass,superClass)}(Bumpable,_Component);var Constructor,protoProps,staticProps,_super=Bumpable_component_createSuper(Bumpable);function Bumpable(){return Bumpable_component_classCallCheck(this,Bumpable),_super.apply(this,arguments)}return Constructor=Bumpable,(protoProps=[{key:"onBump",value:function(evt){if(this.entity.fightable){var _interactor$equipment,_interactor$equipment2,interactor=evt.data.interactor,primaryWeaponId=(null==interactor||null===(_interactor$equipment=interactor.equipmentSlot)||void 0===_interactor$equipment||null===(_interactor$equipment2=_interactor$equipment.leftHand)||void 0===_interactor$equipment2?void 0:_interactor$equipment2.contentId)||null;if(primaryWeaponId){var interactant=getEntity(primaryWeaponId),interactions=[];interactant.fireEvent("get-melee-interactions",{interactions,interactee:this.entity,interactor});var interaction=(0,lodash.sample)(interactions);interactant.fireEvent(interaction.evt,{interactant,interactee:this.entity,interactor})}}this.entity.display&&log({evt,source:this.entity})}},{key:"onGetBumpInteractions",value:function(evt){evt.data.interactions.push({name:"Bump",evt:"bump"})}}])&&Bumpable_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Bumpable_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Bumpable}(Component);function LightSource_component_typeof(obj){return LightSource_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},LightSource_component_typeof(obj)}function LightSource_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function LightSource_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function LightSource_component_setPrototypeOf(o,p){return LightSource_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},LightSource_component_setPrototypeOf(o,p)}function LightSource_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=LightSource_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=LightSource_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return LightSource_component_possibleConstructorReturn(this,result)}}function LightSource_component_possibleConstructorReturn(self,call){if(call&&("object"===LightSource_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function LightSource_component_getPrototypeOf(o){return LightSource_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},LightSource_component_getPrototypeOf(o)}var LightSource=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&LightSource_component_setPrototypeOf(subClass,superClass)}(LightSource,_Component);var Constructor,protoProps,staticProps,_super=LightSource_component_createSuper(LightSource);function LightSource(){return LightSource_component_classCallCheck(this,LightSource),_super.apply(this,arguments)}return Constructor=LightSource,(protoProps=[{key:"onRecalcLight",value:function(){this.recalc=!0}}])&&LightSource_component_defineProperties(Constructor.prototype,protoProps),staticProps&&LightSource_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),LightSource}(Component);function Fire_component_typeof(obj){return Fire_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Fire_component_typeof(obj)}function Fire_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Fire_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Fire_component_setPrototypeOf(o,p){return Fire_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Fire_component_setPrototypeOf(o,p)}function Fire_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Fire_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Fire_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Fire_component_possibleConstructorReturn(this,result)}}function Fire_component_possibleConstructorReturn(self,call){if(call&&("object"===Fire_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Fire_component_getPrototypeOf(o){return Fire_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Fire_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(LightSource,"properties",{lumens:100,beam:5,stationary:!0,recalc:!0});var Fire=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Fire_component_setPrototypeOf(subClass,superClass)}(Fire,_Component);var Constructor,protoProps,staticProps,_super=Fire_component_createSuper(Fire);function Fire(){return Fire_component_classCallCheck(this,Fire),_super.apply(this,arguments)}return Constructor=Fire,protoProps=[{key:"onAttached",value:function(){this.entity.add(LightSource,{stationary:!0}),this.entity.appearance.color=colors_fire,setState((function(state){return state.recalcLighting=!0}))}},{key:"onDestroyed",value:function(){this.entity.remove(this.entity.lightSource),this.entity.appearance.color=this.entity.appearance.baseColor,setState((function(state){return state.recalcLighting=!0}))}},{key:"onTryExtinguish",value:function(evt){log({evt,source:this.entity}),this.destroy()}},{key:"onGetInteractions",value:function(evt){var _evt$data=evt.data,interactor=_evt$data.interactor,interactant=(_evt$data.interactee,_evt$data.interactant);evt.data.interactions.push({name:"Extinguish",evt:"try-extinguish",interactor,interactant,interactee:this.entity,caller:"interactee"})}}],protoProps&&Fire_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Fire_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Fire}(Component);function Combustible_component_typeof(obj){return Combustible_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Combustible_component_typeof(obj)}function Combustible_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Combustible_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Combustible_component_setPrototypeOf(o,p){return Combustible_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Combustible_component_setPrototypeOf(o,p)}function Combustible_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Combustible_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Combustible_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Combustible_component_possibleConstructorReturn(this,result)}}function Combustible_component_possibleConstructorReturn(self,call){if(call&&("object"===Combustible_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Combustible_component_getPrototypeOf(o){return Combustible_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Combustible_component_getPrototypeOf(o)}var Combustible=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Combustible_component_setPrototypeOf(subClass,superClass)}(Combustible,_Component);var Constructor,protoProps,staticProps,_super=Combustible_component_createSuper(Combustible);function Combustible(){return Combustible_component_classCallCheck(this,Combustible),_super.apply(this,arguments)}return Constructor=Combustible,(protoProps=[{key:"isOnFire",get:function(){return!!this.entity.fire}},{key:"onTryIgnite",value:function(evt){this.entity.add(Fire),log({evt,source:this.entity})}},{key:"onGetInteractions",value:function(evt){if(!this.isOnFire){var _evt$data=evt.data,interactor=_evt$data.interactor,interactant=(_evt$data.interactee,_evt$data.interactant);evt.data.interactions.push({name:"Ignite",evt:"try-ignite",interactor,interactee:this.entity,interactant,caller:"interactee"})}}}])&&Combustible_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Combustible_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Combustible}(Component);function Damage_component_typeof(obj){return Damage_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Damage_component_typeof(obj)}function Damage_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Damage_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Damage_component_setPrototypeOf(o,p){return Damage_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Damage_component_setPrototypeOf(o,p)}function Damage_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Damage_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Damage_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Damage_component_possibleConstructorReturn(this,result)}}function Damage_component_possibleConstructorReturn(self,call){if(call&&("object"===Damage_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Damage_component_getPrototypeOf(o){return Damage_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Damage_component_getPrototypeOf(o)}function Damage_component_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function Damage_component_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Damage_component_ownKeys(Object(source),!0).forEach((function(key){Damage_component_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):Damage_component_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function Damage_component_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var meleeDmgTypes={BLUDGEONING:"BLUDGEONING",PIERCING:"PIERCING",SLASHING:"SLASHING"},magicDmgTypes={ACID:"ACID",COLD:"COLD",FIRE:"FIRE",FORCE:"FORCE",ELECTRIC:"ELECTRIC",NECROTIC:"NECROTIC",POISON:"POISON",PSYCHIC:"PSYCHIC",RADIANT:"RADIANT",SONIC:"SONIC"},dmgTypes=Damage_component_objectSpread(Damage_component_objectSpread({},meleeDmgTypes),magicDmgTypes),Damage=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Damage_component_setPrototypeOf(subClass,superClass)}(Damage,_Component);var Constructor,protoProps,staticProps,_super=Damage_component_createSuper(Damage);function Damage(){return Damage_component_classCallCheck(this,Damage),_super.apply(this,arguments)}return Constructor=Damage,(protoProps=[{key:"onGetDamageTypes",value:function(evt){evt.data.damageTypes.push({type:this.type,value:this.value})}}])&&Damage_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Damage_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Damage}(Component);function DamageImmunity_component_typeof(obj){return DamageImmunity_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},DamageImmunity_component_typeof(obj)}function DamageImmunity_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function DamageImmunity_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function DamageImmunity_component_setPrototypeOf(o,p){return DamageImmunity_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},DamageImmunity_component_setPrototypeOf(o,p)}function DamageImmunity_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=DamageImmunity_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=DamageImmunity_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return DamageImmunity_component_possibleConstructorReturn(this,result)}}function DamageImmunity_component_possibleConstructorReturn(self,call){if(call&&("object"===DamageImmunity_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function DamageImmunity_component_getPrototypeOf(o){return DamageImmunity_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},DamageImmunity_component_getPrototypeOf(o)}function DamageImmunity_component_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Damage_component_defineProperty(Damage,"properties",{type:dmgTypes.BLUDGEONING,value:1}),Damage_component_defineProperty(Damage,"allowMultiple",!0);var DamageImmunity=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&DamageImmunity_component_setPrototypeOf(subClass,superClass)}(DamageImmunity,_Component);var Constructor,protoProps,staticProps,_super=DamageImmunity_component_createSuper(DamageImmunity);function DamageImmunity(){return DamageImmunity_component_classCallCheck(this,DamageImmunity),_super.apply(this,arguments)}return Constructor=DamageImmunity,(protoProps=[{key:"onGetImmunities",value:function(evt){evt.data.immunities.push(this.type)}}])&&DamageImmunity_component_defineProperties(Constructor.prototype,protoProps),staticProps&&DamageImmunity_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),DamageImmunity}(Component);function DamageResistance_component_typeof(obj){return DamageResistance_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},DamageResistance_component_typeof(obj)}function DamageResistance_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function DamageResistance_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function DamageResistance_component_setPrototypeOf(o,p){return DamageResistance_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},DamageResistance_component_setPrototypeOf(o,p)}function DamageResistance_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=DamageResistance_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=DamageResistance_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return DamageResistance_component_possibleConstructorReturn(this,result)}}function DamageResistance_component_possibleConstructorReturn(self,call){if(call&&("object"===DamageResistance_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function DamageResistance_component_getPrototypeOf(o){return DamageResistance_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},DamageResistance_component_getPrototypeOf(o)}function DamageResistance_component_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}DamageImmunity_component_defineProperty(DamageImmunity,"properties",{type:""}),DamageImmunity_component_defineProperty(DamageImmunity,"allowMultiple",!0);var DamageResistance=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&DamageResistance_component_setPrototypeOf(subClass,superClass)}(DamageResistance,_Component);var Constructor,protoProps,staticProps,_super=DamageResistance_component_createSuper(DamageResistance);function DamageResistance(){return DamageResistance_component_classCallCheck(this,DamageResistance),_super.apply(this,arguments)}return Constructor=DamageResistance,(protoProps=[{key:"onGetResistances",value:function(evt){evt.data.resistances.push(this.type)}}])&&DamageResistance_component_defineProperties(Constructor.prototype,protoProps),staticProps&&DamageResistance_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),DamageResistance}(Component);function DamageVulnerability_component_typeof(obj){return DamageVulnerability_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},DamageVulnerability_component_typeof(obj)}function DamageVulnerability_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function DamageVulnerability_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function DamageVulnerability_component_setPrototypeOf(o,p){return DamageVulnerability_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},DamageVulnerability_component_setPrototypeOf(o,p)}function DamageVulnerability_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=DamageVulnerability_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=DamageVulnerability_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return DamageVulnerability_component_possibleConstructorReturn(this,result)}}function DamageVulnerability_component_possibleConstructorReturn(self,call){if(call&&("object"===DamageVulnerability_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function DamageVulnerability_component_getPrototypeOf(o){return DamageVulnerability_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},DamageVulnerability_component_getPrototypeOf(o)}function DamageVulnerability_component_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}DamageResistance_component_defineProperty(DamageResistance,"properties",{type:""}),DamageResistance_component_defineProperty(DamageResistance,"allowMultiple",!0);var DamageVulnerability=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&DamageVulnerability_component_setPrototypeOf(subClass,superClass)}(DamageVulnerability,_Component);var Constructor,protoProps,staticProps,_super=DamageVulnerability_component_createSuper(DamageVulnerability);function DamageVulnerability(){return DamageVulnerability_component_classCallCheck(this,DamageVulnerability),_super.apply(this,arguments)}return Constructor=DamageVulnerability,(protoProps=[{key:"onGetVulnerabilities",value:function(evt){evt.data.vulnerabilities.push(this.type)}}])&&DamageVulnerability_component_defineProperties(Constructor.prototype,protoProps),staticProps&&DamageVulnerability_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),DamageVulnerability}(Component);function Discoverable_component_typeof(obj){return Discoverable_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Discoverable_component_typeof(obj)}function Discoverable_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Discoverable_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Discoverable_component_setPrototypeOf(o,p){return Discoverable_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Discoverable_component_setPrototypeOf(o,p)}function Discoverable_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Discoverable_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Discoverable_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Discoverable_component_possibleConstructorReturn(this,result)}}function Discoverable_component_possibleConstructorReturn(self,call){if(call&&("object"===Discoverable_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Discoverable_component_getPrototypeOf(o){return Discoverable_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Discoverable_component_getPrototypeOf(o)}DamageVulnerability_component_defineProperty(DamageVulnerability,"properties",{type:""}),DamageVulnerability_component_defineProperty(DamageVulnerability,"allowMultiple",!0);var Discoverable=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Discoverable_component_setPrototypeOf(subClass,superClass)}(Discoverable,_Component);var Constructor,protoProps,staticProps,_super=Discoverable_component_createSuper(Discoverable);function Discoverable(){return Discoverable_component_classCallCheck(this,Discoverable),_super.apply(this,arguments)}return Constructor=Discoverable,protoProps&&Discoverable_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Discoverable_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function Display_component_typeof(obj){return Display_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Display_component_typeof(obj)}function Display_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Display_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Display_component_setPrototypeOf(o,p){return Display_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Display_component_setPrototypeOf(o,p)}function Display_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Display_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Display_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Display_component_possibleConstructorReturn(this,result)}}function Display_component_possibleConstructorReturn(self,call){if(call&&("object"===Display_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Display_component_getPrototypeOf(o){return Display_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Display_component_getPrototypeOf(o)}var Display=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Display_component_setPrototypeOf(subClass,superClass)}(Display,_Component);var Constructor,protoProps,staticProps,_super=Display_component_createSuper(Display);function Display(){return Display_component_classCallCheck(this,Display),_super.apply(this,arguments)}return Constructor=Display,(protoProps=[{key:"simple",get:function(){return this.name}},{key:"detailed",get:function(){return this.entity.door?this.entity.door.isOpen?"an open ".concat(this.name):"a closed ".concat(this.name):this.entity.fire?"a burning ".concat(this.name):this.entity.equipped?"".concat(this.name," [equipped]"):this.simple}}])&&Display_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Display_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Display}(Component);function Lock_component_typeof(obj){return Lock_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Lock_component_typeof(obj)}function Lock_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Lock_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Lock_component_setPrototypeOf(o,p){return Lock_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Lock_component_setPrototypeOf(o,p)}function Lock_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Lock_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Lock_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Lock_component_possibleConstructorReturn(this,result)}}function Lock_component_possibleConstructorReturn(self,call){if(call&&("object"===Lock_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Lock_component_getPrototypeOf(o){return Lock_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Lock_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Display,"properties",{name:"Unknown",description:"You can't even know!"});var Lock=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Lock_component_setPrototypeOf(subClass,superClass)}(Lock,_Component);var Constructor,protoProps,staticProps,_super=Lock_component_createSuper(Lock);function Lock(){return Lock_component_classCallCheck(this,Lock),_super.apply(this,arguments)}return Constructor=Lock,(protoProps=[{key:"lock",value:function(){if(this.isLocked)return!1;this.isLocked=!0}},{key:"unlock",value:function(){if(!this.isLocked)return!1;this.isLocked=!1}},{key:"onTryLock",value:function(evt){this.lock()?console.log("this lock is locked"):log({evt,source:this.entity})}},{key:"onTryUnlock",value:function(evt){this.unlock()?console.log("the lock is unlocked"):log({evt,source:this.entity})}},{key:"onGetInteractions",value:function(evt){var _evt$data=evt.data,interactor=_evt$data.interactor,interactant=(_evt$data.interactee,_evt$data.interactant);this.isLocked||evt.data.interactions.push({name:"Lock",evt:"try-lock",interactor,interactee:this.entity,interactant,caller:"interactee"})}}])&&Lock_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Lock_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Lock}(Component);function Shadowcaster_component_typeof(obj){return Shadowcaster_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Shadowcaster_component_typeof(obj)}function Shadowcaster_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Shadowcaster_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Shadowcaster_component_setPrototypeOf(o,p){return Shadowcaster_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Shadowcaster_component_setPrototypeOf(o,p)}function Shadowcaster_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Shadowcaster_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Shadowcaster_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Shadowcaster_component_possibleConstructorReturn(this,result)}}function Shadowcaster_component_possibleConstructorReturn(self,call){if(call&&("object"===Shadowcaster_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Shadowcaster_component_getPrototypeOf(o){return Shadowcaster_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Shadowcaster_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Lock,"properties",{isLocked:!1});var Shadowcaster=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Shadowcaster_component_setPrototypeOf(subClass,superClass)}(Shadowcaster,_Component);var Constructor,protoProps,staticProps,_super=Shadowcaster_component_createSuper(Shadowcaster);function Shadowcaster(){return Shadowcaster_component_classCallCheck(this,Shadowcaster),_super.apply(this,arguments)}return Constructor=Shadowcaster,protoProps&&Shadowcaster_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Shadowcaster_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function Door_component_typeof(obj){return Door_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Door_component_typeof(obj)}function Door_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Door_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Door_component_setPrototypeOf(o,p){return Door_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Door_component_setPrototypeOf(o,p)}function Door_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Door_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Door_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Door_component_possibleConstructorReturn(this,result)}}function Door_component_possibleConstructorReturn(self,call){if(call&&("object"===Door_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Door_component_getPrototypeOf(o){return Door_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Door_component_getPrototypeOf(o)}var Door=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Door_component_setPrototypeOf(subClass,superClass)}(Door,_Component);var Constructor,protoProps,staticProps,_super=Door_component_createSuper(Door);function Door(){return Door_component_classCallCheck(this,Door),_super.apply(this,arguments)}return Constructor=Door,protoProps=[{key:"char",get:function(){return this.isOpen?this.charOpen:this.charClosed}},{key:"openDoor",value:function(){return!this.isOpen&&(this.entity.has(Lock)&&this.entity.lock.isLocked?(console.log("the door is locked"),!1):(this.isOpen=!0,this.entity.appearance.char=this.char,this.entity.bumpable.destroy(),this.entity.shadowcaster.destroy(),!0))}},{key:"closeDoor",value:function(){return!!this.isOpen&&(this.isOpen=!1,this.entity.appearance.char=this.char,this.entity.add(Bumpable),this.entity.add(Shadowcaster),!0)}},{key:"onTryCloseDoor",value:function(evt){this.closeDoor()&&(setState((function(state){return state.recalcLighting=!0})),log({evt,source:this.entity})),evt.handle()}},{key:"onTryOpenDoor",value:function(evt){this.openDoor()&&(setState((function(state){return state.recalcLighting=!0})),log({evt,source:this.entity})),evt.handle()}},{key:"onGetBumpInteractions",value:function(evt){this.isOpen?evt.data.interactions.push({name:"Close door",evt:"try-close-door"}):evt.data.interactions.push({name:"Open door",evt:"try-open-door"})}},{key:"onGetInteractions",value:function(evt){var _evt$data=evt.data,interactor=_evt$data.interactor,interactant=(_evt$data.interactee,_evt$data.interactant);this.isOpen?evt.data.interactions.push({name:"Close",evt:"try-close-door",interactor,interactee:this.entity,interactant,caller:"interactee"}):evt.data.interactions.push({name:"Open",evt:"try-open-door",interactor,interactee:this.entity,interactant,caller:"interactee"})}}],protoProps&&Door_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Door_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Door}(Component);function Equipped_component_typeof(obj){return Equipped_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Equipped_component_typeof(obj)}function Equipped_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Equipped_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Equipped_component_setPrototypeOf(o,p){return Equipped_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Equipped_component_setPrototypeOf(o,p)}function Equipped_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Equipped_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Equipped_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Equipped_component_possibleConstructorReturn(this,result)}}function Equipped_component_possibleConstructorReturn(self,call){if(call&&("object"===Equipped_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Equipped_component_getPrototypeOf(o){return Equipped_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Equipped_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Door,"properties",{isOpen:!1,charOpen:"'",charClosed:"+"});var Equipped=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Equipped_component_setPrototypeOf(subClass,superClass)}(Equipped,_Component);var Constructor,protoProps,staticProps,_super=Equipped_component_createSuper(Equipped);function Equipped(){return Equipped_component_classCallCheck(this,Equipped),_super.apply(this,arguments)}return Constructor=Equipped,(protoProps=[{key:"slot",get:function(){return getEntity(this.ownerId).equipmentSlot[this.slotKey]}},{key:"onDropped",value:function(evt){this.slot.unequip(),evt.handle()}}])&&Equipped_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Equipped_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Equipped}(Component);function EquipmentSlot_component_typeof(obj){return EquipmentSlot_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},EquipmentSlot_component_typeof(obj)}function EquipmentSlot_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function EquipmentSlot_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function EquipmentSlot_component_setPrototypeOf(o,p){return EquipmentSlot_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},EquipmentSlot_component_setPrototypeOf(o,p)}function EquipmentSlot_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=EquipmentSlot_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=EquipmentSlot_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return EquipmentSlot_component_possibleConstructorReturn(this,result)}}function EquipmentSlot_component_possibleConstructorReturn(self,call){if(call&&("object"===EquipmentSlot_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function EquipmentSlot_component_getPrototypeOf(o){return EquipmentSlot_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},EquipmentSlot_component_getPrototypeOf(o)}function EquipmentSlot_component_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Equipped,"properties",{slotKey:"",ownerId:""});var EquipmentSlot=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&EquipmentSlot_component_setPrototypeOf(subClass,superClass)}(EquipmentSlot,_Component);var Constructor,protoProps,staticProps,_super=EquipmentSlot_component_createSuper(EquipmentSlot);function EquipmentSlot(){return EquipmentSlot_component_classCallCheck(this,EquipmentSlot),_super.apply(this,arguments)}return Constructor=EquipmentSlot,(protoProps=[{key:"equip",value:function(entity){entity.loot.take(this.entity),entity.add(Equipped),entity.equipped.slotKey=this.slotKey,entity.equipped.ownerId=this.entity.id,this.contentId=entity.id}},{key:"unequip",value:function(){var content=getEntity(this.contentId);this.contentId=null,content.equipped.destroy()}},{key:"onTryEquip",value:function(evt){if(evt.data.slot===this.slotKey){var entity=evt.data.entity;return entity?this.contentId?(console.log("Cannot equip, slot is full"),evt.handle(),!1):(this.equip(entity),evt.handle(),!0):(console.log("Error: no entity"),evt.handle(),!1)}return!1}},{key:"onTryUnequip",value:function(evt){return evt.data.slot===this.slotKey&&(this.contentId="",evt.handle(),!0)}}])&&EquipmentSlot_component_defineProperties(Constructor.prototype,protoProps),staticProps&&EquipmentSlot_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),EquipmentSlot}(Component);function Eyes_component_typeof(obj){return Eyes_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Eyes_component_typeof(obj)}function Eyes_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Eyes_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Eyes_component_setPrototypeOf(o,p){return Eyes_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Eyes_component_setPrototypeOf(o,p)}function Eyes_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Eyes_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Eyes_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Eyes_component_possibleConstructorReturn(this,result)}}function Eyes_component_possibleConstructorReturn(self,call){if(call&&("object"===Eyes_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Eyes_component_getPrototypeOf(o){return Eyes_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Eyes_component_getPrototypeOf(o)}EquipmentSlot_component_defineProperty(EquipmentSlot,"allowMultiple",!0),EquipmentSlot_component_defineProperty(EquipmentSlot,"keyProperty","slotKey"),EquipmentSlot_component_defineProperty(EquipmentSlot,"properties",{name:"",slotKey:"",isPrimary:!1,contentId:""});var Eyes=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Eyes_component_setPrototypeOf(subClass,superClass)}(Eyes,_Component);var Constructor,protoProps,staticProps,_super=Eyes_component_createSuper(Eyes);function Eyes(){return Eyes_component_classCallCheck(this,Eyes),_super.apply(this,arguments)}return Constructor=Eyes,(protoProps=[{key:"canSee",value:function(entity){var lineOfSight=line(this.entity.position,entity.position);return!(lineOfSight.length>this.range||lineOfSight.some((function(segment){return getEntitiesAt(segment).some((function(entity){return entity.has(Shadowcaster)}))})))}},{key:"onTryPerception",value:function(evt){var _this=this;this.entity.position&&(getEntitiesInRange(this.entity.position,this.range).forEach((function(ent){_this.canSee(ent)&&evt.data.entities.push(ent)})),evt.handle())}}])&&Eyes_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Eyes_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Eyes}(Component);function Fightable_component_typeof(obj){return Fightable_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Fightable_component_typeof(obj)}function Fightable_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Fightable_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Fightable_component_setPrototypeOf(o,p){return Fightable_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Fightable_component_setPrototypeOf(o,p)}function Fightable_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Fightable_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Fightable_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Fightable_component_possibleConstructorReturn(this,result)}}function Fightable_component_possibleConstructorReturn(self,call){if(call&&("object"===Fightable_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Fightable_component_getPrototypeOf(o){return Fightable_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Fightable_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Eyes,"properties",{range:5});var Fightable=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Fightable_component_setPrototypeOf(subClass,superClass)}(Fightable,_Component);var Constructor,protoProps,staticProps,_super=Fightable_component_createSuper(Fightable);function Fightable(){return Fightable_component_classCallCheck(this,Fightable),_super.apply(this,arguments)}return Constructor=Fightable,protoProps&&Fightable_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Fightable_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function Goal_component_typeof(obj){return Goal_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Goal_component_typeof(obj)}function Goal_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Goal_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Goal_component_setPrototypeOf(o,p){return Goal_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Goal_component_setPrototypeOf(o,p)}function Goal_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Goal_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Goal_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Goal_component_possibleConstructorReturn(this,result)}}function Goal_component_possibleConstructorReturn(self,call){if(call&&("object"===Goal_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Goal_component_getPrototypeOf(o){return Goal_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Goal_component_getPrototypeOf(o)}var Goal=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Goal_component_setPrototypeOf(subClass,superClass)}(Goal,_Component);var Constructor,protoProps,staticProps,_super=Goal_component_createSuper(Goal);function Goal(){return Goal_component_classCallCheck(this,Goal),_super.apply(this,arguments)}return Constructor=Goal,(protoProps=[{key:"onAttached",value:function(){this.originalIntent=this.entity}}])&&Goal_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Goal_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Goal}(Component);function IsDead_component_typeof(obj){return IsDead_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},IsDead_component_typeof(obj)}function IsDead_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function IsDead_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function IsDead_component_setPrototypeOf(o,p){return IsDead_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},IsDead_component_setPrototypeOf(o,p)}function IsDead_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=IsDead_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=IsDead_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return IsDead_component_possibleConstructorReturn(this,result)}}function IsDead_component_possibleConstructorReturn(self,call){if(call&&("object"===IsDead_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function IsDead_component_getPrototypeOf(o){return IsDead_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},IsDead_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Goal,"properties",{isFinished:function(){return!0},takeAction:function(){return!1},originalIntent:null,data:{}});var IsDead=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&IsDead_component_setPrototypeOf(subClass,superClass)}(IsDead,_Component);var Constructor,protoProps,staticProps,_super=IsDead_component_createSuper(IsDead);function IsDead(){return IsDead_component_classCallCheck(this,IsDead),_super.apply(this,arguments)}return Constructor=IsDead,protoProps&&IsDead_component_defineProperties(Constructor.prototype,protoProps),staticProps&&IsDead_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function Health_component_typeof(obj){return Health_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Health_component_typeof(obj)}function Health_component_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return Health_component_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return Health_component_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Health_component_arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Health_component_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Health_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Health_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Health_component_setPrototypeOf(o,p){return Health_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Health_component_setPrototypeOf(o,p)}function Health_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Health_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Health_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Health_component_possibleConstructorReturn(this,result)}}function Health_component_possibleConstructorReturn(self,call){if(call&&("object"===Health_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Health_component_getPrototypeOf(o){return Health_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Health_component_getPrototypeOf(o)}var Health=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Health_component_setPrototypeOf(subClass,superClass)}(Health,_Component);var Constructor,protoProps,staticProps,_super=Health_component_createSuper(Health);function Health(){return Health_component_classCallCheck(this,Health),_super.apply(this,arguments)}return Constructor=Health,protoProps=[{key:"onApplyDamage",value:function(evt){var _evt$data=evt.data,damageTypes=_evt$data.damageTypes,interactee=_evt$data.interactee,interactor=_evt$data.interactor,interactant=_evt$data.interactant,verb=_evt$data.verb,dmgType=_evt$data.dmgType,applicableMeleeDmgTypes=Object.keys(meleeDmgTypes).filter((function(dt){return dt===dmgType})),applicableMagicDmgTypes=Object.keys(magicDmgTypes).filter((function(dt){return damageTypes.map((function(damageType){return damageType.type})).includes(dt)})),applicableDmgTypes=[].concat(Health_component_toConsumableArray(applicableMeleeDmgTypes),Health_component_toConsumableArray(applicableMagicDmgTypes)),damageTotal=0,resistances=interactee.fireEvent("get-resistances",{resistances:[]}).data.resistances,immunities=interactee.fireEvent("get-immunities",{immunities:[]}).data.immunities,vulnerabilities=interactee.fireEvent("get-vulnerabilities",{vulnerabilities:[]}).data.vulnerabilities;damageTypes.forEach((function(dt){applicableDmgTypes.includes(dt.type)&&(damageTotal+=function(_ref){var damage=_ref.damage,_ref$vulnerabilities=_ref.vulnerabilities,vulnerabilities=void 0===_ref$vulnerabilities?[]:_ref$vulnerabilities,_ref$resistances=_ref.resistances,resistances=void 0===_ref$resistances?[]:_ref$resistances,_ref$immunities=_ref.immunities,immunities=void 0===_ref$immunities?[]:_ref$immunities,type=damage.type,finalValue=damage.value;return resistances.includes(type)&&(finalValue/=2),vulnerabilities.includes(type)&&(finalValue*=2),immunities.includes(type)&&(finalValue=0),finalValue}({damage:dt,resistances,vulnerabilities,immunities}))})),damageTotal>0?(this.current-=damageTotal,log({log:[{str:"The ".concat(interactor.display.name," ").concat(verb," the ").concat(interactee.display.name," with the ").concat(interactant.display.name," for ").concat(damageTotal," damage!")}]})):log({log:[{str:"The ".concat(interactor.display.name," deals a glancing blow for no damage. ")}]}),this.current<=0&&(this.entity.add(IsDead),this.entity.pc&&setState((function(state){return state.mode="GAME_OVER"}))),evt.handle()}}],protoProps&&Health_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Health_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Health}(Component);function InFov_component_typeof(obj){return InFov_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},InFov_component_typeof(obj)}function InFov_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function InFov_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function InFov_component_setPrototypeOf(o,p){return InFov_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},InFov_component_setPrototypeOf(o,p)}function InFov_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=InFov_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=InFov_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return InFov_component_possibleConstructorReturn(this,result)}}function InFov_component_possibleConstructorReturn(self,call){if(call&&("object"===InFov_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function InFov_component_getPrototypeOf(o){return InFov_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},InFov_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Health,"properties",{max:10,current:10});var InFov=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&InFov_component_setPrototypeOf(subClass,superClass)}(InFov,_Component);var Constructor,protoProps,staticProps,_super=InFov_component_createSuper(InFov);function InFov(){return InFov_component_classCallCheck(this,InFov),_super.apply(this,arguments)}return Constructor=InFov,protoProps&&InFov_component_defineProperties(Constructor.prototype,protoProps),staticProps&&InFov_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function Position_component_typeof(obj){return Position_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Position_component_typeof(obj)}function Position_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Position_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Position_component_setPrototypeOf(o,p){return Position_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Position_component_setPrototypeOf(o,p)}function Position_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Position_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Position_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Position_component_possibleConstructorReturn(this,result)}}function Position_component_possibleConstructorReturn(self,call){if(call&&("object"===Position_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Position_component_getPrototypeOf(o){return Position_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Position_component_getPrototypeOf(o)}var Position=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Position_component_setPrototypeOf(subClass,superClass)}(Position,_Component);var Constructor,protoProps,staticProps,_super=Position_component_createSuper(Position);function Position(){return Position_component_classCallCheck(this,Position),_super.apply(this,arguments)}return Constructor=Position,protoProps=[{key:"onAttached",value:function(entity){setState((function(state){var currentMapId=state.currentMapId,_entity$position=entity.position,x=_entity$position.x,y=_entity$position.y;state.maps[currentMapId][y][x]||(state.maps[currentMapId][y][x]=new Set),state.maps[currentMapId][y][x].add(entity.id)}))}},{key:"onUpdatePosition",value:function(evt){var _this=this;setState((function(state){state.maps[state.currentMapId][_this.y][_this.x].delete(_this.entity.id),_this.entity.impassable&&state.astarGrids[state.currentMapId]&&(state.astarGrids[state.currentMapId][_this.y][_this.x]=1)})),this.x=evt.data.x,this.y=evt.data.y,this.z=evt.data.z||getState().z,this.entity.has(LightSource)&&(this.entity.lightSource.recalc=!0),evt.handle(),setState((function(state){state.maps[state.currentMapId][_this.y][_this.x].add(_this.entity.id),_this.entity.impassable&&state.astarGrids[state.currentMapId]&&(state.astarGrids[state.currentMapId][_this.y][_this.x]=0)}))}},{key:"onDestroyed",value:function(){var _this2=this;setState((function(state){state.maps[state.currentMapId][_this2.y][_this2.x].delete(_this2.entity.id)})),this.entity.revealed&&this.entity.remove(this.entity.revealed)}}],protoProps&&Position_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Position_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Position}(Component);function Inventory_component_typeof(obj){return Inventory_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Inventory_component_typeof(obj)}function Inventory_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Inventory_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Inventory_component_setPrototypeOf(o,p){return Inventory_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Inventory_component_setPrototypeOf(o,p)}function Inventory_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Inventory_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Inventory_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Inventory_component_possibleConstructorReturn(this,result)}}function Inventory_component_possibleConstructorReturn(self,call){if(call&&("object"===Inventory_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Inventory_component_getPrototypeOf(o){return Inventory_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Inventory_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Position,"properties",{x:0,y:0,z:0});var Inventory=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Inventory_component_setPrototypeOf(subClass,superClass)}(Inventory,_Component);var Constructor,protoProps,staticProps,_super=Inventory_component_createSuper(Inventory);function Inventory(){return Inventory_component_classCallCheck(this,Inventory),_super.apply(this,arguments)}return Constructor=Inventory,protoProps=[{key:"onAttached",value:function(){this.contentIds=[]}},{key:"addLoot",value:function(loot){this.contentIds.includes(loot.id)||(loot.position&&loot.remove(loot.position),loot.lightSource&&setState((function(state){return state.recalcLighting=!0})),this.contentIds.push(loot.id))}},{key:"hasLoot",value:function(loot){return this.contentIds.indexOf(loot.id)>-1}},{key:"removeLoot",value:function(loot){var idx=this.contentIds.indexOf(loot.id);return idx>=0&&this.contentIds.splice(idx,1),loot}},{key:"dropLoot",value:function(loot){var ent=this.removeLoot(loot),position=this.entity.position;return ent.add(Position,position),loot.lightSource&&setState((function(state){return state.recalcLighting=!0})),ent.fireEvent("dropped",{dropper:this.entity}),ent}}],protoProps&&Inventory_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Inventory_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Inventory}(Component);function Legend_component_typeof(obj){return Legend_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Legend_component_typeof(obj)}function Legend_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Legend_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Legend_component_setPrototypeOf(o,p){return Legend_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Legend_component_setPrototypeOf(o,p)}function Legend_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Legend_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Legend_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Legend_component_possibleConstructorReturn(this,result)}}function Legend_component_possibleConstructorReturn(self,call){if(call&&("object"===Legend_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Legend_component_getPrototypeOf(o){return Legend_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Legend_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Inventory,"properties",{contentIds:[]});var Legend=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Legend_component_setPrototypeOf(subClass,superClass)}(Legend,_Component);var Constructor,protoProps,staticProps,_super=Legend_component_createSuper(Legend);function Legend(){return Legend_component_classCallCheck(this,Legend),_super.apply(this,arguments)}return Constructor=Legend,protoProps&&Legend_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Legend_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function LockPick_component_typeof(obj){return LockPick_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},LockPick_component_typeof(obj)}function LockPick_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function LockPick_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function LockPick_component_setPrototypeOf(o,p){return LockPick_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},LockPick_component_setPrototypeOf(o,p)}function LockPick_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=LockPick_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=LockPick_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return LockPick_component_possibleConstructorReturn(this,result)}}function LockPick_component_possibleConstructorReturn(self,call){if(call&&("object"===LockPick_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function LockPick_component_getPrototypeOf(o){return LockPick_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},LockPick_component_getPrototypeOf(o)}var LockPick=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&LockPick_component_setPrototypeOf(subClass,superClass)}(LockPick,_Component);var Constructor,protoProps,staticProps,_super=LockPick_component_createSuper(LockPick);function LockPick(){return LockPick_component_classCallCheck(this,LockPick),_super.apply(this,arguments)}return Constructor=LockPick,(protoProps=[{key:"onTryPickLock",value:function(evt){evt.data.interactee.fireEvent("try-unlock"),log({evt,source:this.entity})}},{key:"onGetApplications",value:function(evt){var _evt$data=evt.data,interactee=_evt$data.interactee,interactor=_evt$data.interactor;interactee.lock&&interactee.lock.isLocked&&evt.data.interactions.push({name:"Pick",evt:"try-pick-lock",interactee,interactor,interactant:this.entity,caller:"interactant"})}}])&&LockPick_component_defineProperties(Constructor.prototype,protoProps),staticProps&&LockPick_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),LockPick}(Component);function Loot_component_typeof(obj){return Loot_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Loot_component_typeof(obj)}function Loot_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Loot_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Loot_component_setPrototypeOf(o,p){return Loot_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Loot_component_setPrototypeOf(o,p)}function Loot_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Loot_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Loot_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Loot_component_possibleConstructorReturn(this,result)}}function Loot_component_possibleConstructorReturn(self,call){if(call&&("object"===Loot_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Loot_component_getPrototypeOf(o){return Loot_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Loot_component_getPrototypeOf(o)}var Loot=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Loot_component_setPrototypeOf(subClass,superClass)}(Loot,_Component);var Constructor,protoProps,staticProps,_super=Loot_component_createSuper(Loot);function Loot(){return Loot_component_classCallCheck(this,Loot),_super.apply(this,arguments)}return Constructor=Loot,(protoProps=[{key:"drop",value:function(oldOwner){return!!oldOwner.inventory.hasLoot(this.entity)&&(oldOwner.inventory.dropLoot(this.entity),!0)}},{key:"take",value:function(newOwner){return newOwner.inventory.addLoot(this.entity),!0}},{key:"onGetInteractions",value:function(evt){var interactor=evt.data.interactor;interactor.has(Inventory)&&evt.data.interactions.push({name:"Pick up",evt:"try-pick-up",interactor,interactee:this.entity,caller:"interactee"})}},{key:"onTryDrop",value:function(evt){return this.drop(evt.data.interactor)?(log({evt,source:this.entity}),!0):(console.log("You can't drop that"),!1)}},{key:"onTryPickUp",value:function(evt){this.take(evt.data.interactor),log({evt,source:this.entity}),evt.handle()}}])&&Loot_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Loot_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Loot}(Component);function Lux_component_typeof(obj){return Lux_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Lux_component_typeof(obj)}function Lux_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Lux_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Lux_component_setPrototypeOf(o,p){return Lux_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Lux_component_setPrototypeOf(o,p)}function Lux_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Lux_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Lux_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Lux_component_possibleConstructorReturn(this,result)}}function Lux_component_possibleConstructorReturn(self,call){if(call&&("object"===Lux_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Lux_component_getPrototypeOf(o){return Lux_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Lux_component_getPrototypeOf(o)}var Lux=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Lux_component_setPrototypeOf(subClass,superClass)}(Lux,_Component);var Constructor,protoProps,staticProps,_super=Lux_component_createSuper(Lux);function Lux(){return Lux_component_classCallCheck(this,Lux),_super.apply(this,arguments)}return Constructor=Lux,(protoProps=[{key:"onRecalcLight",value:function(){this.ambient=0}}])&&Lux_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Lux_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Lux}(Component);function MeleeSlash_component_typeof(obj){return MeleeSlash_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},MeleeSlash_component_typeof(obj)}function MeleeSlash_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function MeleeSlash_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function MeleeSlash_component_setPrototypeOf(o,p){return MeleeSlash_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},MeleeSlash_component_setPrototypeOf(o,p)}function MeleeSlash_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=MeleeSlash_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=MeleeSlash_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return MeleeSlash_component_possibleConstructorReturn(this,result)}}function MeleeSlash_component_possibleConstructorReturn(self,call){if(call&&("object"===MeleeSlash_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function MeleeSlash_component_getPrototypeOf(o){return MeleeSlash_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},MeleeSlash_component_getPrototypeOf(o)}!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(Lux,"properties",{current:0,ambient:0});var MeleeSlash=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&MeleeSlash_component_setPrototypeOf(subClass,superClass)}(MeleeSlash,_Component);var Constructor,protoProps,staticProps,_super=MeleeSlash_component_createSuper(MeleeSlash);function MeleeSlash(){return MeleeSlash_component_classCallCheck(this,MeleeSlash),_super.apply(this,arguments)}return Constructor=MeleeSlash,(protoProps=[{key:"onTrySlash",value:function(evt){var _evt$data=evt.data,interactee=_evt$data.interactee,interactor=_evt$data.interactor,damageBucket=this.entity.fireEvent("get-damage-types",{damageTypes:[]});interactee.fireEvent("ApplyDamage",{interactor,interactee,interactant:this.entity,damageTypes:damageBucket.data.damageTypes,verb:"slashes",dmgType:dmgTypes.SLASHING}).handled||log({log:[{str:"You slash pointlessly at the ".concat(interactee.display.name," with the ").concat(this.entity.display.name,"!")}]})}},{key:"onGetMeleeInteractions",value:function(evt){var _evt$data2=evt.data,interactions=_evt$data2.interactions,interactee=_evt$data2.interactee,interactor=_evt$data2.interactor;interactions.push({name:"Slash",evt:"try-slash",interactor,interactee,interactant:this.entity,caller:"interactant"})}}])&&MeleeSlash_component_defineProperties(Constructor.prototype,protoProps),staticProps&&MeleeSlash_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),MeleeSlash}(Component);function MeleeStab_component_typeof(obj){return MeleeStab_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},MeleeStab_component_typeof(obj)}function MeleeStab_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function MeleeStab_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function MeleeStab_component_setPrototypeOf(o,p){return MeleeStab_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},MeleeStab_component_setPrototypeOf(o,p)}function MeleeStab_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=MeleeStab_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=MeleeStab_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return MeleeStab_component_possibleConstructorReturn(this,result)}}function MeleeStab_component_possibleConstructorReturn(self,call){if(call&&("object"===MeleeStab_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function MeleeStab_component_getPrototypeOf(o){return MeleeStab_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},MeleeStab_component_getPrototypeOf(o)}var MeleeStab=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&MeleeStab_component_setPrototypeOf(subClass,superClass)}(MeleeStab,_Component);var Constructor,protoProps,staticProps,_super=MeleeStab_component_createSuper(MeleeStab);function MeleeStab(){return MeleeStab_component_classCallCheck(this,MeleeStab),_super.apply(this,arguments)}return Constructor=MeleeStab,(protoProps=[{key:"onTryStab",value:function(evt){var _evt$data=evt.data,interactee=_evt$data.interactee,interactor=_evt$data.interactor,damageBucket=this.entity.fireEvent("get-damage-types",{damageTypes:[]});interactee.fireEvent("ApplyDamage",{interactor,interactee,interactant:this.entity,damageTypes:damageBucket.data.damageTypes,verb:"stabs",dmgType:dmgTypes.PIERCING}).handled||log({log:[{str:"You stab impotently at the ".concat(interactee.display.name," with the ").concat(this.entity.display.name,"!")}]})}},{key:"onGetMeleeInteractions",value:function(evt){var _evt$data2=evt.data,interactions=_evt$data2.interactions,interactee=_evt$data2.interactee,interactor=_evt$data2.interactor;interactions.push({name:"Stab",evt:"try-stab",interactor,interactee,interactant:this.entity,caller:"interactant"})}}])&&MeleeStab_component_defineProperties(Constructor.prototype,protoProps),staticProps&&MeleeStab_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),MeleeStab}(Component);function PC_component_typeof(obj){return PC_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},PC_component_typeof(obj)}function PC_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function PC_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function PC_component_setPrototypeOf(o,p){return PC_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},PC_component_setPrototypeOf(o,p)}function PC_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=PC_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=PC_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return PC_component_possibleConstructorReturn(this,result)}}function PC_component_possibleConstructorReturn(self,call){if(call&&("object"===PC_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function PC_component_getPrototypeOf(o){return PC_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},PC_component_getPrototypeOf(o)}var PC=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&PC_component_setPrototypeOf(subClass,superClass)}(PC,_Component);var Constructor,protoProps,staticProps,_super=PC_component_createSuper(PC);function PC(){return PC_component_classCallCheck(this,PC),_super.apply(this,arguments)}return Constructor=PC,protoProps&&PC_component_defineProperties(Constructor.prototype,protoProps),staticProps&&PC_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function Revealed_component_typeof(obj){return Revealed_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Revealed_component_typeof(obj)}function Revealed_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Revealed_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Revealed_component_setPrototypeOf(o,p){return Revealed_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},Revealed_component_setPrototypeOf(o,p)}function Revealed_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=Revealed_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Revealed_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Revealed_component_possibleConstructorReturn(this,result)}}function Revealed_component_possibleConstructorReturn(self,call){if(call&&("object"===Revealed_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Revealed_component_getPrototypeOf(o){return Revealed_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Revealed_component_getPrototypeOf(o)}var Revealed=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Revealed_component_setPrototypeOf(subClass,superClass)}(Revealed,_Component);var Constructor,protoProps,staticProps,_super=Revealed_component_createSuper(Revealed);function Revealed(){return Revealed_component_classCallCheck(this,Revealed),_super.apply(this,arguments)}return Constructor=Revealed,protoProps&&Revealed_component_defineProperties(Constructor.prototype,protoProps),staticProps&&Revealed_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);function ZIndex_component_typeof(obj){return ZIndex_component_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},ZIndex_component_typeof(obj)}function ZIndex_component_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function ZIndex_component_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function ZIndex_component_setPrototypeOf(o,p){return ZIndex_component_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},ZIndex_component_setPrototypeOf(o,p)}function ZIndex_component_createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var result,Super=ZIndex_component_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=ZIndex_component_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return ZIndex_component_possibleConstructorReturn(this,result)}}function ZIndex_component_possibleConstructorReturn(self,call){if(call&&("object"===ZIndex_component_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function ZIndex_component_getPrototypeOf(o){return ZIndex_component_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},ZIndex_component_getPrototypeOf(o)}var ZIndex=function(_Component){!function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&ZIndex_component_setPrototypeOf(subClass,superClass)}(ZIndex,_Component);var Constructor,protoProps,staticProps,_super=ZIndex_component_createSuper(ZIndex);function ZIndex(){return ZIndex_component_classCallCheck(this,ZIndex),_super.apply(this,arguments)}return Constructor=ZIndex,protoProps&&ZIndex_component_defineProperties(Constructor.prototype,protoProps),staticProps&&ZIndex_component_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Component);!function(obj,key,value){key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}(ZIndex,"properties",{z:0});var Brazier={name:"Brazier",inherit:["Item"],components:[{type:"Appearance",properties:{char:chars_brazier,color:colors_metal,baseColor:colors_metal}},{type:"Impassable"},{type:"Bumpable"},{type:"Combustible"},{type:"Discoverable"},{type:"Display",properties:{name:"Brazier",description:"A container used to burn fuel for cooking, heating, cultural rituals, or light."}},{type:"ZIndex",properties:{z:200}}]},Door_prefab_Door={name:"Door",inherit:["Tile"],components:[{type:"Appearance",properties:{char:chars_doorClosed,color:colors_door,baseColor:colors_door}},{type:"Astar",properties:{wt:2}},{type:"Discoverable"},{type:"Bumpable"},{type:"Combustible"},{type:"Lock"},{type:"Shadowcaster"},{type:"ZIndex",properties:{z:200}},{type:"Door"},{type:"Display",properties:{name:"Door"}},{type:"Legend"}]},Floor={name:"Floor",inherit:["Tile"],components:[{type:"Appearance",properties:{char:chars_floor,color:colors_floor,baseColor:colors_floor}},{type:"Discoverable"},{type:"Display",properties:{name:"Floor"}}]},Goblin={name:"Goblin",inherit:["Being"],components:[{type:"Appearance",properties:{char:chars_goblin,color:colors_goblin,baseColor:colors_goblin}},{type:"Brain"},{type:"Display",properties:{name:"Goblin"}},{type:"EquipmentSlot",properties:{name:"Left Hand",slotKey:"leftHand",isPrimary:!0}},{type:"Eyes"},{type:"Inventory"},{type:"Motor"}]},Lockpick={name:"Lockpick",inherit:["Item"],components:[{type:"Appearance",properties:{char:chars_tool,color:colors_tool,baseColor:colors_tool}},{type:"Damage",properties:{type:dmgTypes.SLASHING,value:10}},{type:"Damage",properties:{type:dmgTypes.PIERCING,value:5}},{type:"Discoverable"},{type:"Display",properties:{name:"Lockpick",description:"A small peice of metal useful for open locks without a key."}},{type:"LockPick"},{type:"Wieldable"},{type:"MeleeStab"},{type:"MeleeSlash"}]},Player={name:"Player",inherit:["Being"],components:[{type:"PC"},{type:"Appearance",properties:{char:chars_player,color:colors_player,baseColor:colors_player}},{type:"LightSource",properties:{lumens:100,beam:5,stationary:!1}},{type:"ZIndex",properties:{z:310}},{type:"Display",properties:{name:"Player"}},{type:"Motor"},{type:"EquipmentSlot",properties:{name:"Left Hand",slotKey:"leftHand",isPrimary:!0}},{type:"Health",properties:{max:1e3,current:1e3}},{type:"DamageResistance",properties:{type:dmgTypes.PIERCING}},{type:"DamageVulnerability",properties:{type:dmgTypes.SLASHING}}]},Wall={name:"Wall",inherit:["Tile"],components:[{type:"Astar",properties:{wt:0}},{type:"Impassable"},{type:"Bumpable"},{type:"Shadowcaster"},{type:"Appearance",properties:{char:chars_wall,color:colors_wall,baseColor:colors_wall}},{type:"Display",properties:{name:"Wall"}}]},engine=new Engine,world=engine.createWorld();function ecsHelpers_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return ecsHelpers_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return ecsHelpers_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ecsHelpers_arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ecsHelpers_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}engine.registerComponent(Appearance),engine.registerComponent(Astar),engine.registerComponent(Impassable),engine.registerComponent(Brain),engine.registerComponent(Bumpable),engine.registerComponent(Combustible),engine.registerComponent(Damage),engine.registerComponent(DamageImmunity),engine.registerComponent(DamageResistance),engine.registerComponent(DamageVulnerability),engine.registerComponent(Discoverable),engine.registerComponent(Display),engine.registerComponent(Door),engine.registerComponent(EquipmentSlot),engine.registerComponent(Equipped),engine.registerComponent(Eyes),engine.registerComponent(Fightable),engine.registerComponent(Fire),engine.registerComponent(Goal),engine.registerComponent(Health),engine.registerComponent(InFov),engine.registerComponent(Inventory),engine.registerComponent(IsDead),engine.registerComponent(Legend),engine.registerComponent(LightSource),engine.registerComponent(Lock),engine.registerComponent(LockPick),engine.registerComponent(Loot),engine.registerComponent(Lux),engine.registerComponent(MeleeSlash),engine.registerComponent(MeleeStab),engine.registerComponent(Motor),engine.registerComponent(PC),engine.registerComponent(Position),engine.registerComponent(Revealed),engine.registerComponent(Shadowcaster),engine.registerComponent(ZIndex),engine.registerPrefab({name:"Being",components:[{type:"Appearance"},{type:"Astar",properties:{wt:2}},{type:"Bumpable"},{type:"Display"},{type:"Fightable"},{type:"Health"},{type:"Inventory"},{type:"Legend"},{type:"Position"},{type:"ZIndex",properties:{z:300}}]}),engine.registerPrefab({name:"Item",components:[{type:"Appearance"},{type:"Position"},{type:"ZIndex",properties:{z:200}},{type:"Display"},{type:"Loot"},{type:"Legend"}]}),engine.registerPrefab({name:"Tile",components:[{type:"Appearance"},{type:"Position"},{type:"ZIndex",properties:{z:100}},{type:"Display"},{type:"Astar",properties:{wt:1}}]}),engine.registerPrefab(Brazier),engine.registerPrefab(Door_prefab_Door),engine.registerPrefab(Floor),engine.registerPrefab(Goblin),engine.registerPrefab(Lockpick),engine.registerPrefab(Player),engine.registerPrefab(Wall),engine.registerPrefab({name:"Goal",components:[{type:"Goal",properties:{isFinished:function(){},takeAction:function(){}}},{type:"Display",properties:{name:"Goal"}}]});var createGoal=function(_ref){var goal=_ref.goal,name=_ref.name,originalIntent=_ref.originalIntent,data=_ref.data,createdGoal=world.createPrefab("Goal",{goal,display:{name},data}),ogIntent=originalIntent||createdGoal.id;return createdGoal.goal.originalIntent=ogIntent,createdGoal.originalIntent=ogIntent,createdGoal.data=data,createdGoal},getEntity=function(eid){return world.getEntity(eid)},getEAtPos=function(cellOrPosId){var _toCell=toCell(cellOrPosId),x=_toCell.x,y=_toCell.y,_getState=getState(),maps=_getState.maps,currentMapId=_getState.currentMapId;return ecsHelpers_toConsumableArray(lodash_default().get(maps,"".concat(currentMapId,"[").concat(y,"][").concat(x,"]"),[]))},getEntitiesAt=function(cellOrPosid){return getEAtPos(cellOrPosid).map((function(eid){return world.getEntity(eid)}))},getEntitiesInRange=function(center,range){var locationsInRange=function(center,radius){for(var top=center.y-radius,bottom=center.y+radius,left=center.x-radius,right=center.x+radius,locsIds=[],y=top;y<=bottom;y++)for(var x=left;x<=right;x++){var cx=Math.ceil(x),cy=Math.ceil(y);insideCircle(center,{x:cx,y:cy},radius)&&locsIds.push("".concat(cx,",").concat(cy))}return locsIds}(center,range);return locationsInRange.flatMap((function(loc){return getEAtPos(loc).map((function(eid){return world.getEntity(eid)}))}))},getNeighborEntities=function(_ref2){var x=_ref2.x,y=_ref2.y,_ref2$direction=_ref2.direction,direction=void 0===_ref2$direction?"CARDINAL":_ref2$direction,z=getState().currentMapId.split(",")[2],posIds=getNeighborIds({x,y,z},direction),entities=[];return posIds.forEach((function(posId){getEAtPos(posId).forEach((function(eid){entities.push(world.getEntity(eid))}))})),entities};function canvas_slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||canvas_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function canvas_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return canvas_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?canvas_arrayLikeToArray(o,minLen):void 0}}function canvas_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function canvas_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function canvas_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}window.PIXI=pixi_legacy_namespaceObject;var containers,canvas_canvas=document.getElementById("pixi-canvas"),cellW=window.innerWidth/grid_grid.width,cellH=cellW,cellHfW=cellW/2,app=new Application({view:canvas_canvas,width:window.innerWidth,height:cellW*grid_grid.height,autoDensity:!0,autoResize:!0,resolution:window.devicePixelRatio||1}),loader=Loader.shared,getFontTexture=function(_ref){var _char=_ref.char;return loader.resources["static/fonts/menlo-bold-half.json"].textures[menloBoldHalfAlphaMap[_char]]},getAsciTexture=function(_ref2){var _char2=_ref2.char;return loader.resources["static/fonts/menlo-bold.json"].textures[menloBoldAlphaMap[_char2]]},getTileTexture=function(){return loader.resources.tile.texture},initPixiContainerSprites=function(container){lodash_default().times(container.height,(function(i){!function(_ref3){var container=_ref3.container,row=_ref3.row,width=container.halfWidth?2*container.width:container.width,func=container.halfWidth?getFontTexture:getAsciTexture;lodash_default().times(width,(function(i){var sprite=new Sprite(func({char:" "})),spriteWidth=container.halfWidth?cellHfW:cellW,spriteHeight=cellH;sprite.width=spriteWidth,sprite.height=spriteHeight,sprite.x=i*spriteWidth,sprite.y=row*spriteHeight,sprite.debug={container,x:i,y:row},sprite.interactive=!0,sprite.on("click",(function(){var ents=getEntitiesAt({x:i,y:row});ents.forEach((function(e){e.brain&&(e.goals=e.brain.goalIds.map((function(gid){return getEntity(gid)})))})),console.log({sprite,ents})})),container.sprites[row][i]=sprite,container.container.addChild(sprite)}))}({container,row:i})}))},initUi=function(){containers=lodash_default().reduce(grid_grid,(function(acc,val,key){return["width","height"].includes(key)||(acc[key]=function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?canvas_ownKeys(Object(source),!0).forEach((function(key){canvas_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):canvas_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({container:{},sprites:Array.from(Array(val.height),(function(){return[]}))},val),function(container){var graphics,width=container.width*cellW,height=container.height*cellW,x=container.x*cellW,y=container.y*cellW;container.container=new Container,container.container.width=width,container.container.height=height,container.container.x=x,container.container.y=y,container.bgColor&&((graphics=new Graphics).beginFill(container.bgColor),graphics.drawRect(0,0,width,height),graphics.endFill()),"float"===container.name&&(container.bg=new Sprite(getTileTexture()),container.bg.width=width,container.bg.height=height,container.bg.x=0,container.bg.y=0,container.bg.tint=3355443,container.bg.alpha=1,container.container.addChild(container.bg)),app.stage.addChild(container.container),graphics&&container.container.addChild(graphics)}(acc[key]),initPixiContainerSprites(acc[key])),acc}),{}),printRow({container:"build",str:"TAG: ".concat("8f43f77")})},printCell=function(_ref4){var container=_ref4.container,_ref4$x=_ref4.x,x=void 0===_ref4$x?0:_ref4$x,_ref4$y=_ref4.y,y=void 0===_ref4$y?0:_ref4$y,_char3=_ref4.char,_ref4$color=_ref4.color,color=void 0===_ref4$color?13421772:_ref4$color,_ref4$alpha=_ref4.alpha,alpha=void 0===_ref4$alpha?1:_ref4$alpha;containers[container].sprites[y][x].tint=color,containers[container].sprites[y][x].alpha=alpha;var func=containers[container].halfWidth?getFontTexture:getAsciTexture;containers[container].sprites[y][x].texture=func({char:_char3})},printTile=function(_ref5){var container=_ref5.container,_ref5$x=_ref5.x,x=void 0===_ref5$x?0:_ref5$x,_ref5$y=_ref5.y,y=void 0===_ref5$y?0:_ref5$y,_ref5$color=_ref5.color,color=void 0===_ref5$color?13421772:_ref5$color,_ref5$alpha=_ref5.alpha,alpha=void 0===_ref5$alpha?1:_ref5$alpha;containers[container].sprites[y][x].tint=color,containers[container].sprites[y][x].alpha=alpha,containers[container].sprites[y][x].texture=getTileTexture()},printRow=function(_ref6){for(var container=_ref6.container,_ref6$x=_ref6.x,x=void 0===_ref6$x?0:_ref6$x,_ref6$y=_ref6.y,y=void 0===_ref6$y?0:_ref6$y,_ref6$width=_ref6.width,width=void 0===_ref6$width?null:_ref6$width,str=_ref6.str,_ref6$color=_ref6.color,color=void 0===_ref6$color?13421772:_ref6$color,_ref6$alpha=_ref6.alpha,alpha=void 0===_ref6$alpha?1:_ref6$alpha,len=width||containers[container].sprites[y].length,i=0;i<len;i++)printCell({container,x:x+i,y,char:str[i],color,halfWidth:containers[container].halfWidth,alpha})},printTemplate=function(_ref7){var _step,container=_ref7.container,_ref7$x=_ref7.x,x=void 0===_ref7$x?0:_ref7$x,_ref7$y=_ref7.y,y=void 0===_ref7$y?0:_ref7$y,_ref7$template=_ref7.template,template=void 0===_ref7$template?[]:_ref7$template,_ref7$alpha=_ref7.alpha,alpha=void 0===_ref7$alpha?1:_ref7$alpha,curX=x,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=canvas_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e3){didErr=!0,err=_e3},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(template.entries());try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=canvas_slicedToArray(_step.value,2),t=(_step$value[0],_step$value[1]);printRow({container,x:curX,y,str:t.str,color:t.color||13421772,halfWidth:containers[container].halfWidth,width:t.str.length,alpha:t.alpha||0===t.alpha?t.alpha:alpha}),curX+=t.str.length}}catch(err){_iterator.e(err)}finally{_iterator.f()}},clearContainer=function(container){var str=new Array(containers[container].width).join(" ");containers[container].sprites.forEach((function(row,i){printRow({container,y:i,str})}))},hideFloat=function(container){clearContainer(container),containers[container].container.visible=!1},aiQuery=world.createQuery({all:[Brain]}),coronerQuery=(world.createQuery({all:[Appearance]}),world.createQuery({all:[IsDead]})),fovQuery=world.createQuery({all:[InFov]}),legendableQuery=world.createQuery({all:[InFov,Legend]}),lightSourceQuery=world.createQuery({all:[LightSource,Position]}),luxQuery=world.createQuery({all:[Lux]}),pcQuery=world.createQuery({all:[PC]}),positionQuery=world.createQuery({all:[Position]}),revealedQuery=world.createQuery({all:[Revealed],none:[InFov]}),shadowcasterQuery=world.createQuery({all:[Discoverable,Shadowcaster]}),visibleQuery=world.createQuery({all:[Appearance,InFov,Position]});function adventureLog_slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||adventureLog_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function adventureLog_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return adventureLog_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?adventureLog_arrayLikeToArray(o,minLen):void 0}}function adventureLog_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var renderAdventureLog=function(){clearContainer("adventureLog");var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=adventureLog_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e3){didErr=!0,err=_e3},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(getState().adventureLog.slice(0,3).reverse().entries());try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=adventureLog_slicedToArray(_step.value,2),i=_step$value[0],l=_step$value[1];printTemplate({container:"adventureLog",template:l.log,y:i,alpha:getState().tick===l.tick?1:.5})}}catch(err){_iterator.e(err)}finally{_iterator.f()}};function interacting_system_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return interacting_system_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return interacting_system_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return interacting_system_arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function interacting_system_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var interactionKeys=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],wrap_ansi=__webpack_require__(152),wrap_ansi_default=__webpack_require__.n(wrap_ansi),renderInventory=function(player){if("MENU_INVENTORY"===getState().mode){clearContainer("menu"),function(container){containers[container].container.visible=!0}("menu"),printTemplate({container:"menu",template:[{str:" -- INVENTORY --"}],y:1});var items=player.inventory.contentIds.map((function(eid){return world.getEntity(eid)})),inventoryIndex=getState().inventoryIndex;if(items.length){items.forEach((function(item,index){printTemplate({container:"menu",y:3+index,template:[{str:"  ".concat(inventoryIndex===index?"*":" "," ").concat(item.display.detailed)}]})}));var _selectedItem$display=items[inventoryIndex].display,description=_selectedItem$display.description,detailed=_selectedItem$display.detailed,content=wrap_ansi_default()(description,53).split("\n");printTemplate({container:"menu",y:1,x:57,template:[{str:"  * ".concat(detailed)}]}),content.forEach((function(line,index){printTemplate({container:"menu",y:3+index,x:57,template:[{str:"    ".concat(line)}]})}))}else printTemplate({container:"menu",y:3,template:[{str:"    Your inventory is empty."}]})}else!function(container){containers[container].container.visible=!1}("menu")};function legend_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return legend_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||legend_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function legend_slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||legend_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function legend_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return legend_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?legend_arrayLikeToArray(o,minLen):void 0}}function legend_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function render_system_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function render_system_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?render_system_ownKeys(Object(source),!0).forEach((function(key){render_system_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):render_system_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function render_system_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function render_system_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return render_system_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return render_system_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return render_system_arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function render_system_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var minAlpha=.1,isOnTop=function(eid,eAtPos){var zIndex=0,eidOnTop=eid;return eAtPos.forEach((function(id){var candidate=world.getEntity(id).zIndex.z;candidate>zIndex&&(zIndex=candidate,eidOnTop=id)})),eidOnTop===eid},renderIfOnTop=function(entity){var revealed=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(entity.position){var _entity$position=entity.position,x=_entity$position.x,y=_entity$position.y,_getState=getState(),maps=_getState.maps,currentMapId=_getState.currentMapId,entitiesAtPosition=maps[currentMapId][y][x],shouldRender=isOnTop(entity.id,render_system_toConsumableArray(entitiesAtPosition));if(shouldRender){var _entity$appearance=entity.appearance,_char=_entity$appearance.char,color=_entity$appearance.color,alpha=_entity$appearance.alpha,currentColor=color,currentAlpha=alpha;(revealed||alpha<=minAlpha&&alpha>0)&&(currentColor=colors_revealed,currentAlpha=.08),printCell({container:"map",x,y,char:_char,color:currentColor,alpha:currentAlpha})}}},renderSystem=function(){("LOOKING"===getState().mode&&(clearContainer("mapOverlay"),printTile(render_system_objectSpread({container:"mapOverlay",color:colors_uiLooking},getState().cursor))),"INTERACTING"===getState().mode&&(clearContainer("mapOverlay"),printTile(render_system_objectSpread({container:"mapOverlay",color:colors_uiInteraction},getState().cursor))),"PLAYER"===getState().turn)&&(pcQuery.get().forEach((function(entity){entity.appearance.alpha=minAlpha})),shadowcasterQuery.get().forEach((function(entity){entity.has(Revealed)&&(entity.appearance.alpha=minAlpha),renderIfOnTop(entity)})),[].concat(render_system_toConsumableArray(pcQuery.get()),render_system_toConsumableArray(visibleQuery.get())).forEach((function(entity){if(entity.has(Lux)&&(entity.appearance.alpha=Math.max(minAlpha,(entity.lux.ambient+entity.lux.current)/100)),entity.has(Shadowcaster)||entity.has(PC)){var _entity$position2=entity.position,x=_entity$position2.x,y=_entity$position2.y,lux=0;getNeighborEntities({x,y}).forEach((function(ent){var onTopEntity=function(entity,entitiesAtPos){var zIndex=0,entityOnTop=entity;return entitiesAtPos.forEach((function(entity){var candidate=entity.zIndex.z;candidate>zIndex&&(zIndex=candidate,entityOnTop=entity)})),entityOnTop.id===entity.id}(ent,getEntitiesAt(ent.position).filter((function(e){return e.has(Shadowcaster)})));if(onTopEntity&&ent.has(Lux)&&ent.has(InFov)){var candidate=ent.lux.ambient+ent.lux.current;lux<candidate&&(lux=candidate)}})),lux>minAlpha&&(entity.appearance.alpha=lux/100),lux&&entity.add(Revealed)}renderIfOnTop(entity)})));"WORLD"===getState().turn&&visibleQuery.get().forEach((function(entity){if(entity.brain){var otherEntAtPos=getEntitiesAt(entity.position).find((function(e){return e.appearance&&e.id!==entity.id}));entity.appearance.alpha=otherEntAtPos.appearance.alpha,renderIfOnTop(entity)}})),render_system_toConsumableArray(getState().rerender).forEach((function(x){getEntitiesAt(x).forEach((function(ent){renderIfOnTop(ent)}))})),setState((function(state){return state.rerender=new Set})),revealedQuery.get().forEach((function(entity){entity.appearance.alpha=minAlpha,renderIfOnTop(entity,!0)})),function(ents){clearContainer("legend");var lEnts=ents.filter((function(ent){return ent.appearance&&ent.appearance.alpha>minAlpha})),player=legend_slicedToArray(lodash_default().remove(lEnts,(function(ent){return ent.has(PC)})),1)[0],orderedLegend=lodash_default().orderBy(lEnts,(function(ent){return distance(player.position,ent.position)}));setState((function(state){state.legendPositions=[player.position].concat(legend_toConsumableArray(orderedLegend.map((function(ent){return ent.position}))))}));var _player$appearance=player.appearance,_char=_player$appearance.char,color=_player$appearance.color,name=player.display.simple,isLooking="LOOKING"===getState().mode,isLookingAtPlayer=0===getState().legendPositionsIndex,playerNameColor=isLooking&&isLookingAtPlayer?colors_default:void 0;printTemplate({container:"legend",template:[{str:" ".concat(_char," "),color},{str:"".concat(name),color:playerNameColor}],y:0}),orderedLegend.forEach((function(ent,i){var nameColor,_ent$appearance=ent.appearance,_char2=_ent$appearance.char,color=_ent$appearance.color,name=ent.display.simple,_getState$cursor=getState().cursor,cx=_getState$cursor.x,cy=_getState$cursor.y,_ent$position=ent.position,ex=_ent$position.x,ey=_ent$position.y,isLooking="LOOKING"===getState().mode,isInteracting="INTERACTING"===getState().mode,isDirectedAt=cx===ex&&cy===ey;isLooking&&isDirectedAt&&(nameColor=colors_default),isInteracting&&isDirectedAt&&(nameColor=colors_revealed),printTemplate({container:"legend",template:[{str:" ".concat(_char2," "),color},{str:"".concat(name),color:nameColor}],y:i+1})}))}(legendableQuery.get()),renderAdventureLog(),clearContainer("ambiance"),printTemplate({container:"ambiance",template:getState().ambiance}),pcQuery.get()[0].position,clearContainer("contextMenu"),"GAME"===getState().mode&&(hideFloat("float"),printTemplate({container:"contextMenu",template:[{str:"(i)Interact (l)Look (arrow keys)Move",color:6710886}]})),"MENU_INVENTORY"===getState().mode&&printTemplate({container:"contextMenu",template:[{str:"(esc)Back (arrow keys)Select Item",color:6710886}]}),"LOOKING"===getState().mode&&printTemplate({container:"contextMenu",template:[{str:"Looking: (esc)Back (arrow keys)Move (shift + arrow keys)Cycle",color:6710886}]}),"INTERACTING"===getState().mode&&printTemplate({container:"contextMenu",template:[{str:"Interacting: (esc)Back (arrow keys)Move",color:6710886}]}),renderInventory(pcQuery.get()[0]),function(){if(clearContainer("interactions"),"INTERACTING"===getState().mode){printTemplate({container:"interactions",template:[{str:"Actions (esc)Back"}]});var y=2,keyBinding=0,interactions=getState().interactions,interactTemplates=interactions.interact.map((function(interaction){var template={str:"(".concat(interactionKeys[keyBinding],")").concat(interaction.name," ").concat(interaction.interactee.display.name)};return keyBinding++,template})),applyTemplates=interactions.apply.map((function(interaction){console.log(interaction);var template={str:"(".concat(interactionKeys[keyBinding],")").concat(interaction.name," with ").concat(interaction.interactant.display.name)};return keyBinding++,template})),meleeTemplates=interactions.melee.map((function(interaction){var template={str:"(".concat(interactionKeys[keyBinding],")").concat(interaction.name," with ").concat(interaction.interactant.display.name)};return keyBinding++,template}));interactTemplates.length&&(printTemplate({container:"interactions",template:[{str:"Interact"}],y}),y++,interactTemplates.forEach((function(tmpl){printTemplate({container:"interactions",template:[tmpl],y,x:1}),y++})),y++),applyTemplates.length&&(printTemplate({container:"interactions",template:[{str:"Apply"}],y}),y++,applyTemplates.forEach((function(tmpl){printTemplate({container:"interactions",template:[tmpl],y,x:1}),y++})),y++),meleeTemplates.length&&(printTemplate({container:"interactions",template:[{str:"Melee"}],y}),y++,meleeTemplates.forEach((function(tmpl){printTemplate({container:"interactions",template:[tmpl],y,x:1}),y++})))}}()};function ambiance_system_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return ambiance_system_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return ambiance_system_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ambiance_system_arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ambiance_system_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var ambianceSystem=function(){var playerEnt=pcQuery.get()[0],ambiancePos=playerEnt.position,index=1,isGameMode="GAME"===getState().mode,isLookingMode="LOOKING"===getState().mode;isGameMode&&(ambiancePos=playerEnt.position,index=1),isLookingMode&&(ambiancePos=getState().cursor,index=0);var eAtPos=getEntitiesAt(ambiancePos),stack=lodash_default().orderBy(ambiance_system_toConsumableArray(eAtPos),(function(entity){return entity.zIndex.z}),"desc"),entity=stack[index];if(isLookingMode&&setState((function(state){var isInFov=entity.inFov,isInDarkness=entity.appearance.alpha>0&&entity.appearance.alpha<=minAlpha,isRevealed=entity.revealed;return isRevealed?isInFov&&isInDarkness?state.ambiance=[{str:"You're pretty sure there is ".concat(stack[index].display.detailed," in the darkness"),color:colors_default}]:isInFov&&!isInDarkness?state.ambiance=[{str:"You see ".concat(stack[index].display.detailed),color:colors_default}]:isRevealed&&!isInFov?state.ambiance=[{str:"You recall seeing ".concat(stack[index].display.detailed," here"),color:colors_default}]:void 0:state.ambiance=[{str:""}]})),isGameMode&&entity.inFov&&entity)return getState().ambiance=[{str:"There is ".concat(stack[index].display.detailed," beneath your feet")}]},coronerSystem=function(){coronerQuery.get().forEach((function(ent){ent.fireEvent("ChangeChar",{value:chars_corpse}),ent.bumpable&&ent.bumpable.destroy(),ent.brain&&ent.brain.destroy(),ent.isDead&&ent.isDead.destroy()}))};function fov_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return fov_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||fov_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fov_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return fov_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fov_arrayLikeToArray(o,minLen):void 0}}function fov_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var octantTransforms=[{xx:1,xy:0,yx:0,yy:1},{xx:1,xy:0,yx:0,yy:-1},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:0,xy:-1,yx:-1,yy:0}];function createFOV(_ref){var impassableLocations=_ref.impassableLocations,width=_ref.width,height=_ref.height,originX=_ref.originX,originY=_ref.originY,radius=_ref.radius,visible=new Set,isShadowcaster=function(x,y){var locId="".concat(x,",").concat(y);return!!impassableLocations.has(locId)},reveal=function(x,y){return visible.add("".concat(x,",").concat(y))};function castShadows(originX,originY,row,start,end,transform,radius){var newStart=0;if(!(start<end))for(var blocked=!1,_distance=row;_distance<radius&&!blocked;_distance++)for(var deltaY=-_distance,deltaX=-_distance;deltaX<=0;deltaX++){var currentX=originX+deltaX*transform.xx+deltaY*transform.xy,currentY=originY+deltaX*transform.yx+deltaY*transform.yy,leftSlope=(deltaX-.5)/(deltaY+.5),rightSlope=(deltaX+.5)/(deltaY-.5);if(currentX>=0&&currentY>=0&&currentX<width&&currentY<height&&!(start<rightSlope)){if(end>leftSlope)break;if(Math.sqrt(deltaX*deltaX+deltaY*deltaY)<=radius&&reveal(currentX,currentY),blocked){if(isShadowcaster(currentX,currentY)){newStart=rightSlope;continue}blocked=!1,start=newStart}else isShadowcaster(currentX,currentY)&&_distance<radius&&(blocked=!0,castShadows(originX,originY,_distance+1,start,leftSlope,transform,radius),newStart=rightSlope)}}}reveal(originX,originY);var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=fov_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(octantTransforms);try{for(_iterator.s();!(_step=_iterator.n()).done;){var octant=_step.value;castShadows(originX,originY,1,1,0,octant,radius)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return{fov:visible,distance:fov_toConsumableArray(visible).reduce((function(acc,val){var cell=idToCell(val);return acc[val]=distance({x:originX,y:originY},{x:cell.x,y:cell.y}),acc}),{})}}function fov_system_slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||fov_system_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fov_system_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return fov_system_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||fov_system_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fov_system_unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return fov_system_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fov_system_arrayLikeToArray(o,minLen):void 0}}function fov_system_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var fovSystem=function(){var playerEntity=pcQuery.get()[0],_grid$map=grid_grid.map,width=_grid$map.width,height=_grid$map.height,origin={x:playerEntity.position.x,y:playerEntity.position.y},radius=grid_grid.map.width,impassableLocations=new Set;shadowcasterQuery.get().forEach((function(entity){impassableLocations.add("".concat(entity.position.x,",").concat(entity.position.y))}));var FOV=createFOV({impassableLocations,width,height,originX:origin.x,originY:origin.y,radius});fov_system_toConsumableArray(fovQuery.get()).forEach((function(entity){entity.remove(entity.inFov)})),FOV.fov.forEach((function(locId){var _locId$split2=fov_system_slicedToArray(locId.split(","),2),x=_locId$split2[0],y=_locId$split2[1],eAtPos=getEAtPos({x,y});eAtPos&&eAtPos.forEach((function(eid){var entity=world.getEntity(eid);entity.add(InFov),entity.has(Lux)&&entity.add(Revealed)}))}))},lightingSystem=function(){getState().recalcLighting&&(lightSourceQuery.get().forEach((function(entity){entity.fireEvent("recalc-light")})),luxQuery.get().forEach((function(entity){entity.fireEvent("recalc-light")})),setState((function(state){return state.recalcLighting=!1}))),luxQuery.get().forEach((function(entity){entity.lux.current=0})),lightSourceQuery.get().forEach((function(entity){if(!entity.lightSource.stationary||entity.lightSource.recalc){var _grid$map=grid_grid.map,width=_grid$map.width,height=_grid$map.height,origin={x:entity.position.x,y:entity.position.y},radius=entity.lightSource.beam,impassableLocations=new Set;shadowcasterQuery.get().forEach((function(entity){impassableLocations.add("".concat(entity.position.x,",").concat(entity.position.y))}));var FOV=createFOV({impassableLocations,width,height,originX:origin.x,originY:origin.y,radius});FOV.fov.forEach((function(locId){getEAtPos({x:locId.split(",")[0],y:locId.split(",")[1]}).forEach((function(eId){var ent=world.getEntity(eId);if(!ent.has(Shadowcaster)&&!ent.has(PC)){var dist=FOV.distance[locId],_entity$lightSource=entity.lightSource,lux=function(_ref){var dist=_ref.dist,beam=_ref.beam,lumens=_ref.lumens;return lumens-dist*(lumens/beam)}({dist,beam:_entity$lightSource.beam,lumens:_entity$lightSource.lumens});lux&&(ent.has(Lux)||ent.add(Lux),entity.lightSource.stationary?ent.lux.ambient+=lux:ent.lux.current+=lux)}}))})),entity.lightSource.recalc=!1}}))};function userInput_system_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function userInput_system_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?userInput_system_ownKeys(Object(source),!0).forEach((function(key){userInput_system_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):userInput_system_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function userInput_system_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function userInput_system_toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return userInput_system_arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||function(o,minLen){if(!o)return;if("string"==typeof o)return userInput_system_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return userInput_system_arrayLikeToArray(o,minLen)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function userInput_system_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var userInputSystem=function(){var player=pcQuery.get()[0],userInput=getState().userInput;if(userInput){var key=userInput.key,shiftKey=userInput.shiftKey,mode=getState().mode;if("GAME"===mode){if("I"===key&&setState((function(state){return state.mode="MENU_INVENTORY"})),"l"===key&&(setState((function(state){return state.mode="LOOKING"})),setState((function(state){return state.cursor=player.position}))),"i"===key){setState((function(state){return state.mode="INTERACTING"}));var positions={N:null,S:null,E:null,W:null};getNeighbors(player.position).forEach((function(pos){var to,from,dir,cellA,cellB,ax,ay,bx,by,eAtPos=getEntitiesAt(pos),stack=lodash_default().orderBy(userInput_system_toConsumableArray(eAtPos),(function(entity){return entity.zIndex.z}),"desc"),entity=stack[0],direction=(to=entity.position,from=player.position,cellA=toCell(to),cellB=toCell(from),ax=cellA.x,ay=cellA.y,bx=cellB.x,by=cellB.y,ax-bx==-1&&ay-by==-1&&(dir="NW"),ax-bx==1&&ay-by==-1&&(dir="NE"),ax-bx==1&&ay-by==1&&(dir="SE"),ax-bx==-1&&ay-by==1&&(dir="SW"),ax-bx==1&&ay-by==0&&(dir="E"),ax-bx==0&&ay-by==-1&&(dir="N"),ax-bx==-1&&ay-by==0&&(dir="W"),ax-bx==0&&ay-by==1&&(dir="S"),ax-bx==0&&ay-by==0&&(dir="X"),{dir,x:ax-bx,y:ay-by});positions[direction.dir]=entity.position}));var cursorPosition=lodash_default().find(positions,(function(position){return position}));cursorPosition?setState((function(state){return state.cursor=cursorPosition})):(console.log("there is nothing nearby to interact with"),setState((function(state){return state.mode="GAME"})))}pcQuery.get().forEach((function(entity){if("ArrowUp"===key){var _entity$position=entity.position,x=_entity$position.x,y=_entity$position.y,z=_entity$position.z;entity.fireEvent("tryMove",{position:{x,y:y-1,z}})}if("ArrowRight"===key){var _entity$position2=entity.position,_x=_entity$position2.x,_y=_entity$position2.y,_z=_entity$position2.z;entity.fireEvent("tryMove",{position:{x:_x+1,y:_y,z:_z}})}if("ArrowDown"===key){var _entity$position3=entity.position,_x2=_entity$position3.x,_y2=_entity$position3.y,_z2=_entity$position3.z;entity.fireEvent("tryMove",{position:{x:_x2,y:_y2+1,z:_z2}})}if("ArrowLeft"===key){var _entity$position4=entity.position,_x3=_entity$position4.x,_y3=_entity$position4.y,_z3=_entity$position4.z;entity.fireEvent("tryMove",{position:{x:_x3-1,y:_y3,z:_z3}})}}))}if("MENU_INVENTORY"===mode){if("Escape"===key)return setState((function(state){return state.mode="GAME"}));var inventoryIndex=getState().inventoryIndex,inventoryLength=player.inventory.contentIds.length,inventoryContentsLength=player.inventory.contentIds.length,selectedItemId=player.inventory.contentIds[inventoryIndex],selectedItem=world.getEntity(selectedItemId);if("ArrowUp"===key&&setState(inventoryIndex-1<0?function(state){return state.inventoryIndex=inventoryLength-1}:function(state){return state.inventoryIndex-=1}),"ArrowDown"===key&&setState(inventoryIndex+1>=inventoryLength?function(state){return state.inventoryIndex=0}:function(state){return state.inventoryIndex+=1}),"d"===key)if(selectedItem)selectedItem.fireEvent("try-drop",{name:"Drop",interactor:player})&&inventoryIndex>=inventoryContentsLength-1&&setState((function(state){return state.inventoryIndex=0}));"e"===key&&selectedItem&&(selectedItem.equipped?player.equipmentSlot.leftHand.unequip():player.equipmentSlot.leftHand.equip(selectedItem))}if("LOOKING"===mode){if("Escape"===key)return clearContainer("mapOverlay"),setState((function(state){state.mode="GAME",state.cursor={x:0,y:0}}));if(shiftKey){var _getState4=getState(),legendPositions=_getState4.legendPositions,legendPositionsIndex=_getState4.legendPositionsIndex;if("ArrowUp"===key||"ArrowLeft"===key){var newIndex=legendPositionsIndex-1;newIndex<0&&(newIndex=legendPositions.length-1),setState((function(state){state.legendPositionsIndex=newIndex,state.cursor=state.legendPositions[state.legendPositionsIndex]}))}if("ArrowDown"===key||"ArrowRight"===key){var _newIndex=legendPositionsIndex+1;_newIndex>=legendPositions.length&&(_newIndex=0),setState((function(state){state.legendPositionsIndex=_newIndex,state.cursor=state.legendPositions[state.legendPositionsIndex]}))}}else{var maybeNewPosition=userInput_system_objectSpread({},getState().cursor);"ArrowUp"===key&&(maybeNewPosition.y-=1),"ArrowRight"===key&&(maybeNewPosition.x+=1),"ArrowDown"===key&&(maybeNewPosition.y+=1),"ArrowLeft"===key&&(maybeNewPosition.x-=1);var x=maybeNewPosition.x,y=maybeNewPosition.y;x>=0&&x<grid_grid.map.width&&y>=0&&y<grid_grid.map.height&&setState((function(state){return state.cursor=maybeNewPosition}))}}if("INTERACTING"===mode){if("Escape"===key)return clearContainer("mapOverlay"),setState((function(state){return state.mode="GAME"}));var _maybeNewPosition=userInput_system_objectSpread({},player.position);if(["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"].includes(key)&&("ArrowUp"===key&&(_maybeNewPosition.y-=1),"ArrowRight"===key&&(_maybeNewPosition.x+=1),"ArrowDown"===key&&(_maybeNewPosition.y+=1),"ArrowLeft"===key&&(_maybeNewPosition.x-=1),setState((function(state){return state.cursor=_maybeNewPosition}))),interactionKeys.includes(key)){var index=lodash_default().findIndex(interactionKeys,(function(k){return k===key})),interactions=getState().interactions,interaction=[].concat(userInput_system_toConsumableArray(interactions.interact),userInput_system_toConsumableArray(interactions.apply),userInput_system_toConsumableArray(interactions.melee))[index];if(!interaction)return setState((function(state){return state.mode="GAME"})),void clearContainer("mapOverlay");var caller=interaction.caller,interactor=interaction.interactor,interactee=interaction.interactee,interactant=interaction.interactant;interaction[caller].fireEvent(interaction.evt,{interaction,interactor,interactee,interactant}),setState((function(state){return state.mode="GAME"})),clearContainer("mapOverlay")}}setState((function(state){return state.userInput=null}))}};function dungeon_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function dungeon_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?dungeon_ownKeys(Object(source),!0).forEach((function(key){dungeon_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):dungeon_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function dungeon_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function digHorizontalPassage(x1,x2,y){for(var tiles={},start=Math.min(x1,x2),end=Math.max(x1,x2)+1,x=start;x<end;)tiles["".concat(x,",").concat(y)]={x,y,sprite:"FLOOR"},x++;return tiles}function digVerticalPassage(y1,y2,x){for(var tiles={},start=Math.min(y1,y2),end=Math.max(y1,y2)+1,y=start;y<end;)tiles["".concat(x,",").concat(y)]={x,y,sprite:"FLOOR"},y++;return tiles}var onLoaded,generateDungeonFloor=function(_ref){var world=_ref.world,_ref$z=_ref.z,z=void 0===_ref$z?0:_ref$z,dungeon=function(_ref){var x=_ref.x,y=_ref.y,width=_ref.width,height=_ref.height,_ref$minRoomSize=_ref.minRoomSize,minRoomSize=void 0===_ref$minRoomSize?6:_ref$minRoomSize,_ref$maxRoomSize=_ref.maxRoomSize,maxRoomSize=void 0===_ref$maxRoomSize?12:_ref$maxRoomSize,_ref$maxRoomCount=_ref.maxRoomCount,maxRoomCount=void 0===_ref$maxRoomCount?30:_ref$maxRoomCount,dungeon=rectangle({x,y,width,height},{sprite:"WALL"});dungeon.dTiles=dungeon_objectSpread({},dungeon.tiles),(0,lodash.each)(dungeon.dTiles,(function(val,key){dungeon.dTiles[key].tags=[],dungeon.dTiles[key].tags.push("DIRT")}));var rooms=[],roomTiles={};(0,lodash.times)(maxRoomCount,(function(){var rw=(0,lodash.random)(minRoomSize,maxRoomSize),rh=(0,lodash.random)(minRoomSize,maxRoomSize),rx=(0,lodash.random)(x,width+x-rw-1),ry=(0,lodash.random)(y,height+y-rh-1),candidate=rectangle({x:rx,y:ry,width:rw,height:rh,hasWalls:!0},{sprite:"FLOOR"});rooms.some((function(room){return rect2=candidate,(rect1=room).x1<=rect2.x2&&rect1.x2>=rect2.x1&&rect1.y1<=rect2.y2&&rect1.y2>=rect2.y1;var rect1,rect2}))||(rooms.push(candidate),roomTiles=dungeon_objectSpread(dungeon_objectSpread({},roomTiles),candidate.tiles))})),(0,lodash.each)(roomTiles,(function(val,key){dungeon.dTiles[key].tags.push("ROOM"),dungeon.dTiles[key].tags.push("FLOOR")}));for(var passageTiles,prevRoom=null,_i=0,_rooms=rooms;_i<_rooms.length;_i++){var room=_rooms[_i];if(prevRoom){var prev=prevRoom.center,curr=room.center;passageTiles=dungeon_objectSpread(dungeon_objectSpread(dungeon_objectSpread({},passageTiles),digHorizontalPassage(prev.x,curr.x,curr.y)),digVerticalPassage(prev.y,curr.y,prev.x))}prevRoom=room}dungeon.rooms=rooms,dungeon.tiles=dungeon_objectSpread(dungeon_objectSpread(dungeon_objectSpread({},dungeon.tiles),roomTiles),passageTiles);var addPerimeterTags=function(cell){var posid="".concat(cell.x,",").concat(cell.y);dungeon.dTiles[posid]&&(dungeon.dTiles[posid].tags.push("WALL"),dungeon.dTiles[posid].tags.push("PERIMETER"))};return(0,lodash.each)(rooms,(function(room){var sw={x:room.x1,y:room.y2-1},se={x:room.x2-1,y:room.y2-1},nw={x:room.x1,y:room.y1},ne={x:room.x2-1,y:room.y1};line(nw,ne).forEach(addPerimeterTags),line(ne,se).forEach(addPerimeterTags),line(se,sw).forEach(addPerimeterTags),line(sw,nw).forEach(addPerimeterTags)})),(0,lodash.each)(passageTiles,(function(val,key){dungeon.dTiles[key].tags.push("PASSAGE")})),dungeon}({x:0,y:0,z,width:grid_grid.map.width,height:grid_grid.map.height}),wallEntities=[],floorEntities=[];Object.values(dungeon.tiles).forEach((function(tile){if("WALL"===tile.sprite){var x=tile.x,y=tile.y,wallEntity=world.createPrefab("Wall",{position:{x,y,z}});wallEntities.push(wallEntity)}if("FLOOR"===tile.sprite){var _x=tile.x,_y=tile.y,floorEntity=world.createPrefab("Floor",{position:{x:_x,y:_y,z}});floorEntities.push(floorEntity)}})),wallEntities.forEach((function(entity){getNeighborEntities({x:entity.position.x,y:entity.position.y}).some((function(ent){return!!ent&&ent.has(Discoverable)}))&&entity.add(Discoverable)})),dungeon.rooms.forEach((function(room){var x1=room.x1,x2=room.x2,y1=room.y1,y2=room.y2;[{x:x1+1,y:y1+1},{x:x2-2,y:y1+1},{x:x1+1,y:y2-2},{x:x2-2,y:y2-2}].forEach((function(pos){var roll=lodash_default().random(0,10),x=pos.x,y=pos.y;roll>5?world.createPrefab("Brazier",{position:{x,y,z}}):world.createPrefab("Lockpick",{position:{x,y,z}})}))}));var maybeDoorTiles=lodash_default().filter(dungeon.dTiles,(function(val){return val.tags.includes("PASSAGE")&&val.tags.includes("PERIMETER")})),maybeDoorTilePosids=lodash_default().keyBy(maybeDoorTiles,(function(tile){return"".concat(tile.x,",").concat(tile.y)}));return maybeDoorTiles.forEach((function(tile){var pos="".concat(tile.x,",").concat(tile.y),neids=getNeighborIds(pos).map((function(neid){var coords=neid.split(",");return"".concat(coords[0],",").concat(coords[1])}));!lodash_default().some(neids,(function(posid){return maybeDoorTilePosids[posid]}))&&world.createPrefab("Door",{position:{x:tile.x,y:tile.y,z}})})),lodash_default().times(10,(function(){var cellOrPosid,entities,candidate=lodash_default().sample(floorEntities);if(cellOrPosid=candidate.position,entities=getEntitiesAt(cellOrPosid),!find(entities,(function(ent){return ent.impassable}))){var goblin=world.createPrefab("Goblin");goblin.fireEvent("update-position",candidate.position);var lockpick=world.createPrefab("Lockpick");goblin.fireEvent("try-equip",{entity:lockpick,slot:"leftHand"})}})),dungeon},state=(onLoaded=function(){var mapId;initUi(),mapId="0,0,0",setState((function(state){state.maps[mapId]=lodash_default().times(grid_grid.map.height,(function(i){return[]}))}));var hero=world.createPrefab("Player"),dungeon=generateDungeonFloor({world});hero.fireEvent("update-position",dungeon.rooms[0].center),function(entities){var graph=[],_grid$map=grid_grid.map,width=_grid$map.width,height=_grid$map.height;(0,lodash.times)(height,(function(){return graph.push(new Array(width).fill(1))})),entities.forEach((function(entity){var _entity$position=entity.position,x=_entity$position.x,y=_entity$position.y;entity.impassable||(graph[y][x]=0)})),setState((function(state){state.astarGrids[state.currentMapId]=graph}))}(positionQuery.get()),lightingSystem(),fovSystem(),ambianceSystem(),renderSystem();var fps=0,now=null,fpsSamples=[];(function gameLoop(){requestAnimationFrame(gameLoop),getState().userInput&&"PLAYER"===getState().turn&&(setState((function(state){state.tick=state.tick+1})),userInputSystem(),lightingSystem(),fovSystem(),ambianceSystem(),function(){var _playerEnt$equipmentS,_playerEnt$equipmentS2;if("INTERACTING"===getState().mode){var playerEnt=pcQuery.get()[0],cursorPos=getState().cursor,eAtPos=getEntitiesAt(cursorPos),stack=lodash_default().orderBy(interacting_system_toConsumableArray(eAtPos),(function(entity){return entity.zIndex.z}),"desc"),entity=stack[0],evtInteractions=entity.fireEvent("get-interactions",{interactor:playerEnt,interactions:[]}),applyEvts=[];playerEnt.inventory&&playerEnt.inventory.contentIds.forEach((function(eid){var ent=world.getEntity(eid),evtApplications=ent.fireEvent("get-applications",{interactor:ent,interactions:[],interactee:entity});evtApplications&&applyEvts.push(evtApplications)}));var meleeEvts=[],primaryWeaponId=(null==playerEnt||null===(_playerEnt$equipmentS=playerEnt.equipmentSlot)||void 0===_playerEnt$equipmentS||null===(_playerEnt$equipmentS2=_playerEnt$equipmentS.leftHand)||void 0===_playerEnt$equipmentS2?void 0:_playerEnt$equipmentS2.contentId)||null;if(primaryWeaponId){var evtMelees=getEntity(primaryWeaponId).fireEvent("get-melee-interactions",{interactions:[],interactee:entity,interactor:playerEnt});evtMelees&&meleeEvts.push(evtMelees)}setState((function(state){state.interactions.interact=evtInteractions.data.interactions,state.interactions.apply=lodash_default().flatMap(applyEvts,(function(e){return e.data.interactions})),state.interactions.melee=lodash_default().flatMap(meleeEvts,(function(e){return e.data.interactions}))}))}else setState((function(state){state.interactions={interact:[],melee:[],apply:[]}}))}(),getState().logsToProcess.forEach((function(log){if(log.evt){var interactor=log.evt.data.interactor;if(!interactor)return!1;var interactee=log.evt.data.interactee||log.source,name=_.get(log,"evt.data.interaction.name")||log.evt.name,subject=interactor.display.simple,verb=name.toLowerCase(),object=interactee.display.simple.toLowerCase();addLog("Player"===subject?[{str:"You ".concat(verb," the ").concat(object)}]:[{str:"".concat(subject," ").concat(verb,"s the ").concat(object)}])}else addLog(log.log)})),setState((function(state){return state.logsToProcess=[]})),coronerSystem(),renderSystem(),setState((function(state){return state.turn="WORLD"}))),"WORLD"===getState().turn&&(aiQuery.get().forEach((function(ent){ent.fireEvent("take-action")})),coronerSystem(),renderSystem(),setState((function(state){return state.turn="PLAYER"}))),now||(now=Date.now()),Date.now()-now>1e3&&(fpsSamples.unshift(fps),fpsSamples.length>3&&fpsSamples.pop(),isNaN(getState().fps)||printRow({container:"fps",str:"FPS: ".concat(getState().fps)}),now=Date.now(),fps=0),setState((function(state){return state.fps=Math.round(lodash_default().mean(fpsSamples))})),fps++})(),"GAME_OVER"!==state.mode&&document.addEventListener("keydown",(function(ev){setState((function(state){state.userInput=ev}))}))},loader.add("static/fonts/menlo-bold.json").add("static/fonts/menlo-bold-half.json").add("tile","static/tile.png").load(onLoaded),{adventureLog:[{log:[{str:"Welcome to Skrimshank"}],tick:0},{log:[{str:"*********************"}],tick:0},{log:[{str:"Your adventure begins"}],tick:0}],ambiance:[],astarGrids:{},currentMapId:"0,0,0",cursor:{x:0,y:0},fps:0,interactions:{interact:[],melee:[],apply:[]},inventoryIndex:0,legendPositions:[],legendPositionsIndex:0,logsToProcess:[],maps:{"0,0,0":[]},mode:"GAME",recalcLighting:!1,rerender:new Set,tick:0,turn:"PLAYER",userInput:"",z:0});window.st8=state,window.wrld=world;var setState=function(callback){callback(state)},getState=function(){return state}})()})();
//# sourceMappingURL=main.a4ce334cb254b52f5b8e.js.map